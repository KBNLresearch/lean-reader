import"./style-CTr4gFod.js";const Si="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='Inherit'%3e%3cpath%20d='m%20758.36716,-480%20-480,480%20v%20-960%20z'%20/%3e%3c/svg%3e",uh="data:image/svg+xml,%3csvg%20width='24px'%20height='24px'%20fill='inherit'%20version='1.1'%20viewBox='0%20-960%20960%20960'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m128.91-105.12h291.8l4.4416-742.36h-291.8zm434.07%200h290.32l4.4416-742.36h-290.32z'%20/%3e%3c/svg%3e",De=class gt{constructor(e){if(typeof e=="string"){if(!gt.VALID_MODES.has(e.toLowerCase()))return;this.value=e.toLowerCase()}else{const t=e.filter(r=>gt.VALID_MODES.has(r.toLowerCase()));if(t.length===0)return;this.value=Array.from(new Set(t))}}static deserialize(e){if(!e)return;if(typeof e=="string")return new gt(e);if(!Array.isArray(e))return;const t=e.filter(r=>r?gt.VALID_MODES.has(r.toLowerCase()):!1);if(t.length!==0)return new gt(t)}serialize(){return this.value}};De.VALID_MODES=new Set(["auditory","tactile","textual","visual"]),De.AUDITORY=new De("auditory"),De.TACTILE=new De("tactile"),De.TEXTUAL=new De("textual"),De.VISUAL=new De("visual");class Sn{constructor(e){this.algorithm=e.algorithm,this.compression=e.compression,this.originalLength=e.originalLength,this.profile=e.profile,this.scheme=e.scheme}static deserialize(e){if(e&&e.algorithm)return new Sn({algorithm:e.algorithm,compression:e.compression,originalLength:e.originalLength,profile:e.profile,scheme:e.scheme})}serialize(){const e={algorithm:this.algorithm};return this.compression!==void 0&&(e.compression=this.compression),this.originalLength!==void 0&&(e.originalLength=this.originalLength),this.profile!==void 0&&(e.profile=this.profile),this.scheme!==void 0&&(e.scheme=this.scheme),e}}let Ae=class zr{constructor(e){this.otherProperties=e}get page(){return this.otherProperties.page}static deserialize(e){if(e)return new zr(e)}serialize(){return this.otherProperties}add(e){const t=Object.assign({},this.otherProperties);for(const r in e)t[r]=e[r];return new zr(t)}};Object.defineProperty(Ae.prototype,"encryption",{get:function(){return Sn.deserialize(this.otherProperties.encrypted)}});function dh(i){return i&&Array.isArray(i)?i:void 0}function Go(i){return i&&typeof i=="string"?[i]:dh(i)}function ls(i){return typeof i=="string"?new Date(i):void 0}function Ei(i){return isNaN(i)?void 0:i}function he(i){return Ei(i)!==void 0&&Math.sign(i)>=0?i:void 0}function ph(i){const e=new Array;return i.forEach(t=>e.push(t)),e}class b{constructor(e){let t,r,n=e.mediaType.replace(/\s/g,"").split(";");const s=n[0].split("/");if(s.length===2){if(t=s[0].toLowerCase().trim(),r=s[1].toLowerCase().trim(),t.length===0||r.length===0)throw new Error("Invalid media type")}else throw new Error("Invalid media type");const o={};for(let f=1;f<n.length;f++){const g=n[f].split("=");if(g.length===2){const d=g[0].toLocaleLowerCase(),m=d==="charset"?g[1].toUpperCase():g[1];o[d]=m}}const a={},h=Object.keys(o);h.sort((f,g)=>f.localeCompare(g)),h.forEach(f=>a[f]=o[f]);let l="";for(const f in a){const g=a[f];l+=`;${f}=${g}`}const u=`${t}/${r}${l}`,c=a.encoding;this.string=u,this.type=t,this.subtype=r,this.parameters=a,this.encoding=c,this.name=e.name,this.fileExtension=e.fileExtension}static parse(e){return new b(e)}get structuredSyntaxSuffix(){const e=this.subtype.split("+");return e.length>1?`+${e[e.length-1]}`:void 0}get charset(){return this.parameters.charset}contains(e){const t=typeof e=="string"?b.parse({mediaType:e}):e;if(!((this.type==="*"||this.type===t.type)&&(this.subtype==="*"||this.subtype===t.subtype)))return!1;const r=new Set(Object.entries(this.parameters).map(([s,o])=>`${s}=${o}`)),n=new Set(Object.entries(t.parameters).map(([s,o])=>`${s}=${o}`));for(const s of Array.from(r.values()))if(!n.has(s))return!1;return!0}matches(e){const t=typeof e=="string"?b.parse({mediaType:e}):e;return this.contains(t)||t.contains(this)}matchesAny(...e){for(const t of e)if(this.matches(t))return!0;return!1}equals(e){return this.string===e.string}get isZIP(){return this.matchesAny(b.ZIP,b.LCP_PROTECTED_AUDIOBOOK,b.LCP_PROTECTED_PDF)||this.structuredSyntaxSuffix==="+zip"}get isJSON(){return this.matchesAny(b.JSON)||this.structuredSyntaxSuffix==="+json"}get isOPDS(){return this.matchesAny(b.OPDS1,b.OPDS1_ENTRY,b.OPDS2,b.OPDS2_PUBLICATION,b.OPDS_AUTHENTICATION)||this.structuredSyntaxSuffix==="+json"}get isHTML(){return this.matchesAny(b.HTML,b.XHTML)}get isBitmap(){return this.matchesAny(b.BMP,b.GIF,b.JPEG,b.PNG,b.TIFF,b.WEBP)}get isAudio(){return this.type==="audio"}get isVideo(){return this.type==="video"}get isRWPM(){return this.matchesAny(b.READIUM_AUDIOBOOK_MANIFEST,b.DIVINA_MANIFEST,b.READIUM_WEBPUB_MANIFEST)}get isPublication(){return this.matchesAny(b.READIUM_AUDIOBOOK,b.READIUM_AUDIOBOOK_MANIFEST,b.CBZ,b.DIVINA,b.DIVINA_MANIFEST,b.EPUB,b.LCP_PROTECTED_AUDIOBOOK,b.LCP_PROTECTED_PDF,b.LPF,b.PDF,b.W3C_WPUB_MANIFEST,b.READIUM_WEBPUB,b.READIUM_WEBPUB_MANIFEST,b.ZAB)}static get AAC(){return b.parse({mediaType:"audio/aac",fileExtension:"aac"})}static get ACSM(){return b.parse({mediaType:"application/vnd.adobe.adept+xml",name:"Adobe Content Server Message",fileExtension:"acsm"})}static get AIFF(){return b.parse({mediaType:"audio/aiff",fileExtension:"aiff"})}static get AVI(){return b.parse({mediaType:"video/x-msvideo",fileExtension:"avi"})}static get BINARY(){return b.parse({mediaType:"application/octet-stream"})}static get BMP(){return b.parse({mediaType:"image/bmp",fileExtension:"bmp"})}static get CBZ(){return b.parse({mediaType:"application/vnd.comicbook+zip",name:"Comic Book Archive",fileExtension:"cbz"})}static get CSS(){return b.parse({mediaType:"text/css",fileExtension:"css"})}static get DIVINA(){return b.parse({mediaType:"application/divina+zip",name:"Digital Visual Narratives",fileExtension:"divina"})}static get DIVINA_MANIFEST(){return b.parse({mediaType:"application/divina+json",name:"Digital Visual Narratives",fileExtension:"json"})}static get EPUB(){return b.parse({mediaType:"application/epub+zip",name:"EPUB",fileExtension:"epub"})}static get GIF(){return b.parse({mediaType:"image/gif",fileExtension:"gif"})}static get GZ(){return b.parse({mediaType:"application/gzip",fileExtension:"gz"})}static get HTML(){return b.parse({mediaType:"text/html",fileExtension:"html"})}static get JAVASCRIPT(){return b.parse({mediaType:"text/javascript",fileExtension:"js"})}static get JPEG(){return b.parse({mediaType:"image/jpeg",fileExtension:"jpeg"})}static get JSON(){return b.parse({mediaType:"application/json"})}static get LCP_LICENSE_DOCUMENT(){return b.parse({mediaType:"application/vnd.readium.lcp.license.v1.0+json",name:"LCP License",fileExtension:"lcpl"})}static get LCP_PROTECTED_AUDIOBOOK(){return b.parse({mediaType:"application/audiobook+lcp",name:"LCP Protected Audiobook",fileExtension:"lcpa"})}static get LCP_PROTECTED_PDF(){return b.parse({mediaType:"application/pdf+lcp",name:"LCP Protected PDF",fileExtension:"lcpdf"})}static get LCP_STATUS_DOCUMENT(){return b.parse({mediaType:"application/vnd.readium.license.status.v1.0+json"})}static get LPF(){return b.parse({mediaType:"application/lpf+zip",fileExtension:"lpf"})}static get MP3(){return b.parse({mediaType:"audio/mpeg",fileExtension:"mp3"})}static get MPEG(){return b.parse({mediaType:"video/mpeg",fileExtension:"mpeg"})}static get NCX(){return b.parse({mediaType:"application/x-dtbncx+xml",fileExtension:"ncx"})}static get OGG(){return b.parse({mediaType:"audio/ogg",fileExtension:"oga"})}static get OGV(){return b.parse({mediaType:"video/ogg",fileExtension:"ogv"})}static get OPDS1(){return b.parse({mediaType:"application/atom+xml;profile=opds-catalog"})}static get OPDS1_ENTRY(){return b.parse({mediaType:"application/atom+xml;type=entry;profile=opds-catalog"})}static get OPDS2(){return b.parse({mediaType:"application/opds+json"})}static get OPDS2_PUBLICATION(){return b.parse({mediaType:"application/opds-publication+json"})}static get OPDS_AUTHENTICATION(){return b.parse({mediaType:"application/opds-authentication+json"})}static get OPUS(){return b.parse({mediaType:"audio/opus",fileExtension:"opus"})}static get OTF(){return b.parse({mediaType:"font/otf",fileExtension:"otf"})}static get PDF(){return b.parse({mediaType:"application/pdf",name:"PDF",fileExtension:"pdf"})}static get PNG(){return b.parse({mediaType:"image/png",fileExtension:"png"})}static get READIUM_AUDIOBOOK(){return b.parse({mediaType:"application/audiobook+zip",name:"Readium Audiobook",fileExtension:"audiobook"})}static get READIUM_AUDIOBOOK_MANIFEST(){return b.parse({mediaType:"application/audiobook+json",name:"Readium Audiobook",fileExtension:"json"})}static get READIUM_CONTENT_DOCUMENT(){return b.parse({mediaType:"application/vnd.readium.content+json",name:"Readium Content Document",fileExtension:"json"})}static get READIUM_GUIDED_NAVIGATION_DOCUMENT(){return b.parse({mediaType:"application/guided-navigation+json",name:"Readium Guided Navigation Document",fileExtension:"json"})}static get READIUM_POSITION_LIST(){return b.parse({mediaType:"application/vnd.readium.position-list+json",name:"Readium Position List",fileExtension:"json"})}static get READIUM_WEBPUB(){return b.parse({mediaType:"application/webpub+zip",name:"Readium Web Publication",fileExtension:"webpub"})}static get READIUM_WEBPUB_MANIFEST(){return b.parse({mediaType:"application/webpub+json",name:"Readium Web Publication",fileExtension:"json"})}static get SMIL(){return b.parse({mediaType:"application/smil+xml",fileExtension:"smil"})}static get SVG(){return b.parse({mediaType:"image/svg+xml",fileExtension:"svg"})}static get TEXT(){return b.parse({mediaType:"text/plain",fileExtension:"txt"})}static get TIFF(){return b.parse({mediaType:"image/tiff",fileExtension:"tiff"})}static get TTF(){return b.parse({mediaType:"font/ttf",fileExtension:"ttf"})}static get W3C_WPUB_MANIFEST(){return b.parse({mediaType:"application/x.readium.w3c.wpub+json",name:"Web Publication",fileExtension:"json"})}static get WAV(){return b.parse({mediaType:"audio/wav",fileExtension:"wav"})}static get WEBM_AUDIO(){return b.parse({mediaType:"audio/webm",fileExtension:"webm"})}static get WEBM_VIDEO(){return b.parse({mediaType:"video/webm",fileExtension:"webm"})}static get WEBP(){return b.parse({mediaType:"image/webp",fileExtension:"webp"})}static get WOFF(){return b.parse({mediaType:"font/woff",fileExtension:"woff"})}static get WOFF2(){return b.parse({mediaType:"font/woff2",fileExtension:"woff2"})}static get XHTML(){return b.parse({mediaType:"application/xhtml+xml",fileExtension:"xhtml"})}static get XML(){return b.parse({mediaType:"application/xml",fileExtension:"xml"})}static get ZAB(){return b.parse({mediaType:"application/x.readium.zab+zip",name:"Zipped Audio Book",fileExtension:"zab"})}static get ZIP(){return b.parse({mediaType:"application/zip",fileExtension:"zip"})}}let hs=class{constructor(e){this.uri=e,this.parameters=this.getParameters(e)}getParameters(e){const t=/\{\??([^}]+)\}/g,r=e.match(t);return r?new Set(r.join(",").replace(t,"$1").split(",").map(n=>n.trim())):new Set}expand(e){const t=n=>n.split(",").map(s=>{const o=e[s];return o?encodeURIComponent(o):""}).join(","),r=n=>"?"+n.split(",").map(s=>{const o=s.split("=")[0],a=e[o];return a?`${o}=${encodeURIComponent(a)}`:""}).join("&");return this.uri.replace(/\{(\??)([^}]+)\}/g,(...n)=>n[1]?r(n[2]):t(n[2]))}},ie=class Xo{constructor(e){this.fragments=e.fragments?e.fragments:new Array,this.progression=e.progression,this.totalProgression=e.totalProgression,this.position=e.position,this.otherLocations=e.otherLocations}static deserialize(e){if(!e)return;const t=Ei(e.progression),r=Ei(e.totalProgression),n=Ei(e.position),s=new Map,o=new Set(["fragment","fragments","progression","totalProgression","position"]);return Object.entries(e).forEach(([a,h])=>{o.has(a)||s.set(a,h)}),new Xo({fragments:Go(e.fragments||e.fragment),progression:t!==void 0&&t>=0&&t<=1?t:void 0,totalProgression:r!==void 0&&r>=0&&r<=1?r:void 0,position:n!==void 0&&n>0?n:void 0,otherLocations:s.size===0?void 0:s})}serialize(){const e={};return this.fragments&&(e.fragments=this.fragments),this.progression!==void 0&&(e.progression=this.progression),this.totalProgression!==void 0&&(e.totalProgression=this.totalProgression),this.position!==void 0&&(e.position=this.position),this.otherLocations&&this.otherLocations.forEach((t,r)=>e[r]=t),e}},ri=class Yo{constructor(e){this.after=e.after,this.before=e.before,this.highlight=e.highlight}static deserialize(e){if(e)return new Yo({after:e.after,before:e.before,highlight:e.highlight})}serialize(){const e={};return this.after!==void 0&&(e.after=this.after),this.before!==void 0&&(e.before=this.before),this.highlight!==void 0&&(e.highlight=this.highlight),e}},kt=class kr{constructor(e){this.href=e.href,this.type=e.type,this.title=e.title,this.locations=e.locations?e.locations:new ie({}),this.text=e.text}static deserialize(e){if(e&&e.href&&e.type)return new kr({href:e.href,type:e.type,title:e.title,locations:ie.deserialize(e.locations),text:ri.deserialize(e.text)})}serialize(){const e={href:this.href,type:this.type};return this.title!==void 0&&(e.title=this.title),this.locations&&(e.locations=this.locations.serialize()),this.text&&(e.text=this.text.serialize()),e}copyWithLocations(e){return new kr({href:this.href,type:this.type,title:this.title,text:this.text,locations:new ie({...this.locations,...e})})}},Jo=class xi{constructor(e){this.href=e.href,this.templated=e.templated,this.type=e.type,this.title=e.title,this.rels=e.rels,this.properties=e.properties,this.height=e.height,this.width=e.width,this.size=e.size,this.duration=e.duration,this.bitrate=e.bitrate,this.languages=e.languages,this.alternates=e.alternates,this.children=e.children}static deserialize(e){if(!(!e||typeof e.href!="string"))return new xi({href:e.href,templated:e.templated,type:e.type,title:e.title,rels:e.rel?Array.isArray(e.rel)?new Set(e.rel):new Set([e.rel]):void 0,properties:Ae.deserialize(e.properties),height:he(e.height),width:he(e.width),size:he(e.size),duration:he(e.duration),bitrate:he(e.bitrate),languages:Go(e.language),alternates:cs.deserialize(e.alternate),children:cs.deserialize(e.children)})}serialize(){const e={href:this.href};return this.templated!==void 0&&(e.templated=this.templated),this.type!==void 0&&(e.type=this.type),this.title!==void 0&&(e.title=this.title),this.rels&&(e.rel=ph(this.rels)),this.properties&&(e.properties=this.properties.serialize()),this.height!==void 0&&(e.height=this.height),this.width!==void 0&&(e.width=this.width),this.size!==void 0&&(e.size=this.size),this.duration!==void 0&&(e.duration=this.duration),this.bitrate!==void 0&&(e.bitrate=this.bitrate),this.languages&&(e.language=this.languages),this.alternates&&(e.alternate=this.alternates.serialize()),this.children&&(e.children=this.children.serialize()),e}get mediaType(){return this.type!==void 0?b.parse({mediaType:this.type}):b.BINARY}toURL(e){const t=this.href.replace(/^(\/)/,"");if(t.length===0)return;let r=e||"/";return r.startsWith("/")&&(r="file://"+r),new URL(t,r).href.replace(/^(file:\/\/)/,"")}get templateParameters(){return this.templated?new hs(this.href).parameters:new Set}expandTemplate(e){return new xi({href:new hs(this.href).expand(e),templated:!1})}addProperties(e){const t=xi.deserialize(this.serialize());return t.properties=t.properties?t.properties?.add(e):new Ae(e),t}get locator(){let e=this.href.split("#");return new kt({href:e.length>0&&e[0]!==void 0?e[0]:this.href,type:this.type??"",title:this.title,locations:new ie({fragments:e.length>1&&e[1]!==void 0?[e[1]]:[]})})}},cs=class Ko{constructor(e){this.items=e}static deserialize(e){if(e&&Array.isArray(e))return new Ko(e.map(t=>Jo.deserialize(t)).filter(t=>t!==void 0))}serialize(){return this.items.map(e=>e.serialize())}findWithRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.find(t)}filterByRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.filter(t)}findWithHref(e){const t=r=>r.href===e;return this.items.find(t)}findIndexWithHref(e){const t=r=>r.href===e;return this.items.findIndex(t)}findWithMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.find(t)}filterByMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.filter(t)}filterByMediaTypes(e){const t=r=>{for(const n of e)if(r.mediaType.matches(n))return!0;return!1};return this.items.filter(t)}everyIsAudio(){const e=t=>t.mediaType.isAudio;return this.items.length>0&&this.items.every(e)}everyIsBitmap(){const e=t=>t.mediaType.isBitmap;return this.items.length>0&&this.items.every(e)}everyIsHTML(){const e=t=>t.mediaType.isHTML;return this.items.length>0&&this.items.every(e)}everyIsVideo(){const e=t=>t.mediaType.isVideo;return this.items.length>0&&this.items.every(e)}everyMatchesMediaType(e){return Array.isArray(e)?this.items.length>0&&this.items.every(t=>{for(const r of e)return t.mediaType.matches(r);return!1}):this.items.length>0&&this.items.every(t=>t.mediaType.matches(e))}filterLinksHasType(){return this.items.filter(e=>e.type)}};Ae.prototype.getContains=function(){return new Set(this.otherProperties.contains||[])};let us=class Zo{constructor(e){this.cssSelector=e.cssSelector,this.textNodeIndex=e.textNodeIndex,this.charOffset=e.charOffset}static deserialize(e){if(!(e&&e.cssSelector))return;let t=he(e.textNodeIndex);if(t===void 0)return;let r=he(e.charOffset);return r===void 0&&(r=he(e.offset)),new Zo({cssSelector:e.cssSelector,textNodeIndex:t,charOffset:r})}serialize(){const e={cssSelector:this.cssSelector,textNodeIndex:this.textNodeIndex};return this.charOffset!==void 0&&(e.charOffset=this.charOffset),e}},fh=class Qo{constructor(e){this.start=e.start,this.end=e.end}static deserialize(e){if(!e)return;let t=us.deserialize(e.start);if(t)return new Qo({start:t,end:us.deserialize(e.end)})}serialize(){const e={start:this.start.serialize()};return this.end&&(e.end=this.end.serialize()),e}};ie.prototype.getCssSelector=function(){return this.otherLocations?.get("cssSelector")};ie.prototype.getPartialCfi=function(){return this.otherLocations?.get("partialCfi")};ie.prototype.getDomRange=function(){return fh.deserialize(this.otherLocations?.get("domRange"))};ie.prototype.fragmentParameters=function(){return new Map(this.fragments.map(i=>i.startsWith("#")?i.slice(1):i).join("&").split("&").filter(i=>!i.startsWith("#")).map(i=>i.split("=")).filter(i=>i.length===2).map(i=>[i[0].trim().toLowerCase(),i[1].trim()]))};ie.prototype.htmlId=function(){if(!this.fragments.length)return;let i=this.fragments.find(e=>e.length&&!e.includes("="));if(!i){const e=this.fragmentParameters();e.has("id")?i=e.get("id"):e.has("name")&&(i=e.get("name"))}return i?.startsWith("#")?i.slice(1):i};ie.prototype.page=function(){const i=parseInt(this.fragmentParameters().get("page"));if(!isNaN(i)&&i>=0)return i};ie.prototype.time=function(){const i=parseInt(this.fragmentParameters().get("t"));if(!isNaN(i))return i};ie.prototype.space=function(){const i=this.fragmentParameters();if(!i.has("xywh"))return;const e=i.get("xywh").split(",").map(t=>parseInt(t));if(e.length===4&&!e.some(isNaN))return e};let gh=class ea{constructor(e){this.currency=e.currency,this.value=e.value}static deserialize(e){if(!e)return;let t=e.currency;if(!(t&&typeof t=="string"&&t.length>0))return;let r=he(e.value);if(r!==void 0)return new ea({currency:t,value:r})}serialize(){return{currency:this.currency,value:this.value}}};class Xt{constructor(e){this.type=e.type,this.children=e.children}static deserialize(e){if(e&&e.type)return new Xt({type:e.type,children:Xt.deserializeArray(e.children)})}static deserializeArray(e){if(Array.isArray(e))return e.map(t=>Xt.deserialize(t)).filter(t=>t!==void 0)}serialize(){const e={type:this.type};return this.children&&(e.children=this.children.map(t=>t.serialize())),e}}let mh=class ta{constructor(e){this.total=e.total,this.position=e.position}static deserialize(e){if(e)return new ta({total:he(e.total),position:he(e.position)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.position!==void 0&&(e.position=this.position),e}};class En{constructor(e){this.total=e.total,this.available=e.available}static deserialize(e){if(e)return new En({total:he(e.total),available:he(e.available)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.available!==void 0&&(e.available=this.available),e}}let yh=class ia{constructor(e){this.state=e.state,this.since=e.since,this.until=e.until}static deserialize(e){if(e&&e.state)return new ia({state:e.state,since:ls(e.since),until:ls(e.until)})}serialize(){const e={state:this.state};return this.since!==void 0&&(e.since=this.since.toISOString()),this.until!==void 0&&(e.until=this.until.toISOString()),e}};Ae.prototype.getNumberOfItems=function(){return he(this.otherProperties.numberOfItems)};Ae.prototype.getPrice=function(){return gh.deserialize(this.otherProperties.price)};Ae.prototype.getIndirectAcquisitions=function(){const i=this.otherProperties.indirectAcquisition;if(i&&Array.isArray(i))return i.map(e=>Xt.deserialize(e)).filter(e=>e!==void 0)};Ae.prototype.getHolds=function(){return mh.deserialize(this.otherProperties.holds)};Ae.prototype.getCopies=function(){return En.deserialize(this.otherProperties.copies)};Ae.prototype.getAvailability=function(){return yh.deserialize(this.otherProperties.availability)};Ae.prototype.getAuthenticate=function(){return Jo.deserialize(this.otherProperties.authenticate)};const bh="CssSelectorGenerator";function ds(i="unknown problem",...e){console.warn(`${bh}: ${i}`,...e)}function vh(i){return i instanceof RegExp}function wh(i){return i.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".+")}function Sh(i){const e=i.map(t=>{if(vh(t))return r=>t.test(r);if(typeof t=="function")return r=>{const n=t(r);return typeof n!="boolean"?(ds("pattern matcher function invalid","Provided pattern matching function does not return boolean. It's result will be ignored.",t),!1):n};if(typeof t=="string"){const r=new RegExp("^"+wh(t)+"$");return n=>r.test(n)}return ds("pattern matcher invalid","Pattern matching only accepts strings, regular expressions and/or functions. This item is invalid and will be ignored.",t),()=>!1});return t=>e.some(r=>r(t))}Sh(["class","id","ng-*"]);let ni=class{};function ps(i){return i.split("").reverse().join("")}function Eh(i,e,t){const r=ps(e);return t.map(n=>{const s=Math.max(0,n.end-e.length-n.errors),o=ps(i.slice(s,n.end));return{start:ra(o,r,n.errors).reduce((a,h)=>n.end-h.end<a?n.end-h.end:a,n.end),end:n.end,errors:n.errors}})}function dr(i){return(i|-i)>>31&1}function fs(i,e,t,r){let n=i.P[t],s=i.M[t];const o=r>>>31,a=e[t]|o,h=a|s,l=(a&n)+n^n|a;let u=s|~(l|n),c=n&l;const f=dr(u&i.lastRowMask[t])-dr(c&i.lastRowMask[t]);return u<<=1,c<<=1,c|=o,u|=dr(r)-o,n=c|~(h|u),s=u&h,i.P[t]=n,i.M[t]=s,f}function ra(i,e,t){if(e.length===0)return[];t=Math.min(t,e.length);const r=[],n=32,s=Math.ceil(e.length/n)-1,o={P:new Uint32Array(s+1),M:new Uint32Array(s+1),lastRowMask:new Uint32Array(s+1)};o.lastRowMask.fill(1<<31),o.lastRowMask[s]=1<<(e.length-1)%n;const a=new Uint32Array(s+1),h=new Map,l=[];for(let f=0;f<256;f++)l.push(a);for(let f=0;f<e.length;f+=1){const g=e.charCodeAt(f);if(h.has(g))continue;const d=new Uint32Array(s+1);h.set(g,d),g<l.length&&(l[g]=d);for(let m=0;m<=s;m+=1){d[m]=0;for(let y=0;y<n;y+=1){const x=m*n+y;x>=e.length||e.charCodeAt(x)===g&&(d[m]|=1<<y)}}}let u=Math.max(0,Math.ceil(t/n)-1);const c=new Uint32Array(s+1);for(let f=0;f<=u;f+=1)c[f]=(f+1)*n;c[s]=e.length;for(let f=0;f<=u;f+=1)o.P[f]=-1,o.M[f]=0;for(let f=0;f<i.length;f+=1){const g=i.charCodeAt(f);let d;g<l.length?d=l[g]:(d=h.get(g),typeof d>"u"&&(d=a));let m=0;for(let y=0;y<=u;y+=1)m=fs(o,d,y,m),c[y]+=m;if(c[u]-m<=t&&u<s&&(d[u+1]&1||m<0)){u+=1,o.P[u]=-1,o.M[u]=0;let y;if(u===s){const x=e.length%n;y=x===0?n:x}else y=n;c[u]=c[u-1]+y-m+fs(o,d,u,m)}else for(;u>0&&c[u]>=t+n;)u-=1;u===s&&c[u]<=t&&(c[u]<t&&r.splice(0,r.length),r.push({start:-1,end:f+1,errors:c[u]}),t=c[u])}return r}function xh(i,e,t){const r=ra(i,e,t);return Eh(i,e,r)}function na(i,e,t){let r=0;const n=[];for(;r!==-1;)r=i.indexOf(e,r),r!==-1&&(n.push({start:r,end:r+e.length,errors:0}),r+=1);return n.length>0?n:xh(i,e,t)}function gs(i,e){return e.length===0||i.length===0?0:1-na(i,e,e.length)[0].errors/e.length}function Th(i,e,t={}){if(e.length===0)return null;const r=Math.min(256,e.length/2),n=na(i,e,r);if(n.length===0)return null;const s=a=>{const h=1-a.errors/e.length,l=t.prefix?gs(i.slice(Math.max(0,a.start-t.prefix.length),a.start),t.prefix):1,u=t.suffix?gs(i.slice(a.end,a.end+t.suffix.length),t.suffix):1;let c=1;return typeof t.hint=="number"&&(c=1-Math.abs(a.start-t.hint)/i.length),(50*h+20*l+20*u+2*c)/92},o=n.map(a=>({start:a.start,end:a.end,score:s(a)}));return o.sort((a,h)=>h.score-a.score),o[0]}function Mr(i,e,t){const r=t===1?e:e-1;if(i.charAt(r).trim()!=="")return e;let n,s;if(t===2?(n=i.substring(0,e),s=n.trimEnd()):(n=i.substring(e),s=n.trimStart()),!s.length)return-1;const o=n.length-s.length;return t===2?e-o:e+o}function ms(i,e){const t=i.commonAncestorContainer.ownerDocument.createNodeIterator(i.commonAncestorContainer,NodeFilter.SHOW_TEXT),r=e===1?i.startContainer:i.endContainer,n=e===1?i.endContainer:i.startContainer;let s=t.nextNode();for(;s&&s!==r;)s=t.nextNode();e===2&&(s=t.previousNode());let o=-1;const a=()=>{if(s=e===1?t.nextNode():t.previousNode(),s){const h=s.textContent,l=e===1?0:h.length;o=Mr(h,l,e)}};for(;s&&o===-1&&s!==n;)a();if(s&&o>=0)return{node:s,offset:o};throw new RangeError("No text nodes with non-whitespace text found in range")}function Ah(i){if(!i.toString().trim().length)throw new RangeError("Range contains no non-whitespace text");if(i.startContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range startContainer is not a text node");if(i.endContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range endContainer is not a text node");const e=i.cloneRange();let t=!1,r=!1;const n={start:Mr(i.startContainer.textContent,i.startOffset,1),end:Mr(i.endContainer.textContent,i.endOffset,2)};if(n.start>=0&&(e.setStart(i.startContainer,n.start),t=!0),n.end>0&&(e.setEnd(i.endContainer,n.end),r=!0),t&&r)return e;if(!t){const{node:s,offset:o}=ms(e,1);s&&o>=0&&e.setStart(s,o)}if(!r){const{node:s,offset:o}=ms(e,2);s&&o>0&&e.setEnd(s,o)}return e}function sa(i){switch(i.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:return i.textContent?.length??0;default:return 0}}function ys(i){let e=i.previousSibling,t=0;for(;e;)t+=sa(e),e=e.previousSibling;return t}function oa(i,...e){let t=e.shift();const r=i.ownerDocument.createNodeIterator(i,NodeFilter.SHOW_TEXT),n=[];let s=r.nextNode(),o,a=0;for(;t!==void 0&&s;)o=s,a+o.data.length>t?(n.push({node:o,offset:t-a}),t=e.shift()):(s=r.nextNode(),a+=o.data.length);for(;t!==void 0&&o&&a===t;)n.push({node:o,offset:o.data.length}),t=e.shift();if(t!==void 0)throw new RangeError("Offset exceeds text length");return n}let ci=class mt{constructor(e,t){if(t<0)throw new Error("Offset is invalid");this.element=e,this.offset=t}relativeTo(e){if(!e.contains(this.element))throw new Error("Parent is not an ancestor of current element");let t=this.element,r=this.offset;for(;t!==e;)r+=ys(t),t=t.parentElement;return new mt(t,r)}resolve(e={}){try{return oa(this.element,this.offset)[0]}catch(t){if(this.offset===0&&e.direction!==void 0){const r=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);r.currentNode=this.element;const n=e.direction===1,s=n?r.nextNode():r.previousNode();if(!s)throw t;return{node:s,offset:n?0:s.data.length}}else throw t}}static fromCharOffset(e,t){switch(e.nodeType){case Node.TEXT_NODE:return mt.fromPoint(e,t);case Node.ELEMENT_NODE:return new mt(e,t);default:throw new Error("Node is not an element or text node")}}static fromPoint(e,t){switch(e.nodeType){case Node.TEXT_NODE:{if(t<0||t>e.data.length)throw new Error("Text node offset is out of range");if(!e.parentElement)throw new Error("Text node has no parent");const r=ys(e)+t;return new mt(e.parentElement,r)}case Node.ELEMENT_NODE:{if(t<0||t>e.childNodes.length)throw new Error("Child node offset is out of range");let r=0;for(let n=0;n<t;n++)r+=sa(e.childNodes[n]);return new mt(e,r)}default:throw new Error("Point is not in an element or text node")}}},Dr=class Ht{constructor(e,t){this.start=e,this.end=t}relativeTo(e){return new Ht(this.start.relativeTo(e),this.end.relativeTo(e))}toRange(){let e,t;this.start.element===this.end.element&&this.start.offset<=this.end.offset?[e,t]=oa(this.start.element,this.start.offset,this.end.offset):(e=this.start.resolve({direction:1}),t=this.end.resolve({direction:2}));const r=new Range;return r.setStart(e.node,e.offset),r.setEnd(t.node,t.offset),r}static fromRange(e){const t=ci.fromPoint(e.startContainer,e.startOffset),r=ci.fromPoint(e.endContainer,e.endOffset);return new Ht(t,r)}static fromOffsets(e,t,r){return new Ht(new ci(e,t),new ci(e,r))}static trimmedRange(e){return Ah(Ht.fromRange(e).toRange())}},Ch=class Fr{constructor(e,t,r){this.root=e,this.start=t,this.end=r}static fromRange(e,t){const r=Dr.fromRange(t).relativeTo(e);return new Fr(e,r.start.offset,r.end.offset)}static fromSelector(e,t){return new Fr(e,t.start,t.end)}toSelector(){return{type:"TextPositionSelector",start:this.start,end:this.end}}toRange(){return Dr.fromOffsets(this.root,this.start,this.end).toRange()}},Ph=class Ur{constructor(e,t,r={}){this.root=e,this.exact=t,this.context=r}static fromRange(e,t){const r=e.textContent,n=Dr.fromRange(t).relativeTo(e),s=n.start.offset,o=n.end.offset,a=32;return new Ur(e,r.slice(s,o),{prefix:r.slice(Math.max(0,s-a),s),suffix:r.slice(o,Math.min(r.length,o+a))})}static fromSelector(e,t){const{prefix:r,suffix:n}=t;return new Ur(e,t.exact,{prefix:r,suffix:n})}toSelector(){return{type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}}toRange(e={}){return this.toPositionAnchor(e).toRange()}toPositionAnchor(e={}){const t=this.root.textContent,r=Th(t,this.exact,{...this.context,hint:e.hint});if(!r)throw new Error("Quote not found");return new Ch(this.root,r.start,r.end)}};function _h(i){const e=i.tagName.toUpperCase();return e==="IMG"||e==="VIDEO"||e==="AUDIO"||e==="IFRAME"||e==="OBJECT"||e==="EMBED"||e==="CANVAS"}function nr(i,e){try{const t=e.locations,r=e.text;if(r&&r.highlight){let n;t&&t.getCssSelector()&&(n=i.querySelector(t.getCssSelector())),n||(n=i.body);const s=new Ph(n,r.highlight,{prefix:r.before,suffix:r.after});try{return s.toRange()}catch{return console.warn("Quote not found:",s),null}}if(t){let n=null;if(!n&&t.getCssSelector()&&(n=i.querySelector(t.getCssSelector())),!n&&t.fragments){for(const s of t.fragments)if(n=i.getElementById(s),n)break}if(n){const s=i.createRange();return n.childNodes.length===0||_h(n)?(s.selectNode(n),s):(s.setStartBefore(n),s.setEndAfter(n),s)}}}catch(t){console.error(t)}return null}function Oh(i,e){let t=i.getClientRects();t.length||i.commonAncestorContainer.nodeType===Node.ELEMENT_NODE&&(t=i.commonAncestorContainer.getClientRects());const r=1,n=[];for(const l of t)n.push({bottom:l.bottom,height:l.height,left:l.left,right:l.right,top:l.top,width:l.width});const s=aa(n,r),o=Lh(s,r),a=la(o),h=4;for(let l=a.length-1;l>=0;l--){const u=a[l];if(!(u.width*u.height>h))if(a.length>1)a.splice(l,1);else break}return a}function aa(i,e,t){for(let r=0;r<i.length;r++)for(let n=r+1;n<i.length;n++){const s=i[r],o=i[n];if(s===o)continue;const a=we(s.top,o.top,e)&&we(s.bottom,o.bottom,e),h=we(s.left,o.left,e)&&we(s.right,o.right,e);if(a&&!h&&ha(s,o,e)){const l=i.filter(c=>c!==s&&c!==o),u=Rh(s,o);return l.push(u),aa(l,e)}}return i}function Rh(i,e){const t=Math.min(i.left,e.left),r=Math.max(i.right,e.right),n=Math.min(i.top,e.top),s=Math.max(i.bottom,e.bottom);return{bottom:s,height:s-n,left:t,right:r,top:n,width:r-t}}function Lh(i,e){const t=new Set(i);for(const r of i){if(!(r.width>1&&r.height>1)){t.delete(r);continue}for(const n of i)if(r!==n&&t.has(n)&&Ih(n,r,e)){t.delete(r);break}}return Array.from(t)}function Ih(i,e,t){return ui(i,e.left,e.top,t)&&ui(i,e.right,e.top,t)&&ui(i,e.left,e.bottom,t)&&ui(i,e.right,e.bottom,t)}function ui(i,e,t,r){return(i.left<e||we(i.left,e,r))&&(i.right>e||we(i.right,e,r))&&(i.top<t||we(i.top,t,r))&&(i.bottom>t||we(i.bottom,t,r))}function la(i){for(let e=0;e<i.length;e++)for(let t=e+1;t<i.length;t++){const r=i[e],n=i[t];if(r!==n&&ha(r,n,-1)){let s=[],o;const a=bs(r,n);if(a.length===1)s=a,o=r;else{const l=bs(n,r);a.length<l.length?(s=a,o=r):(s=l,o=n)}const h=i.filter(l=>l!==o);return Array.prototype.push.apply(h,s),la(h)}}return i}function bs(i,e){const t=Nh(e,i);if(t.height===0||t.width===0)return[i];const r=[];{const n={bottom:i.bottom,height:0,left:i.left,right:t.left,top:i.top,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}{const n={bottom:t.top,height:0,left:t.left,right:t.right,top:i.top,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}{const n={bottom:i.bottom,height:0,left:t.left,right:t.right,top:t.bottom,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}{const n={bottom:i.bottom,height:0,left:t.right,right:i.right,top:i.top,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}return r}function Nh(i,e){const t=Math.max(i.left,e.left),r=Math.min(i.right,e.right),n=Math.max(i.top,e.top),s=Math.min(i.bottom,e.bottom);return{bottom:s,height:Math.max(0,s-n),left:t,right:r,top:n,width:Math.max(0,r-t)}}function ha(i,e,t){return(i.left<e.right||t>=0&&we(i.left,e.right,t))&&(e.left<i.right||t>=0&&we(e.left,i.right,t))&&(i.top<e.bottom||t>=0&&we(i.top,e.bottom,t))&&(e.top<i.bottom||t>=0&&we(e.top,i.bottom,t))}function we(i,e,t){return Math.abs(i-e)<=t}function ca(i){const e={},t=i.document.documentElement.style;for(const r in i.document.documentElement.style)Object.hasOwn(t,r)&&!Number.isNaN(Number.parseInt(r))&&(e[t[r]]=t.getPropertyValue(t[r]));return e}function zh(i,e){const t=ca(i);Object.keys(t).forEach(r=>{e.hasOwnProperty(r)||xn(i,r)}),Object.entries(e).forEach(([r,n])=>{t[r]!==n&&ki(i,r,n)})}function vs(i,e){return i.document.documentElement.style.getPropertyValue(e)}function ki(i,e,t){i.document.documentElement.style.setProperty(e,t)}function xn(i,e){i.document.documentElement.style.removeProperty(e)}const kh=i=>{if(i.startsWith("rgb")){const e=i.match(/rgb\((\d+),\s(\d+),\s(\d+)(?:,\s(\d+))?\)/);if(e)return{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10),a:e[4]?parseInt(e[4],10)/255:1}}else if(i.startsWith("#")){const e=i.slice(1);if(e.length===3||e.length===4)return{r:parseInt(e[0]+e[0],16)/255,g:parseInt(e[1]+e[1],16)/255,b:parseInt(e[2]+e[2],16)/255,a:e.length===4?parseInt(e[3]+e[3],16)/255:1};if(e.length===6||e.length===8)return{r:parseInt(e[0]+e[1],16)/255,g:parseInt(e[2]+e[3],16)/255,b:parseInt(e[4]+e[5],16)/255,a:e.length===8?parseInt(e[6]+e[7],16)/255:1}}return{r:0,g:0,b:0,a:1}},Mh=i=>.2126*i.r*i.a+.7152*i.g*i.a+.0722*i.b*i.a,Dh=i=>{const e=kh(i);return Mh(e)<128},Fh=()=>"Highlight"in window,ws=["IMG","IMAGE","AUDIO","VIDEO","SVG"];let Uh=class{constructor(e,t,r,n){this.wnd=e,this.comms=t,this.id=r,this.name=n,this.items=[],this.lastItemId=0,this.container=void 0,this.activateable=!1,this.experimentalHighlights=!1,this.currentRender=0,Fh()&&(this.experimentalHighlights=!0,this.notTextFlag=new Map)}get activeable(){return this.activateable}set activeable(e){this.activateable=e}add(e){const t=`${this.id}-${this.lastItemId++}`,r=nr(this.wnd.document,e.locator);if(!r){this.comms.log("Can't locate DOM range for decoration",e);return}const n=r.commonAncestorContainer;n.nodeType!==Node.TEXT_NODE&&this.experimentalHighlights&&(ws.includes(n.nodeName.toUpperCase())&&this.notTextFlag?.set(t,!0),n.querySelector(ws.join(", ").toLowerCase())&&this.notTextFlag?.set(t,!0),(n.textContent?.trim()||"").length===0&&this.notTextFlag?.set(t,!0));const s={decoration:e,id:t,range:r};this.items.push(s),this.layout(s),this.renderLayout([s])}remove(e){const t=this.items.findIndex(n=>n.decoration.id===e);if(t<0)return;const r=this.items[t];this.items.splice(t,1),r.clickableElements=void 0,r.container&&(r.container.remove(),r.container=void 0),this.experimentalHighlights&&!this.notTextFlag?.has(r.id)&&this.wnd.CSS.highlights.get(this.id)?.delete(r.range),this.notTextFlag?.delete(r.id)}update(e){this.remove(e.id),this.add(e)}clear(){this.clearContainer(),this.items.length=0,this.notTextFlag?.clear()}requestLayout(){this.wnd.cancelAnimationFrame(this.currentRender),this.clearContainer(),this.items.forEach(e=>this.layout(e)),this.renderLayout(this.items)}experimentalLayout(e){const[t,r]=this.requireContainer(!0);r.add(e.range),t.innerHTML=`
        ::highlight(${this.id}) {
            color: black;
            background-color: ${e.decoration?.style?.tint??"yellow"};
        }`}layout(e){if(this.experimentalHighlights&&!this.notTextFlag?.has(e.id))return this.experimentalLayout(e);const t=this.wnd.document.createElement("div");t.setAttribute("id",e.id),t.style.setProperty("pointer-events","none");const r=this.wnd.innerWidth,n=parseInt(getComputedStyle(this.wnd.document.documentElement).getPropertyValue("column-count")),s=r/(n||1),o=this.wnd.document.scrollingElement,a=o.scrollLeft,h=o.scrollTop,l=(d,m,y)=>{if(d.style.position="absolute",e.decoration?.style?.width==="viewport"){d.style.width=`${r}px`,d.style.height=`${m.height}px`;let x=Math.floor(m.left/r)*r;d.style.left=`${x+a}px`,d.style.top=`${m.top+h}px`}else if(e.decoration?.style?.width==="bounds")d.style.width=`${y.width}px`,d.style.height=`${m.height}px`,d.style.left=`${y.left+a}px`,d.style.top=`${m.top+h}px`;else if(e.decoration?.style?.width==="page"){d.style.width=`${s}px`,d.style.height=`${m.height}px`;let x=Math.floor(m.left/s)*s;d.style.left=`${x+a}px`,d.style.top=`${m.top+h}px`}else d.style.width=`${m.width}px`,d.style.height=`${m.height}px`,d.style.left=`${m.left+a}px`,d.style.top=`${m.top+h}px`},u=e.range.getBoundingClientRect();let c=this.wnd.document.createElement("template");const f=vs(this.wnd,"--USER__appearance")==="readium-night-on"||Dh(vs(this.wnd,"--USER__backgroundColor"));c.innerHTML=`
        <div
            class="r2-highlight-0"
            style="${[`background-color: ${e.decoration?.style?.tint??"yellow"} !important`,`mix-blend-mode: ${f?"exclusion":"multiply"} !important`,"opacity: 1 !important","box-sizing: border-box !important"].join("; ")}"
        >
        </div>
        `.trim();const g=c.content.firstElementChild;if(e.decoration?.style?.layout==="bounds"){const d=g.cloneNode(!0);d.style.setProperty("pointer-events","none"),l(d,u,u),t.append(d)}else{let d=Oh(e.range);d=d.sort((m,y)=>m.top<y.top?-1:m.top>y.top?1:0);for(let m of d){const y=g.cloneNode(!0);y.style.setProperty("pointer-events","none"),l(y,m,u),t.append(y)}}e.container=t,e.clickableElements=Array.from(t.querySelectorAll("[data-activable='1']")),e.clickableElements.length||(e.clickableElements=Array.from(t.children))}renderLayout(e){this.wnd.cancelAnimationFrame(this.currentRender),this.currentRender=this.wnd.requestAnimationFrame(()=>{e=e.filter(t=>!this.experimentalHighlights||!!this.notTextFlag?.has(t.id)),!(!e||e.length===0)&&this.requireContainer().append(...e.map(t=>t.container).filter(t=>!!t))})}requireContainer(e=!1){if(e){let t;this.wnd.document.getElementById(`${this.id}-style`)?t=this.wnd.document.getElementById(`${this.id}-style`):(t=this.wnd.document.createElement("style"),t.dataset.readium="true",t.id=`${this.id}-style`,this.wnd.document.head.appendChild(t));let r;return this.wnd.CSS.highlights.has(this.id)?r=this.wnd.CSS.highlights.get(this.id):(r=new this.wnd.Highlight,this.wnd.CSS.highlights.set(this.id,r)),[t,r]}return this.container||(this.container=this.wnd.document.createElement("div"),this.container.setAttribute("id",this.id),this.container.dataset.group=this.name,this.container.dataset.readium="true",this.container.style.setProperty("pointer-events","none"),this.container.style.display="contents",this.wnd.document.body.append(this.container)),this.container}clearContainer(){this.experimentalHighlights&&this.wnd.CSS.highlights.delete(this.id),this.container&&(this.container.remove(),this.container=void 0)}};const ua=class Wr extends ni{constructor(){super(...arguments),this.resizeFrame=0,this.lastGroupId=0,this.groups=new Map,this.handleResizer=this.handleResize.bind(this)}cleanup(){this.groups.forEach(e=>e.clear()),this.groups.clear()}handleResize(){this.wnd.clearTimeout(this.resizeFrame),this.resizeFrame=this.wnd.setTimeout(()=>{this.groups.forEach(e=>{e.experimentalHighlights||e.requestLayout()})},50)}mount(e,t){return this.wnd=e,t.register("decorate",Wr.moduleName,(r,n)=>{const s=r;s.decoration&&s.decoration.locator&&(s.decoration.locator=kt.deserialize(s.decoration.locator)),this.groups.has(s.group)||this.groups.set(s.group,new Uh(e,t,`readium-decoration-${this.lastGroupId++}`,s.group));const o=this.groups.get(s.group);switch(s.action){case"add":o?.add(s.decoration);break;case"remove":o?.remove(s.decoration.id);break;case"clear":o?.clear();break;case"update":o?.update(s.decoration);break}n(!0)}),this.resizeObserver=new ResizeObserver(()=>e.requestAnimationFrame(()=>this.handleResize())),this.resizeObserver.observe(e.document.body),e.addEventListener("orientationchange",this.handleResizer),e.addEventListener("resize",this.handleResizer),t.log("Decorator Mounted"),!0}unmount(e,t){return e.removeEventListener("orientationchange",this.handleResizer),e.removeEventListener("resize",this.handleResizer),t.unregisterAll(Wr.moduleName),this.resizeObserver.disconnect(),this.cleanup(),t.log("Decorator Unmounted"),!0}};ua.moduleName="decorator";let Wh=ua;const Ss="readium-snapper-style",da=class Br extends ni{constructor(){super(...arguments),this.protected=!1}buildStyles(){return`
        html, body {
            touch-action: manipulation;
            user-select: ${this.protected?"none":"auto"};
        }`}mount(e,t){const r=e.document.createElement("style");return r.dataset.readium="true",r.id=Ss,r.textContent=this.buildStyles(),e.document.head.appendChild(r),t.register("protect",Br.moduleName,(n,s)=>{this.protected=!0,r.textContent=this.buildStyles(),s(!0)}),t.register("unprotect",Br.moduleName,(n,s)=>{this.protected=!1,r.textContent=this.buildStyles(),s(!0)}),t.log("Snapper Mounted"),!0}unmount(e,t){return e.document.getElementById(Ss)?.remove(),t.log("Snapper Unmounted"),!0}};da.moduleName="snapper";let Tn=da;function Ze(i){return i.document.body.dir.toLowerCase()==="rtl"}function pa(i){return parseInt(i.getComputedStyle(i.document.documentElement).getPropertyValue("column-count"))}function Bh(i){const e=getComputedStyle(i),t=parseFloat(e.paddingTop||"0"),r=parseFloat(e.paddingBottom||"0");return i.clientHeight-t-r}function Es(i){const e=pa(i);if(!e)return!1;const t=i.document.querySelectorAll("div[id^='readium-virtual-page']");for(const h of t)h.remove();const r=t.length,n=i.document.scrollingElement.scrollWidth,s=i.visualViewport.width,o=Math.round(n/s*e)%e,a=e===1||o===0?0:e-o;if(a>0)for(let h=0;h<a;h++){const l=i.document.createElement("div");l.setAttribute("id",`readium-virtual-page-${h}`),l.dataset.readium="true",CSS.supports("break-before","column")?l.style.breakBefore="column":(CSS.supports("break-inside","avoid-column")&&(l.style.breakInside="avoid-column"),l.style.height=Bh(i.document.documentElement)+"px"),l.innerHTML="&#8203;",i.document.body.appendChild(l)}return r!==a}function fa(i){const e=i.document.createElement("style");e.appendChild(i.document.createTextNode("*{}")),i.document.body.appendChild(e),i.document.body.removeChild(e)}function $h(i){return i<.5?2*i*i:-1+(4-2*i)*i}function Y(i){const e=i.getSelection();e&&e.removeAllRanges()}const Hh=["a","audio","button","canvas","details","input","label","option","select","submit","textarea","video"];function ga(i){return Hh.indexOf(i.nodeName.toLowerCase())!==-1||i.hasAttribute("contenteditable")&&i.getAttribute("contenteditable")?.toLowerCase()!=="false"?i:i.parentElement?ga(i.parentElement):null}function An(i,e){const t=ma(i,i.document.body,e),r=i._readium_cssSelectorGenerator.getCssSelector(t,{selectors:["tag","id","class","nthchild","nthoftype","attribute"]});return new kt({href:"#",type:"application/xhtml+xml",locations:new ie({otherLocations:new Map([["cssSelector",r]])}),text:new ri({highlight:t.textContent||void 0})})}function ma(i,e,t){for(var r=0;r<e.children.length;r++){const n=e.children[r];if(!Vh(n)&&jh(i,n,t))return qh(i,n)?n:ma(i,n,t)}return e}function jh(i,e,t){if(e===document.body||e===document.documentElement)return!0;if(!document||!document.documentElement||!document.body)return!1;const r=e.getBoundingClientRect();return t?r.bottom>0&&r.top<i.innerHeight:r.right>0&&r.left<i.innerWidth}function qh(i,e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=i.innerHeight&&t.right<=i.innerWidth}function Vh(i){const e=getComputedStyle(i);if(e){const t=e.getPropertyValue("display");if(t!="block"&&t!="list-item"||e.getPropertyValue("opacity")==="0")return!0}return!1}const xs="readium-column-snapper-style",Gh=200,ya=class de extends Tn{constructor(){super(...arguments),this.shakeTimeout=0,this.snappingCancelled=!1,this.alreadyScrollLeft=0,this.overscroll=0,this.cachedScrollWidth=0,this.touchState=0,this.startingX=void 0,this.endingX=void 0,this.onTouchStarter=this.onTouchStart.bind(this),this.onTouchEnder=this.onTouchEnd.bind(this),this.onWidthChanger=this.onWidthChange.bind(this),this.onTouchMover=this.onTouchMove.bind(this)}doc(){return this.wnd.document.scrollingElement}scrollOffset(){return this.doc().scrollLeft>0?this.doc().scrollLeft:this.alreadyScrollLeft}snapOffset(e){const t=e+(Ze(this.wnd)?-1:1);return t-t%this.wnd.innerWidth}reportProgress(){const e=this.wnd.scrollX,t=this.cachedScrollWidth,r=Math.max(0,Math.min(1,e/t)),n=Math.max(0,Math.min(1,(e+this.wnd.innerWidth)/t));this.comms.send("progress",{start:r,end:n})}shake(){if(this.overscroll!==0||this.shakeTimeout!==0)return;const e=this.doc();e.classList.add(Ze(this.wnd)?"readium-bounce-l":"readium-bounce-r");const t=this.scrollOffset();this.shakeTimeout=this.wnd.setTimeout(()=>{e.classList.remove("readium-bounce-l"),e.classList.remove("readium-bounce-r"),this.shakeTimeout=0,this.doc().scrollLeft=t},150)}takeOverSnap(){this.snappingCancelled=!0,this.clearTouches();const e=this.doc();this.overscroll=e.style.transform?.length>12?parseFloat(e.style.transform.slice(12).split("px")[0]):0}snapCurrentOffset(e=!1,t=!1){const r=this.wnd.scrollX>0?this.wnd.scrollX:this.alreadyScrollLeft,n=this.doc(),s=this.dragOffset(),o=pa(this.wnd),a=Math.min(Math.max(0,r),this.cachedScrollWidth),h=Ze(this.wnd)?-1:1,l=h*(this.wnd.innerWidth/3)*(h*s>0?2:1),u=this.snapOffset(a+l);if(e&&u!==this.scrollOffset()){this.snappingCancelled=!1;const c=(m,y,x,R)=>x>R?y:m+(y-m)*$h(x/R),f=Gh*o;let g;const d=m=>{if(this.snappingCancelled)return;g||(g=m);const y=m-g,x=c(this.overscroll,0,y,f),R=c(r,u,y,f);n.scrollLeft=R,this.overscroll!==0&&(n.style.transform=`translate3d(${-x}px, 0px, 0px)`),y<f?this.wnd.requestAnimationFrame(d):(this.clearTouches(),n.style.removeProperty("transform"),n.scrollLeft=u,t||this.reportProgress())};this.wnd.requestAnimationFrame(d)}else n.style.removeProperty("transform"),this.wnd.requestAnimationFrame(()=>{n.scrollLeft=u,this.clearTouches(),t||this.reportProgress()})}dragOffset(){return(this.startingX??0)-(this.endingX??0)}clearTouches(){this.startingX=void 0,this.endingX=void 0,this.overscroll=0}onTouchStart(e){switch(e.stopPropagation(),this.takeOverSnap(),e.touches.length){case 1:break;case 2:this.onTouchEnd(e);return;default:{this.onTouchEnd(e),this.comms.send("tap_more",e.touches.length);return}}this.startingX=e.touches[0].clientX,this.alreadyScrollLeft=this.doc().scrollLeft,this.touchState=1}onTouchEnd(e){if(this.touchState===2){const t=this.dragOffset(),r=this.scrollOffset();this.cachedScrollWidth<=this.wnd.innerWidth?(this.reportProgress(),t>5&&this.comms.send("no_more",void 0),t<-5&&this.comms.send("no_less",void 0)):r<5&&t<5?(this.alreadyScrollLeft=0,this.comms.send("no_less",void 0)):this.cachedScrollWidth-r-this.wnd.innerWidth<5&&t>5&&(this.alreadyScrollLeft=this.cachedScrollWidth,this.comms.send("no_more",void 0)),this.snapCurrentOffset(!0),this.comms.send("swipe",t)}this.touchState=0}onWidthChange(){this.cachedScrollWidth=this.doc().scrollWidth,this.comms.ready&&this.snapCurrentOffset()}onTouchMove(e){if(this.touchState===0)return;this.touchState===1&&(this.touchState=2,Y(this.wnd)),this.endingX=e.touches[0].clientX;const t=this.dragOffset(),r=this.alreadyScrollLeft+t;r<0?(this.overscroll=r,this.doc().style.transform=`translate3d(${-this.overscroll}px, 0px, 0px)`):r+this.wnd.innerWidth>this.cachedScrollWidth?(this.overscroll=r,this.doc().style.transform=`translate3d(${-r}px, 0px, 0px)`):(this.overscroll=0,this.doc().style.removeProperty("transform"),this.doc().scrollLeft=this.alreadyScrollLeft+t)}mount(e,t){if(this.wnd=e,this.comms=t,!super.mount(e,t))return!1;e.navigator.epubReadingSystem&&(e.navigator.epubReadingSystem.layoutStyle="paginated");const r=e.document.createElement("style");r.dataset.readium="true",r.id=xs,r.textContent=`
        @keyframes readium-bounce-l-animation {
            0%, 100% {transform: translate3d(0, 0, 0);}
            50% {transform: translate3d(-50px, 0, 0);}
        }

        @keyframes readium-bounce-r-animation {
            0%, 100% {transform: translate3d(0, 0, 0);}
            50% {transform: translate3d(50px, 0, 0);}
        }

        .readium-bounce-l {
            animation: readium-bounce-l-animation 150ms ease-out 1;
        }

        .readium-bounce-r {
            animation: readium-bounce-r-animation 150ms ease-out 1;
        }

        html {
            overflow: hidden;
        }

        body {
            -ms-overflow-style: none; /* for Internet Explorer, Edge */
        }

        * {
            scrollbar-width: none; /* for Firefox */
        }
        
        body::-webkit-scrollbar {
            display: none; /* for Chrome, Safari, and Opera */
        }
        `,e.document.head.appendChild(r),this.resizeObserver=new ResizeObserver(()=>{e.requestAnimationFrame(()=>{e&&Es(e)}),this.onWidthChange()}),this.resizeObserver.observe(e.document.body),this.mutationObserver=new MutationObserver(s=>{for(const o of s)if(o.target===this.wnd.document.documentElement){const a=o.oldValue,h=o.target.getAttribute("style"),l=/transform\s*:\s*([^;]+)/,u=a?.match(l),c=h?.match(l);(!u&&!c||u&&!c||u&&c&&u[1]!==c[1])&&(e.requestAnimationFrame(()=>{e&&Es(e)}),this.onWidthChange())}else e.requestAnimationFrame(()=>this.cachedScrollWidth=this.doc().scrollWidth)}),e.frameElement&&this.mutationObserver.observe(e.frameElement,{attributes:!0,attributeFilter:["style"]}),this.mutationObserver.observe(e.document,{attributes:!0,attributeFilter:["style"]}),this.mutationObserver.observe(e.document.documentElement,{attributes:!0,attributeFilter:["style"]});const n=s=>{const o=this.doc().scrollLeft;return this.doc().scrollLeft=this.snapOffset(s),o!==this.doc().scrollLeft};return e.addEventListener("orientationchange",this.onWidthChanger),e.addEventListener("resize",this.onWidthChanger),e.requestAnimationFrame(()=>this.cachedScrollWidth=this.doc().scrollWidth),t.register("go_progression",de.moduleName,(s,o)=>{const a=s;if(a<0||a>1){t.send("error",{message:"go_progression must be given a position from 0.0 to 1.0"}),o(!1);return}this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const h=this.cachedScrollWidth,l=Ze(e)?-1:1,u=h*a*l;this.doc().scrollLeft=this.snapOffset(u),this.reportProgress(),Y(this.wnd),o(!0)})}),t.register("go_id",de.moduleName,(s,o)=>{const a=e.document.getElementById(s);if(!a){o(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollLeft=this.snapOffset(a.getBoundingClientRect().left+e.scrollX),this.reportProgress(),Y(this.wnd),o(!0)})}),t.register("go_text",de.moduleName,(s,o)=>{let a;Array.isArray(s)&&(s.length>1&&(a=s[1]),s=s[0]);const h=ri.deserialize(s),l=nr(this.wnd.document,new kt({href:e.location.href,type:"text/html",text:h,locations:a?new ie({otherLocations:new Map([["cssSelector",a]])}):void 0}));if(!l){o(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollLeft=this.snapOffset(l.getBoundingClientRect().left+e.scrollX),this.reportProgress(),Y(this.wnd),o(!0)})}),t.register("go_end",de.moduleName,(s,o)=>{const a=Ze(e)?-1:1;this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const h=this.cachedScrollWidth*a;if(this.doc().scrollLeft===h)return o(!1);this.doc().scrollLeft=this.snapOffset(h),this.reportProgress(),Y(this.wnd),o(!0)})}),t.register("go_start",de.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{if(this.doc().scrollLeft===0)return o(!1);this.doc().scrollLeft=0,this.reportProgress(),Y(this.wnd),o(!0)})}),t.register("go_prev",de.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const a=e.scrollX-e.innerWidth,h=Ze(e)?-(this.cachedScrollWidth-e.innerWidth):0,l=n(Math.max(a,h));l&&(this.reportProgress(),Y(this.wnd)),o(l)})}),t.register("go_next",de.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const a=e.scrollX+e.innerWidth,h=Ze(e)?0:this.cachedScrollWidth-e.innerWidth,l=n(Math.min(a,h));l&&(this.reportProgress(),Y(this.wnd)),o(l)})}),t.register("unfocus",de.moduleName,(s,o)=>{this.snappingCancelled=!0,Y(this.wnd),o(!0)}),t.register("shake",de.moduleName,(s,o)=>{this.shake(),o(!0)}),t.register("focus",de.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth,this.snapCurrentOffset(!1,!0),this.reportProgress(),o(!0)})}),t.register("first_visible_locator",de.moduleName,(s,o)=>{const a=An(e,!1);this.comms.send("first_visible_locator",a.serialize()),o(!0)}),e.addEventListener("touchstart",this.onTouchStarter,{passive:!0}),e.addEventListener("touchend",this.onTouchEnder,{passive:!0}),e.addEventListener("touchmove",this.onTouchMover,{passive:!0}),e.document.addEventListener("touchstart",()=>{}),t.log("ColumnSnapper Mounted"),!0}unmount(e,t){return this.snappingCancelled=!0,t.unregisterAll(de.moduleName),this.resizeObserver.disconnect(),this.mutationObserver.disconnect(),e.removeEventListener("touchstart",this.onTouchStarter),e.removeEventListener("touchend",this.onTouchEnder),e.removeEventListener("touchmove",this.onTouchMover),e.removeEventListener("orientationchange",this.onWidthChanger),e.removeEventListener("resize",this.onWidthChanger),e.document.getElementById(xs)?.remove(),t.log("ColumnSnapper Unmounted"),super.unmount(e,t)}};ya.moduleName="column_snapper";let Xh=ya;const Ts="readium-scroll-snapper-style",ba=class me extends Tn{constructor(){super(...arguments),this.initialScrollHandled=!1,this.isScrolling=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce=null,this.handleScroll=()=>{if(this.comms.ready&&!this.isResizing){if(!this.initialScrollHandled){this.lastScrollTop=this.doc().scrollTop,this.initialScrollHandled=!0,this.reportProgress();return}this.isScrolling||(this.isScrolling=!0,this.wnd.requestAnimationFrame(()=>{this.reportProgress();const e=this.doc().scrollTop,t=e-this.lastScrollTop;this.lastScrollTop=e,this.comms.send("scroll",t),this.isScrolling=!1}))}}}doc(){return this.wnd.document.scrollingElement}reportProgress(){if(!this.comms.ready)return;const e=Math.ceil(this.doc().scrollTop),t=this.doc().scrollHeight,r=this.wnd.innerHeight,n=Math.max(0,Math.min(1,e/t)),s=Math.max(0,Math.min(1,(e+r)/t));this.comms.send("progress",{start:n,end:s})}mount(e,t){this.wnd=e,this.comms=t,this.initialScrollHandled=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce&&(this.wnd.clearTimeout(this.resizeDebounce),this.resizeDebounce=null),e.navigator.epubReadingSystem&&(e.navigator.epubReadingSystem.layoutStyle="scrolling");const r=e.document.createElement("style");return r.dataset.readium="true",r.id=Ts,r.textContent=`
        * {
            scrollbar-width: none; /* for Firefox */
        }
        
        body::-webkit-scrollbar {
            display: none; /* for Chrome, Safari, and Opera */
        }
        `,e.document.head.appendChild(r),this.resizeObserver=new ResizeObserver(()=>{this.resizeDebounce&&this.wnd.clearTimeout(this.resizeDebounce),this.isResizing=!0,this.resizeDebounce=this.wnd.setTimeout(()=>{this.isResizing=!1,this.resizeDebounce=null,this.reportProgress()},50)}),this.resizeObserver.observe(e.document.body),e.addEventListener("scroll",this.handleScroll,{passive:!0}),t.register("force_webkit_recalc",me.moduleName,()=>{fa(this.wnd);const n=this.doc().scrollTop;n>1?this.doc().scrollTop=n-1:this.doc().scrollTop=n+1,this.doc().scrollTop=n}),t.register("go_progression",me.moduleName,(n,s)=>{const o=n;if(o<0||o>1){t.send("error",{message:"go_progression must be given a position from 0.0 to 1.0"}),s(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=this.doc().offsetHeight*o,this.reportProgress(),Y(this.wnd),s(!0)})}),t.register("go_id",me.moduleName,(n,s)=>{const o=e.document.getElementById(n);if(!o){s(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=o.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),Y(this.wnd),s(!0)})}),t.register("go_text",me.moduleName,(n,s)=>{let o;Array.isArray(n)&&(n.length>1&&(o=n[1]),n=n[0]);const a=ri.deserialize(n),h=nr(this.wnd.document,new kt({href:e.location.href,type:"text/html",text:a,locations:o?new ie({otherLocations:new Map([["cssSelector",o]])}):void 0}));if(!h){s(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=h.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),Y(this.wnd),s(!0)})}),t.register("go_start",me.moduleName,(n,s)=>{if(this.doc().scrollTop===0)return s(!1);this.doc().scrollTop=0,this.reportProgress(),s(!0)}),t.register("go_end",me.moduleName,(n,s)=>{if(this.doc().scrollTop===this.doc().scrollHeight-this.doc().offsetHeight)return s(!1);this.doc().scrollTop=this.doc().scrollHeight-this.doc().offsetHeight,this.reportProgress(),s(!0)}),t.register("unfocus",me.moduleName,(n,s)=>{Y(this.wnd),s(!0)}),t.register(["go_next","go_prev"],me.moduleName,(n,s)=>s(!1)),t.register("focus",me.moduleName,(n,s)=>{this.reportProgress(),s(!0)}),t.register("first_visible_locator",me.moduleName,(n,s)=>{const o=An(e,!0);this.comms.send("first_visible_locator",o.serialize()),s(!0)}),t.log("ScrollSnapper Mounted"),!0}unmount(e,t){return t.unregisterAll(me.moduleName),this.resizeObserver.disconnect(),this.handleScroll&&e.removeEventListener("scroll",this.handleScroll),e.document.getElementById(Ts)?.remove(),t.log("ScrollSnapper Unmounted"),!0}};ba.moduleName="scroll_snapper";let Yh=ba;const va=class ye extends Tn{constructor(){super(...arguments),this.initialScrollHandled=!1,this.isScrolling=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce=null,this.handleScroll=()=>{if(this.comms.ready&&!this.isResizing){if(!this.initialScrollHandled){this.lastScrollTop=this.doc().scrollTop,this.initialScrollHandled=!0,this.reportProgress();return}this.isScrolling||(this.isScrolling=!0,this.wnd.requestAnimationFrame(()=>{this.reportProgress();const e=this.doc().scrollTop,t=e-this.lastScrollTop;this.lastScrollTop=e,this.comms.send("scroll",t),this.isScrolling=!1}))}}}doc(){return this.wnd.document.scrollingElement}reportProgress(){if(!this.comms.ready)return;const e=Math.ceil(this.doc().scrollTop),t=this.doc().scrollHeight,r=this.wnd.innerHeight,n=Math.max(0,Math.min(1,e/t)),s=Math.max(0,Math.min(1,(e+r)/t));this.comms.send("progress",{start:n,end:s})}mount(e,t){return this.wnd=e,this.comms=t,this.initialScrollHandled=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce&&(this.wnd.clearTimeout(this.resizeDebounce),this.resizeDebounce=null),this.resizeObserver=new ResizeObserver(()=>{this.resizeDebounce&&this.wnd.clearTimeout(this.resizeDebounce),this.isResizing=!0,this.resizeDebounce=this.wnd.setTimeout(()=>{this.isResizing=!1,this.resizeDebounce=null,this.reportProgress()},50)}),this.resizeObserver.observe(e.document.body),e.addEventListener("scroll",this.handleScroll,{passive:!0}),t.register("force_webkit_recalc",ye.moduleName,()=>{fa(this.wnd);const r=this.doc().scrollTop;r>1?this.doc().scrollTop=r-1:this.doc().scrollTop=r+1,this.doc().scrollTop=r}),t.register("go_progression",ye.moduleName,(r,n)=>{const s=r;if(s<0||s>1){t.send("error",{message:"go_progression must be given a position from 0.0 to 1.0"}),n(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=this.doc().offsetHeight*s,this.reportProgress(),Y(this.wnd),n(!0)})}),this.comms.register("go_id",ye.moduleName,(r,n)=>{const s=e.document.getElementById(r);if(!s){n(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=s.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),Y(this.wnd),n(!0)})}),t.register("go_text",ye.moduleName,(r,n)=>{let s;Array.isArray(r)&&(r.length>1&&(s=r[1]),r=r[0]);const o=ri.deserialize(r),a=nr(this.wnd.document,new kt({href:e.location.href,type:"text/html",text:o,locations:s?new ie({otherLocations:new Map([["cssSelector",s]])}):void 0}));if(!a){n(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=a.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),Y(this.wnd),n(!0)})}),t.register("go_start",ye.moduleName,(r,n)=>{if(this.doc().scrollTop===0)return n(!1);this.doc().scrollTop=0,this.reportProgress(),n(!0)}),t.register("go_end",ye.moduleName,(r,n)=>{if(this.doc().scrollTop===this.doc().scrollHeight-this.doc().offsetHeight)return n(!1);this.doc().scrollTop=this.doc().scrollHeight-this.doc().offsetHeight,this.reportProgress(),n(!0)}),t.register("unfocus",ye.moduleName,(r,n)=>{Y(this.wnd),n(!0)}),t.register(["go_next","go_prev"],ye.moduleName,(r,n)=>n(!1)),t.register("focus",ye.moduleName,(r,n)=>{this.reportProgress(),n(!0)}),t.register("first_visible_locator",ye.moduleName,(r,n)=>{const s=An(e,!0);t.send("first_visible_locator",s.serialize()),n(!0)}),t.log("WebPubSnapper Mounted"),!0}unmount(e,t){return t.unregisterAll(ye.moduleName),this.resizeObserver.disconnect(),this.handleScroll&&e.removeEventListener("scroll",this.handleScroll),t.log("WebPubSnapper Unmounted"),!0}};va.moduleName="webpub_snapper";let Jh=va;const wa=class extends ni{constructor(){super(...arguments),this.pointerMoved=!1,this.onPointerUp=this.onPointUp.bind(this),this.onPointerMove=this.onPointMove.bind(this),this.onPointerDown=this.onPointDown.bind(this),this.onContextMenu=this.onContext.bind(this),this.onClicker=this.onClick.bind(this)}onPointUp(e){const t=this.wnd.getSelection();if(t&&t.toString()?.length>0){const n=t.getRangeAt(0)?.getClientRects();if(!n||n.length===0)return;const s=n[0],o={text:t.toString(),x:s.x,y:s.y,width:s.width,height:s.height,targetFrameSrc:this.wnd?.location?.href};this.comms.send("text_selected",o)}if(this.pointerMoved){this.pointerMoved=!1;return}if(!t?.isCollapsed||!e.isPrimary)return;const r=this.wnd.devicePixelRatio;e.preventDefault(),this.comms.send(e.pointerType==="touch"?"tap":"click",{defaultPrevented:e.defaultPrevented,x:e.clientX*r,y:e.clientY*r,targetFrameSrc:this.wnd.location.href,targetElement:e.target.outerHTML,interactiveElement:ga(e.target)?.outerHTML,cssSelector:this.wnd._readium_cssSelectorGenerator.getCssSelector(e.target)}),this.pointerMoved=!1}onPointMove(e){if(e.movementY!==void 0&&e.movementX!==void 0){(Math.abs(e.movementX)>1||Math.abs(e.movementY)>1)&&(this.pointerMoved=!0);return}this.pointerMoved=!0}onPointDown(){this.pointerMoved=!1}onContext(e){this.onPointUp(e),this.pointerMoved=!1}onClick(e){if(e.preventDefault(),!e.isTrusted){const t=new PointerEvent("pointerup",{isPrimary:!0,pointerType:"mouse",clientX:e.clientX,clientY:e.clientY});Object.defineProperty(t,"target",{writable:!1,value:e.target}),Object.defineProperty(t,"defaultPrevented",{writable:!1,value:e.defaultPrevented}),this.onPointUp(t)}}mount(e,t){return this.wnd=e,this.comms=t,e.document.addEventListener("pointerdown",this.onPointerDown),e.document.addEventListener("pointerup",this.onPointerUp),e.document.addEventListener("contextmenu",this.onContextMenu),e.document.addEventListener("pointermove",this.onPointerMove),e.document.addEventListener("click",this.onClicker),t.log("Peripherals Mounted"),!0}unmount(e,t){return e.document.removeEventListener("pointerdown",this.onPointerDown),e.document.removeEventListener("pointerup",this.onPointerUp),e.document.removeEventListener("contextmenu",this.onContextMenu),e.document.removeEventListener("pointermove",this.onPointerMove),e.document.removeEventListener("click",this.onClicker),t.log("Peripherals Unmounted"),!0}};wa.moduleName="peripherals";let Kh=wa;const Sa=class $r extends ni{constructor(){super(...arguments),this.mediaPlayingCount=0,this.allAnimations=new Set}wndOnErr(e){this.comms?.send("error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno})}unblock(e){for(e._readium_blockEvents=!1;e._readium_blockedEvents?.length>0;){const t=e._readium_blockedEvents.shift();switch(t[0]){case 0:Reflect.apply(t[1],t[2],t[3]);break;case 1:const r=t[1],n=t[2];e.removeEventListener(r.type,e._readium_eventBlocker,!0);const s=new Event(r.type,{bubbles:r.bubbles,cancelable:r.cancelable});n?n.dispatchEvent(s):e.dispatchEvent(s);break}}}onMediaPlayEvent(){this.mediaPlayingCount++,this.comms?.send("media_play",this.mediaPlayingCount)}onMediaPauseEvent(){this.mediaPlayingCount>0&&this.mediaPlayingCount--,this.comms?.send("media_pause",this.mediaPlayingCount)}pauseAllMedia(e){const t=e.document.querySelectorAll("audio,video");for(let r=0;r<t.length;r++)t[r].pause()}mount(e,t){this.comms=t,e.addEventListener("error",this.wndOnErr,!1),Reflect.defineProperty(e.navigator,"epubReadingSystem",{value:{name:"readium-ts-toolkit",version:"2.2.0",hasFeature:(n,s="")=>{switch(n){case"dom-manipulation":return!0;case"layout-changes":return!0;case"touch-events":return!0;case"mouse-events":return!0;case"keyboard-events":return!0;case"spine-scripting":return!0;case"embedded-web-content":return!0;default:return!1}}},writable:!1}),"getAnimations"in e.document&&e.document.getAnimations().forEach(n=>{n.cancel(),this.allAnimations.add(n)}),t.register("activate",$r.moduleName,(n,s)=>{this.allAnimations.forEach(o=>{o.cancel(),o.play()}),s(!0)}),t.register("unfocus",$r.moduleName,(n,s)=>{this.pauseAllMedia(e),this.allAnimations.forEach(o=>o.pause()),s(!0)});const r=e.document.querySelectorAll("audio,video");for(let n=0;n<r.length;n++){const s=r[n];s.addEventListener("play",this.onMediaPlayEvent,{passive:!0}),s.addEventListener("pause",this.onMediaPauseEvent,{passive:!0})}return t.log("Setup Mounted"),!0}unmount(e,t){return e.removeEventListener("error",this.wndOnErr),e.removeEventListener("play",this.onMediaPlayEvent),e.removeEventListener("pause",this.onMediaPauseEvent),this.allAnimations.forEach(r=>r.cancel()),this.allAnimations.clear(),t.log("Setup Unmounted"),!0}};Sa.moduleName="setup";let Ea=Sa;const As="readium-viewport",xa=class et extends Ea{onViewportWidthChanged(e){const t=e.target;ki(t,"--RS__viewportWidth",`${t.innerWidth}px`)}mount(e,t){if(!super.mount(e,t))return!1;const r=e.document.createElement("meta");return r.dataset.readium="true",r.setAttribute("name","viewport"),r.setAttribute("id",As),r.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no"),e.document.head.appendChild(r),e.addEventListener("orientationchange",this.onViewportWidthChanged),e.addEventListener("resize",this.onViewportWidthChanged),this.onViewportWidthChanged({target:e}),t.register("get_properties",et.moduleName,(n,s)=>{ca(e),s(!0)}),t.register("update_properties",et.moduleName,(n,s)=>{n["--RS__viewportWidth"]=`${e.innerWidth}px`,zh(e,n),s(!0)}),t.register("set_property",et.moduleName,(n,s)=>{const o=n;ki(e,o[0],o[1]),s(!0)}),t.register("remove_property",et.moduleName,(n,s)=>{xn(e,n),s(!0)}),t.register("activate",et.moduleName,(n,s)=>{this.unblock(e),s(!0)}),t.log("ReflowableSetup Mounted"),!0}unmount(e,t){return t.unregisterAll(et.moduleName),e.document.head.querySelector(`#${As}`)?.remove(),e.removeEventListener("orientationchange",this.onViewportWidthChanged),t.log("ReflowableSetup Unmounted"),super.unmount(e,t)}};xa.moduleName="reflowable_setup";let Zh=xa;const Cs="readium-fixed-style",Ta=class Ge extends Ea{mount(e,t){if(!super.mount(e,t))return!1;e.navigator.epubReadingSystem&&(e.navigator.epubReadingSystem.layoutStyle="paginated");const r=e.document.createElement("style");return r.id=Cs,r.dataset.readium="true",r.textContent=`
        html, body {
            text-size-adjust: none;
            -ms-text-size-adjust: none;
            -webkit-text-size-adjust: none;
            -moz-text-size-adjust: none;

            /* Fight Safari pinches */
            touch-action: none !important;
            min-height: 100%;

            /*cursor: var() TODO*/
        }`,e.document.head.appendChild(r),t.register("set_property",Ge.moduleName,(n,s)=>{const o=n;ki(e,o[0],o[1]),s(!0)}),t.register("remove_property",Ge.moduleName,(n,s)=>{xn(e,n),s(!0)}),t.register("first_visible_locator",Ge.moduleName,(n,s)=>s(!1)),t.register("unfocus",Ge.moduleName,(n,s)=>{Y(e),s(!0)}),t.register(["focus","go_next","go_prev","go_id","go_end","go_start","go_text","go_progression"],Ge.moduleName,(n,s)=>s(!0)),t.register("activate",Ge.moduleName,(n,s)=>{this.unblock(e),s(!0)}),t.log("FixedSetup Mounted"),!0}unmount(e,t){return t.unregisterAll(Ge.moduleName),e.document.getElementById(Cs)?.remove(),t.log("FixedSetup Unmounted"),super.unmount(e,t)}};Ta.moduleName="fixed_setup";let Qh=Ta;const Aa=class Ca extends ni{wndOnErr(e){this.comms?.send("error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno})}mount(e,t){return this.comms=t,e.addEventListener("error",this.wndOnErr,!1),t.register("activate",Ca.moduleName,(r,n)=>{n(!0)}),t.log("WebPubSetup Mounted"),!0}unmount(e,t){return e.removeEventListener("error",this.wndOnErr),t.log("WebPubSetup Unmounted"),!0}};Aa.moduleName="webpub_setup";let ec=Aa;new Map([Qh,Zh,ec,Jh,Kh,Wh,Xh,Yh].map(i=>[i.moduleName,i]));const Fe=class yt{constructor(e){if(typeof e=="string"){if(!yt.VALID_MODES.has(e.toLowerCase()))return;this.value=e.toLowerCase()}else{const t=e.filter(r=>yt.VALID_MODES.has(r.toLowerCase()));if(t.length===0)return;this.value=Array.from(new Set(t))}}static deserialize(e){if(!e)return;if(typeof e=="string")return new yt(e);if(!Array.isArray(e))return;const t=e.filter(r=>r?yt.VALID_MODES.has(r.toLowerCase()):!1);if(t.length!==0)return new yt(t)}serialize(){return this.value}};Fe.VALID_MODES=new Set(["auditory","tactile","textual","visual"]),Fe.AUDITORY=new Fe("auditory"),Fe.TACTILE=new Fe("tactile"),Fe.TEXTUAL=new Fe("textual"),Fe.VISUAL=new Fe("visual");var _=(i=>(i.reflowable="reflowable",i.fixed="fixed",i.scrolled="scrolled",i))(_||{});let tc=class Pa{constructor(e){this.algorithm=e.algorithm,this.compression=e.compression,this.originalLength=e.originalLength,this.profile=e.profile,this.scheme=e.scheme}static deserialize(e){if(e&&e.algorithm)return new Pa({algorithm:e.algorithm,compression:e.compression,originalLength:e.originalLength,profile:e.profile,scheme:e.scheme})}serialize(){const e={algorithm:this.algorithm};return this.compression!==void 0&&(e.compression=this.compression),this.originalLength!==void 0&&(e.originalLength=this.originalLength),this.profile!==void 0&&(e.profile=this.profile),this.scheme!==void 0&&(e.scheme=this.scheme),e}};var Ne=(i=>(i.left="left",i.right="right",i.center="center",i))(Ne||{});let Ce=class Hr{constructor(e){this.otherProperties=e}get page(){return this.otherProperties.page}static deserialize(e){if(e)return new Hr(e)}serialize(){return this.otherProperties}add(e){const t=Object.assign({},this.otherProperties);for(const r in e)t[r]=e[r];return new Hr(t)}};Object.defineProperty(Ce.prototype,"encryption",{get:function(){return tc.deserialize(this.otherProperties.encrypted)}});function ic(i){return i&&Array.isArray(i)?i:void 0}function _a(i){return i&&typeof i=="string"?[i]:ic(i)}function Ps(i){return typeof i=="string"?new Date(i):void 0}function Ti(i){return isNaN(i)?void 0:i}function ce(i){return Ti(i)!==void 0&&Math.sign(i)>=0?i:void 0}function rc(i){const e=new Array;return i.forEach(t=>e.push(t)),e}let Mi=class w{constructor(e){let t,r,n=e.mediaType.replace(/\s/g,"").split(";");const s=n[0].split("/");if(s.length===2){if(t=s[0].toLowerCase().trim(),r=s[1].toLowerCase().trim(),t.length===0||r.length===0)throw new Error("Invalid media type")}else throw new Error("Invalid media type");const o={};for(let f=1;f<n.length;f++){const g=n[f].split("=");if(g.length===2){const d=g[0].toLocaleLowerCase(),m=d==="charset"?g[1].toUpperCase():g[1];o[d]=m}}const a={},h=Object.keys(o);h.sort((f,g)=>f.localeCompare(g)),h.forEach(f=>a[f]=o[f]);let l="";for(const f in a){const g=a[f];l+=`;${f}=${g}`}const u=`${t}/${r}${l}`,c=a.encoding;this.string=u,this.type=t,this.subtype=r,this.parameters=a,this.encoding=c,this.name=e.name,this.fileExtension=e.fileExtension}static parse(e){return new w(e)}get structuredSyntaxSuffix(){const e=this.subtype.split("+");return e.length>1?`+${e[e.length-1]}`:void 0}get charset(){return this.parameters.charset}contains(e){const t=typeof e=="string"?w.parse({mediaType:e}):e;if(!((this.type==="*"||this.type===t.type)&&(this.subtype==="*"||this.subtype===t.subtype)))return!1;const r=new Set(Object.entries(this.parameters).map(([s,o])=>`${s}=${o}`)),n=new Set(Object.entries(t.parameters).map(([s,o])=>`${s}=${o}`));for(const s of Array.from(r.values()))if(!n.has(s))return!1;return!0}matches(e){const t=typeof e=="string"?w.parse({mediaType:e}):e;return this.contains(t)||t.contains(this)}matchesAny(...e){for(const t of e)if(this.matches(t))return!0;return!1}equals(e){return this.string===e.string}get isZIP(){return this.matchesAny(w.ZIP,w.LCP_PROTECTED_AUDIOBOOK,w.LCP_PROTECTED_PDF)||this.structuredSyntaxSuffix==="+zip"}get isJSON(){return this.matchesAny(w.JSON)||this.structuredSyntaxSuffix==="+json"}get isOPDS(){return this.matchesAny(w.OPDS1,w.OPDS1_ENTRY,w.OPDS2,w.OPDS2_PUBLICATION,w.OPDS_AUTHENTICATION)||this.structuredSyntaxSuffix==="+json"}get isHTML(){return this.matchesAny(w.HTML,w.XHTML)}get isBitmap(){return this.matchesAny(w.BMP,w.GIF,w.JPEG,w.PNG,w.TIFF,w.WEBP)}get isAudio(){return this.type==="audio"}get isVideo(){return this.type==="video"}get isRWPM(){return this.matchesAny(w.READIUM_AUDIOBOOK_MANIFEST,w.DIVINA_MANIFEST,w.READIUM_WEBPUB_MANIFEST)}get isPublication(){return this.matchesAny(w.READIUM_AUDIOBOOK,w.READIUM_AUDIOBOOK_MANIFEST,w.CBZ,w.DIVINA,w.DIVINA_MANIFEST,w.EPUB,w.LCP_PROTECTED_AUDIOBOOK,w.LCP_PROTECTED_PDF,w.LPF,w.PDF,w.W3C_WPUB_MANIFEST,w.READIUM_WEBPUB,w.READIUM_WEBPUB_MANIFEST,w.ZAB)}static get AAC(){return w.parse({mediaType:"audio/aac",fileExtension:"aac"})}static get ACSM(){return w.parse({mediaType:"application/vnd.adobe.adept+xml",name:"Adobe Content Server Message",fileExtension:"acsm"})}static get AIFF(){return w.parse({mediaType:"audio/aiff",fileExtension:"aiff"})}static get AVI(){return w.parse({mediaType:"video/x-msvideo",fileExtension:"avi"})}static get BINARY(){return w.parse({mediaType:"application/octet-stream"})}static get BMP(){return w.parse({mediaType:"image/bmp",fileExtension:"bmp"})}static get CBZ(){return w.parse({mediaType:"application/vnd.comicbook+zip",name:"Comic Book Archive",fileExtension:"cbz"})}static get CSS(){return w.parse({mediaType:"text/css",fileExtension:"css"})}static get DIVINA(){return w.parse({mediaType:"application/divina+zip",name:"Digital Visual Narratives",fileExtension:"divina"})}static get DIVINA_MANIFEST(){return w.parse({mediaType:"application/divina+json",name:"Digital Visual Narratives",fileExtension:"json"})}static get EPUB(){return w.parse({mediaType:"application/epub+zip",name:"EPUB",fileExtension:"epub"})}static get GIF(){return w.parse({mediaType:"image/gif",fileExtension:"gif"})}static get GZ(){return w.parse({mediaType:"application/gzip",fileExtension:"gz"})}static get HTML(){return w.parse({mediaType:"text/html",fileExtension:"html"})}static get JAVASCRIPT(){return w.parse({mediaType:"text/javascript",fileExtension:"js"})}static get JPEG(){return w.parse({mediaType:"image/jpeg",fileExtension:"jpeg"})}static get JSON(){return w.parse({mediaType:"application/json"})}static get LCP_LICENSE_DOCUMENT(){return w.parse({mediaType:"application/vnd.readium.lcp.license.v1.0+json",name:"LCP License",fileExtension:"lcpl"})}static get LCP_PROTECTED_AUDIOBOOK(){return w.parse({mediaType:"application/audiobook+lcp",name:"LCP Protected Audiobook",fileExtension:"lcpa"})}static get LCP_PROTECTED_PDF(){return w.parse({mediaType:"application/pdf+lcp",name:"LCP Protected PDF",fileExtension:"lcpdf"})}static get LCP_STATUS_DOCUMENT(){return w.parse({mediaType:"application/vnd.readium.license.status.v1.0+json"})}static get LPF(){return w.parse({mediaType:"application/lpf+zip",fileExtension:"lpf"})}static get MP3(){return w.parse({mediaType:"audio/mpeg",fileExtension:"mp3"})}static get MPEG(){return w.parse({mediaType:"video/mpeg",fileExtension:"mpeg"})}static get NCX(){return w.parse({mediaType:"application/x-dtbncx+xml",fileExtension:"ncx"})}static get OGG(){return w.parse({mediaType:"audio/ogg",fileExtension:"oga"})}static get OGV(){return w.parse({mediaType:"video/ogg",fileExtension:"ogv"})}static get OPDS1(){return w.parse({mediaType:"application/atom+xml;profile=opds-catalog"})}static get OPDS1_ENTRY(){return w.parse({mediaType:"application/atom+xml;type=entry;profile=opds-catalog"})}static get OPDS2(){return w.parse({mediaType:"application/opds+json"})}static get OPDS2_PUBLICATION(){return w.parse({mediaType:"application/opds-publication+json"})}static get OPDS_AUTHENTICATION(){return w.parse({mediaType:"application/opds-authentication+json"})}static get OPUS(){return w.parse({mediaType:"audio/opus",fileExtension:"opus"})}static get OTF(){return w.parse({mediaType:"font/otf",fileExtension:"otf"})}static get PDF(){return w.parse({mediaType:"application/pdf",name:"PDF",fileExtension:"pdf"})}static get PNG(){return w.parse({mediaType:"image/png",fileExtension:"png"})}static get READIUM_AUDIOBOOK(){return w.parse({mediaType:"application/audiobook+zip",name:"Readium Audiobook",fileExtension:"audiobook"})}static get READIUM_AUDIOBOOK_MANIFEST(){return w.parse({mediaType:"application/audiobook+json",name:"Readium Audiobook",fileExtension:"json"})}static get READIUM_CONTENT_DOCUMENT(){return w.parse({mediaType:"application/vnd.readium.content+json",name:"Readium Content Document",fileExtension:"json"})}static get READIUM_GUIDED_NAVIGATION_DOCUMENT(){return w.parse({mediaType:"application/guided-navigation+json",name:"Readium Guided Navigation Document",fileExtension:"json"})}static get READIUM_POSITION_LIST(){return w.parse({mediaType:"application/vnd.readium.position-list+json",name:"Readium Position List",fileExtension:"json"})}static get READIUM_WEBPUB(){return w.parse({mediaType:"application/webpub+zip",name:"Readium Web Publication",fileExtension:"webpub"})}static get READIUM_WEBPUB_MANIFEST(){return w.parse({mediaType:"application/webpub+json",name:"Readium Web Publication",fileExtension:"json"})}static get SMIL(){return w.parse({mediaType:"application/smil+xml",fileExtension:"smil"})}static get SVG(){return w.parse({mediaType:"image/svg+xml",fileExtension:"svg"})}static get TEXT(){return w.parse({mediaType:"text/plain",fileExtension:"txt"})}static get TIFF(){return w.parse({mediaType:"image/tiff",fileExtension:"tiff"})}static get TTF(){return w.parse({mediaType:"font/ttf",fileExtension:"ttf"})}static get W3C_WPUB_MANIFEST(){return w.parse({mediaType:"application/x.readium.w3c.wpub+json",name:"Web Publication",fileExtension:"json"})}static get WAV(){return w.parse({mediaType:"audio/wav",fileExtension:"wav"})}static get WEBM_AUDIO(){return w.parse({mediaType:"audio/webm",fileExtension:"webm"})}static get WEBM_VIDEO(){return w.parse({mediaType:"video/webm",fileExtension:"webm"})}static get WEBP(){return w.parse({mediaType:"image/webp",fileExtension:"webp"})}static get WOFF(){return w.parse({mediaType:"font/woff",fileExtension:"woff"})}static get WOFF2(){return w.parse({mediaType:"font/woff2",fileExtension:"woff2"})}static get XHTML(){return w.parse({mediaType:"application/xhtml+xml",fileExtension:"xhtml"})}static get XML(){return w.parse({mediaType:"application/xml",fileExtension:"xml"})}static get ZAB(){return w.parse({mediaType:"application/x.readium.zab+zip",name:"Zipped Audio Book",fileExtension:"zab"})}static get ZIP(){return w.parse({mediaType:"application/zip",fileExtension:"zip"})}},_s=class{constructor(i){this.uri=i,this.parameters=this.getParameters(i)}getParameters(i){const e=/\{\??([^}]+)\}/g,t=i.match(e);return t?new Set(t.join(",").replace(e,"$1").split(",").map(r=>r.trim())):new Set}expand(i){const e=r=>r.split(",").map(n=>{const s=i[n];return s?encodeURIComponent(s):""}).join(","),t=r=>"?"+r.split(",").map(n=>{const s=n.split("=")[0],o=i[s];return o?`${s}=${encodeURIComponent(o)}`:""}).join("&");return this.uri.replace(/\{(\??)([^}]+)\}/g,(...r)=>r[1]?t(r[2]):e(r[2]))}},Ee=class Oa{constructor(e){this.fragments=e.fragments?e.fragments:new Array,this.progression=e.progression,this.totalProgression=e.totalProgression,this.position=e.position,this.otherLocations=e.otherLocations}static deserialize(e){if(!e)return;const t=Ti(e.progression),r=Ti(e.totalProgression),n=Ti(e.position),s=new Map,o=new Set(["fragment","fragments","progression","totalProgression","position"]);return Object.entries(e).forEach(([a,h])=>{o.has(a)||s.set(a,h)}),new Oa({fragments:_a(e.fragments||e.fragment),progression:t!==void 0&&t>=0&&t<=1?t:void 0,totalProgression:r!==void 0&&r>=0&&r<=1?r:void 0,position:n!==void 0&&n>0?n:void 0,otherLocations:s.size===0?void 0:s})}serialize(){const e={};return this.fragments&&(e.fragments=this.fragments),this.progression!==void 0&&(e.progression=this.progression),this.totalProgression!==void 0&&(e.totalProgression=this.totalProgression),this.position!==void 0&&(e.position=this.position),this.otherLocations&&this.otherLocations.forEach((t,r)=>e[r]=t),e}},nc=class Ra{constructor(e){this.after=e.after,this.before=e.before,this.highlight=e.highlight}static deserialize(e){if(e)return new Ra({after:e.after,before:e.before,highlight:e.highlight})}serialize(){const e={};return this.after!==void 0&&(e.after=this.after),this.before!==void 0&&(e.before=this.before),this.highlight!==void 0&&(e.highlight=this.highlight),e}},jr=class qr{constructor(e){this.href=e.href,this.type=e.type,this.title=e.title,this.locations=e.locations?e.locations:new Ee({}),this.text=e.text}static deserialize(e){if(e&&e.href&&e.type)return new qr({href:e.href,type:e.type,title:e.title,locations:Ee.deserialize(e.locations),text:nc.deserialize(e.text)})}serialize(){const e={href:this.href,type:this.type};return this.title!==void 0&&(e.title=this.title),this.locations&&(e.locations=this.locations.serialize()),this.text&&(e.text=this.text.serialize()),e}copyWithLocations(e){return new qr({href:this.href,type:this.type,title:this.title,text:this.text,locations:new Ee({...this.locations,...e})})}},Yt=class Ai{constructor(e){this.href=e.href,this.templated=e.templated,this.type=e.type,this.title=e.title,this.rels=e.rels,this.properties=e.properties,this.height=e.height,this.width=e.width,this.size=e.size,this.duration=e.duration,this.bitrate=e.bitrate,this.languages=e.languages,this.alternates=e.alternates,this.children=e.children}static deserialize(e){if(!(!e||typeof e.href!="string"))return new Ai({href:e.href,templated:e.templated,type:e.type,title:e.title,rels:e.rel?Array.isArray(e.rel)?new Set(e.rel):new Set([e.rel]):void 0,properties:Ce.deserialize(e.properties),height:ce(e.height),width:ce(e.width),size:ce(e.size),duration:ce(e.duration),bitrate:ce(e.bitrate),languages:_a(e.language),alternates:Os.deserialize(e.alternate),children:Os.deserialize(e.children)})}serialize(){const e={href:this.href};return this.templated!==void 0&&(e.templated=this.templated),this.type!==void 0&&(e.type=this.type),this.title!==void 0&&(e.title=this.title),this.rels&&(e.rel=rc(this.rels)),this.properties&&(e.properties=this.properties.serialize()),this.height!==void 0&&(e.height=this.height),this.width!==void 0&&(e.width=this.width),this.size!==void 0&&(e.size=this.size),this.duration!==void 0&&(e.duration=this.duration),this.bitrate!==void 0&&(e.bitrate=this.bitrate),this.languages&&(e.language=this.languages),this.alternates&&(e.alternate=this.alternates.serialize()),this.children&&(e.children=this.children.serialize()),e}get mediaType(){return this.type!==void 0?Mi.parse({mediaType:this.type}):Mi.BINARY}toURL(e){const t=this.href.replace(/^(\/)/,"");if(t.length===0)return;let r=e||"/";return r.startsWith("/")&&(r="file://"+r),new URL(t,r).href.replace(/^(file:\/\/)/,"")}get templateParameters(){return this.templated?new _s(this.href).parameters:new Set}expandTemplate(e){return new Ai({href:new _s(this.href).expand(e),templated:!1})}addProperties(e){const t=Ai.deserialize(this.serialize());return t.properties=t.properties?t.properties?.add(e):new Ce(e),t}get locator(){let e=this.href.split("#");return new jr({href:e.length>0&&e[0]!==void 0?e[0]:this.href,type:this.type??"",title:this.title,locations:new Ee({fragments:e.length>1&&e[1]!==void 0?[e[1]]:[]})})}},Os=class La{constructor(e){this.items=e}static deserialize(e){if(e&&Array.isArray(e))return new La(e.map(t=>Yt.deserialize(t)).filter(t=>t!==void 0))}serialize(){return this.items.map(e=>e.serialize())}findWithRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.find(t)}filterByRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.filter(t)}findWithHref(e){const t=r=>r.href===e;return this.items.find(t)}findIndexWithHref(e){const t=r=>r.href===e;return this.items.findIndex(t)}findWithMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.find(t)}filterByMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.filter(t)}filterByMediaTypes(e){const t=r=>{for(const n of e)if(r.mediaType.matches(n))return!0;return!1};return this.items.filter(t)}everyIsAudio(){const e=t=>t.mediaType.isAudio;return this.items.length>0&&this.items.every(e)}everyIsBitmap(){const e=t=>t.mediaType.isBitmap;return this.items.length>0&&this.items.every(e)}everyIsHTML(){const e=t=>t.mediaType.isHTML;return this.items.length>0&&this.items.every(e)}everyIsVideo(){const e=t=>t.mediaType.isVideo;return this.items.length>0&&this.items.every(e)}everyMatchesMediaType(e){return Array.isArray(e)?this.items.length>0&&this.items.every(t=>{for(const r of e)return t.mediaType.matches(r);return!1}):this.items.length>0&&this.items.every(t=>t.mediaType.matches(e))}filterLinksHasType(){return this.items.filter(e=>e.type)}};var Ia=(i=>(i.EPUB="https://readium.org/webpub-manifest/profiles/epub",i.AUDIOBOOK="https://readium.org/webpub-manifest/profiles/audiobook",i.DIVINA="https://readium.org/webpub-manifest/profiles/divina",i.PDF="https://readium.org/webpub-manifest/profiles/pdf",i))(Ia||{}),te=(i=>(i.ltr="ltr",i.rtl="rtl",i))(te||{});Ce.prototype.getContains=function(){return new Set(this.otherProperties.contains||[])};let Rs=class Na{constructor(e){this.cssSelector=e.cssSelector,this.textNodeIndex=e.textNodeIndex,this.charOffset=e.charOffset}static deserialize(e){if(!(e&&e.cssSelector))return;let t=ce(e.textNodeIndex);if(t===void 0)return;let r=ce(e.charOffset);return r===void 0&&(r=ce(e.offset)),new Na({cssSelector:e.cssSelector,textNodeIndex:t,charOffset:r})}serialize(){const e={cssSelector:this.cssSelector,textNodeIndex:this.textNodeIndex};return this.charOffset!==void 0&&(e.charOffset=this.charOffset),e}},sc=class za{constructor(e){this.start=e.start,this.end=e.end}static deserialize(e){if(!e)return;let t=Rs.deserialize(e.start);if(t)return new za({start:t,end:Rs.deserialize(e.end)})}serialize(){const e={start:this.start.serialize()};return this.end&&(e.end=this.end.serialize()),e}};Ee.prototype.getCssSelector=function(){return this.otherLocations?.get("cssSelector")};Ee.prototype.getPartialCfi=function(){return this.otherLocations?.get("partialCfi")};Ee.prototype.getDomRange=function(){return sc.deserialize(this.otherLocations?.get("domRange"))};Ee.prototype.fragmentParameters=function(){return new Map(this.fragments.map(i=>i.startsWith("#")?i.slice(1):i).join("&").split("&").filter(i=>!i.startsWith("#")).map(i=>i.split("=")).filter(i=>i.length===2).map(i=>[i[0].trim().toLowerCase(),i[1].trim()]))};Ee.prototype.htmlId=function(){if(!this.fragments.length)return;let i=this.fragments.find(e=>e.length&&!e.includes("="));if(!i){const e=this.fragmentParameters();e.has("id")?i=e.get("id"):e.has("name")&&(i=e.get("name"))}return i?.startsWith("#")?i.slice(1):i};Ee.prototype.page=function(){const i=parseInt(this.fragmentParameters().get("page"));if(!isNaN(i)&&i>=0)return i};Ee.prototype.time=function(){const i=parseInt(this.fragmentParameters().get("t"));if(!isNaN(i))return i};Ee.prototype.space=function(){const i=this.fragmentParameters();if(!i.has("xywh"))return;const e=i.get("xywh").split(",").map(t=>parseInt(t));if(e.length===4&&!e.some(isNaN))return e};class Cn{constructor(e){this.currency=e.currency,this.value=e.value}static deserialize(e){if(!e)return;let t=e.currency;if(!(t&&typeof t=="string"&&t.length>0))return;let r=ce(e.value);if(r!==void 0)return new Cn({currency:t,value:r})}serialize(){return{currency:this.currency,value:this.value}}}let oc=class Ci{constructor(e){this.type=e.type,this.children=e.children}static deserialize(e){if(e&&e.type)return new Ci({type:e.type,children:Ci.deserializeArray(e.children)})}static deserializeArray(e){if(Array.isArray(e))return e.map(t=>Ci.deserialize(t)).filter(t=>t!==void 0)}serialize(){const e={type:this.type};return this.children&&(e.children=this.children.map(t=>t.serialize())),e}},ac=class ka{constructor(e){this.total=e.total,this.position=e.position}static deserialize(e){if(e)return new ka({total:ce(e.total),position:ce(e.position)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.position!==void 0&&(e.position=this.position),e}},lc=class Ma{constructor(e){this.total=e.total,this.available=e.available}static deserialize(e){if(e)return new Ma({total:ce(e.total),available:ce(e.available)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.available!==void 0&&(e.available=this.available),e}},hc=class Da{constructor(e){this.state=e.state,this.since=e.since,this.until=e.until}static deserialize(e){if(e&&e.state)return new Da({state:e.state,since:Ps(e.since),until:Ps(e.until)})}serialize(){const e={state:this.state};return this.since!==void 0&&(e.since=this.since.toISOString()),this.until!==void 0&&(e.until=this.until.toISOString()),e}};Ce.prototype.getNumberOfItems=function(){return ce(this.otherProperties.numberOfItems)};Ce.prototype.getPrice=function(){return Cn.deserialize(this.otherProperties.price)};Ce.prototype.getIndirectAcquisitions=function(){const i=this.otherProperties.indirectAcquisition;if(i&&Array.isArray(i))return i.map(e=>oc.deserialize(e)).filter(e=>e!==void 0)};Ce.prototype.getHolds=function(){return ac.deserialize(this.otherProperties.holds)};Ce.prototype.getCopies=function(){return lc.deserialize(this.otherProperties.copies)};Ce.prototype.getAvailability=function(){return hc.deserialize(this.otherProperties.availability)};Ce.prototype.getAuthenticate=function(){return Yt.deserialize(this.otherProperties.authenticate)};const cc="CssSelectorGenerator";function Ls(i="unknown problem",...e){console.warn(`${cc}: ${i}`,...e)}function uc(i){return i instanceof RegExp}function dc(i){return i.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".+")}function pc(i){const e=i.map(t=>{if(uc(t))return r=>t.test(r);if(typeof t=="function")return r=>{const n=t(r);return typeof n!="boolean"?(Ls("pattern matcher function invalid","Provided pattern matching function does not return boolean. It's result will be ignored.",t),!1):n};if(typeof t=="string"){const r=new RegExp("^"+dc(t)+"$");return n=>r.test(n)}return Ls("pattern matcher invalid","Pattern matching only accepts strings, regular expressions and/or functions. This item is invalid and will be ignored.",t),()=>!1});return t=>e.some(r=>r(t))}pc(["class","id","ng-*"]);class fc{}class gc extends fc{goLeft(e=!1,t){this.readingProgression===te.ltr?this.goBackward(e,t):this.readingProgression===te.rtl&&this.goForward(e,t)}goRight(e=!1,t){this.readingProgression===te.ltr?this.goForward(e,t):this.readingProgression===te.rtl&&this.goBackward(e,t)}}const mc=Math.pow(2,32),Is=()=>Math.round(Math.random()*mc).toString(36),Vr=()=>`${Math.round(performance.now())}-${Is()}-${Is()}`,bt=1;class yc{constructor(e){this.destination=null,this.registrar=new Map,this.origin="",this.channelId="",this.receiver=this.receive.bind(this),this.preLog=[],this.wnd=e,e.addEventListener("message",this.receiver)}receive(e){if(e.source===null)throw Error("Event source is null");if(typeof e.data!="object")return;const t=e.data;if(!(!("_readium"in t)||!t._readium||t._readium<=0)){if(t.key==="_ping"){if(!this.destination){if(this.destination=e.source,this.origin=e.origin,this.channelId=t._channel,t._readium!==bt){t._readium>bt?this.send("error",`received comms version ${t._readium} higher than ${bt}`):this.send("error",`received comms version ${t._readium} lower than ${bt}`),this.destination=null,this.origin="",this.channelId="";return}this.send("_pong",void 0),this.preLog.forEach(r=>this.send("log",r)),this.preLog=[]}return}else if(this.channelId){if(t._channel!==this.channelId||e.origin!==this.origin)return}else return;this.handle(t)}}handle(e){const t=this.registrar.get(e.key);if(!t||t.length===0){e.strict&&this.send("_unhandled",e);return}t.forEach(r=>r.cb(e.data,n=>{this.send("_ack",n,e.id)}))}register(e,t,r){Array.isArray(e)||(e=[e]),e.forEach(n=>{const s=this.registrar.get(n);if(s&&s.length>=0){if(s.find(o=>o.module===t))throw new Error(`Trying to register another callback for combination of event ${n} and module ${t}`);s.push({cb:r,module:t}),this.registrar.set(n,s)}else this.registrar.set(n,[{cb:r,module:t}])})}unregister(e,t){Array.isArray(e)||(e=[e]),e.forEach(r=>{const n=this.registrar.get(r);!n||n.length===0||n.splice(n.findIndex(s=>s.module===t),1)})}unregisterAll(e){this.registrar.forEach((t,r)=>this.registrar.set(r,t.filter(n=>n.module!==e)))}log(...e){this.destination?this.send("log",e):this.preLog.push(e)}get ready(){return!!this.destination}destroy(){this.destination=null,this.channelId="",this.preLog=[],this.registrar.clear(),this.wnd.removeEventListener("message",this.receiver)}send(e,t,r=void 0,n=[]){if(!this.destination)throw Error("Attempted to send comms message before destination has been initialized");const s={_readium:bt,_channel:this.channelId,id:r??Vr(),key:e,data:t};try{this.destination.postMessage(s,{targetOrigin:this.origin,transfer:n})}catch(o){if(n.length>0)throw o;this.destination.postMessage(s,this.origin,n)}}}const Ue=class vt{constructor(e){if(typeof e=="string"){if(!vt.VALID_MODES.has(e.toLowerCase()))return;this.value=e.toLowerCase()}else{const t=e.filter(r=>vt.VALID_MODES.has(r.toLowerCase()));if(t.length===0)return;this.value=Array.from(new Set(t))}}static deserialize(e){if(!e)return;if(typeof e=="string")return new vt(e);if(!Array.isArray(e))return;const t=e.filter(r=>r?vt.VALID_MODES.has(r.toLowerCase()):!1);if(t.length!==0)return new vt(t)}serialize(){return this.value}};Ue.VALID_MODES=new Set(["auditory","tactile","textual","visual"]),Ue.AUDITORY=new Ue("auditory"),Ue.TACTILE=new Ue("tactile"),Ue.TEXTUAL=new Ue("textual"),Ue.VISUAL=new Ue("visual");let bc=class Fa{constructor(e){this.algorithm=e.algorithm,this.compression=e.compression,this.originalLength=e.originalLength,this.profile=e.profile,this.scheme=e.scheme}static deserialize(e){if(e&&e.algorithm)return new Fa({algorithm:e.algorithm,compression:e.compression,originalLength:e.originalLength,profile:e.profile,scheme:e.scheme})}serialize(){const e={algorithm:this.algorithm};return this.compression!==void 0&&(e.compression=this.compression),this.originalLength!==void 0&&(e.originalLength=this.originalLength),this.profile!==void 0&&(e.profile=this.profile),this.scheme!==void 0&&(e.scheme=this.scheme),e}},Pe=class Gr{constructor(e){this.otherProperties=e}get page(){return this.otherProperties.page}static deserialize(e){if(e)return new Gr(e)}serialize(){return this.otherProperties}add(e){const t=Object.assign({},this.otherProperties);for(const r in e)t[r]=e[r];return new Gr(t)}};Object.defineProperty(Pe.prototype,"encryption",{get:function(){return bc.deserialize(this.otherProperties.encrypted)}});function vc(i){return i&&Array.isArray(i)?i:void 0}function Ua(i){return i&&typeof i=="string"?[i]:vc(i)}function Ns(i){return typeof i=="string"?new Date(i):void 0}function Pi(i){return isNaN(i)?void 0:i}function ue(i){return Pi(i)!==void 0&&Math.sign(i)>=0?i:void 0}function wc(i){const e=new Array;return i.forEach(t=>e.push(t)),e}class v{constructor(e){let t,r,n=e.mediaType.replace(/\s/g,"").split(";");const s=n[0].split("/");if(s.length===2){if(t=s[0].toLowerCase().trim(),r=s[1].toLowerCase().trim(),t.length===0||r.length===0)throw new Error("Invalid media type")}else throw new Error("Invalid media type");const o={};for(let f=1;f<n.length;f++){const g=n[f].split("=");if(g.length===2){const d=g[0].toLocaleLowerCase(),m=d==="charset"?g[1].toUpperCase():g[1];o[d]=m}}const a={},h=Object.keys(o);h.sort((f,g)=>f.localeCompare(g)),h.forEach(f=>a[f]=o[f]);let l="";for(const f in a){const g=a[f];l+=`;${f}=${g}`}const u=`${t}/${r}${l}`,c=a.encoding;this.string=u,this.type=t,this.subtype=r,this.parameters=a,this.encoding=c,this.name=e.name,this.fileExtension=e.fileExtension}static parse(e){return new v(e)}get structuredSyntaxSuffix(){const e=this.subtype.split("+");return e.length>1?`+${e[e.length-1]}`:void 0}get charset(){return this.parameters.charset}contains(e){const t=typeof e=="string"?v.parse({mediaType:e}):e;if(!((this.type==="*"||this.type===t.type)&&(this.subtype==="*"||this.subtype===t.subtype)))return!1;const r=new Set(Object.entries(this.parameters).map(([s,o])=>`${s}=${o}`)),n=new Set(Object.entries(t.parameters).map(([s,o])=>`${s}=${o}`));for(const s of Array.from(r.values()))if(!n.has(s))return!1;return!0}matches(e){const t=typeof e=="string"?v.parse({mediaType:e}):e;return this.contains(t)||t.contains(this)}matchesAny(...e){for(const t of e)if(this.matches(t))return!0;return!1}equals(e){return this.string===e.string}get isZIP(){return this.matchesAny(v.ZIP,v.LCP_PROTECTED_AUDIOBOOK,v.LCP_PROTECTED_PDF)||this.structuredSyntaxSuffix==="+zip"}get isJSON(){return this.matchesAny(v.JSON)||this.structuredSyntaxSuffix==="+json"}get isOPDS(){return this.matchesAny(v.OPDS1,v.OPDS1_ENTRY,v.OPDS2,v.OPDS2_PUBLICATION,v.OPDS_AUTHENTICATION)||this.structuredSyntaxSuffix==="+json"}get isHTML(){return this.matchesAny(v.HTML,v.XHTML)}get isBitmap(){return this.matchesAny(v.BMP,v.GIF,v.JPEG,v.PNG,v.TIFF,v.WEBP)}get isAudio(){return this.type==="audio"}get isVideo(){return this.type==="video"}get isRWPM(){return this.matchesAny(v.READIUM_AUDIOBOOK_MANIFEST,v.DIVINA_MANIFEST,v.READIUM_WEBPUB_MANIFEST)}get isPublication(){return this.matchesAny(v.READIUM_AUDIOBOOK,v.READIUM_AUDIOBOOK_MANIFEST,v.CBZ,v.DIVINA,v.DIVINA_MANIFEST,v.EPUB,v.LCP_PROTECTED_AUDIOBOOK,v.LCP_PROTECTED_PDF,v.LPF,v.PDF,v.W3C_WPUB_MANIFEST,v.READIUM_WEBPUB,v.READIUM_WEBPUB_MANIFEST,v.ZAB)}static get AAC(){return v.parse({mediaType:"audio/aac",fileExtension:"aac"})}static get ACSM(){return v.parse({mediaType:"application/vnd.adobe.adept+xml",name:"Adobe Content Server Message",fileExtension:"acsm"})}static get AIFF(){return v.parse({mediaType:"audio/aiff",fileExtension:"aiff"})}static get AVI(){return v.parse({mediaType:"video/x-msvideo",fileExtension:"avi"})}static get BINARY(){return v.parse({mediaType:"application/octet-stream"})}static get BMP(){return v.parse({mediaType:"image/bmp",fileExtension:"bmp"})}static get CBZ(){return v.parse({mediaType:"application/vnd.comicbook+zip",name:"Comic Book Archive",fileExtension:"cbz"})}static get CSS(){return v.parse({mediaType:"text/css",fileExtension:"css"})}static get DIVINA(){return v.parse({mediaType:"application/divina+zip",name:"Digital Visual Narratives",fileExtension:"divina"})}static get DIVINA_MANIFEST(){return v.parse({mediaType:"application/divina+json",name:"Digital Visual Narratives",fileExtension:"json"})}static get EPUB(){return v.parse({mediaType:"application/epub+zip",name:"EPUB",fileExtension:"epub"})}static get GIF(){return v.parse({mediaType:"image/gif",fileExtension:"gif"})}static get GZ(){return v.parse({mediaType:"application/gzip",fileExtension:"gz"})}static get HTML(){return v.parse({mediaType:"text/html",fileExtension:"html"})}static get JAVASCRIPT(){return v.parse({mediaType:"text/javascript",fileExtension:"js"})}static get JPEG(){return v.parse({mediaType:"image/jpeg",fileExtension:"jpeg"})}static get JSON(){return v.parse({mediaType:"application/json"})}static get LCP_LICENSE_DOCUMENT(){return v.parse({mediaType:"application/vnd.readium.lcp.license.v1.0+json",name:"LCP License",fileExtension:"lcpl"})}static get LCP_PROTECTED_AUDIOBOOK(){return v.parse({mediaType:"application/audiobook+lcp",name:"LCP Protected Audiobook",fileExtension:"lcpa"})}static get LCP_PROTECTED_PDF(){return v.parse({mediaType:"application/pdf+lcp",name:"LCP Protected PDF",fileExtension:"lcpdf"})}static get LCP_STATUS_DOCUMENT(){return v.parse({mediaType:"application/vnd.readium.license.status.v1.0+json"})}static get LPF(){return v.parse({mediaType:"application/lpf+zip",fileExtension:"lpf"})}static get MP3(){return v.parse({mediaType:"audio/mpeg",fileExtension:"mp3"})}static get MPEG(){return v.parse({mediaType:"video/mpeg",fileExtension:"mpeg"})}static get NCX(){return v.parse({mediaType:"application/x-dtbncx+xml",fileExtension:"ncx"})}static get OGG(){return v.parse({mediaType:"audio/ogg",fileExtension:"oga"})}static get OGV(){return v.parse({mediaType:"video/ogg",fileExtension:"ogv"})}static get OPDS1(){return v.parse({mediaType:"application/atom+xml;profile=opds-catalog"})}static get OPDS1_ENTRY(){return v.parse({mediaType:"application/atom+xml;type=entry;profile=opds-catalog"})}static get OPDS2(){return v.parse({mediaType:"application/opds+json"})}static get OPDS2_PUBLICATION(){return v.parse({mediaType:"application/opds-publication+json"})}static get OPDS_AUTHENTICATION(){return v.parse({mediaType:"application/opds-authentication+json"})}static get OPUS(){return v.parse({mediaType:"audio/opus",fileExtension:"opus"})}static get OTF(){return v.parse({mediaType:"font/otf",fileExtension:"otf"})}static get PDF(){return v.parse({mediaType:"application/pdf",name:"PDF",fileExtension:"pdf"})}static get PNG(){return v.parse({mediaType:"image/png",fileExtension:"png"})}static get READIUM_AUDIOBOOK(){return v.parse({mediaType:"application/audiobook+zip",name:"Readium Audiobook",fileExtension:"audiobook"})}static get READIUM_AUDIOBOOK_MANIFEST(){return v.parse({mediaType:"application/audiobook+json",name:"Readium Audiobook",fileExtension:"json"})}static get READIUM_CONTENT_DOCUMENT(){return v.parse({mediaType:"application/vnd.readium.content+json",name:"Readium Content Document",fileExtension:"json"})}static get READIUM_GUIDED_NAVIGATION_DOCUMENT(){return v.parse({mediaType:"application/guided-navigation+json",name:"Readium Guided Navigation Document",fileExtension:"json"})}static get READIUM_POSITION_LIST(){return v.parse({mediaType:"application/vnd.readium.position-list+json",name:"Readium Position List",fileExtension:"json"})}static get READIUM_WEBPUB(){return v.parse({mediaType:"application/webpub+zip",name:"Readium Web Publication",fileExtension:"webpub"})}static get READIUM_WEBPUB_MANIFEST(){return v.parse({mediaType:"application/webpub+json",name:"Readium Web Publication",fileExtension:"json"})}static get SMIL(){return v.parse({mediaType:"application/smil+xml",fileExtension:"smil"})}static get SVG(){return v.parse({mediaType:"image/svg+xml",fileExtension:"svg"})}static get TEXT(){return v.parse({mediaType:"text/plain",fileExtension:"txt"})}static get TIFF(){return v.parse({mediaType:"image/tiff",fileExtension:"tiff"})}static get TTF(){return v.parse({mediaType:"font/ttf",fileExtension:"ttf"})}static get W3C_WPUB_MANIFEST(){return v.parse({mediaType:"application/x.readium.w3c.wpub+json",name:"Web Publication",fileExtension:"json"})}static get WAV(){return v.parse({mediaType:"audio/wav",fileExtension:"wav"})}static get WEBM_AUDIO(){return v.parse({mediaType:"audio/webm",fileExtension:"webm"})}static get WEBM_VIDEO(){return v.parse({mediaType:"video/webm",fileExtension:"webm"})}static get WEBP(){return v.parse({mediaType:"image/webp",fileExtension:"webp"})}static get WOFF(){return v.parse({mediaType:"font/woff",fileExtension:"woff"})}static get WOFF2(){return v.parse({mediaType:"font/woff2",fileExtension:"woff2"})}static get XHTML(){return v.parse({mediaType:"application/xhtml+xml",fileExtension:"xhtml"})}static get XML(){return v.parse({mediaType:"application/xml",fileExtension:"xml"})}static get ZAB(){return v.parse({mediaType:"application/x.readium.zab+zip",name:"Zipped Audio Book",fileExtension:"zab"})}static get ZIP(){return v.parse({mediaType:"application/zip",fileExtension:"zip"})}}class zs{constructor(e){this.uri=e,this.parameters=this.getParameters(e)}getParameters(e){const t=/\{\??([^}]+)\}/g,r=e.match(t);return r?new Set(r.join(",").replace(t,"$1").split(",").map(n=>n.trim())):new Set}expand(e){const t=n=>n.split(",").map(s=>{const o=e[s];return o?encodeURIComponent(o):""}).join(","),r=n=>"?"+n.split(",").map(s=>{const o=s.split("=")[0],a=e[o];return a?`${o}=${encodeURIComponent(a)}`:""}).join("&");return this.uri.replace(/\{(\??)([^}]+)\}/g,(...n)=>n[1]?r(n[2]):t(n[2]))}}let re=class Wa{constructor(e){this.fragments=e.fragments?e.fragments:new Array,this.progression=e.progression,this.totalProgression=e.totalProgression,this.position=e.position,this.otherLocations=e.otherLocations}static deserialize(e){if(!e)return;const t=Pi(e.progression),r=Pi(e.totalProgression),n=Pi(e.position),s=new Map,o=new Set(["fragment","fragments","progression","totalProgression","position"]);return Object.entries(e).forEach(([a,h])=>{o.has(a)||s.set(a,h)}),new Wa({fragments:Ua(e.fragments||e.fragment),progression:t!==void 0&&t>=0&&t<=1?t:void 0,totalProgression:r!==void 0&&r>=0&&r<=1?r:void 0,position:n!==void 0&&n>0?n:void 0,otherLocations:s.size===0?void 0:s})}serialize(){const e={};return this.fragments&&(e.fragments=this.fragments),this.progression!==void 0&&(e.progression=this.progression),this.totalProgression!==void 0&&(e.totalProgression=this.totalProgression),this.position!==void 0&&(e.position=this.position),this.otherLocations&&this.otherLocations.forEach((t,r)=>e[r]=t),e}},si=class Ba{constructor(e){this.after=e.after,this.before=e.before,this.highlight=e.highlight}static deserialize(e){if(e)return new Ba({after:e.after,before:e.before,highlight:e.highlight})}serialize(){const e={};return this.after!==void 0&&(e.after=this.after),this.before!==void 0&&(e.before=this.before),this.highlight!==void 0&&(e.highlight=this.highlight),e}},Mt=class Xr{constructor(e){this.href=e.href,this.type=e.type,this.title=e.title,this.locations=e.locations?e.locations:new re({}),this.text=e.text}static deserialize(e){if(e&&e.href&&e.type)return new Xr({href:e.href,type:e.type,title:e.title,locations:re.deserialize(e.locations),text:si.deserialize(e.text)})}serialize(){const e={href:this.href,type:this.type};return this.title!==void 0&&(e.title=this.title),this.locations&&(e.locations=this.locations.serialize()),this.text&&(e.text=this.text.serialize()),e}copyWithLocations(e){return new Xr({href:this.href,type:this.type,title:this.title,text:this.text,locations:new re({...this.locations,...e})})}},$a=class _i{constructor(e){this.href=e.href,this.templated=e.templated,this.type=e.type,this.title=e.title,this.rels=e.rels,this.properties=e.properties,this.height=e.height,this.width=e.width,this.size=e.size,this.duration=e.duration,this.bitrate=e.bitrate,this.languages=e.languages,this.alternates=e.alternates,this.children=e.children}static deserialize(e){if(!(!e||typeof e.href!="string"))return new _i({href:e.href,templated:e.templated,type:e.type,title:e.title,rels:e.rel?Array.isArray(e.rel)?new Set(e.rel):new Set([e.rel]):void 0,properties:Pe.deserialize(e.properties),height:ue(e.height),width:ue(e.width),size:ue(e.size),duration:ue(e.duration),bitrate:ue(e.bitrate),languages:Ua(e.language),alternates:ks.deserialize(e.alternate),children:ks.deserialize(e.children)})}serialize(){const e={href:this.href};return this.templated!==void 0&&(e.templated=this.templated),this.type!==void 0&&(e.type=this.type),this.title!==void 0&&(e.title=this.title),this.rels&&(e.rel=wc(this.rels)),this.properties&&(e.properties=this.properties.serialize()),this.height!==void 0&&(e.height=this.height),this.width!==void 0&&(e.width=this.width),this.size!==void 0&&(e.size=this.size),this.duration!==void 0&&(e.duration=this.duration),this.bitrate!==void 0&&(e.bitrate=this.bitrate),this.languages&&(e.language=this.languages),this.alternates&&(e.alternate=this.alternates.serialize()),this.children&&(e.children=this.children.serialize()),e}get mediaType(){return this.type!==void 0?v.parse({mediaType:this.type}):v.BINARY}toURL(e){const t=this.href.replace(/^(\/)/,"");if(t.length===0)return;let r=e||"/";return r.startsWith("/")&&(r="file://"+r),new URL(t,r).href.replace(/^(file:\/\/)/,"")}get templateParameters(){return this.templated?new zs(this.href).parameters:new Set}expandTemplate(e){return new _i({href:new zs(this.href).expand(e),templated:!1})}addProperties(e){const t=_i.deserialize(this.serialize());return t.properties=t.properties?t.properties?.add(e):new Pe(e),t}get locator(){let e=this.href.split("#");return new Mt({href:e.length>0&&e[0]!==void 0?e[0]:this.href,type:this.type??"",title:this.title,locations:new re({fragments:e.length>1&&e[1]!==void 0?[e[1]]:[]})})}},ks=class Ha{constructor(e){this.items=e}static deserialize(e){if(e&&Array.isArray(e))return new Ha(e.map(t=>$a.deserialize(t)).filter(t=>t!==void 0))}serialize(){return this.items.map(e=>e.serialize())}findWithRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.find(t)}filterByRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.filter(t)}findWithHref(e){const t=r=>r.href===e;return this.items.find(t)}findIndexWithHref(e){const t=r=>r.href===e;return this.items.findIndex(t)}findWithMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.find(t)}filterByMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.filter(t)}filterByMediaTypes(e){const t=r=>{for(const n of e)if(r.mediaType.matches(n))return!0;return!1};return this.items.filter(t)}everyIsAudio(){const e=t=>t.mediaType.isAudio;return this.items.length>0&&this.items.every(e)}everyIsBitmap(){const e=t=>t.mediaType.isBitmap;return this.items.length>0&&this.items.every(e)}everyIsHTML(){const e=t=>t.mediaType.isHTML;return this.items.length>0&&this.items.every(e)}everyIsVideo(){const e=t=>t.mediaType.isVideo;return this.items.length>0&&this.items.every(e)}everyMatchesMediaType(e){return Array.isArray(e)?this.items.length>0&&this.items.every(t=>{for(const r of e)return t.mediaType.matches(r);return!1}):this.items.length>0&&this.items.every(t=>t.mediaType.matches(e))}filterLinksHasType(){return this.items.filter(e=>e.type)}};Pe.prototype.getContains=function(){return new Set(this.otherProperties.contains||[])};class Di{constructor(e){this.cssSelector=e.cssSelector,this.textNodeIndex=e.textNodeIndex,this.charOffset=e.charOffset}static deserialize(e){if(!(e&&e.cssSelector))return;let t=ue(e.textNodeIndex);if(t===void 0)return;let r=ue(e.charOffset);return r===void 0&&(r=ue(e.offset)),new Di({cssSelector:e.cssSelector,textNodeIndex:t,charOffset:r})}serialize(){const e={cssSelector:this.cssSelector,textNodeIndex:this.textNodeIndex};return this.charOffset!==void 0&&(e.charOffset=this.charOffset),e}}class Pn{constructor(e){this.start=e.start,this.end=e.end}static deserialize(e){if(!e)return;let t=Di.deserialize(e.start);if(t)return new Pn({start:t,end:Di.deserialize(e.end)})}serialize(){const e={start:this.start.serialize()};return this.end&&(e.end=this.end.serialize()),e}}re.prototype.getCssSelector=function(){return this.otherLocations?.get("cssSelector")};re.prototype.getPartialCfi=function(){return this.otherLocations?.get("partialCfi")};re.prototype.getDomRange=function(){return Pn.deserialize(this.otherLocations?.get("domRange"))};re.prototype.fragmentParameters=function(){return new Map(this.fragments.map(i=>i.startsWith("#")?i.slice(1):i).join("&").split("&").filter(i=>!i.startsWith("#")).map(i=>i.split("=")).filter(i=>i.length===2).map(i=>[i[0].trim().toLowerCase(),i[1].trim()]))};re.prototype.htmlId=function(){if(!this.fragments.length)return;let i=this.fragments.find(e=>e.length&&!e.includes("="));if(!i){const e=this.fragmentParameters();e.has("id")?i=e.get("id"):e.has("name")&&(i=e.get("name"))}return i?.startsWith("#")?i.slice(1):i};re.prototype.page=function(){const i=parseInt(this.fragmentParameters().get("page"));if(!isNaN(i)&&i>=0)return i};re.prototype.time=function(){const i=parseInt(this.fragmentParameters().get("t"));if(!isNaN(i))return i};re.prototype.space=function(){const i=this.fragmentParameters();if(!i.has("xywh"))return;const e=i.get("xywh").split(",").map(t=>parseInt(t));if(e.length===4&&!e.some(isNaN))return e};class _n{constructor(e){this.currency=e.currency,this.value=e.value}static deserialize(e){if(!e)return;let t=e.currency;if(!(t&&typeof t=="string"&&t.length>0))return;let r=ue(e.value);if(r!==void 0)return new _n({currency:t,value:r})}serialize(){return{currency:this.currency,value:this.value}}}let Sc=class Oi{constructor(e){this.type=e.type,this.children=e.children}static deserialize(e){if(e&&e.type)return new Oi({type:e.type,children:Oi.deserializeArray(e.children)})}static deserializeArray(e){if(Array.isArray(e))return e.map(t=>Oi.deserialize(t)).filter(t=>t!==void 0)}serialize(){const e={type:this.type};return this.children&&(e.children=this.children.map(t=>t.serialize())),e}};class On{constructor(e){this.total=e.total,this.position=e.position}static deserialize(e){if(e)return new On({total:ue(e.total),position:ue(e.position)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.position!==void 0&&(e.position=this.position),e}}let Ec=class ja{constructor(e){this.total=e.total,this.available=e.available}static deserialize(e){if(e)return new ja({total:ue(e.total),available:ue(e.available)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.available!==void 0&&(e.available=this.available),e}};class Rn{constructor(e){this.state=e.state,this.since=e.since,this.until=e.until}static deserialize(e){if(e&&e.state)return new Rn({state:e.state,since:Ns(e.since),until:Ns(e.until)})}serialize(){const e={state:this.state};return this.since!==void 0&&(e.since=this.since.toISOString()),this.until!==void 0&&(e.until=this.until.toISOString()),e}}Pe.prototype.getNumberOfItems=function(){return ue(this.otherProperties.numberOfItems)};Pe.prototype.getPrice=function(){return _n.deserialize(this.otherProperties.price)};Pe.prototype.getIndirectAcquisitions=function(){const i=this.otherProperties.indirectAcquisition;if(i&&Array.isArray(i))return i.map(e=>Sc.deserialize(e)).filter(e=>e!==void 0)};Pe.prototype.getHolds=function(){return On.deserialize(this.otherProperties.holds)};Pe.prototype.getCopies=function(){return Ec.deserialize(this.otherProperties.copies)};Pe.prototype.getAvailability=function(){return Rn.deserialize(this.otherProperties.availability)};Pe.prototype.getAuthenticate=function(){return $a.deserialize(this.otherProperties.authenticate)};const xc="CssSelectorGenerator";function Ms(i="unknown problem",...e){console.warn(`${xc}: ${i}`,...e)}function Tc(i){return i instanceof RegExp}function Ac(i){return i.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".+")}function Cc(i){const e=i.map(t=>{if(Tc(t))return r=>t.test(r);if(typeof t=="function")return r=>{const n=t(r);return typeof n!="boolean"?(Ms("pattern matcher function invalid","Provided pattern matching function does not return boolean. It's result will be ignored.",t),!1):n};if(typeof t=="string"){const r=new RegExp("^"+Ac(t)+"$");return n=>r.test(n)}return Ms("pattern matcher invalid","Pattern matching only accepts strings, regular expressions and/or functions. This item is invalid and will be ignored.",t),()=>!1});return t=>e.some(r=>r(t))}Cc(["class","id","ng-*"]);let oi=class{};function Ds(i){return i.split("").reverse().join("")}function Pc(i,e,t){const r=Ds(e);return t.map(n=>{const s=Math.max(0,n.end-e.length-n.errors),o=Ds(i.slice(s,n.end));return{start:qa(o,r,n.errors).reduce((a,h)=>n.end-h.end<a?n.end-h.end:a,n.end),end:n.end,errors:n.errors}})}function pr(i){return(i|-i)>>31&1}function Fs(i,e,t,r){let n=i.P[t],s=i.M[t];const o=r>>>31,a=e[t]|o,h=a|s,l=(a&n)+n^n|a;let u=s|~(l|n),c=n&l;const f=pr(u&i.lastRowMask[t])-pr(c&i.lastRowMask[t]);return u<<=1,c<<=1,c|=o,u|=pr(r)-o,n=c|~(h|u),s=u&h,i.P[t]=n,i.M[t]=s,f}function qa(i,e,t){if(e.length===0)return[];t=Math.min(t,e.length);const r=[],n=32,s=Math.ceil(e.length/n)-1,o={P:new Uint32Array(s+1),M:new Uint32Array(s+1),lastRowMask:new Uint32Array(s+1)};o.lastRowMask.fill(1<<31),o.lastRowMask[s]=1<<(e.length-1)%n;const a=new Uint32Array(s+1),h=new Map,l=[];for(let f=0;f<256;f++)l.push(a);for(let f=0;f<e.length;f+=1){const g=e.charCodeAt(f);if(h.has(g))continue;const d=new Uint32Array(s+1);h.set(g,d),g<l.length&&(l[g]=d);for(let m=0;m<=s;m+=1){d[m]=0;for(let y=0;y<n;y+=1){const x=m*n+y;x>=e.length||e.charCodeAt(x)===g&&(d[m]|=1<<y)}}}let u=Math.max(0,Math.ceil(t/n)-1);const c=new Uint32Array(s+1);for(let f=0;f<=u;f+=1)c[f]=(f+1)*n;c[s]=e.length;for(let f=0;f<=u;f+=1)o.P[f]=-1,o.M[f]=0;for(let f=0;f<i.length;f+=1){const g=i.charCodeAt(f);let d;g<l.length?d=l[g]:(d=h.get(g),typeof d>"u"&&(d=a));let m=0;for(let y=0;y<=u;y+=1)m=Fs(o,d,y,m),c[y]+=m;if(c[u]-m<=t&&u<s&&(d[u+1]&1||m<0)){u+=1,o.P[u]=-1,o.M[u]=0;let y;if(u===s){const x=e.length%n;y=x===0?n:x}else y=n;c[u]=c[u-1]+y-m+Fs(o,d,u,m)}else for(;u>0&&c[u]>=t+n;)u-=1;u===s&&c[u]<=t&&(c[u]<t&&r.splice(0,r.length),r.push({start:-1,end:f+1,errors:c[u]}),t=c[u])}return r}function _c(i,e,t){const r=qa(i,e,t);return Pc(i,e,r)}function Va(i,e,t){let r=0;const n=[];for(;r!==-1;)r=i.indexOf(e,r),r!==-1&&(n.push({start:r,end:r+e.length,errors:0}),r+=1);return n.length>0?n:_c(i,e,t)}function Us(i,e){return e.length===0||i.length===0?0:1-Va(i,e,e.length)[0].errors/e.length}function Oc(i,e,t={}){if(e.length===0)return null;const r=Math.min(256,e.length/2),n=Va(i,e,r);if(n.length===0)return null;const s=a=>{const h=1-a.errors/e.length,l=t.prefix?Us(i.slice(Math.max(0,a.start-t.prefix.length),a.start),t.prefix):1,u=t.suffix?Us(i.slice(a.end,a.end+t.suffix.length),t.suffix):1;let c=1;return typeof t.hint=="number"&&(c=1-Math.abs(a.start-t.hint)/i.length),(50*h+20*l+20*u+2*c)/92},o=n.map(a=>({start:a.start,end:a.end,score:s(a)}));return o.sort((a,h)=>h.score-a.score),o[0]}function Yr(i,e,t){const r=t===1?e:e-1;if(i.charAt(r).trim()!=="")return e;let n,s;if(t===2?(n=i.substring(0,e),s=n.trimEnd()):(n=i.substring(e),s=n.trimStart()),!s.length)return-1;const o=n.length-s.length;return t===2?e-o:e+o}function Ws(i,e){const t=i.commonAncestorContainer.ownerDocument.createNodeIterator(i.commonAncestorContainer,NodeFilter.SHOW_TEXT),r=e===1?i.startContainer:i.endContainer,n=e===1?i.endContainer:i.startContainer;let s=t.nextNode();for(;s&&s!==r;)s=t.nextNode();e===2&&(s=t.previousNode());let o=-1;const a=()=>{if(s=e===1?t.nextNode():t.previousNode(),s){const h=s.textContent,l=e===1?0:h.length;o=Yr(h,l,e)}};for(;s&&o===-1&&s!==n;)a();if(s&&o>=0)return{node:s,offset:o};throw new RangeError("No text nodes with non-whitespace text found in range")}function Rc(i){if(!i.toString().trim().length)throw new RangeError("Range contains no non-whitespace text");if(i.startContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range startContainer is not a text node");if(i.endContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range endContainer is not a text node");const e=i.cloneRange();let t=!1,r=!1;const n={start:Yr(i.startContainer.textContent,i.startOffset,1),end:Yr(i.endContainer.textContent,i.endOffset,2)};if(n.start>=0&&(e.setStart(i.startContainer,n.start),t=!0),n.end>0&&(e.setEnd(i.endContainer,n.end),r=!0),t&&r)return e;if(!t){const{node:s,offset:o}=Ws(e,1);s&&o>=0&&e.setStart(s,o)}if(!r){const{node:s,offset:o}=Ws(e,2);s&&o>0&&e.setEnd(s,o)}return e}function Ga(i){switch(i.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:return i.textContent?.length??0;default:return 0}}function Bs(i){let e=i.previousSibling,t=0;for(;e;)t+=Ga(e),e=e.previousSibling;return t}function Xa(i,...e){let t=e.shift();const r=i.ownerDocument.createNodeIterator(i,NodeFilter.SHOW_TEXT),n=[];let s=r.nextNode(),o,a=0;for(;t!==void 0&&s;)o=s,a+o.data.length>t?(n.push({node:o,offset:t-a}),t=e.shift()):(s=r.nextNode(),a+=o.data.length);for(;t!==void 0&&o&&a===t;)n.push({node:o,offset:o.data.length}),t=e.shift();if(t!==void 0)throw new RangeError("Offset exceeds text length");return n}let di=class wt{constructor(e,t){if(t<0)throw new Error("Offset is invalid");this.element=e,this.offset=t}relativeTo(e){if(!e.contains(this.element))throw new Error("Parent is not an ancestor of current element");let t=this.element,r=this.offset;for(;t!==e;)r+=Bs(t),t=t.parentElement;return new wt(t,r)}resolve(e={}){try{return Xa(this.element,this.offset)[0]}catch(t){if(this.offset===0&&e.direction!==void 0){const r=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);r.currentNode=this.element;const n=e.direction===1,s=n?r.nextNode():r.previousNode();if(!s)throw t;return{node:s,offset:n?0:s.data.length}}else throw t}}static fromCharOffset(e,t){switch(e.nodeType){case Node.TEXT_NODE:return wt.fromPoint(e,t);case Node.ELEMENT_NODE:return new wt(e,t);default:throw new Error("Node is not an element or text node")}}static fromPoint(e,t){switch(e.nodeType){case Node.TEXT_NODE:{if(t<0||t>e.data.length)throw new Error("Text node offset is out of range");if(!e.parentElement)throw new Error("Text node has no parent");const r=Bs(e)+t;return new wt(e.parentElement,r)}case Node.ELEMENT_NODE:{if(t<0||t>e.childNodes.length)throw new Error("Child node offset is out of range");let r=0;for(let n=0;n<t;n++)r+=Ga(e.childNodes[n]);return new wt(e,r)}default:throw new Error("Point is not in an element or text node")}}},Jr=class jt{constructor(e,t){this.start=e,this.end=t}relativeTo(e){return new jt(this.start.relativeTo(e),this.end.relativeTo(e))}toRange(){let e,t;this.start.element===this.end.element&&this.start.offset<=this.end.offset?[e,t]=Xa(this.start.element,this.start.offset,this.end.offset):(e=this.start.resolve({direction:1}),t=this.end.resolve({direction:2}));const r=new Range;return r.setStart(e.node,e.offset),r.setEnd(t.node,t.offset),r}static fromRange(e){const t=di.fromPoint(e.startContainer,e.startOffset),r=di.fromPoint(e.endContainer,e.endOffset);return new jt(t,r)}static fromOffsets(e,t,r){return new jt(new di(e,t),new di(e,r))}static trimmedRange(e){return Rc(jt.fromRange(e).toRange())}},Lc=class Kr{constructor(e,t,r){this.root=e,this.start=t,this.end=r}static fromRange(e,t){const r=Jr.fromRange(t).relativeTo(e);return new Kr(e,r.start.offset,r.end.offset)}static fromSelector(e,t){return new Kr(e,t.start,t.end)}toSelector(){return{type:"TextPositionSelector",start:this.start,end:this.end}}toRange(){return Jr.fromOffsets(this.root,this.start,this.end).toRange()}};class Fi{constructor(e,t,r={}){this.root=e,this.exact=t,this.context=r}static fromRange(e,t){const r=e.textContent,n=Jr.fromRange(t).relativeTo(e),s=n.start.offset,o=n.end.offset,a=32;return new Fi(e,r.slice(s,o),{prefix:r.slice(Math.max(0,s-a),s),suffix:r.slice(o,Math.min(r.length,o+a))})}static fromSelector(e,t){const{prefix:r,suffix:n}=t;return new Fi(e,t.exact,{prefix:r,suffix:n})}toSelector(){return{type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}}toRange(e={}){return this.toPositionAnchor(e).toRange()}toPositionAnchor(e={}){const t=this.root.textContent,r=Oc(t,this.exact,{...this.context,hint:e.hint});if(!r)throw new Error("Quote not found");return new Lc(this.root,r.start,r.end)}}function Ic(i){const e=i.tagName.toUpperCase();return e==="IMG"||e==="VIDEO"||e==="AUDIO"||e==="IFRAME"||e==="OBJECT"||e==="EMBED"||e==="CANVAS"}function sr(i,e){try{const t=e.locations,r=e.text;if(r&&r.highlight){let n;t&&t.getCssSelector()&&(n=i.querySelector(t.getCssSelector())),n||(n=i.body);const s=new Fi(n,r.highlight,{prefix:r.before,suffix:r.after});try{return s.toRange()}catch{return console.warn("Quote not found:",s),null}}if(t){let n=null;if(!n&&t.getCssSelector()&&(n=i.querySelector(t.getCssSelector())),!n&&t.fragments){for(const s of t.fragments)if(n=i.getElementById(s),n)break}if(n){const s=i.createRange();return n.childNodes.length===0||Ic(n)?(s.selectNode(n),s):(s.setStartBefore(n),s.setEndAfter(n),s)}}}catch(t){console.error(t)}return null}function Nc(i,e){let t=i.getClientRects();t.length||i.commonAncestorContainer.nodeType===Node.ELEMENT_NODE&&(t=i.commonAncestorContainer.getClientRects());const r=1,n=[];for(const l of t)n.push({bottom:l.bottom,height:l.height,left:l.left,right:l.right,top:l.top,width:l.width});const s=Ya(n,r),o=kc(s,r),a=Ja(o),h=4;for(let l=a.length-1;l>=0;l--){const u=a[l];if(!(u.width*u.height>h))if(a.length>1)a.splice(l,1);else break}return a}function Ya(i,e,t){for(let r=0;r<i.length;r++)for(let n=r+1;n<i.length;n++){const s=i[r],o=i[n];if(s===o)continue;const a=Se(s.top,o.top,e)&&Se(s.bottom,o.bottom,e),h=Se(s.left,o.left,e)&&Se(s.right,o.right,e);if(a&&!h&&Ka(s,o,e)){const l=i.filter(c=>c!==s&&c!==o),u=zc(s,o);return l.push(u),Ya(l,e)}}return i}function zc(i,e){const t=Math.min(i.left,e.left),r=Math.max(i.right,e.right),n=Math.min(i.top,e.top),s=Math.max(i.bottom,e.bottom);return{bottom:s,height:s-n,left:t,right:r,top:n,width:r-t}}function kc(i,e){const t=new Set(i);for(const r of i){if(!(r.width>1&&r.height>1)){t.delete(r);continue}for(const n of i)if(r!==n&&t.has(n)&&Mc(n,r,e)){t.delete(r);break}}return Array.from(t)}function Mc(i,e,t){return pi(i,e.left,e.top,t)&&pi(i,e.right,e.top,t)&&pi(i,e.left,e.bottom,t)&&pi(i,e.right,e.bottom,t)}function pi(i,e,t,r){return(i.left<e||Se(i.left,e,r))&&(i.right>e||Se(i.right,e,r))&&(i.top<t||Se(i.top,t,r))&&(i.bottom>t||Se(i.bottom,t,r))}function Ja(i){for(let e=0;e<i.length;e++)for(let t=e+1;t<i.length;t++){const r=i[e],n=i[t];if(r!==n&&Ka(r,n,-1)){let s=[],o;const a=$s(r,n);if(a.length===1)s=a,o=r;else{const l=$s(n,r);a.length<l.length?(s=a,o=r):(s=l,o=n)}const h=i.filter(l=>l!==o);return Array.prototype.push.apply(h,s),Ja(h)}}return i}function $s(i,e){const t=Dc(e,i);if(t.height===0||t.width===0)return[i];const r=[];{const n={bottom:i.bottom,height:0,left:i.left,right:t.left,top:i.top,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}{const n={bottom:t.top,height:0,left:t.left,right:t.right,top:i.top,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}{const n={bottom:i.bottom,height:0,left:t.left,right:t.right,top:t.bottom,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}{const n={bottom:i.bottom,height:0,left:t.right,right:i.right,top:i.top,width:0};n.width=n.right-n.left,n.height=n.bottom-n.top,n.height!==0&&n.width!==0&&r.push(n)}return r}function Dc(i,e){const t=Math.max(i.left,e.left),r=Math.min(i.right,e.right),n=Math.max(i.top,e.top),s=Math.min(i.bottom,e.bottom);return{bottom:s,height:Math.max(0,s-n),left:t,right:r,top:n,width:Math.max(0,r-t)}}function Ka(i,e,t){return(i.left<e.right||t>=0&&Se(i.left,e.right,t))&&(e.left<i.right||t>=0&&Se(e.left,i.right,t))&&(i.top<e.bottom||t>=0&&Se(i.top,e.bottom,t))&&(e.top<i.bottom||t>=0&&Se(e.top,i.bottom,t))}function Se(i,e,t){return Math.abs(i-e)<=t}function Za(i){const e={},t=i.document.documentElement.style;for(const r in i.document.documentElement.style)Object.hasOwn(t,r)&&!Number.isNaN(Number.parseInt(r))&&(e[t[r]]=t.getPropertyValue(t[r]));return e}function Fc(i,e){const t=Za(i);Object.keys(t).forEach(r=>{e.hasOwnProperty(r)||Ln(i,r)}),Object.entries(e).forEach(([r,n])=>{t[r]!==n&&Ui(i,r,n)})}function Hs(i,e){return i.document.documentElement.style.getPropertyValue(e)}function Ui(i,e,t){i.document.documentElement.style.setProperty(e,t)}function Ln(i,e){i.document.documentElement.style.removeProperty(e)}const Uc=i=>{if(i.startsWith("rgb")){const e=i.match(/rgb\((\d+),\s(\d+),\s(\d+)(?:,\s(\d+))?\)/);if(e)return{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10),a:e[4]?parseInt(e[4],10)/255:1}}else if(i.startsWith("#")){const e=i.slice(1);if(e.length===3||e.length===4)return{r:parseInt(e[0]+e[0],16)/255,g:parseInt(e[1]+e[1],16)/255,b:parseInt(e[2]+e[2],16)/255,a:e.length===4?parseInt(e[3]+e[3],16)/255:1};if(e.length===6||e.length===8)return{r:parseInt(e[0]+e[1],16)/255,g:parseInt(e[2]+e[3],16)/255,b:parseInt(e[4]+e[5],16)/255,a:e.length===8?parseInt(e[6]+e[7],16)/255:1}}return{r:0,g:0,b:0,a:1}},Wc=i=>.2126*i.r*i.a+.7152*i.g*i.a+.0722*i.b*i.a,Bc=i=>{const e=Uc(i);return Wc(e)<128},$c=()=>"Highlight"in window,js=["IMG","IMAGE","AUDIO","VIDEO","SVG"];class Hc{constructor(e,t,r,n){this.wnd=e,this.comms=t,this.id=r,this.name=n,this.items=[],this.lastItemId=0,this.container=void 0,this.activateable=!1,this.experimentalHighlights=!1,this.currentRender=0,$c()&&(this.experimentalHighlights=!0,this.notTextFlag=new Map)}get activeable(){return this.activateable}set activeable(e){this.activateable=e}add(e){const t=`${this.id}-${this.lastItemId++}`,r=sr(this.wnd.document,e.locator);if(!r){this.comms.log("Can't locate DOM range for decoration",e);return}const n=r.commonAncestorContainer;n.nodeType!==Node.TEXT_NODE&&this.experimentalHighlights&&(js.includes(n.nodeName.toUpperCase())&&this.notTextFlag?.set(t,!0),n.querySelector(js.join(", ").toLowerCase())&&this.notTextFlag?.set(t,!0),(n.textContent?.trim()||"").length===0&&this.notTextFlag?.set(t,!0));const s={decoration:e,id:t,range:r};this.items.push(s),this.layout(s),this.renderLayout([s])}remove(e){const t=this.items.findIndex(n=>n.decoration.id===e);if(t<0)return;const r=this.items[t];this.items.splice(t,1),r.clickableElements=void 0,r.container&&(r.container.remove(),r.container=void 0),this.experimentalHighlights&&!this.notTextFlag?.has(r.id)&&this.wnd.CSS.highlights.get(this.id)?.delete(r.range),this.notTextFlag?.delete(r.id)}update(e){this.remove(e.id),this.add(e)}clear(){this.clearContainer(),this.items.length=0,this.notTextFlag?.clear()}requestLayout(){this.wnd.cancelAnimationFrame(this.currentRender),this.clearContainer(),this.items.forEach(e=>this.layout(e)),this.renderLayout(this.items)}experimentalLayout(e){const[t,r]=this.requireContainer(!0);r.add(e.range),t.innerHTML=`
        ::highlight(${this.id}) {
            color: black;
            background-color: ${e.decoration?.style?.tint??"yellow"};
        }`}layout(e){if(this.experimentalHighlights&&!this.notTextFlag?.has(e.id))return this.experimentalLayout(e);const t=this.wnd.document.createElement("div");t.setAttribute("id",e.id),t.style.setProperty("pointer-events","none");const r=this.wnd.innerWidth,n=parseInt(getComputedStyle(this.wnd.document.documentElement).getPropertyValue("column-count")),s=r/(n||1),o=this.wnd.document.scrollingElement,a=o.scrollLeft,h=o.scrollTop,l=(d,m,y)=>{if(d.style.position="absolute",e.decoration?.style?.width==="viewport"){d.style.width=`${r}px`,d.style.height=`${m.height}px`;let x=Math.floor(m.left/r)*r;d.style.left=`${x+a}px`,d.style.top=`${m.top+h}px`}else if(e.decoration?.style?.width==="bounds")d.style.width=`${y.width}px`,d.style.height=`${m.height}px`,d.style.left=`${y.left+a}px`,d.style.top=`${m.top+h}px`;else if(e.decoration?.style?.width==="page"){d.style.width=`${s}px`,d.style.height=`${m.height}px`;let x=Math.floor(m.left/s)*s;d.style.left=`${x+a}px`,d.style.top=`${m.top+h}px`}else d.style.width=`${m.width}px`,d.style.height=`${m.height}px`,d.style.left=`${m.left+a}px`,d.style.top=`${m.top+h}px`},u=e.range.getBoundingClientRect();let c=this.wnd.document.createElement("template");const f=Hs(this.wnd,"--USER__appearance")==="readium-night-on"||Bc(Hs(this.wnd,"--USER__backgroundColor"));c.innerHTML=`
        <div
            class="r2-highlight-0"
            style="${[`background-color: ${e.decoration?.style?.tint??"yellow"} !important`,`mix-blend-mode: ${f?"exclusion":"multiply"} !important`,"opacity: 1 !important","box-sizing: border-box !important"].join("; ")}"
        >
        </div>
        `.trim();const g=c.content.firstElementChild;if(e.decoration?.style?.layout==="bounds"){const d=g.cloneNode(!0);d.style.setProperty("pointer-events","none"),l(d,u,u),t.append(d)}else{let d=Nc(e.range);d=d.sort((m,y)=>m.top<y.top?-1:m.top>y.top?1:0);for(let m of d){const y=g.cloneNode(!0);y.style.setProperty("pointer-events","none"),l(y,m,u),t.append(y)}}e.container=t,e.clickableElements=Array.from(t.querySelectorAll("[data-activable='1']")),e.clickableElements.length||(e.clickableElements=Array.from(t.children))}renderLayout(e){this.wnd.cancelAnimationFrame(this.currentRender),this.currentRender=this.wnd.requestAnimationFrame(()=>{e=e.filter(t=>!this.experimentalHighlights||!!this.notTextFlag?.has(t.id)),!(!e||e.length===0)&&this.requireContainer().append(...e.map(t=>t.container).filter(t=>!!t))})}requireContainer(e=!1){if(e){let t;this.wnd.document.getElementById(`${this.id}-style`)?t=this.wnd.document.getElementById(`${this.id}-style`):(t=this.wnd.document.createElement("style"),t.dataset.readium="true",t.id=`${this.id}-style`,this.wnd.document.head.appendChild(t));let r;return this.wnd.CSS.highlights.has(this.id)?r=this.wnd.CSS.highlights.get(this.id):(r=new this.wnd.Highlight,this.wnd.CSS.highlights.set(this.id,r)),[t,r]}return this.container||(this.container=this.wnd.document.createElement("div"),this.container.setAttribute("id",this.id),this.container.dataset.group=this.name,this.container.dataset.readium="true",this.container.style.setProperty("pointer-events","none"),this.container.style.display="contents",this.wnd.document.body.append(this.container)),this.container}clearContainer(){this.experimentalHighlights&&this.wnd.CSS.highlights.delete(this.id),this.container&&(this.container.remove(),this.container=void 0)}}const Qa=class Zr extends oi{constructor(){super(...arguments),this.resizeFrame=0,this.lastGroupId=0,this.groups=new Map,this.handleResizer=this.handleResize.bind(this)}cleanup(){this.groups.forEach(e=>e.clear()),this.groups.clear()}handleResize(){this.wnd.clearTimeout(this.resizeFrame),this.resizeFrame=this.wnd.setTimeout(()=>{this.groups.forEach(e=>{e.experimentalHighlights||e.requestLayout()})},50)}mount(e,t){return this.wnd=e,t.register("decorate",Zr.moduleName,(r,n)=>{const s=r;s.decoration&&s.decoration.locator&&(s.decoration.locator=Mt.deserialize(s.decoration.locator)),this.groups.has(s.group)||this.groups.set(s.group,new Hc(e,t,`readium-decoration-${this.lastGroupId++}`,s.group));const o=this.groups.get(s.group);switch(s.action){case"add":o?.add(s.decoration);break;case"remove":o?.remove(s.decoration.id);break;case"clear":o?.clear();break;case"update":o?.update(s.decoration);break}n(!0)}),this.resizeObserver=new ResizeObserver(()=>e.requestAnimationFrame(()=>this.handleResize())),this.resizeObserver.observe(e.document.body),e.addEventListener("orientationchange",this.handleResizer),e.addEventListener("resize",this.handleResizer),t.log("Decorator Mounted"),!0}unmount(e,t){return e.removeEventListener("orientationchange",this.handleResizer),e.removeEventListener("resize",this.handleResizer),t.unregisterAll(Zr.moduleName),this.resizeObserver.disconnect(),this.cleanup(),t.log("Decorator Unmounted"),!0}};Qa.moduleName="decorator";let jc=Qa;const qs="readium-snapper-style",el=class Qr extends oi{constructor(){super(...arguments),this.protected=!1}buildStyles(){return`
        html, body {
            touch-action: manipulation;
            user-select: ${this.protected?"none":"auto"};
        }`}mount(e,t){const r=e.document.createElement("style");return r.dataset.readium="true",r.id=qs,r.textContent=this.buildStyles(),e.document.head.appendChild(r),t.register("protect",Qr.moduleName,(n,s)=>{this.protected=!0,r.textContent=this.buildStyles(),s(!0)}),t.register("unprotect",Qr.moduleName,(n,s)=>{this.protected=!1,r.textContent=this.buildStyles(),s(!0)}),t.log("Snapper Mounted"),!0}unmount(e,t){return e.document.getElementById(qs)?.remove(),t.log("Snapper Unmounted"),!0}};el.moduleName="snapper";let In=el;function Qe(i){return i.document.body.dir.toLowerCase()==="rtl"}function tl(i){return parseInt(i.getComputedStyle(i.document.documentElement).getPropertyValue("column-count"))}function qc(i){const e=getComputedStyle(i),t=parseFloat(e.paddingTop||"0"),r=parseFloat(e.paddingBottom||"0");return i.clientHeight-t-r}function Vs(i){const e=tl(i);if(!e)return!1;const t=i.document.querySelectorAll("div[id^='readium-virtual-page']");for(const h of t)h.remove();const r=t.length,n=i.document.scrollingElement.scrollWidth,s=i.visualViewport.width,o=Math.round(n/s*e)%e,a=e===1||o===0?0:e-o;if(a>0)for(let h=0;h<a;h++){const l=i.document.createElement("div");l.setAttribute("id",`readium-virtual-page-${h}`),l.dataset.readium="true",CSS.supports("break-before","column")?l.style.breakBefore="column":(CSS.supports("break-inside","avoid-column")&&(l.style.breakInside="avoid-column"),l.style.height=qc(i.document.documentElement)+"px"),l.innerHTML="&#8203;",i.document.body.appendChild(l)}return r!==a}function il(i){const e=i.document.createElement("style");e.appendChild(i.document.createTextNode("*{}")),i.document.body.appendChild(e),i.document.body.removeChild(e)}function Vc(i){return i<.5?2*i*i:-1+(4-2*i)*i}function J(i){const e=i.getSelection();e&&e.removeAllRanges()}const Gc=["a","audio","button","canvas","details","input","label","option","select","submit","textarea","video"];function rl(i){return Gc.indexOf(i.nodeName.toLowerCase())!==-1||i.hasAttribute("contenteditable")&&i.getAttribute("contenteditable")?.toLowerCase()!=="false"?i:i.parentElement?rl(i.parentElement):null}function Nn(i,e){const t=nl(i,i.document.body,e),r=i._readium_cssSelectorGenerator.getCssSelector(t,{selectors:["tag","id","class","nthchild","nthoftype","attribute"]});return new Mt({href:"#",type:"application/xhtml+xml",locations:new re({otherLocations:new Map([["cssSelector",r]])}),text:new si({highlight:t.textContent||void 0})})}function nl(i,e,t){for(var r=0;r<e.children.length;r++){const n=e.children[r];if(!Jc(n)&&Xc(i,n,t))return Yc(i,n)?n:nl(i,n,t)}return e}function Xc(i,e,t){if(e===document.body||e===document.documentElement)return!0;if(!document||!document.documentElement||!document.body)return!1;const r=e.getBoundingClientRect();return t?r.bottom>0&&r.top<i.innerHeight:r.right>0&&r.left<i.innerWidth}function Yc(i,e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=i.innerHeight&&t.right<=i.innerWidth}function Jc(i){const e=getComputedStyle(i);if(e){const t=e.getPropertyValue("display");if(t!="block"&&t!="list-item"||e.getPropertyValue("opacity")==="0")return!0}return!1}const Gs="readium-column-snapper-style",Kc=200,sl=class pe extends In{constructor(){super(...arguments),this.shakeTimeout=0,this.snappingCancelled=!1,this.alreadyScrollLeft=0,this.overscroll=0,this.cachedScrollWidth=0,this.touchState=0,this.startingX=void 0,this.endingX=void 0,this.onTouchStarter=this.onTouchStart.bind(this),this.onTouchEnder=this.onTouchEnd.bind(this),this.onWidthChanger=this.onWidthChange.bind(this),this.onTouchMover=this.onTouchMove.bind(this)}doc(){return this.wnd.document.scrollingElement}scrollOffset(){return this.doc().scrollLeft>0?this.doc().scrollLeft:this.alreadyScrollLeft}snapOffset(e){const t=e+(Qe(this.wnd)?-1:1);return t-t%this.wnd.innerWidth}reportProgress(){const e=this.wnd.scrollX,t=this.cachedScrollWidth,r=Math.max(0,Math.min(1,e/t)),n=Math.max(0,Math.min(1,(e+this.wnd.innerWidth)/t));this.comms.send("progress",{start:r,end:n})}shake(){if(this.overscroll!==0||this.shakeTimeout!==0)return;const e=this.doc();e.classList.add(Qe(this.wnd)?"readium-bounce-l":"readium-bounce-r");const t=this.scrollOffset();this.shakeTimeout=this.wnd.setTimeout(()=>{e.classList.remove("readium-bounce-l"),e.classList.remove("readium-bounce-r"),this.shakeTimeout=0,this.doc().scrollLeft=t},150)}takeOverSnap(){this.snappingCancelled=!0,this.clearTouches();const e=this.doc();this.overscroll=e.style.transform?.length>12?parseFloat(e.style.transform.slice(12).split("px")[0]):0}snapCurrentOffset(e=!1,t=!1){const r=this.wnd.scrollX>0?this.wnd.scrollX:this.alreadyScrollLeft,n=this.doc(),s=this.dragOffset(),o=tl(this.wnd),a=Math.min(Math.max(0,r),this.cachedScrollWidth),h=Qe(this.wnd)?-1:1,l=h*(this.wnd.innerWidth/3)*(h*s>0?2:1),u=this.snapOffset(a+l);if(e&&u!==this.scrollOffset()){this.snappingCancelled=!1;const c=(m,y,x,R)=>x>R?y:m+(y-m)*Vc(x/R),f=Kc*o;let g;const d=m=>{if(this.snappingCancelled)return;g||(g=m);const y=m-g,x=c(this.overscroll,0,y,f),R=c(r,u,y,f);n.scrollLeft=R,this.overscroll!==0&&(n.style.transform=`translate3d(${-x}px, 0px, 0px)`),y<f?this.wnd.requestAnimationFrame(d):(this.clearTouches(),n.style.removeProperty("transform"),n.scrollLeft=u,t||this.reportProgress())};this.wnd.requestAnimationFrame(d)}else n.style.removeProperty("transform"),this.wnd.requestAnimationFrame(()=>{n.scrollLeft=u,this.clearTouches(),t||this.reportProgress()})}dragOffset(){return(this.startingX??0)-(this.endingX??0)}clearTouches(){this.startingX=void 0,this.endingX=void 0,this.overscroll=0}onTouchStart(e){switch(e.stopPropagation(),this.takeOverSnap(),e.touches.length){case 1:break;case 2:this.onTouchEnd(e);return;default:{this.onTouchEnd(e),this.comms.send("tap_more",e.touches.length);return}}this.startingX=e.touches[0].clientX,this.alreadyScrollLeft=this.doc().scrollLeft,this.touchState=1}onTouchEnd(e){if(this.touchState===2){const t=this.dragOffset(),r=this.scrollOffset();this.cachedScrollWidth<=this.wnd.innerWidth?(this.reportProgress(),t>5&&this.comms.send("no_more",void 0),t<-5&&this.comms.send("no_less",void 0)):r<5&&t<5?(this.alreadyScrollLeft=0,this.comms.send("no_less",void 0)):this.cachedScrollWidth-r-this.wnd.innerWidth<5&&t>5&&(this.alreadyScrollLeft=this.cachedScrollWidth,this.comms.send("no_more",void 0)),this.snapCurrentOffset(!0),this.comms.send("swipe",t)}this.touchState=0}onWidthChange(){this.cachedScrollWidth=this.doc().scrollWidth,this.comms.ready&&this.snapCurrentOffset()}onTouchMove(e){if(this.touchState===0)return;this.touchState===1&&(this.touchState=2,J(this.wnd)),this.endingX=e.touches[0].clientX;const t=this.dragOffset(),r=this.alreadyScrollLeft+t;r<0?(this.overscroll=r,this.doc().style.transform=`translate3d(${-this.overscroll}px, 0px, 0px)`):r+this.wnd.innerWidth>this.cachedScrollWidth?(this.overscroll=r,this.doc().style.transform=`translate3d(${-r}px, 0px, 0px)`):(this.overscroll=0,this.doc().style.removeProperty("transform"),this.doc().scrollLeft=this.alreadyScrollLeft+t)}mount(e,t){if(this.wnd=e,this.comms=t,!super.mount(e,t))return!1;e.navigator.epubReadingSystem&&(e.navigator.epubReadingSystem.layoutStyle="paginated");const r=e.document.createElement("style");r.dataset.readium="true",r.id=Gs,r.textContent=`
        @keyframes readium-bounce-l-animation {
            0%, 100% {transform: translate3d(0, 0, 0);}
            50% {transform: translate3d(-50px, 0, 0);}
        }

        @keyframes readium-bounce-r-animation {
            0%, 100% {transform: translate3d(0, 0, 0);}
            50% {transform: translate3d(50px, 0, 0);}
        }

        .readium-bounce-l {
            animation: readium-bounce-l-animation 150ms ease-out 1;
        }

        .readium-bounce-r {
            animation: readium-bounce-r-animation 150ms ease-out 1;
        }

        html {
            overflow: hidden;
        }

        body {
            -ms-overflow-style: none; /* for Internet Explorer, Edge */
        }

        * {
            scrollbar-width: none; /* for Firefox */
        }
        
        body::-webkit-scrollbar {
            display: none; /* for Chrome, Safari, and Opera */
        }
        `,e.document.head.appendChild(r),this.resizeObserver=new ResizeObserver(()=>{e.requestAnimationFrame(()=>{e&&Vs(e)}),this.onWidthChange()}),this.resizeObserver.observe(e.document.body),this.mutationObserver=new MutationObserver(s=>{for(const o of s)if(o.target===this.wnd.document.documentElement){const a=o.oldValue,h=o.target.getAttribute("style"),l=/transform\s*:\s*([^;]+)/,u=a?.match(l),c=h?.match(l);(!u&&!c||u&&!c||u&&c&&u[1]!==c[1])&&(e.requestAnimationFrame(()=>{e&&Vs(e)}),this.onWidthChange())}else e.requestAnimationFrame(()=>this.cachedScrollWidth=this.doc().scrollWidth)}),e.frameElement&&this.mutationObserver.observe(e.frameElement,{attributes:!0,attributeFilter:["style"]}),this.mutationObserver.observe(e.document,{attributes:!0,attributeFilter:["style"]}),this.mutationObserver.observe(e.document.documentElement,{attributes:!0,attributeFilter:["style"]});const n=s=>{const o=this.doc().scrollLeft;return this.doc().scrollLeft=this.snapOffset(s),o!==this.doc().scrollLeft};return e.addEventListener("orientationchange",this.onWidthChanger),e.addEventListener("resize",this.onWidthChanger),e.requestAnimationFrame(()=>this.cachedScrollWidth=this.doc().scrollWidth),t.register("go_progression",pe.moduleName,(s,o)=>{const a=s;if(a<0||a>1){t.send("error",{message:"go_progression must be given a position from 0.0 to 1.0"}),o(!1);return}this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const h=this.cachedScrollWidth,l=Qe(e)?-1:1,u=h*a*l;this.doc().scrollLeft=this.snapOffset(u),this.reportProgress(),J(this.wnd),o(!0)})}),t.register("go_id",pe.moduleName,(s,o)=>{const a=e.document.getElementById(s);if(!a){o(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollLeft=this.snapOffset(a.getBoundingClientRect().left+e.scrollX),this.reportProgress(),J(this.wnd),o(!0)})}),t.register("go_text",pe.moduleName,(s,o)=>{let a;Array.isArray(s)&&(s.length>1&&(a=s[1]),s=s[0]);const h=si.deserialize(s),l=sr(this.wnd.document,new Mt({href:e.location.href,type:"text/html",text:h,locations:a?new re({otherLocations:new Map([["cssSelector",a]])}):void 0}));if(!l){o(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollLeft=this.snapOffset(l.getBoundingClientRect().left+e.scrollX),this.reportProgress(),J(this.wnd),o(!0)})}),t.register("go_end",pe.moduleName,(s,o)=>{const a=Qe(e)?-1:1;this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const h=this.cachedScrollWidth*a;if(this.doc().scrollLeft===h)return o(!1);this.doc().scrollLeft=this.snapOffset(h),this.reportProgress(),J(this.wnd),o(!0)})}),t.register("go_start",pe.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{if(this.doc().scrollLeft===0)return o(!1);this.doc().scrollLeft=0,this.reportProgress(),J(this.wnd),o(!0)})}),t.register("go_prev",pe.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const a=e.scrollX-e.innerWidth,h=Qe(e)?-(this.cachedScrollWidth-e.innerWidth):0,l=n(Math.max(a,h));l&&(this.reportProgress(),J(this.wnd)),o(l)})}),t.register("go_next",pe.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth;const a=e.scrollX+e.innerWidth,h=Qe(e)?0:this.cachedScrollWidth-e.innerWidth,l=n(Math.min(a,h));l&&(this.reportProgress(),J(this.wnd)),o(l)})}),t.register("unfocus",pe.moduleName,(s,o)=>{this.snappingCancelled=!0,J(this.wnd),o(!0)}),t.register("shake",pe.moduleName,(s,o)=>{this.shake(),o(!0)}),t.register("focus",pe.moduleName,(s,o)=>{this.wnd.requestAnimationFrame(()=>{this.cachedScrollWidth=this.doc().scrollWidth,this.snapCurrentOffset(!1,!0),this.reportProgress(),o(!0)})}),t.register("first_visible_locator",pe.moduleName,(s,o)=>{const a=Nn(e,!1);this.comms.send("first_visible_locator",a.serialize()),o(!0)}),e.addEventListener("touchstart",this.onTouchStarter,{passive:!0}),e.addEventListener("touchend",this.onTouchEnder,{passive:!0}),e.addEventListener("touchmove",this.onTouchMover,{passive:!0}),e.document.addEventListener("touchstart",()=>{}),t.log("ColumnSnapper Mounted"),!0}unmount(e,t){return this.snappingCancelled=!0,t.unregisterAll(pe.moduleName),this.resizeObserver.disconnect(),this.mutationObserver.disconnect(),e.removeEventListener("touchstart",this.onTouchStarter),e.removeEventListener("touchend",this.onTouchEnder),e.removeEventListener("touchmove",this.onTouchMover),e.removeEventListener("orientationchange",this.onWidthChanger),e.removeEventListener("resize",this.onWidthChanger),e.document.getElementById(Gs)?.remove(),t.log("ColumnSnapper Unmounted"),super.unmount(e,t)}};sl.moduleName="column_snapper";let Zc=sl;const Xs="readium-scroll-snapper-style",ol=class be extends In{constructor(){super(...arguments),this.initialScrollHandled=!1,this.isScrolling=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce=null,this.handleScroll=()=>{if(this.comms.ready&&!this.isResizing){if(!this.initialScrollHandled){this.lastScrollTop=this.doc().scrollTop,this.initialScrollHandled=!0,this.reportProgress();return}this.isScrolling||(this.isScrolling=!0,this.wnd.requestAnimationFrame(()=>{this.reportProgress();const e=this.doc().scrollTop,t=e-this.lastScrollTop;this.lastScrollTop=e,this.comms.send("scroll",t),this.isScrolling=!1}))}}}doc(){return this.wnd.document.scrollingElement}reportProgress(){if(!this.comms.ready)return;const e=Math.ceil(this.doc().scrollTop),t=this.doc().scrollHeight,r=this.wnd.innerHeight,n=Math.max(0,Math.min(1,e/t)),s=Math.max(0,Math.min(1,(e+r)/t));this.comms.send("progress",{start:n,end:s})}mount(e,t){this.wnd=e,this.comms=t,this.initialScrollHandled=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce&&(this.wnd.clearTimeout(this.resizeDebounce),this.resizeDebounce=null),e.navigator.epubReadingSystem&&(e.navigator.epubReadingSystem.layoutStyle="scrolling");const r=e.document.createElement("style");return r.dataset.readium="true",r.id=Xs,r.textContent=`
        * {
            scrollbar-width: none; /* for Firefox */
        }
        
        body::-webkit-scrollbar {
            display: none; /* for Chrome, Safari, and Opera */
        }
        `,e.document.head.appendChild(r),this.resizeObserver=new ResizeObserver(()=>{this.resizeDebounce&&this.wnd.clearTimeout(this.resizeDebounce),this.isResizing=!0,this.resizeDebounce=this.wnd.setTimeout(()=>{this.isResizing=!1,this.resizeDebounce=null,this.reportProgress()},50)}),this.resizeObserver.observe(e.document.body),e.addEventListener("scroll",this.handleScroll,{passive:!0}),t.register("force_webkit_recalc",be.moduleName,()=>{il(this.wnd);const n=this.doc().scrollTop;n>1?this.doc().scrollTop=n-1:this.doc().scrollTop=n+1,this.doc().scrollTop=n}),t.register("go_progression",be.moduleName,(n,s)=>{const o=n;if(o<0||o>1){t.send("error",{message:"go_progression must be given a position from 0.0 to 1.0"}),s(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=this.doc().offsetHeight*o,this.reportProgress(),J(this.wnd),s(!0)})}),t.register("go_id",be.moduleName,(n,s)=>{const o=e.document.getElementById(n);if(!o){s(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=o.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),J(this.wnd),s(!0)})}),t.register("go_text",be.moduleName,(n,s)=>{let o;Array.isArray(n)&&(n.length>1&&(o=n[1]),n=n[0]);const a=si.deserialize(n),h=sr(this.wnd.document,new Mt({href:e.location.href,type:"text/html",text:a,locations:o?new re({otherLocations:new Map([["cssSelector",o]])}):void 0}));if(!h){s(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=h.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),J(this.wnd),s(!0)})}),t.register("go_start",be.moduleName,(n,s)=>{if(this.doc().scrollTop===0)return s(!1);this.doc().scrollTop=0,this.reportProgress(),s(!0)}),t.register("go_end",be.moduleName,(n,s)=>{if(this.doc().scrollTop===this.doc().scrollHeight-this.doc().offsetHeight)return s(!1);this.doc().scrollTop=this.doc().scrollHeight-this.doc().offsetHeight,this.reportProgress(),s(!0)}),t.register("unfocus",be.moduleName,(n,s)=>{J(this.wnd),s(!0)}),t.register(["go_next","go_prev"],be.moduleName,(n,s)=>s(!1)),t.register("focus",be.moduleName,(n,s)=>{this.reportProgress(),s(!0)}),t.register("first_visible_locator",be.moduleName,(n,s)=>{const o=Nn(e,!0);this.comms.send("first_visible_locator",o.serialize()),s(!0)}),t.log("ScrollSnapper Mounted"),!0}unmount(e,t){return t.unregisterAll(be.moduleName),this.resizeObserver.disconnect(),this.handleScroll&&e.removeEventListener("scroll",this.handleScroll),e.document.getElementById(Xs)?.remove(),t.log("ScrollSnapper Unmounted"),!0}};ol.moduleName="scroll_snapper";let Qc=ol;const al=class ve extends In{constructor(){super(...arguments),this.initialScrollHandled=!1,this.isScrolling=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce=null,this.handleScroll=()=>{if(this.comms.ready&&!this.isResizing){if(!this.initialScrollHandled){this.lastScrollTop=this.doc().scrollTop,this.initialScrollHandled=!0,this.reportProgress();return}this.isScrolling||(this.isScrolling=!0,this.wnd.requestAnimationFrame(()=>{this.reportProgress();const e=this.doc().scrollTop,t=e-this.lastScrollTop;this.lastScrollTop=e,this.comms.send("scroll",t),this.isScrolling=!1}))}}}doc(){return this.wnd.document.scrollingElement}reportProgress(){if(!this.comms.ready)return;const e=Math.ceil(this.doc().scrollTop),t=this.doc().scrollHeight,r=this.wnd.innerHeight,n=Math.max(0,Math.min(1,e/t)),s=Math.max(0,Math.min(1,(e+r)/t));this.comms.send("progress",{start:n,end:s})}mount(e,t){return this.wnd=e,this.comms=t,this.initialScrollHandled=!1,this.lastScrollTop=0,this.isResizing=!1,this.resizeDebounce&&(this.wnd.clearTimeout(this.resizeDebounce),this.resizeDebounce=null),this.resizeObserver=new ResizeObserver(()=>{this.resizeDebounce&&this.wnd.clearTimeout(this.resizeDebounce),this.isResizing=!0,this.resizeDebounce=this.wnd.setTimeout(()=>{this.isResizing=!1,this.resizeDebounce=null,this.reportProgress()},50)}),this.resizeObserver.observe(e.document.body),e.addEventListener("scroll",this.handleScroll,{passive:!0}),t.register("force_webkit_recalc",ve.moduleName,()=>{il(this.wnd);const r=this.doc().scrollTop;r>1?this.doc().scrollTop=r-1:this.doc().scrollTop=r+1,this.doc().scrollTop=r}),t.register("go_progression",ve.moduleName,(r,n)=>{const s=r;if(s<0||s>1){t.send("error",{message:"go_progression must be given a position from 0.0 to 1.0"}),n(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=this.doc().offsetHeight*s,this.reportProgress(),J(this.wnd),n(!0)})}),this.comms.register("go_id",ve.moduleName,(r,n)=>{const s=e.document.getElementById(r);if(!s){n(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=s.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),J(this.wnd),n(!0)})}),t.register("go_text",ve.moduleName,(r,n)=>{let s;Array.isArray(r)&&(r.length>1&&(s=r[1]),r=r[0]);const o=si.deserialize(r),a=sr(this.wnd.document,new Mt({href:e.location.href,type:"text/html",text:o,locations:s?new re({otherLocations:new Map([["cssSelector",s]])}):void 0}));if(!a){n(!1);return}this.wnd.requestAnimationFrame(()=>{this.doc().scrollTop=a.getBoundingClientRect().top+e.scrollY-e.innerHeight/2,this.reportProgress(),J(this.wnd),n(!0)})}),t.register("go_start",ve.moduleName,(r,n)=>{if(this.doc().scrollTop===0)return n(!1);this.doc().scrollTop=0,this.reportProgress(),n(!0)}),t.register("go_end",ve.moduleName,(r,n)=>{if(this.doc().scrollTop===this.doc().scrollHeight-this.doc().offsetHeight)return n(!1);this.doc().scrollTop=this.doc().scrollHeight-this.doc().offsetHeight,this.reportProgress(),n(!0)}),t.register("unfocus",ve.moduleName,(r,n)=>{J(this.wnd),n(!0)}),t.register(["go_next","go_prev"],ve.moduleName,(r,n)=>n(!1)),t.register("focus",ve.moduleName,(r,n)=>{this.reportProgress(),n(!0)}),t.register("first_visible_locator",ve.moduleName,(r,n)=>{const s=Nn(e,!0);t.send("first_visible_locator",s.serialize()),n(!0)}),t.log("WebPubSnapper Mounted"),!0}unmount(e,t){return t.unregisterAll(ve.moduleName),this.resizeObserver.disconnect(),this.handleScroll&&e.removeEventListener("scroll",this.handleScroll),t.log("WebPubSnapper Unmounted"),!0}};al.moduleName="webpub_snapper";let eu=al;const ll=class extends oi{constructor(){super(...arguments),this.pointerMoved=!1,this.onPointerUp=this.onPointUp.bind(this),this.onPointerMove=this.onPointMove.bind(this),this.onPointerDown=this.onPointDown.bind(this),this.onContextMenu=this.onContext.bind(this),this.onClicker=this.onClick.bind(this)}onPointUp(i){const e=this.wnd.getSelection();if(e&&e.toString()?.length>0){const r=e.getRangeAt(0)?.getClientRects();if(!r||r.length===0)return;const n=r[0],s={text:e.toString(),x:n.x,y:n.y,width:n.width,height:n.height,targetFrameSrc:this.wnd?.location?.href};this.comms.send("text_selected",s)}if(this.pointerMoved){this.pointerMoved=!1;return}if(!e?.isCollapsed||!i.isPrimary)return;const t=this.wnd.devicePixelRatio;i.preventDefault(),this.comms.send(i.pointerType==="touch"?"tap":"click",{defaultPrevented:i.defaultPrevented,x:i.clientX*t,y:i.clientY*t,targetFrameSrc:this.wnd.location.href,targetElement:i.target.outerHTML,interactiveElement:rl(i.target)?.outerHTML,cssSelector:this.wnd._readium_cssSelectorGenerator.getCssSelector(i.target)}),this.pointerMoved=!1}onPointMove(i){if(i.movementY!==void 0&&i.movementX!==void 0){(Math.abs(i.movementX)>1||Math.abs(i.movementY)>1)&&(this.pointerMoved=!0);return}this.pointerMoved=!0}onPointDown(){this.pointerMoved=!1}onContext(i){this.onPointUp(i),this.pointerMoved=!1}onClick(i){if(i.preventDefault(),!i.isTrusted){const e=new PointerEvent("pointerup",{isPrimary:!0,pointerType:"mouse",clientX:i.clientX,clientY:i.clientY});Object.defineProperty(e,"target",{writable:!1,value:i.target}),Object.defineProperty(e,"defaultPrevented",{writable:!1,value:i.defaultPrevented}),this.onPointUp(e)}}mount(i,e){return this.wnd=i,this.comms=e,i.document.addEventListener("pointerdown",this.onPointerDown),i.document.addEventListener("pointerup",this.onPointerUp),i.document.addEventListener("contextmenu",this.onContextMenu),i.document.addEventListener("pointermove",this.onPointerMove),i.document.addEventListener("click",this.onClicker),e.log("Peripherals Mounted"),!0}unmount(i,e){return i.document.removeEventListener("pointerdown",this.onPointerDown),i.document.removeEventListener("pointerup",this.onPointerUp),i.document.removeEventListener("contextmenu",this.onContextMenu),i.document.removeEventListener("pointermove",this.onPointerMove),i.document.removeEventListener("click",this.onClicker),e.log("Peripherals Unmounted"),!0}};ll.moduleName="peripherals";let tu=ll;const hl=class en extends oi{constructor(){super(...arguments),this.mediaPlayingCount=0,this.allAnimations=new Set}wndOnErr(e){this.comms?.send("error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno})}unblock(e){for(e._readium_blockEvents=!1;e._readium_blockedEvents?.length>0;){const t=e._readium_blockedEvents.shift();switch(t[0]){case 0:Reflect.apply(t[1],t[2],t[3]);break;case 1:const r=t[1],n=t[2];e.removeEventListener(r.type,e._readium_eventBlocker,!0);const s=new Event(r.type,{bubbles:r.bubbles,cancelable:r.cancelable});n?n.dispatchEvent(s):e.dispatchEvent(s);break}}}onMediaPlayEvent(){this.mediaPlayingCount++,this.comms?.send("media_play",this.mediaPlayingCount)}onMediaPauseEvent(){this.mediaPlayingCount>0&&this.mediaPlayingCount--,this.comms?.send("media_pause",this.mediaPlayingCount)}pauseAllMedia(e){const t=e.document.querySelectorAll("audio,video");for(let r=0;r<t.length;r++)t[r].pause()}mount(e,t){this.comms=t,e.addEventListener("error",this.wndOnErr,!1),Reflect.defineProperty(e.navigator,"epubReadingSystem",{value:{name:"readium-ts-toolkit",version:"2.2.0",hasFeature:(n,s="")=>{switch(n){case"dom-manipulation":return!0;case"layout-changes":return!0;case"touch-events":return!0;case"mouse-events":return!0;case"keyboard-events":return!0;case"spine-scripting":return!0;case"embedded-web-content":return!0;default:return!1}}},writable:!1}),"getAnimations"in e.document&&e.document.getAnimations().forEach(n=>{n.cancel(),this.allAnimations.add(n)}),t.register("activate",en.moduleName,(n,s)=>{this.allAnimations.forEach(o=>{o.cancel(),o.play()}),s(!0)}),t.register("unfocus",en.moduleName,(n,s)=>{this.pauseAllMedia(e),this.allAnimations.forEach(o=>o.pause()),s(!0)});const r=e.document.querySelectorAll("audio,video");for(let n=0;n<r.length;n++){const s=r[n];s.addEventListener("play",this.onMediaPlayEvent,{passive:!0}),s.addEventListener("pause",this.onMediaPauseEvent,{passive:!0})}return t.log("Setup Mounted"),!0}unmount(e,t){return e.removeEventListener("error",this.wndOnErr),e.removeEventListener("play",this.onMediaPlayEvent),e.removeEventListener("pause",this.onMediaPauseEvent),this.allAnimations.forEach(r=>r.cancel()),this.allAnimations.clear(),t.log("Setup Unmounted"),!0}};hl.moduleName="setup";let cl=hl;const Ys="readium-viewport",ul=class tt extends cl{onViewportWidthChanged(e){const t=e.target;Ui(t,"--RS__viewportWidth",`${t.innerWidth}px`)}mount(e,t){if(!super.mount(e,t))return!1;const r=e.document.createElement("meta");return r.dataset.readium="true",r.setAttribute("name","viewport"),r.setAttribute("id",Ys),r.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no"),e.document.head.appendChild(r),e.addEventListener("orientationchange",this.onViewportWidthChanged),e.addEventListener("resize",this.onViewportWidthChanged),this.onViewportWidthChanged({target:e}),t.register("get_properties",tt.moduleName,(n,s)=>{Za(e),s(!0)}),t.register("update_properties",tt.moduleName,(n,s)=>{n["--RS__viewportWidth"]=`${e.innerWidth}px`,Fc(e,n),s(!0)}),t.register("set_property",tt.moduleName,(n,s)=>{const o=n;Ui(e,o[0],o[1]),s(!0)}),t.register("remove_property",tt.moduleName,(n,s)=>{Ln(e,n),s(!0)}),t.register("activate",tt.moduleName,(n,s)=>{this.unblock(e),s(!0)}),t.log("ReflowableSetup Mounted"),!0}unmount(e,t){return t.unregisterAll(tt.moduleName),e.document.head.querySelector(`#${Ys}`)?.remove(),e.removeEventListener("orientationchange",this.onViewportWidthChanged),t.log("ReflowableSetup Unmounted"),super.unmount(e,t)}};ul.moduleName="reflowable_setup";let iu=ul;const Js="readium-fixed-style",dl=class Xe extends cl{mount(e,t){if(!super.mount(e,t))return!1;e.navigator.epubReadingSystem&&(e.navigator.epubReadingSystem.layoutStyle="paginated");const r=e.document.createElement("style");return r.id=Js,r.dataset.readium="true",r.textContent=`
        html, body {
            text-size-adjust: none;
            -ms-text-size-adjust: none;
            -webkit-text-size-adjust: none;
            -moz-text-size-adjust: none;

            /* Fight Safari pinches */
            touch-action: none !important;
            min-height: 100%;

            /*cursor: var() TODO*/
        }`,e.document.head.appendChild(r),t.register("set_property",Xe.moduleName,(n,s)=>{const o=n;Ui(e,o[0],o[1]),s(!0)}),t.register("remove_property",Xe.moduleName,(n,s)=>{Ln(e,n),s(!0)}),t.register("first_visible_locator",Xe.moduleName,(n,s)=>s(!1)),t.register("unfocus",Xe.moduleName,(n,s)=>{J(e),s(!0)}),t.register(["focus","go_next","go_prev","go_id","go_end","go_start","go_text","go_progression"],Xe.moduleName,(n,s)=>s(!0)),t.register("activate",Xe.moduleName,(n,s)=>{this.unblock(e),s(!0)}),t.log("FixedSetup Mounted"),!0}unmount(e,t){return t.unregisterAll(Xe.moduleName),e.document.getElementById(Js)?.remove(),t.log("FixedSetup Unmounted"),super.unmount(e,t)}};dl.moduleName="fixed_setup";let ru=dl;const pl=class fl extends oi{wndOnErr(e){this.comms?.send("error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno})}mount(e,t){return this.comms=t,e.addEventListener("error",this.wndOnErr,!1),t.register("activate",fl.moduleName,(r,n)=>{n(!0)}),t.log("WebPubSetup Mounted"),!0}unmount(e,t){return e.removeEventListener("error",this.wndOnErr),t.log("WebPubSetup Unmounted"),!0}};pl.moduleName="webpub_setup";let nu=pl;const su=["fixed_setup","decorator","peripherals"],ou=["reflowable_setup","decorator","peripherals","column_snapper","scroll_snapper"],tn=new Map([ru,iu,nu,eu,tu,jc,Zc,Qc].map(i=>[i.moduleName,i]));class Wi{constructor(e=window,t=[]){this.loadedModules=[],this.wnd=e,this.comms=new yc(e);const r=[...new Set(t)];if(r.length){if(typeof e>"u")throw Error("Loader is not in a web browser");e.parent!==e&&this.comms.log("Loader is probably in a frame"),this.loadedModules=r.map(n=>{const s=this.loadModule(n);if(s)return s.mount(this.wnd,this.comms),s}).filter(n=>n!==void 0)}}loadModule(e){const t=tn.get(e);return t===void 0?(this.comms.log(`Module "${name}" does not exist in the library`),t):new t}addModule(e){const t=this.loadModule(e);return!t||!t.mount(this.wnd,this.comms)?!1:(this.loadedModules.push(t),!0)}removeModule(e){const t=tn.get(e);if(t===void 0)return this.comms.log(`Module "${e}" does not exist in the library`),!1;const r=this.loadedModules.findIndex(n=>n instanceof t);return r<0?!1:(this.loadedModules[r].unmount(this.wnd,this.comms),this.loadedModules.splice(r,1),!0)}destroy(){this.comms.destroy(),this.loadedModules.forEach(e=>e.unmount(this.wnd,this.comms)),this.loadedModules=[]}}const au=1e4;let rn=class{constructor(e,t){this.registry=new Map,this._ready=!1,this.listenerBuffer=[],this.handler=this.handle.bind(this),this.wnd=e,this.origin=t;try{this.channelId=window.crypto.randomUUID()}catch{this.channelId=Vr()}this.gc=setInterval(()=>{this.registry.forEach((r,n)=>{performance.now()-r.time>au&&(console.warn(n,"event for",r.key,"was never handled!"),this.registry.delete(n))})},5e3),window.addEventListener("message",this.handler),this.send("_ping",void 0)}set listener(e){this.listenerBuffer.length>0&&this.listenerBuffer.forEach(t=>e(t[0],t[1])),this.listenerBuffer=[],this._listener=e}clearListener(){typeof this._listener=="function"&&(this._listener=void 0)}halt(){this._ready=!1,window.removeEventListener("message",this.handler),clearInterval(this.gc),this._listener=void 0,this.registry.clear()}resume(){window.addEventListener("message",this.handler),this._ready=!0}handle(e){const t=e.data;if(!t._readium){console.warn("Ignoring",t);return}if(t._channel===this.channelId)switch(t.key){case"_ack":{if(!t.id)return;const r=this.registry.get(t.id);if(!r)return;this.registry.delete(t.id),r.cb(!!t.data);return}case"_pong":this._ready=!0;default:{if(!this.ready)return;typeof this._listener=="function"?this._listener(t.key,t.data):this.listenerBuffer.push([t.key,t.data])}}}get ready(){return this._ready}send(e,t,r,n=!1,s=[]){const o=Vr();return r&&this.registry.set(o,{cb:r,time:performance.now(),key:e}),this.wnd.postMessage({_readium:bt,_channel:this.channelId,id:o,data:t,key:e,strict:n},"/",s),o}};const lu="'Iowan Old Style', Sitka, 'Sitka Text', Palatino, 'Book Antiqua', 'URW Palladio L', P052, serif",hu={RS__oldStyleTf:lu},cu=16,Ks=hu.RS__oldStyleTf;let uu=class Ri{constructor(e){this._optimalLineLength=null,this._canvas=document.createElement("canvas"),this._optimalChars=e.optimalChars,this._minChars=e.minChars,this._maxChars=e.maxChars,this._baseFontSize=e.baseFontSize||cu,this._fontFace=e.fontFace||Ks,this._sample=e.sample||null,this._pageGutter=e.pageGutter||0,this._letterSpacing=e.letterSpacing?Math.round(e.letterSpacing*this._baseFontSize):0,this._wordSpacing=e.wordSpacing?Math.round(e.wordSpacing*this._baseFontSize):0,this._isCJK=e.isCJK||!1,this._getRelative=e.getRelative||!1,this._padding=this._pageGutter*2,this._minDivider=this._minChars&&this._minChars<this._optimalChars?this._optimalChars/this._minChars:this._minChars===null?null:1,this._maxMultiplier=this._maxChars&&this._maxChars>this._optimalChars?this._maxChars/this._optimalChars:this._maxChars===null?null:1,this._approximatedWordSpaces=Ri.approximateWordSpaces(this._optimalChars,this._sample)}updateMultipliers(){this._minDivider=this._minChars&&this._minChars<this._optimalChars?this._optimalChars/this._minChars:this._minChars===null?null:1,this._maxMultiplier=this._maxChars&&this._maxChars>this._optimalChars?this._maxChars/this._optimalChars:this._maxChars===null?null:1}update(e){e.optimalChars&&(this._optimalChars=e.optimalChars),e.minChars!==void 0&&(this._minChars=e.minChars),e.maxChars!==void 0&&(this._maxChars=e.maxChars),e.baseFontSize&&(this._baseFontSize=e.baseFontSize),e.fontFace!==void 0&&(this._fontFace=e.fontFace||Ks),e.letterSpacing&&(this._letterSpacing=e.letterSpacing),e.wordSpacing&&(this._wordSpacing=e.wordSpacing),e.isCJK!=null&&(this._isCJK=e.isCJK),e.pageGutter&&(this._pageGutter=e.pageGutter),e.getRelative&&(this._getRelative=e.getRelative),e.sample&&(this._sample=e.sample,this._approximatedWordSpaces=Ri.approximateWordSpaces(this._optimalChars,this._sample)),this.updateMultipliers(),this._optimalLineLength=this.getOptimalLineLength()}get baseFontSize(){return this._baseFontSize}get minimalLineLength(){return this._optimalLineLength||(this._optimalLineLength=this.getOptimalLineLength()),this._minDivider!==null?Math.round(this._optimalLineLength/this._minDivider+this._padding)/(this._getRelative?this._baseFontSize:1):null}get maximalLineLength(){return this._optimalLineLength||(this._optimalLineLength=this.getOptimalLineLength()),this._maxMultiplier!==null?Math.round(this._optimalLineLength*this._maxMultiplier+this._padding)/(this._getRelative?this._baseFontSize:1):null}get optimalLineLength(){return this._optimalLineLength||(this._optimalLineLength=this.getOptimalLineLength()),Math.round(this._optimalLineLength+this._padding)/(this._getRelative?this._baseFontSize:1)}get all(){return this._optimalLineLength||(this._optimalLineLength=this.getOptimalLineLength()),{min:this.minimalLineLength,max:this.maximalLineLength,optimal:this.optimalLineLength,baseFontSize:this._baseFontSize}}static approximateWordSpaces(e,t){let r=0;if(t&&t.length>=e){const n=t.match(/([\s]+)/gi);r=(n?n.length:0)*(e/t.length)}return r}getLineLengthFallback(){const e=this._letterSpacing*(this._optimalChars-1),t=this._wordSpacing*this._approximatedWordSpaces;return this._optimalChars*(this._baseFontSize*.5)+e+t}getOptimalLineLength(){if(this._fontFace){if(typeof this._fontFace=="string")return this.measureText(this._fontFace);{const e=new FontFace(this._fontFace.name,`url(${this._fontFace.url})`);e.load().then(()=>(document.fonts.add(e),this.measureText(e.family)),t=>{})}}return this.getLineLengthFallback()}measureText(e){const t=this._canvas.getContext("2d");if(t&&e){let r=this._isCJK?"".repeat(this._optimalChars):"0".repeat(this._optimalChars);if(t.font=`${this._baseFontSize}px ${e}`,this._sample&&this._sample.length>=this._optimalChars&&(r=this._sample.slice(0,this._optimalChars)),Object.hasOwn(t,"letterSpacing")&&Object.hasOwn(t,"wordSpacing"))return t.letterSpacing=this._letterSpacing.toString()+"px",t.wordSpacing=this._wordSpacing.toString()+"px",t.measureText(r).width;{const n=this._letterSpacing*(this._optimalChars-1),s=this._wordSpacing*Ri.approximateWordSpaces(this._optimalChars,this._sample);return t.measureText(r).width+n+s}}else return this.getLineLengthFallback()}};/*!
 *                                                                                                                         ()
 *  # sML.js | I'm a Simple and Middling Library.
 *
 *  * Copyright (c) Satoru MATSUSHIMA - https://github.com/satorumurmur/sML
 *  * Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 * Portions of this code come from the sML library
 * Current version: 1.0.36
 */const gl=()=>typeof navigator>"u"?"":navigator.userAgent||"",ml=()=>typeof navigator>"u"?void 0:navigator.userAgentData||void 0;class yl{constructor(){const e=ml(),t=gl(),r=s=>(typeof s=="string"||typeof s=="number")&&s?String(s).replace(/_/g,".").split(".").map(o=>parseInt(o)||0):[],n=(s="")=>{if(!s)return[];const o=new RegExp("^.*"+s+"[ :\\/]?(\\d+([\\._]\\d+)*).*$");return o.test(t)?r(t.replace(o,"$1")):[]};this.OS=(s=>(/(macOS|Mac OS X)/.test(t)?(/\(iP(hone|od touch);/.test(t)&&(s.iOS=n("CPU (?:iPhone )?OS ")),/\(iPad;/.test(t)?s.iOS=s.iPadOS=n("CPU (?:iPhone )?OS "):/(macOS|Mac OS X) \d/.test(t)&&(document.ontouchend!==void 0?s.iOS=s.iPadOS=n():s.macOS=n("(?:macOS|Mac OS X) "))):/Windows( NT)? \d/.test(t)?s.Windows=(o=>o[0]!==6||!o[1]?o:o[1]===1?[7]:o[1]===2?[8]:[8,1])(n("Windows(?: NT)?")):/Android \d/.test(t)?s.Android=n("Android"):/CrOS/.test(t)?s.ChromeOS=n():/X11;/.test(t)&&(s.Linux=n()),s))({}),e&&e.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion"]).then(s=>(o=>{const a=s.platform,h=s.platformVersion;if(!(!a||!h)){if(/^i(OS|P(hone|od touch))$/.test(a))o.iOS=r(h);else if(/^iPad(OS)?$/.test(a))o.iOS=o.iPadOS=r(h);else if(/^(macOS|(Mac )?OS X|Mac(Intel)?)$/.test(a))document.ontouchend!==void 0?o.iOS=o.iPadOS=r():o.macOS=r(h);else if(/^(Microsoft )?Windows$/.test(a))o.Windows=r(h);else if(/^(Google )?Android$/.test(a))o.Android=r(h);else if(/^((Google )?Chrome OS|CrOS)$/.test(a))o.ChromeOS=r(h);else if(/^(Linux|Ubuntu|X11)$/.test(a))o.Linux=r(h);else return;Object.keys(this.OS).forEach(l=>delete this.OS[l]),Object.assign(this.OS,o)}})({})),this.UA=(s=>{let o=!1;if(e&&Array.isArray(e.brands)){const a=e.brands.reduce((h,l)=>(h[l.brand]=[l.version*1],h),{});a["Google Chrome"]?(o=!0,s.Blink=s.Chromium=a.Chromium||[],s.Chrome=a["Google Chrome"]):a["Microsoft Edge"]?(o=!0,s.Blink=s.Chromium=a.Chromium||[],s.Edge=a["Microsoft Edge"]):a.Opera&&(o=!0,s.Blink=s.Chromium=a.Chromium||[],s.Opera=a.Opera)}return o||(/ Gecko\/\d/.test(t)?(s.Gecko=n("rv"),/ Waterfox\/\d/.test(t)?s.Waterfox=n("Waterfox"):/ Firefox\/\d/.test(t)&&(s.Firefox=n("Firefox"))):/ Edge\/\d/.test(t)?(s.EdgeHTML=n("Edge"),s.Edge=s.EdgeHTML):/ Chrom(ium|e)\/\d/.test(t)?(s.Blink=s.Chromium=(a=>a[0]?a:n("Chrome"))(n("Chromium")),/ EdgA?\/\d/.test(t)?s.Edge=(a=>a[0]?a:n("Edg"))(n("EdgA")):/ OPR\/\d/.test(t)?s.Opera=n("OPR"):/ Vivaldi\/\d/.test(t)?s.Vivaldi=n("Vivaldi"):/ Silk\/\d/.test(t)?s.Silk=n("Silk"):/ UCBrowser\/\d/.test(t)?s.UCBrowser=n("UCBrowser"):/ Phoebe\/\d/.test(t)?s.Phoebe=n("Phoebe"):s.Chrome=(a=>a[0]?a:s.Chromium)(n("Chrome"))):/ AppleWebKit\/\d/.test(t)?(s.WebKit=n("AppleWebKit"),/ CriOS \d/.test(t)?s.Chrome=n("CriOS"):/ FxiOS \d/.test(t)?s.Firefox=n("FxiOS"):/ EdgiOS\/\d/.test(t)?s.Edge=n("EdgiOS"):/ Version\/\d/.test(t)&&(s.Safari=n("Version"))):/ Trident\/\d/.test(t)&&(s.Trident=n("Trident"),s.InternetExplorer=(a=>a[0]?a:n("MSIE"))(n("rv")))),/[\[; ]FB(AN|_IAB)\//.test(t)&&(s.Facebook=n("FBAV")),/ Line\/\d/.test(t)&&(s.LINE=n("Line")),s})({}),this.Env={get:()=>[this.OS,this.UA].reduce((s,o)=>{for(const a in o)o[a]&&s.push(a);return s},[])}}}class du extends yl{get iOSRequest(){const e=ml(),t=gl();if(this.OS.iOS&&!this.OS.iPadOS)return"mobile";if(this.OS.iPadOS)return/\(iPad;/.test(t)||e&&/^iPad(OS)?$/.test(e.platform)?"mobile":"desktop"}}const Li=new yl,ze=new du;var fr,Zs;function pu(){if(Zs)return fr;Zs=1;function i(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function e(n,s){for(var o="",a=0,h=-1,l=0,u,c=0;c<=n.length;++c){if(c<n.length)u=n.charCodeAt(c);else{if(u===47)break;u=47}if(u===47){if(!(h===c-1||l===1))if(h!==c-1&&l===2){if(o.length<2||a!==2||o.charCodeAt(o.length-1)!==46||o.charCodeAt(o.length-2)!==46){if(o.length>2){var f=o.lastIndexOf("/");if(f!==o.length-1){f===-1?(o="",a=0):(o=o.slice(0,f),a=o.length-1-o.lastIndexOf("/")),h=c,l=0;continue}}else if(o.length===2||o.length===1){o="",a=0,h=c,l=0;continue}}s&&(o.length>0?o+="/..":o="..",a=2)}else o.length>0?o+="/"+n.slice(h+1,c):o=n.slice(h+1,c),a=c-h-1;h=c,l=0}else u===46&&l!==-1?++l:l=-1}return o}function t(n,s){var o=s.dir||s.root,a=s.base||(s.name||"")+(s.ext||"");return o?o===s.root?o+a:o+n+a:a}var r={resolve:function(){for(var n="",s=!1,o,a=arguments.length-1;a>=-1&&!s;a--){var h;a>=0?h=arguments[a]:(o===void 0&&(o=process.cwd()),h=o),i(h),h.length!==0&&(n=h+"/"+n,s=h.charCodeAt(0)===47)}return n=e(n,!s),s?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(n){if(i(n),n.length===0)return".";var s=n.charCodeAt(0)===47,o=n.charCodeAt(n.length-1)===47;return n=e(n,!s),n.length===0&&!s&&(n="."),n.length>0&&o&&(n+="/"),s?"/"+n:n},isAbsolute:function(n){return i(n),n.length>0&&n.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var n,s=0;s<arguments.length;++s){var o=arguments[s];i(o),o.length>0&&(n===void 0?n=o:n+="/"+o)}return n===void 0?".":r.normalize(n)},relative:function(n,s){if(i(n),i(s),n===s||(n=r.resolve(n),s=r.resolve(s),n===s))return"";for(var o=1;o<n.length&&n.charCodeAt(o)===47;++o);for(var a=n.length,h=a-o,l=1;l<s.length&&s.charCodeAt(l)===47;++l);for(var u=s.length,c=u-l,f=h<c?h:c,g=-1,d=0;d<=f;++d){if(d===f){if(c>f){if(s.charCodeAt(l+d)===47)return s.slice(l+d+1);if(d===0)return s.slice(l+d)}else h>f&&(n.charCodeAt(o+d)===47?g=d:d===0&&(g=0));break}var m=n.charCodeAt(o+d),y=s.charCodeAt(l+d);if(m!==y)break;m===47&&(g=d)}var x="";for(d=o+g+1;d<=a;++d)(d===a||n.charCodeAt(d)===47)&&(x.length===0?x+="..":x+="/..");return x.length>0?x+s.slice(l+g):(l+=g,s.charCodeAt(l)===47&&++l,s.slice(l))},_makeLong:function(n){return n},dirname:function(n){if(i(n),n.length===0)return".";for(var s=n.charCodeAt(0),o=s===47,a=-1,h=!0,l=n.length-1;l>=1;--l)if(s=n.charCodeAt(l),s===47){if(!h){a=l;break}}else h=!1;return a===-1?o?"/":".":o&&a===1?"//":n.slice(0,a)},basename:function(n,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');i(n);var o=0,a=-1,h=!0,l;if(s!==void 0&&s.length>0&&s.length<=n.length){if(s.length===n.length&&s===n)return"";var u=s.length-1,c=-1;for(l=n.length-1;l>=0;--l){var f=n.charCodeAt(l);if(f===47){if(!h){o=l+1;break}}else c===-1&&(h=!1,c=l+1),u>=0&&(f===s.charCodeAt(u)?--u===-1&&(a=l):(u=-1,a=c))}return o===a?a=c:a===-1&&(a=n.length),n.slice(o,a)}else{for(l=n.length-1;l>=0;--l)if(n.charCodeAt(l)===47){if(!h){o=l+1;break}}else a===-1&&(h=!1,a=l+1);return a===-1?"":n.slice(o,a)}},extname:function(n){i(n);for(var s=-1,o=0,a=-1,h=!0,l=0,u=n.length-1;u>=0;--u){var c=n.charCodeAt(u);if(c===47){if(!h){o=u+1;break}continue}a===-1&&(h=!1,a=u+1),c===46?s===-1?s=u:l!==1&&(l=1):s!==-1&&(l=-1)}return s===-1||a===-1||l===0||l===1&&s===a-1&&s===o+1?"":n.slice(s,a)},format:function(n){if(n===null||typeof n!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof n);return t("/",n)},parse:function(n){i(n);var s={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return s;var o=n.charCodeAt(0),a=o===47,h;a?(s.root="/",h=1):h=0;for(var l=-1,u=0,c=-1,f=!0,g=n.length-1,d=0;g>=h;--g){if(o=n.charCodeAt(g),o===47){if(!f){u=g+1;break}continue}c===-1&&(f=!1,c=g+1),o===46?l===-1?l=g:d!==1&&(d=1):l!==-1&&(d=-1)}return l===-1||c===-1||d===0||d===1&&l===c-1&&l===u+1?c!==-1&&(u===0&&a?s.base=s.name=n.slice(1,c):s.base=s.name=n.slice(u,c)):(u===0&&a?(s.name=n.slice(1,l),s.base=n.slice(1,c)):(s.name=n.slice(u,l),s.base=n.slice(u,c)),s.ext=n.slice(l,c)),u>0?s.dir=n.slice(0,u-1):a&&(s.dir="/"),s},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,fr=r,fr}var Qs=pu();const fu=`/*!
 * Readium CSS v.2.0.0-beta.19
 * Copyright (c) 20172025. Readium Foundation. All rights reserved.
 * Use of this source code is governed by a BSD-style license which is detailed in the
 * LICENSE file present in the project repository where this source code is maintained.
 * Core maintainer: Jiminy Panoz <jiminy.panoz@edrlab.org> 
 * Contributors: 
 * Daniel Weck
 * Hadrien Gardeur
 * Innovimax
 * L. Le Meur
 * Mickael Menu
 * k_taka
 */@namespace url(http://www.w3.org/1999/xhtml);@namespace epub url(http://www.idpf.org/2007/ops);@namespace m url(http://www.w3.org/1998/Math/MathML);@namespace svg url(http://www.w3.org/2000/svg);:root{--RS__viewportWidth:100%;--RS__pageGutter:0;--RS__defaultLineLength:40rem;--RS__colGap:0;--RS__colCount:1;--RS__colWidth:100vw}@page{margin:0!important}:root{position:relative;-webkit-column-width:var(--RS__colWidth);-moz-column-width:var(--RS__colWidth);column-width:var(--RS__colWidth);-webkit-column-count:var(--RS__colCount);-moz-column-count:var(--RS__colCount);column-count:var(--RS__colCount);-webkit-column-gap:var(--RS__colGap);-moz-column-gap:var(--RS__colGap);column-gap:var(--RS__colGap);-moz-column-fill:auto;column-fill:auto;width:var(--RS__viewportWidth);height:100vh;max-width:var(--RS__viewportWidth);max-height:100vh;min-width:var(--RS__viewportWidth);min-height:100vh;padding:0!important;margin:0!important;font-size:1rem!important;box-sizing:border-box;-webkit-touch-callout:none}body{width:100%;max-width:var(--RS__defaultLineLength)!important;padding:0 var(--RS__pageGutter)!important;margin:0 auto!important;box-sizing:border-box}:root:not([style*=readium-noOverflow-on]) body{overflow:hidden}@supports (overflow: clip){:root:not([style*=readium-noOverflow-on]){overflow:clip}:root:not([style*=readium-noOverflow-on]) body{overflow:clip;overflow-clip-margin:content-box}}:root[style*=readium-scroll-on]{-webkit-columns:auto auto!important;-moz-columns:auto auto!important;columns:auto auto!important;width:auto!important;height:auto!important;max-width:none!important;max-height:none!important;min-width:0!important;min-height:0!important}:root[style*=readium-scroll-on] body{max-width:var(--RS__defaultLineLength)!important;box-sizing:border-box!important}:root[style*=readium-scroll-on]:not([style*=readium-noOverflow-on]) body{overflow:auto}@supports (overflow: clip){:root[style*=readium-scroll-on]:not([style*=readium-noOverflow-on]){overflow:auto}:root[style*=readium-scroll-on]:not([style*=readium-noOverflow-on]) body{overflow:clip}}:root[style*=readium-scroll-on][style*=--RS__scrollPaddingTop] body{padding-top:var(--RS__scrollPaddingTop)!important}:root[style*=readium-scroll-on][style*=--RS__scrollPaddingBottom] body{padding-bottom:var(--RS__scrollPaddingBottom)!important}:root[style*=readium-scroll-on][style*=--RS__scrollPaddingLeft] body{padding-left:var(--RS__scrollPaddingLeft)!important}:root[style*=readium-scroll-on][style*=--RS__scrollPaddingRight] body{padding-right:var(--RS__scrollPaddingRight)!important}:root[style*=--USER__backgroundColor]{background-color:var(--USER__backgroundColor)!important}:root[style*=--USER__backgroundColor] *{background-color:transparent!important}:root[style*=--USER__textColor]{color:var(--USER__textColor)!important}:root[style*=--USER__textColor] *:not(a){color:inherit!important;background-color:transparent!important;border-color:currentcolor!important}:root[style*=--USER__textColor] svg text{fill:currentcolor!important;stroke:none!important}:root[style*=--USER__linkColor] a:link,:root[style*=--USER__linkColor] a:link *{color:var(--USER__linkColor)!important}:root[style*=--USER__visitedColor] a:visited,:root[style*=--USER__visitedColor] a:visited *{color:var(--USER__visitedColor)!important}:root[style*=--USER__selectionBackgroundColor][style*=--USER__selectionTextColor] ::-moz-selection{color:var(--USER__selectionTextColor)!important;background-color:var(--USER__selectionBackgroundColor)!important}:root[style*=--USER__selectionBackgroundColor][style*=--USER__selectionTextColor] ::selection{color:var(--USER__selectionTextColor)!important;background-color:var(--USER__selectionBackgroundColor)!important}:root[style*=--USER__colCount]{-webkit-column-count:var(--USER__colCount);-moz-column-count:var(--USER__colCount);column-count:var(--USER__colCount);--RS__colWidth:auto}:root[style*="--USER__colCount: 0"],:root[style*="--USER__colCount:0"]{-webkit-column-count:1;-moz-column-count:1;column-count:1}:root[style*="--USER__colCount: 0"],:root[style*="--USER__colCount:0"],:root[style*="--USER__colCount: 1"],:root[style*="--USER__colCount:1"]{--RS__colWidth:100vw}:root[style*=--USER__lineLength] body{max-width:var(--USER__lineLength)!important}:root[style*=--USER__textAlign]{text-align:var(--USER__textAlign)}:root[style*=--USER__textAlign] body,:root[style*=--USER__textAlign] p:not(blockquote p):not(figcaption p):not(hgroup p),:root[style*=--USER__textAlign] li,:root[style*=--USER__textAlign] dd{text-align:var(--USER__textAlign)!important;-moz-text-align-last:auto!important;-epub-text-align-last:auto!important;text-align-last:auto!important}:root[style*=--USER__bodyHyphens]{-webkit-hyphens:var(--USER__bodyHyphens)!important;-moz-hyphens:var(--USER__bodyHyphens)!important;-ms-hyphens:var(--USER__bodyHyphens)!important;-epub-hyphens:var(--USER__bodyHyphens)!important;hyphens:var(--USER__bodyHyphens)!important}:root[style*=--USER__bodyHyphens] body,:root[style*=--USER__bodyHyphens] p,:root[style*=--USER__bodyHyphens] li,:root[style*=--USER__bodyHyphens] div,:root[style*=--USER__bodyHyphens] dd{-webkit-hyphens:inherit;-moz-hyphens:inherit;-ms-hyphens:inherit;-epub-hyphens:inherit;hyphens:inherit}:root[style*=--USER__fontFamily]{font-family:var(--USER__fontFamily)!important}:root[style*=--USER__fontFamily] *{font-family:revert!important}:root[style*=AccessibleDfA]{font-family:AccessibleDfA,Verdana,Tahoma,Trebuchet MS,sans-serif!important}:root[style*="IA Writer Duospace"]{font-family:IA Writer Duospace,Menlo,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier,monospace!important}:root[style*=AccessibleDfA],:root[style*="IA Writer Duospace"],:root[style*=readium-a11y-on]{font-style:normal!important;font-weight:400!important}:root[style*=AccessibleDfA] *:not(code):not(var):not(kbd):not(samp),:root[style*="IA Writer Duospace"] *:not(code):not(var):not(kbd):not(samp),:root[style*=readium-a11y-on] *:not(code):not(var):not(kbd):not(samp){font-family:inherit!important;font-style:inherit!important;font-weight:inherit!important}:root[style*=AccessibleDfA] *,:root[style*="IA Writer Duospace"] *,:root[style*=readium-a11y-on] *{text-decoration:none!important;font-variant-caps:normal!important;font-variant-numeric:normal!important;font-variant-position:normal!important}:root[style*=AccessibleDfA] sup,:root[style*="IA Writer Duospace"] sup,:root[style*=readium-a11y-on] sup,:root[style*=AccessibleDfA] sub,:root[style*="IA Writer Duospace"] sub,:root[style*=readium-a11y-on] sub{font-size:1rem!important;vertical-align:baseline!important}:root:not([style*=readium-deprecatedFontSize-on]):not([style*=readium-iOSPatch-on])[style*=--USER__fontSize] body{zoom:var(--USER__fontSize)!important}:root[style*=readium-iOSPatch-on][style*=--USER__fontSize] body{-webkit-text-size-adjust:var(--USER__fontSize)!important}@supports not (zoom: 1){:root[style*=--USER__fontSize]{font-size:var(--USER__fontSize)!important}}:root[style*=readium-deprecatedFontSize-on][style*=--USER__fontSize]{font-size:var(--USER__fontSize)!important}:root[style*=--USER__lineHeight]{line-height:var(--USER__lineHeight)!important}:root[style*=--USER__lineHeight] body,:root[style*=--USER__lineHeight] p,:root[style*=--USER__lineHeight] li,:root[style*=--USER__lineHeight] div{line-height:inherit}:root[style*=--USER__paraSpacing] p{margin-top:var(--USER__paraSpacing)!important;margin-bottom:var(--USER__paraSpacing)!important}:root[style*=--USER__paraIndent] p{text-indent:var(--USER__paraIndent)!important}:root[style*=--USER__paraIndent] p *,:root[style*=--USER__paraIndent] p:first-letter{text-indent:0!important}:root[style*=--USER__wordSpacing] h1,:root[style*=--USER__wordSpacing] h2,:root[style*=--USER__wordSpacing] h3,:root[style*=--USER__wordSpacing] h4,:root[style*=--USER__wordSpacing] h5,:root[style*=--USER__wordSpacing] h6,:root[style*=--USER__wordSpacing] p,:root[style*=--USER__wordSpacing] li,:root[style*=--USER__wordSpacing] div,:root[style*=--USER__wordSpacing] dt,:root[style*=--USER__wordSpacing] dd{word-spacing:var(--USER__wordSpacing)}:root[style*=--USER__letterSpacing] h1,:root[style*=--USER__letterSpacing] h2,:root[style*=--USER__letterSpacing] h3,:root[style*=--USER__letterSpacing] h4,:root[style*=--USER__letterSpacing] h5,:root[style*=--USER__letterSpacing] h6,:root[style*=--USER__letterSpacing] p,:root[style*=--USER__letterSpacing] li,:root[style*=--USER__letterSpacing] div,:root[style*=--USER__letterSpacing] dt,:root[style*=--USER__letterSpacing] dd{letter-spacing:var(--USER__letterSpacing);font-variant:none}:root[style*=--USER__fontWeight] body{font-weight:var(--USER__fontWeight)!important}:root[style*=--USER__fontWeight] b,:root[style*=--USER__fontWeight] strong{font-weight:bolder}:root[style*=--USER__fontWidth] body{font-stretch:var(--USER__fontWidth)!important}:root[style*=--USER__fontOpticalSizing] body{font-optical-sizing:var(--USER__fontOpticalSizing)!important}:root[style*=readium-blend-on] svg,:root[style*=readium-blend-on] img{background-color:transparent!important;mix-blend-mode:multiply!important}:root[style*=--USER__darkenImages] img{-webkit-filter:brightness(var(--USER__darkenImages))!important;filter:brightness(var(--USER__darkenImages))!important}:root[style*=readium-darken-on] img{-webkit-filter:brightness(80%)!important;filter:brightness(80%)!important}:root[style*=--USER__invertImages] img{-webkit-filter:invert(var(--USER__invertImages))!important;filter:invert(var(--USER__invertImages))!important}:root[style*=readium-invert-on] img{-webkit-filter:invert(100%)!important;filter:invert(100%)!important}:root[style*=--USER__darkenImages][style*=--USER__invertImages] img{-webkit-filter:brightness(var(--USER__darkenImages)) invert(var(--USER__invertImages))!important;filter:brightness(var(--USER__darkenImages)) invert(var(--USER__invertImages))!important}:root[style*=readium-darken-on][style*=--USER__invertImages] img{-webkit-filter:brightness(80%) invert(var(--USER__invertImages))!important;filter:brightness(80%) invert(var(--USER__invertImages))!important}:root[style*=--USER__darkenImages][style*=readium-invert-on] img{-webkit-filter:brightness(var(--USER__darkenImages)) invert(100%)!important;filter:brightness(var(--USER__darkenImages)) invert(100%)!important}:root[style*=readium-darken-on][style*=readium-invert-on] img{-webkit-filter:brightness(80%) invert(100%)!important;filter:brightness(80%) invert(100%)!important}:root[style*=--USER__invertGaiji] img[class*=gaiji]{-webkit-filter:invert(var(--USER__invertGaiji))!important;filter:invert(var(--USER__invertGaiji))!important}:root[style*=readium-invertGaiji-on] img[class*=gaiji]{-webkit-filter:invert(100%)!important;filter:invert(100%)!important}:root[style*=readium-normalize-on]{--USER__typeScale:1.2}:root[style*=readium-normalize-on] p,:root[style*=readium-normalize-on] li,:root[style*=readium-normalize-on] div,:root[style*=readium-normalize-on] pre,:root[style*=readium-normalize-on] dd{font-size:1rem!important}:root[style*=readium-normalize-on] h1{font-size:1.75rem!important;font-size:calc(((1rem * var(--USER__typeScale)) * var(--USER__typeScale)) * var(--USER__typeScale))!important}:root[style*=readium-normalize-on] h2{font-size:1.5rem!important;font-size:calc((1rem * var(--USER__typeScale)) * var(--USER__typeScale))!important}:root[style*=readium-normalize-on] h3{font-size:1.25rem!important;font-size:calc(1rem * var(--USER__typeScale))!important}:root[style*=readium-normalize-on] h4,:root[style*=readium-normalize-on] h5,:root[style*=readium-normalize-on] h6{font-size:1rem!important}:root[style*=readium-normalize-on] small{font-size:smaller!important}:root[style*=readium-normalize-on] sub,:root[style*=readium-normalize-on] sup{font-size:67.5%!important}:root[style*=readium-normalize-on][style*=--USER__typeScale] h1{font-size:calc(((1rem * var(--USER__typeScale)) * var(--USER__typeScale)) * var(--USER__typeScale))!important}:root[style*=readium-normalize-on][style*=--USER__typeScale] h2{font-size:calc((1rem * var(--USER__typeScale)) * var(--USER__typeScale))!important}:root[style*=readium-normalize-on][style*=--USER__typeScale] h3{font-size:calc(1rem * var(--USER__typeScale))!important}:root[style*=readium-iPadOSPatch-on] body{-webkit-text-size-adjust:none}:root[style*=readium-iPadOSPatch-on] p,:root[style*=readium-iPadOSPatch-on] h1,:root[style*=readium-iPadOSPatch-on] h2,:root[style*=readium-iPadOSPatch-on] h3,:root[style*=readium-iPadOSPatch-on] h4,:root[style*=readium-iPadOSPatch-on] h5,:root[style*=readium-iPadOSPatch-on] h6,:root[style*=readium-iPadOSPatch-on] li,:root[style*=readium-iPadOSPatch-on] th,:root[style*=readium-iPadOSPatch-on] td,:root[style*=readium-iPadOSPatch-on] dt,:root[style*=readium-iPadOSPatch-on] dd,:root[style*=readium-iPadOSPatch-on] pre,:root[style*=readium-iPadOSPatch-on] address,:root[style*=readium-iPadOSPatch-on] details,:root[style*=readium-iPadOSPatch-on] summary,:root[style*=readium-iPadOSPatch-on] figcaption,:root[style*=readium-iPadOSPatch-on] div:not(:has(p,h1,h2,h3,h4,h5,h6,li,th,td,dt,dd,pre,address,aside,details,figcaption,summary)),:root[style*=readium-iPadOSPatch-on] aside:not(:has(p,h1,h2,h3,h4,h5,h6,li,th,td,dt,dd,pre,address,aside,details,figcaption,summary)){-webkit-text-zoom:reset}:root[style*=readium-iPadOSPatch-on] abbr,:root[style*=readium-iPadOSPatch-on] b,:root[style*=readium-iPadOSPatch-on] bdi,:root[style*=readium-iPadOSPatch-on] bdo,:root[style*=readium-iPadOSPatch-on] cite,:root[style*=readium-iPadOSPatch-on] code,:root[style*=readium-iPadOSPatch-on] dfn,:root[style*=readium-iPadOSPatch-on] em,:root[style*=readium-iPadOSPatch-on] i,:root[style*=readium-iPadOSPatch-on] kbd,:root[style*=readium-iPadOSPatch-on] mark,:root[style*=readium-iPadOSPatch-on] q,:root[style*=readium-iPadOSPatch-on] rp,:root[style*=readium-iPadOSPatch-on] rt,:root[style*=readium-iPadOSPatch-on] ruby,:root[style*=readium-iPadOSPatch-on] s,:root[style*=readium-iPadOSPatch-on] samp,:root[style*=readium-iPadOSPatch-on] small,:root[style*=readium-iPadOSPatch-on] span,:root[style*=readium-iPadOSPatch-on] strong,:root[style*=readium-iPadOSPatch-on] sub,:root[style*=readium-iPadOSPatch-on] sup,:root[style*=readium-iPadOSPatch-on] time,:root[style*=readium-iPadOSPatch-on] u,:root[style*=readium-iPadOSPatch-on] var{-webkit-text-zoom:normal}:root[style*=readium-iPadOSPatch-on] p:not(:has(b,cite,em,i,q,s,small,span,strong)):first-line{-webkit-text-zoom:normal}`,gu=`/*!
 * Readium CSS v.2.0.0-beta.19
 * Copyright (c) 20172025. Readium Foundation. All rights reserved.
 * Use of this source code is governed by a BSD-style license which is detailed in the
 * LICENSE file present in the project repository where this source code is maintained.
 * Core maintainer: Jiminy Panoz <jiminy.panoz@edrlab.org> 
 * Contributors: 
 * Daniel Weck
 * Hadrien Gardeur
 * Innovimax
 * L. Le Meur
 * Mickael Menu
 * k_taka
 */@namespace url(http://www.w3.org/1999/xhtml);@namespace epub url(http://www.idpf.org/2007/ops);@namespace m url(http://www.w3.org/1998/Math/MathML);@namespace svg url(http://www.w3.org/2000/svg);@-ms-viewport{width:device-width}@viewport{width:device-width;zoom:1}:root{--RS__monospaceTf:ui-monospace, "Andale Mono", "Cascadia Code", "Source Code Pro", Menlo, Consolas, "DejaVu Sans Mono", monospace;--RS__humanistTf:Seravek, Calibri, "Gill Sans Nova", Roboto, Ubuntu, "DejaVu Sans", source-sans-pro, sans-serif;--RS__sansTf:-ui-sans-serif, -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI Variable", "Segoe UI", Inter, Roboto, "Helvetica Neue", "Arial Nova", "Liberation Sans", Arial, sans-serif;--RS__modernTf:Athelas, Constantia, Charter, "Bitstream Charter", Cambria, "Georgia Pro", Georgia, serif;--RS__oldStyleTf:"Iowan Old Style", Sitka, "Sitka Text", Palatino, "Book Antiqua", "URW Palladio L", P052, serif;--RS__baseFontFamily:var(--RS__oldStyleTf);--RS__lineHeightCompensation:1;--RS__baseLineHeight:calc(1.5 * var(--RS__lineHeightCompensation));--RS__selectionTextColor:inherit;--RS__selectionBackgroundColor:#b4d8fe;--RS__visitedColor:#551A8B;--RS__linkColor:#0000EE;--RS__textColor:#121212;--RS__backgroundColor:#FFFFFF;color:var(--RS__textColor)!important;background-color:var(--RS__backgroundColor)!important}::-moz-selection{color:var(--RS__selectionTextColor);background-color:var(--RS__selectionBackgroundColor)}::selection{color:var(--RS__selectionTextColor);background-color:var(--RS__selectionBackgroundColor)}html{font-family:var(--RS__baseFontFamily);line-height:1.6;line-height:var(--RS__baseLineHeight);text-rendering:optimizelegibility}h1,h2,h3{line-height:normal}:lang(ja),:lang(zh),:lang(ko){word-wrap:break-word;-webkit-line-break:strict;-epub-line-break:strict;line-break:strict}math{font-family:"Latin Modern Math","STIX Two Math","XITS Math","STIX Math","Libertinus Math","TeX Gyre Termes Math","TeX Gyre Bonum Math",TeX Gyre Schola,"DejaVu Math TeX Gyre","TeX Gyre Pagella Math","Asana Math","Cambria Math","Lucida Bright Math","Minion Math",STIXGeneral,STIXSizeOneSym,Symbol,Times New Roman,serif}:lang(am){--RS__baseFontFamily:kefa, nyala, roboto, noto, "Noto Sans Ethiopic", serif;--RS__lineHeightCompensation:1.167}:lang(ar){--RS__baseFontFamily:"Geeza Pro", "Arabic Typesetting", roboto, noto, "Noto Naskh Arabic", "Times New Roman", serif}:lang(bn){--RS__baseFontFamily:"Kohinoor Bangla", "Bangla Sangam MN", vrinda, roboto, noto, "Noto Sans Bengali", sans-serif;--RS__lineHeightCompensation:1.067}:lang(bo){--RS__baseFontFamily:kailasa, "Microsoft Himalaya", roboto, noto, "Noto Sans Tibetan", sans-serif}:lang(chr){--RS__baseFontFamily:"Plantagenet Cherokee", roboto, noto, "Noto Sans Cherokee";--RS__lineHeightCompensation:1.167}:lang(fa){--RS__baseFontFamily:"Geeza Pro", "Arabic Typesetting", roboto, noto, "Noto Naskh Arabic", "Times New Roman", serif}:lang(gu){--RS__baseFontFamily:"Gujarati Sangam MN", "Nirmala UI", shruti, roboto, noto, "Noto Sans Gujarati", sans-serif;--RS__lineHeightCompensation:1.167}:lang(he){--RS__baseFontFamily:"New Peninim MT", "Arial Hebrew", gisha, "Times New Roman", roboto, noto, "Noto Sans Hebrew" sans-serif;--RS__lineHeightCompensation:1.1}:lang(hi){--RS__baseFontFamily:"Kohinoor Devanagari", "Devanagari Sangam MN", kokila, "Nirmala UI", roboto, noto, "Noto Sans Devanagari", sans-serif;--RS__lineHeightCompensation:1.1}:lang(hy){--RS__baseFontFamily:mshtakan, sylfaen, roboto, noto, "Noto Serif Armenian", serif}:lang(iu){--RS__baseFontFamily:"Euphemia UCAS", euphemia, roboto, noto, "Noto Sans Canadian Aboriginal", sans-serif}:lang(ja){--RS__baseFontFamily:yugothic, "Hiragino Maru Gothic ProN", "Hiragino Sans", "Yu Gothic UI", "Meiryo UI", "MS Gothic", roboto, noto, "Noto Sans CJK JP", sans-serif;--RS__lineHeightCompensation:1.167;--RS__serif-ja:"Hiragino Mincho ProN", "Hiragino Mincho Pro", "YuMincho", "BIZ UDPMincho", "Yu Mincho", " ", "MS PMincho", serif;--RS__sans-serif-ja:"Hiragino Sans", "Hiragino Kaku Gothic ProN", "Hiragino Kaku Gothic Pro", " W3", "YuGothic", "Yu Gothic Medium", "BIZ UDPGothic", "Yu Gothic", " ", "MS PGothic", sans-serif;--RS__serif-ja-v:"Hiragino Mincho ProN", "Hiragino Mincho Pro", "YuMincho", "BIZ UDMincho", "Yu Mincho", "", "MS Mincho", serif;--RS__sans-serif-ja-v:"Hiragino Sans", "Hiragino Kaku Gothic ProN", "Hiragino Kaku Gothic Pro", " W3", "YuGothic", "Yu Gothic Medium", "BIZ UDGothic", "Yu Gothic", "", "MS Gothic", sans-serif}:lang(km){--RS__baseFontFamily:"Khmer Sangam MN", "Leelawadee UI", "Khmer UI", roboto, noto, "Noto Sans Khmer", sans-serif;--RS__lineHeightCompensation:1.067}:lang(kn){--RS__baseFontFamily:"Kannada Sangam MN", "Nirmala UI", tunga, roboto, noto, "Noto Sans Kannada", sans-serif;--RS__lineHeightCompensation:1.1}:lang(ko){--RS__baseFontFamily:"Nanum Gothic", "Apple SD Gothic Neo", "Malgun Gothic", roboto, noto, "Noto Sans CJK KR", sans-serif;--RS__lineHeightCompensation:1.167}:lang(lo){--RS__baseFontFamily:"Lao Sangam MN", "Leelawadee UI", "Lao UI", roboto, noto, "Noto Sans Lao", sans-serif}:lang(ml){--RS__baseFontFamily:"Malayalam Sangam MN", "Nirmala UI", kartika, roboto, noto, "Noto Sans Malayalam", sans-serif;--RS__lineHeightCompensation:1.067}:lang(or){--RS__baseFontFamily:"Oriya Sangam MN", "Nirmala UI", kalinga, roboto, noto, "Noto Sans Oriya", sans-serif;--RS__lineHeightCompensation:1.167}:lang(pa){--RS__baseFontFamily:"Gurmukhi MN", "Nirmala UI", kartika, roboto, noto, "Noto Sans Gurmukhi", sans-serif;--RS__lineHeightCompensation:1.1}:lang(si){--RS__baseFontFamily:"Sinhala Sangam MN", "Nirmala UI", "Iskoola Pota", roboto, noto, "Noto Sans Sinhala", sans-serif;--RS__lineHeightCompensation:1.167}:lang(ta){--RS__baseFontFamily:"Tamil Sangam MN", "Nirmala UI", latha, roboto, noto, "Noto Sans Tamil", sans-serif;--RS__lineHeightCompensation:1.067}:lang(te){--RS__baseFontFamily:"Kohinoor Telugu", "Telugu Sangam MN", "Nirmala UI", gautami, roboto, noto, "Noto Sans Telugu", sans-serif}:lang(th){--RS__baseFontFamily:"Thonburi", "Leelawadee UI", "Cordia New", roboto, noto, "Noto Sans Thai", sans-serif;--RS__lineHeightCompensation:1.067}:lang(zh){--RS__baseFontFamily:"", "PingFang SC", "", "Heiti SC", "Microsoft JhengHei UI", "Microsoft JhengHei", roboto, noto, "Noto Sans CJK SC", sans-serif;--RS__lineHeightCompensation:1.167}:lang(zh-Hant),:lang(zh-TW){--RS__baseFontFamily:"", "PingFang TC", "", "Heiti TC", "Microsoft JhengHei UI", "Microsoft JhengHei", roboto, noto, "Noto Sans CJK TC", sans-serif;--RS__lineHeightCompensation:1.167}:lang(zh-HK){--RS__baseFontFamily:"", "PingFang HK", "", "PingFang TC", "", "Heiti TC", "Microsoft JhengHei UI", "Microsoft JhengHei", roboto, noto, "Noto Sans CJK TC", sans-serif;--RS__lineHeightCompensation:1.167}@font-face{font-family:AccessibleDfA;font-style:normal;font-weight:400;src:local("AccessibleDfA"),url(./assets/AccessibleDfA-Regular.woff2) format("woff2"),url(./assets/AccessibleDfA-Regular.woff) format("woff")}@font-face{font-family:AccessibleDfA;font-style:normal;font-weight:700;src:local("AccessibleDfA"),url(./assets/AccessibleDfA-Bold.woff2) format("woff2")}@font-face{font-family:AccessibleDfA;font-style:italic;font-weight:400;src:local("AccessibleDfA"),url(./assets/AccessibleDfA-Italic.woff2) format("woff2")}@font-face{font-family:IA Writer Duospace;font-style:normal;font-weight:400;src:local("iAWriterDuospace-Regular"),url(./assets/iAWriterDuospace-Regular.ttf) format("truetype")}body{widows:2;orphans:2}figcaption,th,td{widows:1;orphans:1}h2,h3,h4,h5,h6,dt,hr,caption{-webkit-column-break-after:avoid;page-break-after:avoid;break-after:avoid}h1,h2,h3,h4,h5,h6,dt,figure,tr{-webkit-column-break-inside:avoid;page-break-inside:avoid;break-inside:avoid}body{-webkit-hyphenate-character:"-";-moz-hyphenate-character:"-";-ms-hyphenate-character:"-";hyphenate-character:"-";-webkit-hyphenate-limit-lines:3;-ms-hyphenate-limit-lines:3;hyphenate-limit-lines:3}h1,h2,h3,h4,h5,h6,dt,figcaption,pre,caption,address,center,code,var{-ms-hyphens:none;-moz-hyphens:none;-webkit-hyphens:none;-epub-hyphens:none;hyphens:none}body{font-variant-numeric:oldstyle-nums proportional-nums}:lang(ja) body,:lang(zh) body,:lang(ko) body{font-variant-numeric:lining-nums proportional-nums}h1,h2,h3,h4,h5,h6,dt{font-variant-numeric:lining-nums proportional-nums}table{font-variant-numeric:lining-nums tabular-nums}code,var{font-variant-ligatures:none;font-variant-numeric:lining-nums tabular-nums slashed-zero}rt{font-variant-east-asian:ruby}:lang(ar){font-variant-ligatures:common-ligatures}:lang(ko){font-kerning:normal}hr{color:inherit;border-color:currentcolor}table,th,td{border-color:currentcolor}figure,blockquote{margin:1em 5%}ul,ol{padding-left:5%}dd{margin-left:5%}pre{white-space:pre-wrap;-ms-tab-size:2;-moz-tab-size:2;-webkit-tab-size:2;tab-size:2}abbr[title],acronym[title]{text-decoration:dotted underline}nobr wbr{white-space:normal}ruby>rt,ruby>rp{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}*:lang(ja):not(:lang(ja-Latn)):not(:lang(ja-Cyrl)),*:lang(zh):not(:lang(zh-Latn)):not(:lang(zh-Cyrl)),*:lang(ko):not(:lang(ko-Latn)):not(:lang(ko-Cyrl)),:lang(ja):not(:lang(ja-Latn)):not(:lang(ja-Cyrl)) cite,:lang(ja):not(:lang(ja-Latn)):not(:lang(ja-Cyrl)) dfn,:lang(ja):not(:lang(ja-Latn)):not(:lang(ja-Cyrl)) em,:lang(ja):not(:lang(ja-Latn)):not(:lang(ja-Cyrl)) i,:lang(zh):not(:lang(zh-Latn)):not(:lang(zh-Cyrl)) cite,:lang(zh):not(:lang(zh-Latn)):not(:lang(zh-Cyrl)) dfn,:lang(zh):not(:lang(zh-Latn)):not(:lang(zh-Cyrl)) em,:lang(zh):not(:lang(zh-Latn)):not(:lang(zh-Cyrl)) i,:lang(ko):not(:lang(ko-Latn)):not(:lang(ko-Cyrl)) cite,:lang(ko):not(:lang(ko-Latn)):not(:lang(ko-Cyrl)) dfn,:lang(ko):not(:lang(ko-Latn)):not(:lang(ko-Cyrl)) em,:lang(ko):not(:lang(ko-Latn)):not(:lang(ko-Cyrl)) i{font-style:normal}:lang(ja) a,:lang(zh) a,:lang(ko) a{text-decoration:none}:root{--RS__maxMediaWidth:100%;--RS__maxMediaHeight:95vh;--RS__boxSizingMedia:border-box;--RS__boxSizingTable:border-box}a,a span,span a,h1,h2,h3,h4,h5,h6{word-wrap:break-word}div{max-width:var(--RS__maxMediaWidth)}img,svg|svg,video{object-fit:contain;width:auto;height:auto;max-width:var(--RS__maxMediaWidth);max-height:var(--RS__maxMediaHeight)!important;box-sizing:var(--RS__boxSizingMedia);-webkit-column-break-inside:avoid;page-break-inside:avoid;break-inside:avoid}audio{max-width:100%;-webkit-column-break-inside:avoid;page-break-inside:avoid;break-inside:avoid}table{max-width:var(--RS__maxMediaWidth);box-sizing:var(--RS__boxSizingTable)}`,mu=`/*!
 * Readium CSS v.2.0.0-beta.19
 * Copyright (c) 20172025. Readium Foundation. All rights reserved.
 * Use of this source code is governed by a BSD-style license which is detailed in the
 * LICENSE file present in the project repository where this source code is maintained.
 * Core maintainer: Jiminy Panoz <jiminy.panoz@edrlab.org> 
 * Contributors: 
 * Daniel Weck
 * Hadrien Gardeur
 * Innovimax
 * L. Le Meur
 * Mickael Menu
 * k_taka
 */@namespace url(http://www.w3.org/1999/xhtml);@namespace epub url(http://www.idpf.org/2007/ops);@namespace m url(http://www.w3.org/1998/Math/MathML);@namespace svg url(http://www.w3.org/2000/svg);:root{--RS__compFontFamily:var(--RS__baseFontFamily);--RS__codeFontFamily:var(--RS__monospaceTf);--RS__typeScale:1.125;--RS__baseFontSize:100%;--RS__flowSpacing:1.5rem;--RS__paraSpacing:0;--RS__paraIndent:1em;--RS__linkColor:#0000EE;--RS__visitedColor:#551A8B;--RS__primaryColor:;--RS__secondaryColor:}body{font-size:var(--RS__baseFontSize)}h1,h2,h3,h4,h5,h6{font-family:var(--RS__compFontFamily)}blockquote,figure,p,pre,aside,footer,form,hr{margin-top:var(--RS__flowSpacing);margin-bottom:var(--RS__flowSpacing)}p{margin-top:var(--RS__paraSpacing);margin-bottom:var(--RS__paraSpacing);text-indent:var(--RS__paraIndent)}h1+p,h2+p,h3+p,h4+p,h5+p,h6+p,hr+p{text-indent:0}pre{font-family:var(--RS__codeFontFamily)}code,kbd,samp,tt{font-family:var(--RS__codeFontFamily)}sub,sup{position:relative;font-size:67.5%;line-height:1}sub{bottom:-.2ex}sup{bottom:0}:link{color:var(--RS__linkColor)}:visited{color:var(--RS__visitedColor)}h1{margin-top:calc(var(--RS__flowSpacing) * 2);margin-bottom:calc(var(--RS__flowSpacing) * 2);font-size:calc(((1em * var(--RS__typeScale)) * var(--RS__typeScale)) * var(--RS__typeScale))}h2{margin-top:calc(var(--RS__flowSpacing) * 2);margin-bottom:var(--RS__flowSpacing);font-size:calc((1em * var(--RS__typeScale)) * var(--RS__typeScale))}h3{margin-top:var(--RS__flowSpacing);margin-bottom:var(--RS__flowSpacing);font-size:calc(1em * var(--RS__typeScale))}h4{margin-top:var(--RS__flowSpacing);margin-bottom:var(--RS__flowSpacing);font-size:1em}h5{margin-top:var(--RS__flowSpacing);margin-bottom:var(--RS__flowSpacing);font-size:1em;font-variant:small-caps}h6{margin-top:var(--RS__flowSpacing);margin-bottom:0;font-size:1em;text-transform:lowercase;font-variant:small-caps}dl,ol,ul{margin-top:var(--RS__flowSpacing);margin-bottom:var(--RS__flowSpacing)}table{margin:var(--RS__flowSpacing) 0;border:1px solid currentcolor;border-collapse:collapse;empty-cells:show}thead,tbody,tfoot,table>tr{vertical-align:top}th{text-align:left}th,td{padding:4px;border:1px solid currentcolor}`,Ye=(i,e)=>URL.createObjectURL(new Blob([i],{type:e})),bl=i=>i.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\n/g,"").replace(/\s+/g," "),gr=i=>i.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"").replace(/ {2,}/g," ").replace(/url\((?!(https?:)?\/\/)("?)\/([^\)]+)/g,`url($2${window.location.origin}/$3`),zn=(i,e)=>{const t=i.createElement("script");return t.dataset.readium="true",t.src=e.startsWith("blob:")?e:Ye(e,"text/javascript"),t},mr=(i,e)=>{const t=i.createElement("link");return t.dataset.readium="true",t.rel="stylesheet",t.type="text/css",t.href=e.startsWith("blob:")?e:Ye(e,"text/css"),t},yr=new Map,Pt=(i,e)=>{if(yr.has(i))return yr.get(i);const t=e();return yr.set(i,t),t},yu=i=>zn(i,Pt("css-selector-generator",()=>Ye('!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports._readium_cssSelectorGenerator=e():t._readium_cssSelectorGenerator=e()}(self,(()=>(()=>{"use strict";var t,e,n={d:(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};function r(t){return t&&t instanceof Element}function i(t="unknown problem",...e){console.warn(`CssSelectorGenerator: ${t}`,...e)}n.r(o),n.d(o,{default:()=>z,getCssSelector:()=>U}),function(t){t.NONE="none",t.DESCENDANT="descendant",t.CHILD="child"}(t||(t={})),function(t){t.id="id",t.class="class",t.tag="tag",t.attribute="attribute",t.nthchild="nthchild",t.nthoftype="nthoftype"}(e||(e={}));const c={selectors:[e.id,e.class,e.tag,e.attribute],includeTag:!1,whitelist:[],blacklist:[],combineWithinSelector:!0,combineBetweenSelectors:!0,root:null,maxCombinations:Number.POSITIVE_INFINITY,maxCandidates:Number.POSITIVE_INFINITY};function u(t){return t instanceof RegExp}function s(t){return["string","function"].includes(typeof t)||u(t)}function l(t){return Array.isArray(t)?t.filter(s):[]}function a(t){const e=[Node.DOCUMENT_NODE,Node.DOCUMENT_FRAGMENT_NODE,Node.ELEMENT_NODE];return function(t){return t instanceof Node}(t)&&e.includes(t.nodeType)}function f(t,e){if(a(t))return t.contains(e)||i("element root mismatch","Provided root does not contain the element. This will most likely result in producing a fallback selector using element\'s real root node. If you plan to use the selector using provided root (e.g. `root.querySelector`), it will nto work as intended."),t;const n=e.getRootNode({composed:!1});return a(n)?(n!==document&&i("shadow root inferred","You did not provide a root and the element is a child of Shadow DOM. This will produce a selector using ShadowRoot as a root. If you plan to use the selector using document as a root (e.g. `document.querySelector`), it will not work as intended."),n):e.ownerDocument.querySelector(":root")}function d(t){return"number"==typeof t?t:Number.POSITIVE_INFINITY}function m(t=[]){const[e=[],...n]=t;return 0===n.length?e:n.reduce(((t,e)=>t.filter((t=>e.includes(t)))),e)}function p(t){return[].concat(...t)}function h(t){const e=t.map((t=>{if(u(t))return e=>t.test(e);if("function"==typeof t)return e=>{const n=t(e);return"boolean"!=typeof n?(i("pattern matcher function invalid","Provided pattern matching function does not return boolean. It\'s result will be ignored.",t),!1):n};if("string"==typeof t){const e=new RegExp("^"+t.replace(/[|\\\\{}()[\\]^$+?.]/g,"\\\\$&").replace(/\\*/g,".+")+"$");return t=>e.test(t)}return i("pattern matcher invalid","Pattern matching only accepts strings, regular expressions and/or functions. This item is invalid and will be ignored.",t),()=>!1}));return t=>e.some((e=>e(t)))}function g(t,e,n){const o=Array.from(f(n,t[0]).querySelectorAll(e));return o.length===t.length&&t.every((t=>o.includes(t)))}function y(t,e){e=null!=e?e:function(t){return t.ownerDocument.querySelector(":root")}(t);const n=[];let o=t;for(;r(o)&&o!==e;)n.push(o),o=o.parentElement;return n}function b(t,e){return m(t.map((t=>y(t,e))))}const N={[t.NONE]:{type:t.NONE,value:""},[t.DESCENDANT]:{type:t.DESCENDANT,value:" > "},[t.CHILD]:{type:t.CHILD,value:" "}},S=new RegExp(["^$","\\\\s"].join("|")),E=new RegExp(["^$"].join("|")),w=[e.nthoftype,e.tag,e.id,e.class,e.attribute,e.nthchild],v=h(["class","id","ng-*"]);function C({nodeName:t}){return`[${t}]`}function O({nodeName:t,nodeValue:e}){return`[${t}=\'${L(e)}\']`}function T(t){const e=Array.from(t.attributes).filter((e=>function({nodeName:t},e){const n=e.tagName.toLowerCase();return!(["input","option"].includes(n)&&"value"===t||v(t))}(e,t)));return[...e.map(C),...e.map(O)]}function I(t){return(t.getAttribute("class")||"").trim().split(/\\s+/).filter((t=>!E.test(t))).map((t=>`.${L(t)}`))}function x(t){const e=t.getAttribute("id")||"",n=`#${L(e)}`,o=t.getRootNode({composed:!1});return!S.test(e)&&g([t],n,o)?[n]:[]}function j(t){const e=t.parentNode;if(e){const n=Array.from(e.childNodes).filter(r).indexOf(t);if(n>-1)return[`:nth-child(${n+1})`]}return[]}function A(t){return[L(t.tagName.toLowerCase())]}function D(t){const e=[...new Set(p(t.map(A)))];return 0===e.length||e.length>1?[]:[e[0]]}function $(t){const e=D([t])[0],n=t.parentElement;if(n){const o=Array.from(n.children).filter((t=>t.tagName.toLowerCase()===e)),r=o.indexOf(t);if(r>-1)return[`${e}:nth-of-type(${r+1})`]}return[]}function R(t=[],{maxResults:e=Number.POSITIVE_INFINITY}={}){const n=[];let o=0,r=k(1);for(;r.length<=t.length&&o<e;)o+=1,n.push(r.map((e=>t[e]))),r=P(r,t.length-1);return n}function P(t=[],e=0){const n=t.length;if(0===n)return[];const o=[...t];o[n-1]+=1;for(let t=n-1;t>=0;t--)if(o[t]>e){if(0===t)return k(n+1);o[t-1]++,o[t]=o[t-1]+1}return o[n-1]>e?k(n+1):o}function k(t=1){return Array.from(Array(t).keys())}const _=":".charCodeAt(0).toString(16).toUpperCase(),M=/[ !"#$%&\'()\\[\\]{|}<>*+,./;=?@^`~\\\\]/;function L(t=""){var e,n;return null!==(n=null===(e=null===CSS||void 0===CSS?void 0:CSS.escape)||void 0===e?void 0:e.call(CSS,t))&&void 0!==n?n:function(t=""){return t.split("").map((t=>":"===t?`\\\\${_} `:M.test(t)?`\\\\${t}`:escape(t).replace(/%/g,"\\\\"))).join("")}(t)}const q={tag:D,id:function(t){return 0===t.length||t.length>1?[]:x(t[0])},class:function(t){return m(t.map(I))},attribute:function(t){return m(t.map(T))},nthchild:function(t){return m(t.map(j))},nthoftype:function(t){return m(t.map($))}},F={tag:A,id:x,class:I,attribute:T,nthchild:j,nthoftype:$};function V(t){return t.includes(e.tag)||t.includes(e.nthoftype)?[...t]:[...t,e.tag]}function Y(t={}){const n=[...w];return t[e.tag]&&t[e.nthoftype]&&n.splice(n.indexOf(e.tag),1),n.map((e=>{return(o=t)[n=e]?o[n].join(""):"";var n,o})).join("")}function B(t,e,n="",o){const r=function(t,e){return""===e?t:function(t,e){return[...t.map((t=>e+" "+t)),...t.map((t=>e+" > "+t))]}(t,e)}(function(t,e,n){const o=function(t,e){const{blacklist:n,whitelist:o,combineWithinSelector:r,maxCombinations:i}=e,c=h(n),u=h(o);return function(t){const{selectors:e,includeTag:n}=t,o=[].concat(e);return n&&!o.includes("tag")&&o.push("tag"),o}(e).reduce(((e,n)=>{const o=function(t,e){var n;return(null!==(n=q[e])&&void 0!==n?n:()=>[])(t)}(t,n),s=function(t=[],e,n){return t.filter((t=>n(t)||!e(t)))}(o,c,u),l=function(t=[],e){return t.sort(((t,n)=>{const o=e(t),r=e(n);return o&&!r?-1:!o&&r?1:0}))}(s,u);return e[n]=r?R(l,{maxResults:i}):l.map((t=>[t])),e}),{})}(t,n),r=function(t,e){return function(t){const{selectors:e,combineBetweenSelectors:n,includeTag:o,maxCandidates:r}=t,i=n?R(e,{maxResults:r}):e.map((t=>[t]));return o?i.map(V):i}(e).map((e=>function(t,e){const n={};return t.forEach((t=>{const o=e[t];o.length>0&&(n[t]=o)})),function(t={}){let e=[];return Object.entries(t).forEach((([t,n])=>{e=n.flatMap((n=>0===e.length?[{[t]:n}]:e.map((e=>Object.assign(Object.assign({},e),{[t]:n})))))})),e}(n).map(Y)}(e,t))).filter((t=>t.length>0))}(o,n),i=p(r);return[...new Set(i)]}(t,o.root,o),n);for(const e of r)if(g(t,e,o.root))return e;return null}function G(t){return{value:t,include:!1}}function W({selectors:t,operator:n}){let o=[...w];t[e.tag]&&t[e.nthoftype]&&(o=o.filter((t=>t!==e.tag)));let r="";return o.forEach((e=>{(t[e]||[]).forEach((({value:t,include:e})=>{e&&(r+=t)}))})),n.value+r}function H(n){return[":root",...y(n).reverse().map((n=>{const o=function(e,n,o=t.NONE){const r={};return n.forEach((t=>{Reflect.set(r,t,function(t,e){return F[e](t)}(e,t).map(G))})),{element:e,operator:N[o],selectors:r}}(n,[e.nthchild],t.DESCENDANT);return o.selectors.nthchild.forEach((t=>{t.include=!0})),o})).map(W)].join("")}function U(t,n={}){const o=function(t){const e=(Array.isArray(t)?t:[t]).filter(r);return[...new Set(e)]}(t),i=function(t,n={}){const o=Object.assign(Object.assign({},c),n);return{selectors:(r=o.selectors,Array.isArray(r)?r.filter((t=>{return n=e,o=t,Object.values(n).includes(o);var n,o})):[]),whitelist:l(o.whitelist),blacklist:l(o.blacklist),root:f(o.root,t),combineWithinSelector:!!o.combineWithinSelector,combineBetweenSelectors:!!o.combineBetweenSelectors,includeTag:!!o.includeTag,maxCombinations:d(o.maxCombinations),maxCandidates:d(o.maxCandidates)};var r}(o[0],n);let u="",s=i.root;function a(){return function(t,e,n="",o){if(0===t.length)return null;const r=[t.length>1?t:[],...b(t,e).map((t=>[t]))];for(const t of r){const e=B(t,0,n,o);if(e)return{foundElements:t,selector:e}}return null}(o,s,u,i)}let m=a();for(;m;){const{foundElements:t,selector:e}=m;if(g(o,e,i.root))return e;s=t[0],u=e,m=a()}return o.length>1?o.map((t=>U(t,i))).join(", "):function(t){return t.map(H).join(", ")}(o)}const z=U;return o})()));',"text/javascript"))),bu=i=>zn(i,Pt("JS-Before",()=>Ye(bl(`
    window._readium_blockedEvents = [];
    window._readium_blockEvents = true;
    window._readium_eventBlocker = (e) => {
        if(!window._readium_blockEvents) return;
        e.preventDefault();
        e.stopImmediatePropagation();
        _readium_blockedEvents.push([
            1, e, e.currentTarget || e.target
        ]);
    };
    window.addEventListener("DOMContentLoaded", window._readium_eventBlocker, true);
    window.addEventListener("load", window._readium_eventBlocker, true);`),"text/javascript"))),vu=i=>zn(i,Pt("JS-After",()=>Ye(bl(`
    if(window.onload) window.onload = new Proxy(window.onload, {
        apply: function(target, receiver, args) {
            if(!window._readium_blockEvents) {
                Reflect.apply(target, receiver, args);
                return;
            }
            _readium_blockedEvents.push([
                0, target, receiver, args
            ]);
        }
    });`),"text/javascript")));class vl{constructor(e,t,r,n){this.pub=e,this.item=r,this.burl=r.toURL(t)||"",this.cssProperties=n}async build(e=!1){if(this.item.mediaType.isHTML)return await this.buildHtmlFrame(e);if(this.item.mediaType.isBitmap)return this.buildImageFrame();throw Error("Unsupported frame mediatype "+this.item.mediaType.string)}async buildHtmlFrame(e=!1){const t=await this.pub.get(this.item).readAsString();if(!t)throw new Error(`Failed reading item ${this.item.href}`);const r=new DOMParser().parseFromString(t,this.item.mediaType.string),n=r.querySelector("parsererror");if(n){const s=n.querySelector("div");throw new Error(`Failed parsing item ${this.item.href}: ${s?.textContent||n.textContent}`)}return this.finalizeDOM(r,this.burl,this.item.mediaType,e,this.cssProperties)}buildImageFrame(){const e=document.implementation.createHTMLDocument(this.item.title||this.item.href),t=document.createElement("img");return t.src=this.burl||"",t.alt=this.item.title||"",t.decoding="async",e.body.appendChild(t),this.finalizeDOM(e,this.burl,this.item.mediaType,!0)}hasExecutable(e){return!!e.querySelector("script")||!!e.querySelector("body[onload]:not(body[onload=''])")}hasStyle(e){return!!(e.querySelector("link[rel='stylesheet']")||e.querySelector("style")||e.querySelector("[style]:not([style=''])"))}setProperties(e,t){for(const r in e){const n=e[r];n&&t.documentElement.style.setProperty(r,n)}}finalizeDOM(e,t,r,n=!1,s){if(!e)return"";if(!n){const a=mr(e,Pt("ReadiumCSS-before",()=>Ye(gr(gu),"text/css")));e.head.firstChild?e.head.firstChild.before(a):e.head.appendChild(a),this.hasStyle(e)||a.after(mr(e,Pt("ReadiumCSS-default",()=>Ye(gr(mu),"text/css")))),e.head.appendChild(mr(e,Pt("ReadiumCSS-after",()=>Ye(gr(fu),"text/css")))),s&&this.setProperties(s,e)}if(e.body.querySelectorAll("img").forEach(a=>{a.setAttribute("fetchpriority","high")}),r.isHTML&&this.pub.metadata.languages?.[0]){const a=this.pub.metadata.languages[0];if(r===Mi.XHTML){const h=document.documentElement.lang||document.documentElement.getAttribute("xml:lang"),l=document.body.lang||document.body.getAttribute("xml:lang");l&&!h?(document.documentElement.lang=l,document.documentElement.setAttribute("xml:lang",l),document.body.removeAttribute("xml:lang"),document.body.removeAttribute("lang")):h||(document.documentElement.lang=a,document.documentElement.setAttribute("xml:lang",a))}else r===Mi.HTML&&!document.documentElement.lang&&(document.documentElement.lang=a)}if(t!==void 0){const a=e.createElement("base");a.href=t,a.dataset.readium="true",e.head.firstChild.before(a)}const o=this.hasExecutable(e);return o&&e.head.firstChild.before(bu(e)),e.head.firstChild.before(yu(e)),o&&e.head.appendChild(vu(e)),URL.createObjectURL(new Blob([new XMLSerializer().serializeToString(e)],{type:r.isHTML?r.string:"application/xhtml+xml"}))}}class wu{constructor(e){this.hidden=!0,this.destroyed=!1,this.currModules=[],this.frame=document.createElement("iframe"),this.frame.classList.add("readium-navigator-iframe"),this.frame.style.visibility="hidden",this.frame.style.setProperty("aria-hidden","true"),this.frame.style.opacity="0",this.frame.style.position="absolute",this.frame.style.pointerEvents="none",this.frame.style.transition="visibility 0s, opacity 0.1s linear",this.source=e}async load(e){return new Promise((t,r)=>{if(this.loader){const n=this.frame.contentWindow;if([...this.currModules].sort().join("|")===[...e].sort().join("|")){try{t(n)}catch{}return}this.comms?.halt(),this.loader.destroy(),this.loader=new Wi(n,e),this.currModules=e,this.comms=void 0;try{t(n)}catch{}return}this.frame.onload=()=>{const n=this.frame.contentWindow;this.loader=new Wi(n,e),this.currModules=e;try{t(n)}catch{}},this.frame.onerror=n=>{try{r(n)}catch{}},this.frame.contentWindow.location.replace(this.source)})}async destroy(){await this.hide(),this.loader?.destroy(),this.frame.remove(),this.destroyed=!0}async hide(){if(!this.destroyed){if(this.frame.style.visibility="hidden",this.frame.style.setProperty("aria-hidden","true"),this.frame.style.opacity="0",this.frame.style.pointerEvents="none",this.hidden=!0,this.frame.parentElement)return this.comms===void 0||!this.comms.ready?void 0:new Promise((e,t)=>{this.comms?.send("unfocus",void 0,r=>{this.comms?.halt(),e()})});this.comms?.halt()}}async show(e){if(this.destroyed)throw Error("Trying to show frame when it doesn't exist");if(!this.frame.parentElement)throw Error("Trying to show frame that is not attached to the DOM");return this.comms?this.comms.resume():this.comms=new rn(this.frame.contentWindow,this.source),new Promise((t,r)=>{this.comms?.send("activate",void 0,()=>{this.comms?.send("focus",void 0,()=>{const n=()=>{this.frame.style.removeProperty("visibility"),this.frame.style.removeProperty("aria-hidden"),this.frame.style.removeProperty("opacity"),this.frame.style.removeProperty("pointer-events"),this.hidden=!1,Li.UA.WebKit&&this.comms?.send("force_webkit_recalc",void 0),t()};e!==void 0?this.comms?.send("go_progression",e,n):n()})})})}setCSSProperties(e){this.destroyed||!this.frame.contentWindow||(this.hidden&&(this.comms?this.comms?.resume():this.comms=new rn(this.frame.contentWindow,this.source)),this.comms?.send("update_properties",e),this.hidden&&this.comms?.halt())}get iframe(){if(this.destroyed)throw Error("Trying to use frame when it doesn't exist");return this.frame}get realSize(){if(this.destroyed)throw Error("Trying to use frame client rect when it doesn't exist");return this.frame.getBoundingClientRect()}get window(){if(this.destroyed||!this.frame.contentWindow)throw Error("Trying to use frame window when it doesn't exist");return this.frame.contentWindow}get atLeft(){return this.window.scrollX<5}get atRight(){return this.window.scrollX>this.window.document.scrollingElement.scrollWidth-this.window.innerWidth-5}get msg(){return this.comms}get ldr(){return this.loader}}const eo=5,to=3;class Su{constructor(e,t,r){this.pool=new Map,this.blobs=new Map,this.inprogress=new Map,this.pendingUpdates=new Map,this.container=e,this.positions=t,this.currentCssProperties=r}async destroy(){let e=this.inprogress.values(),t=e.next();const r=[];for(;t.value;)r.push(t.value),t=e.next();r.length>0&&await Promise.allSettled(r),this.inprogress.clear();let n=this.pool.values(),s=n.next();for(;s.value;)await s.value.destroy(),s=n.next();this.pool.clear(),this.blobs.forEach(o=>URL.revokeObjectURL(o)),this.container.childNodes.forEach(o=>{(o.nodeType===Node.ELEMENT_NODE||o.nodeType===Node.TEXT_NODE)&&o.remove()})}async update(e,t,r,n=!1){let s=this.positions.findIndex(h=>h.locations.position===t.locations.position);if(s<0)throw Error(`Locator not found in position list: ${t.locations.position} > ${this.positions.reduce((h,l)=>l.locations.position||0>h?l.locations.position||0:h,0)}`);const o=this.positions[s].href;this.inprogress.has(o)&&await this.inprogress.get(o);const a=new Promise(async(h,l)=>{const u=[],c=[];this.positions.forEach((d,m)=>{(m>s+eo||m<s-eo)&&(u.includes(d.href)||u.push(d.href)),m<s+to&&m>s-to&&(c.includes(d.href)||c.push(d.href))}),u.forEach(async d=>{c.includes(d)||this.pool.has(d)&&(await this.pool.get(d)?.destroy(),this.pool.delete(d),this.pendingUpdates.has(d)&&this.pendingUpdates.set(d,{inPool:!1}))}),this.currentBaseURL!==void 0&&e.baseURL!==this.currentBaseURL&&(this.blobs.forEach(d=>URL.revokeObjectURL(d)),this.blobs.clear()),this.currentBaseURL=e.baseURL;const f=async d=>{if(n&&(this.blobs.forEach(x=>URL.revokeObjectURL(x)),this.blobs.clear(),this.pendingUpdates.clear()),this.pendingUpdates.has(d)&&this.pendingUpdates.get(d)?.inPool===!1){const x=this.blobs.get(d);x&&(URL.revokeObjectURL(x),this.blobs.delete(d),this.pendingUpdates.delete(d))}if(this.pool.has(d)){const x=this.pool.get(d);if(!this.blobs.has(d))await x.destroy(),this.pool.delete(d),this.pendingUpdates.delete(d);else{await x.load(r);return}}const m=e.readingOrder.findWithHref(d);if(!m)return;if(!this.blobs.has(d)){const x=await new vl(e,this.currentBaseURL||"",m,this.currentCssProperties).build();this.blobs.set(d,x)}const y=new wu(this.blobs.get(d));d!==o&&await y.hide(),this.container.appendChild(y.iframe),await y.load(r),this.pool.set(d,y)};try{await Promise.all(c.map(d=>f(d)))}catch(d){l(d)}const g=this.pool.get(o);(g?.source!==this._currentFrame?.source||n)&&(await this._currentFrame?.hide(),g&&await g.load(r),g&&await g.show(t.locations.progression),this._currentFrame=g),h()});this.inprogress.set(o,a),await a,this.inprogress.delete(o)}setCSSProperties(e){if(!((t,r)=>{const n=Object.keys(t),s=Object.keys(r);if(n.length!==s.length)return!1;for(const o of n)if(t[o]!==r[o])return!1;return!0})(this.currentCssProperties||{},e)){this.currentCssProperties=e,this.pool.forEach(t=>{t.setCSSProperties(e)});for(const t of this.blobs.keys())this.pendingUpdates.set(t,{inPool:this.pool.has(t)})}}get currentFrames(){return[this._currentFrame]}get currentBounds(){const e={x:0,y:0,width:0,height:0,top:0,right:0,bottom:0,left:0,toJSON(){return this}};return this.currentFrames.forEach(t=>{if(!t)return;const r=t.realSize;e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),e.width+=r.width,e.height=Math.max(e.height,r.height),e.top=Math.min(e.top,r.top),e.right=Math.min(e.right,r.right),e.bottom=Math.min(e.bottom,r.bottom),e.left=Math.min(e.left,r.left)}),e}}class Eu{constructor(e,t,r){this.currModules=[],this.cachedPage=void 0,this.peripherals=e,this.debugHref=r,this.frame=document.createElement("iframe"),this.frame.classList.add("readium-navigator-iframe"),this.frame.classList.add("blank"),this.frame.scrolling="no",this.frame.style.visibility="hidden",this.frame.style.setProperty("aria-hidden","true"),this.frame.style.display="none",this.frame.style.position="absolute",this.frame.style.pointerEvents="none",this.frame.style.transformOrigin="0 0",this.frame.style.transform="scale(1)",this.frame.style.background="#fff",this.frame.style.touchAction="none",this.frame.dataset.originalHref=r,this.source="about:blank",this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.wrapper.style.float=this.wrapper.style.cssFloat=t===te.rtl?"right":"left",this.wrapper.appendChild(this.frame)}async load(e,t){return this.source===t&&this.loadPromise&&[...this.currModules].sort().join("|")===[...e].sort().join("|")?this.loadPromise:(this.loaded&&this.source!==t&&this.window.stop(),this.source=t,this.loadPromise=new Promise((r,n)=>{if(this.loader&&this.loaded){const s=this.frame.contentWindow;if([...this.currModules].sort().join("|")===[...e].sort().join("|")){try{r(s),this.loadPromise=void 0}catch{}return}this.comms?.halt(),this.loader.destroy(),this.loader=new Wi(s,e),this.currModules=e,this.comms=void 0;try{r(s),this.loadPromise=void 0}catch{}return}this.frame.addEventListener("load",()=>{const s=this.frame.contentWindow;this.loader=new Wi(s,e),this.currModules=e,this.peripherals.observe(this.wrapper),this.peripherals.observe(s);try{r(s)}catch{}},{once:!0}),this.frame.addEventListener("error",s=>{try{n(s.error),this.loadPromise=void 0}catch{}},{once:!0}),this.frame.style.removeProperty("display"),this.frame.contentWindow.location.replace(this.source)}),this.loadPromise)}loadPageSize(){const e=this.frame.contentWindow,t=e.document.head.querySelector("meta[name=viewport]");if(t){const r=/(\w+) *= *([^\s,]+)/g;let n,s=0,o=0;for(;n=r.exec(t.content);)n[1]==="width"?s=Number.parseFloat(n[2]):n[1]==="height"&&(o=Number.parseFloat(n[2]));if(s>0&&o>0)return{width:s,height:o}}return{width:e.document.body.scrollWidth,height:e.document.body.scrollHeight}}update(e){if(!this.loaded)return;const t=this.loadPageSize();this.frame.style.height=`${t.height}px`,this.frame.style.width=`${t.width}px`;const r=Math.min(this.wrapper.clientWidth/t.width,this.wrapper.clientHeight/t.height);this.frame.style.transform=`scale(${r})`;const n=this.frame.getBoundingClientRect(),s=this.wrapper.clientHeight-n.height;if(this.frame.style.top=`${s/2}px`,e===Ne.left){const o=this.wrapper.clientWidth-n.width;this.frame.style.left=`${o}px`}else if(e===Ne.center){const o=this.wrapper.clientWidth-n.width;this.frame.style.left=`${o/2}px`}else this.frame.style.left="0px";this.frame.style.removeProperty("visibility"),this.frame.style.removeProperty("aria-hidden"),this.frame.style.removeProperty("pointer-events"),this.frame.classList.remove("blank"),this.frame.classList.add("loaded")}async destroy(){await this.unfocus(),this.loader?.destroy(),this.wrapper.remove()}async unload(){if(this.loaded)return this.deselect(),this.frame.style.visibility="hidden",this.frame.style.setProperty("aria-hidden","true"),this.frame.style.pointerEvents="none",this.frame.classList.add("blank"),this.frame.classList.remove("loaded"),this.comms?.halt(),this.loader?.destroy(),this.comms=void 0,this.frame.blur(),new Promise((e,t)=>{this.frame.addEventListener("load",()=>{try{this.showPromise=void 0,e()}catch{}},{once:!0}),this.frame.addEventListener("error",r=>{try{this.showPromise=void 0,t(r.error)}catch{}},{once:!0}),this.source="about:blank",this.frame.contentWindow.location.replace("about:blank"),this.frame.style.display="none"})}deselect(){this.frame.contentWindow?.getSelection()?.removeAllRanges()}async unfocus(){if(this.frame.parentElement)return this.comms===void 0?void 0:new Promise((e,t)=>{this.comms?.send("unfocus",void 0,r=>{this.comms?.halt(),this.showPromise=void 0,e()})});this.comms?.halt()}async show(e){if(!this.frame.parentElement){console.warn("Trying to show frame that is not attached to the DOM");return}if(!this.loaded){this.showPromise=void 0;return}return this.showPromise?(this.cachedPage!==e&&(this.update(e),this.cachedPage=e),this.showPromise):(this.cachedPage=e,this.comms?this.comms.resume():this.comms=new rn(this.frame.contentWindow,this.source),this.showPromise=new Promise((t,r)=>{this.comms.send("focus",void 0,n=>{this.update(this.cachedPage),t()})}),this.showPromise)}async activate(){return new Promise((e,t)=>{if(!this.comms)return e();this.comms?.send("activate",void 0,()=>{e()})})}get element(){return this.wrapper}get iframe(){return this.frame}get realSize(){return this.frame.getBoundingClientRect()}get loaded(){return this.frame.contentWindow&&this.frame.contentWindow.location.href!=="about:blank"}set width(e){const t=`${e}%`;this.wrapper.style.width!==t&&(this.wrapper.style.width=t)}set height(e){const t=`${e}px`;this.wrapper.style.height!==t&&(this.wrapper.style.height=t)}get window(){if(!this.frame.contentWindow)throw Error("Trying to use frame window when it doesn't exist");return this.frame.contentWindow}get atLeft(){return this.window.scrollX<5}get atRight(){return this.window.scrollX>this.window.document.scrollingElement.scrollWidth-this.window.innerWidth-5}get msg(){return this.comms}get ldr(){return this.loader}}class xu{constructor(){this.outerWidth=0,this.outerHeight=0,this.HTML=document.documentElement,this.Head=document.head,this.Body=document.body}refreshOuterPixels(e){Li.OS.iOS||(this.outerHeight=window.outerHeight-window.innerHeight,Li.OS.Android&&Li.UA.Chrome&&window.screen.height>window.innerHeight&&(this.outerHeight=(window.screen.height-window.innerHeight)/1.5),this.outerWidth=window.outerWidth-window.innerWidth)}getBibiEventCoord(e,t=0){const r={X:0,Y:0};return/^touch/.test(e.type)?(r.X=e.touches[t].screenX,r.Y=e.touches[t].screenY):(r.X=e.screenX,r.Y=e.screenY),(e.target.ownerDocument?.documentElement||e.target.documentElement)===this.HTML&&(r.X-=this.HTML.scrollLeft+this.Body.scrollLeft,r.Y-=this.HTML.scrollTop+this.Body.scrollTop),r.X-=this.outerWidth,r.Y-=this.outerHeight,r}getTouchDistance(e){if(e.touches.length!==2)return 0;const t=e.touches[0].screenX-this.outerWidth,r=e.touches[0].screenY-this.outerHeight,n=e.touches[1].screenX-this.outerWidth,s=e.touches[1].screenY-this.outerHeight;return Math.sqrt(Math.pow(n-t,2)+Math.pow(s-r,2))}getTouchCenter(e){if(e.touches.length!==2)return null;const t=this.HTML.scrollLeft+this.Body.scrollLeft,r=this.HTML.scrollTop+this.Body.scrollTop,n=e.touches[0].screenX-this.outerWidth-t,s=e.touches[0].screenY-this.outerHeight-r,o=e.touches[1].screenX-this.outerWidth-t,a=e.touches[1].screenY-this.outerHeight-r;return{X:(n+o)/2,Y:(s+a)/2}}getBibiEvent(e){if(!e)return{Coord:null,Division:null,Ratio:null,Target:null};const t=this.getBibiEventCoord(e);let r=.3;const n={X:t.X/window.innerWidth,Y:t.Y/window.innerHeight};let s,o,a,h;a=s=r,h=o=1-r;const l={X:null,Y:null};return n.X<a?l.X=0:h<n.X?l.X=2:l.X=1,n.Y<s?l.Y=0:o<n.Y?l.Y=2:l.Y=1,{Target:e.target,Coord:t,Ratio:n,Division:l}}}class Tu{constructor(){this._DOM={show:!1,pinchTarget:document.createElement("div"),touch1:document.createElement("div"),touch2:document.createElement("div"),center:document.createElement("div"),stats:document.createElement("div")},this._DOM.show=!0,this._DOM.pinchTarget.style.zIndex=this._DOM.stats.style.zIndex=this._DOM.center.style.zIndex=this._DOM.touch1.style.zIndex=this._DOM.touch2.style.zIndex="100000",this._DOM.pinchTarget.style.position=this._DOM.stats.style.position=this._DOM.center.style.position=this._DOM.touch1.style.position=this._DOM.touch2.style.position="absolute",this._DOM.pinchTarget.style.borderRadius=this._DOM.center.style.borderRadius=this._DOM.touch1.style.borderRadius=this._DOM.touch2.style.borderRadius="50%",this._DOM.pinchTarget.style.pointerEvents=this._DOM.stats.style.pointerEvents=this._DOM.center.style.pointerEvents=this._DOM.touch1.style.pointerEvents=this._DOM.touch2.style.pointerEvents="none",this._DOM.pinchTarget.style.display=this._DOM.center.style.display=this._DOM.touch1.style.display=this._DOM.touch2.style.display="none",this._DOM.pinchTarget.style.paddingTop=this._DOM.center.style.paddingTop="10px",this._DOM.pinchTarget.style.width=this._DOM.pinchTarget.style.height=this._DOM.center.style.width=this._DOM.center.style.height="10px",this._DOM.pinchTarget.style.backgroundColor="green",this._DOM.center.style.backgroundColor="red",this._DOM.touch1.style.backgroundColor=this._DOM.touch2.style.backgroundColor="blue",this._DOM.touch1.style.height=this._DOM.touch2.style.height="20px",this._DOM.touch1.style.width=this._DOM.touch2.style.width="20px",this._DOM.touch1.style.paddingTop=this._DOM.touch2.style.paddingTop="20px",this._DOM.touch1.textContent="1",this._DOM.touch2.textContent="2",this._DOM.stats.style.padding="20px",this._DOM.stats.style.backgroundColor="rgba(0,0,0,0.5)",this._DOM.stats.style.color="white",this._DOM.stats.textContent="[stats]",document.body.appendChild(this._DOM.stats),document.body.appendChild(this._DOM.center),document.body.appendChild(this._DOM.touch1),document.body.appendChild(this._DOM.touch2),document.body.appendChild(this._DOM.pinchTarget)}get show(){return this.DOM.show}get DOM(){return this._DOM}}const io=6,br=1.02,ro=50;class Au{constructor(e,t=!1){this.dragState=0,this.minimumMoved=!1,this.pan={startX:0,endX:0,startY:0,overscrollX:0,overscrollY:0,letItGo:!1,preventClick:!1,translateX:0,translateY:0,touchID:0},this.pinch={startDistance:0,startScale:0,target:{X:0,Y:0},touchN:0,startTranslate:{X:0,Y:0}},this._scale=1,this.scaleDebouncer=0,this.frameBounds=null,this.debugger=null,this.btouchstartHandler=this.touchstartHandler.bind(this),this.btouchendHandler=this.touchendHandler.bind(this),this.btouchmoveHandler=this.touchmoveHandler.bind(this),this.bdblclickHandler=this.dblclickHandler.bind(this),this.bmousedownHandler=this.mousedownHandler.bind(this),this.bmouseupHandler=this.mouseupHandler.bind(this),this.bmousemoveHandler=this.mousemoveHandler.bind(this),this.moveFrame=0,this.manager=e,this.coordinator=new xu,this.attachEvents(),t&&(this.debugger=new Tu)}get scale(){return this._scale}set scale(e){isNaN(e)&&(e=1),window.clearTimeout(this.scaleDebouncer),this.scaleDebouncer=window.setTimeout(()=>{this.dragState===0&&this.scale<br&&(this.pan.translateX=0,this.pan.translateY=0,this.clearPan(),this.manager.updateBookStyle()),this.manager.listener("zoom",e)},100),this._scale=e}attachEvents(){this.observe(this.manager.spineElement),this.pan={startX:0,startY:0,endX:0,overscrollX:0,overscrollY:0,letItGo:!1,preventClick:!1,translateX:0,translateY:0,touchID:0},this.pinch={startDistance:0,startScale:0,target:{X:0,Y:0},startTranslate:{X:0,Y:0},touchN:0}}clearPan(){this.pan.letItGo=!1,this.pan.touchID=0,this.pan.endX=0,this.pan.overscrollX=0,this.pan.overscrollY=0}clearPinch(){this.pinch={startDistance:0,startScale:this.pinch.startScale,target:{X:0,Y:0},touchN:0,startTranslate:{X:0,Y:0}}}observe(e){e.addEventListener("touchstart",this.btouchstartHandler),e.addEventListener("touchend",this.btouchendHandler),e.addEventListener("touchmove",this.btouchmoveHandler,{passive:!0}),e.addEventListener("dblclick",this.bdblclickHandler,{passive:!0}),e.addEventListener("mousedown",this.bmousedownHandler),e.addEventListener("mouseup",this.bmouseupHandler),e.addEventListener("mousemove",this.bmousemoveHandler)}clickHandler(e){}touchstartHandler(e){if(["TEXTAREA","OPTION","INPUT","SELECT"].indexOf(e.target.nodeName)!==-1)return;switch(e.stopPropagation(),this.frameBounds=this.manager.currentBounds,this.coordinator.refreshOuterPixels(this.frameBounds),e.touches.length){case 3:return;case 2:{e.preventDefault(),this.pinch.startDistance=this.coordinator.getTouchDistance(e);const r=this.startTouch(e);this.pan.startX=r.X,this.pan.startY=r.Y,this.dragState=2,this.manager.updateBookStyle(!0),this.isScaled?(this.pinch.target.X-=this.pan.translateX*(this.pinch.startScale/this.scale),this.pinch.target.Y-=this.pan.translateY*(this.pinch.startScale/this.scale),this.pinch.target={X:0,Y:0},this.pinch.startScale=1/this.scale):(this.pinch.target={X:0,Y:0},this.pinch.startScale=this.scale),this.pinch.startTranslate={X:this.pan.translateX,Y:this.pan.translateY},this.debugger?.show&&(this.debugger.DOM.touch2.style.display="",this.debugger.DOM.center.style.display="",this.debugger.DOM.pinchTarget.style.display="");return}case 1:this.pan.touchID=e.touches[0].identifier,this.debugger?.show&&(this.debugger.DOM.touch1.style.display="");default:this.dragState<1&&(this.dragState=1),this.manager.updateBookStyle(!0)}this.manager.updateSpineStyle(!1);const t=this.startTouch(e);this.pan.startX=t.X,this.pan.startY=t.Y}startTouch(e){const t=this.coordinator.getTouchCenter(e)||this.coordinator.getBibiEventCoord(e);return{X:t.X-this.manager.width/2-this.pan.translateX*this.scale+this.manager.width/2,Y:t.Y-this.manager.height/2-this.pan.translateY*this.scale+this.manager.height/2}}touchendHandler(e){if(e.stopPropagation(),!e.touches||e.touches.length===0)this.pan.endX&&!this.isScaled?(this.pinch.touchN&&(this.pan.endX=this.pan.startX),this.updateAfterDrag()):!this.pinch.touchN&&Math.abs(this.pan.overscrollX)>ro&&Math.abs(this.pan.overscrollY)<ro/2&&(this.pan.startX=0,this.pan.endX=-this.pan.overscrollX,this.updateAfterDrag()),this.dragState=0,this.minimumMoved=!1,this.clearPinch(),this.debugger?.show&&(this.debugger.DOM.center.style.display="none",this.debugger.DOM.touch1.style.display="none",this.debugger.DOM.touch2.style.display="none");else if(e.touches.length===1){this.dragState=1,e.touches[0].identifier!==this.pan.touchID&&(this.pan.touchID=e.touches[0].identifier),this.debugger?.show&&(this.debugger.DOM.center.style.display="none",this.debugger.DOM.touch2.style.display="none",this.debugger.DOM.pinchTarget.style.display="none");const t=this.startTouch(e);this.pan.startX=t.X,this.pan.startY=t.Y}window.setTimeout(()=>{this.manager.updateBookStyle(!0),this.dragState===0&&(this.scale<br&&(this.pan.translateX=0,this.pan.translateY=0),this.clearPan()),this.manager.updateBookStyle(!0)},50)}touchmoveHandler(e){e.stopPropagation();const t=this.coordinator.getBibiEventCoord(e);Math.abs(this.pan.startY-t.Y)+Math.abs(this.pan.startX-t.X)>5&&(this.minimumMoved||(this.manager.deselect(),this.minimumMoved=!0),this.dragState<1&&(this.dragState=1));const r=this.coordinator?.getTouchDistance(e);let n=!1;const s=this.scale;if(this.dragState===2&&r){if(this.pinch.touchN++,this.pinch.touchN<4)return;let o=r/this.pinch.startDistance*this.scale;o>=io&&(o=io),o<=br&&(o=1),this.scale=o,this.pinch.startDistance=r,n=!0}if(this.pan.letItGo===!1&&(this.pan.letItGo=Math.abs(this.pan.startY-t.Y)<Math.abs(this.pan.startX-t.X)),this.debugger?.show&&(this.debugger.DOM.touch1.style.top=`${t.Y-10}px`,this.debugger.DOM.touch1.style.left=`${t.X-10}px`,this.debugger.DOM.touch1.innerText=`${t.X.toFixed(2)},${t.Y.toFixed(2)}`),this.dragState>0&&this.isScaled||this.dragState>1){if(this.dragState===1){const h={X:t.X-this.manager.width/2,Y:t.Y-this.manager.height/2};this.pan.translateX=(h.X-(this.pan.startX-this.manager.width/2))*1/this.scale,this.pan.translateY=(h.Y-(this.pan.startY-this.manager.height/2))*1/this.scale}else if(this.dragState===2){const h=this.coordinator.getTouchCenter(e);if(this.debugger?.show){this.debugger.DOM.center.style.top=`${h.Y-5}px`,this.debugger.DOM.center.style.left=`${h.X-5}px`,this.debugger.DOM.center.innerText=`${h.X.toFixed(2)},${h.Y.toFixed(2)}`;const g=this.coordinator.getBibiEventCoord(e,1);this.debugger.DOM.touch2.style.top=`${g.Y-10}px`,this.debugger.DOM.touch2.style.left=`${g.X-10}px`,this.debugger.DOM.touch2.innerText=`${g.X.toFixed(2)},${g.Y.toFixed(2)}`}h.X-=this.manager.width/2,h.Y-=this.manager.height/2;let l=-h.X/s;l+=h.X/this.scale,this.pinch.target.X+=l,h.X+=this.pinch.target.X*this.scale/this.pinch.startScale;let u=-h.Y/s;u+=h.Y/this.scale,this.pinch.target.Y+=u,h.Y+=this.pinch.target.Y*this.scale/this.pinch.startScale;let c=(h.X-(this.pan.startX-this.manager.width/2))*1/this.scale,f=(h.Y-(this.pan.startY-this.manager.height/2))*1/this.scale;this.pan.translateX=c,this.pan.translateY=f,this.debugger?.show&&(this.debugger.DOM.pinchTarget.style.left=`${this.pinch.target.X*this.scale/this.pinch.startScale-5+this.manager.width/2}px`,this.debugger.DOM.pinchTarget.style.top=`${this.pinch.target.Y*this.scale/this.pinch.startScale-5+this.manager.height/2}px`,this.debugger.DOM.pinchTarget.innerText=`${(this.pinch.target.X*this.scale/this.pinch.startScale).toFixed(2)},${(this.pinch.target.Y*this.scale/this.pinch.startScale).toFixed(2)}`)}const o=this.frameBounds.width/6,a=this.frameBounds.height/6;this.pan.translateX<-o&&(this.pan.overscrollX=-(o+this.pan.translateX),this.pan.translateX=-o),this.pan.translateY<-a&&(this.pan.overscrollY=-(a+this.pan.translateY),this.pan.translateY=-a),this.pan.translateX>o&&(this.pan.overscrollX=o-this.pan.translateX,this.pan.translateX=o),this.pan.translateY>a&&(this.pan.overscrollY=a-this.pan.translateY,this.pan.translateY=a),n=!0,this.debugger?.show&&(this.debugger.DOM.stats.innerText=`TX: ${this.pan.translateX.toFixed(2)}
TY: ${this.pan.translateY.toFixed(2)}
Zoom: ${this.scale.toFixed(2)}
Overscroll: ${this.pan.overscrollX.toFixed(2)},${this.pan.overscrollY.toFixed(2)}`)}if(n){this.manager.updateBookStyle();return}if(this.dragState>0&&this.pan.letItGo){this.pan.endX=t.X;const o=this.manager.currentSlide*(this.manager.width/this.manager.perPage),a=this.pan.endX-this.pan.startX,h=this.manager.rtl?o+a:o-a;cancelAnimationFrame(this.moveFrame),this.moveFrame=requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.manager.spineElement.style.transform=`translate3d(${(this.manager.rtl?1:-1)*h}px, 0, 0)`})})}}dblclickHandler(e){clearTimeout(this.dtimer),this.pdblclick=!0,this.dtimer=window.setTimeout(()=>this.pdblclick=!1,200),!this.disableDblClick&&this.isScaled&&(this.scale=1)}get isScaled(){return this.scale>1}addTouch(e){e.touches=[{pageX:e.pageX,pageY:e.pageY}]}mousedownHandler(e){this.isScaled&&(this.addTouch(e),this.touchstartHandler(e))}mouseupHandler(e){this.isScaled&&this.touchendHandler(e)}mousemoveHandler(e){this.isScaled&&e.buttons>0&&(e.preventDefault(),this.addTouch(e),this.touchmoveHandler(e))}updateAfterDrag(){const e=(this.manager.rtl?-1:1)*(this.pan.endX-this.pan.startX),t=Math.abs(e);e>0&&t>this.manager.threshold&&this.manager.slength>this.manager.perPage?this.manager.listener("no_less",void 0):e<0&&t>this.manager.threshold&&this.manager.slength>this.manager.perPage&&this.manager.listener("no_more",void 0),this.manager.slideToCurrent(!0,!0)}}var nn=(i=>(i.auto="auto",i.landscape="landscape",i.portrait="portrait",i))(nn||{}),sn=(i=>(i.auto="auto",i.both="both",i.none="none",i.landscape="landscape",i))(sn||{});class Cu{constructor(e){this.shift=!0,this.spreads=[],this.nLandscape=0,this.index(e),this.testShift(e),console.log(`Indexed ${this.spreads.length} spreads for ${e.readingOrder.items.length} items`)}index(e,t=!1){this.nLandscape=0,e.readingOrder.items.forEach((r,n)=>{t||(e.readingOrder.items[n]=r.addProperties({number:n+1,isImage:r.type?.indexOf("image/")===0}));const s=r.properties?.otherProperties.orientation==="landscape";(!r.properties?.page||t)&&(r.properties=r.properties?.add({page:s?"center":((this.shift?0:1)+n-this.nLandscape)%2?e.metadata.readingProgression===te.rtl?"right":"left":e.metadata.readingProgression===te.rtl?"left":"right"})),(s||r.properties?.otherProperties.addBlank)&&this.nLandscape++}),t&&(this.spreads=[]),this.buildSpreads(e.readingOrder)}testShift(e){let t=!1;this.spreads.forEach((r,n)=>{if(r.length>1)return;const s=r[0],o=s.properties?.otherProperties.orientation;n===0&&(o==="landscape"||o!=="portrait"&&((s.width||0)>(s.height||0)||s.properties?.otherProperties.spread==="both"))&&(this.shift=!1),t&&s.properties?.page===Ne.center&&this.spreads[n-1][0].addProperties({addBlank:!0}),o==="portrait"&&s.properties?.page!=="center"&&s.properties?.otherProperties.number>1?t=!0:t=!1}),this.shift||this.index(e,!0)}buildSpreads(e){let t=[];e.items.forEach((r,n)=>{!n&&this.shift?this.spreads.push([r]):r.properties?.page===Ne.center?(t.length>0&&this.spreads.push(t),this.spreads.push([r]),t=[]):t.length>=2?(this.spreads.push(t),t=[r]):t.push(r)}),t.length>0&&this.spreads.push(t)}currentSpread(e,t){return this.spreads[Math.min(Math.floor(e/t),this.spreads.length-1)]}findByLink(e){return this.spreads.find(t=>t.includes(e))||void 0}}const no=8,so=5,Pu=300,_u=15e3,Ou=250,Ru=150,Lu=500;class Iu{constructor(e,t,r){if(this.pool=new Map,this.blobs=new Map,this.inprogress=new Map,this.delayedShow=new Map,this.delayedTimeout=new Map,this.previousFrames=[],this.width=0,this.height=0,this.transform="",this.currentSlide=0,this.spread=!0,this.orientationInternal=-1,this.container=e,this.positions=t,this.pub=r,this.spreadPresentation=r.metadata.otherMetadata?.spread||sn.auto,this.pub.metadata.effectiveReadingProgression!==te.rtl&&this.pub.metadata.effectiveReadingProgression!==te.ltr)throw Error("Unsupported reading progression for EPUB");this.spreader=new Cu(this.pub),this.containerHeightCached=e.clientHeight,this.bookElement=document.createElement("div"),this.bookElement.ariaLabel="Book",this.bookElement.tabIndex=-1,this.updateBookStyle(!0),this.spineElement=document.createElement("div"),this.spineElement.ariaLabel="Spine",this.bookElement.appendChild(this.spineElement),this.container.appendChild(this.bookElement),this.updateSpineStyle(!0),this.peripherals=new Au(this),this.pub.readingOrder.items.forEach(n=>{const s=new Eu(this.peripherals,this.pub.metadata.effectiveReadingProgression,n.href);this.spineElement.appendChild(s.element),this.pool.set(n.href,s),s.width=100/this.length*(n.properties?.otherProperties.orientation===nn.landscape||n.properties?.otherProperties.addBlank?this.perPage:1),s.height=this.height})}set listener(e){this._listener=e}get listener(){return this._listener}get doNotDisturb(){return this.peripherals.pan.touchID>0}resizeHandler(e=!0,t=!0){this.currentSlide+this.perPage>this.length&&(this.currentSlide=this.length<=this.perPage?0:this.length-1),this.containerHeightCached=this.container.clientHeight,this.orientationInternal=-1,this.updateSpineStyle(!0),e&&(this.currentSlide=this.reAlign(),this.slideToCurrent(!t,t)),clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(()=>{this.pool.forEach((r,n)=>{let s=this.pub.readingOrder.items.findIndex(h=>h.href===n);const o=this.pub.readingOrder.items[s];if(r.width=100/this.length*(o.properties?.otherProperties.orientation===nn.landscape||o.properties?.otherProperties.addBlank?this.perPage:1),r.height=this.height,!r.loaded)return;const a=this.spreader.findByLink(o);r.update(this.spreadPosition(a,o))})},Ou)}updateDimensions(){this.width=this.bookElement.clientWidth,this.height=this.bookElement.clientHeight}get rtl(){return this.pub.metadata.effectiveReadingProgression===te.rtl}get single(){return!this.spread||this.portrait}get perPage(){return this.spread&&!this.portrait?2:1}get threshold(){return 50}get portrait(){return this.spreadPresentation===sn.none?!0:(this.orientationInternal===-1&&(this.orientationInternal=this.containerHeightCached>this.container.clientWidth?1:0),this.orientationInternal===1)}updateSpineStyle(e,t=!0){let r="0";this.updateDimensions(),this.perPage>1&&(r=`${this.width/2}px`);const n={transition:e?`all ${t?Ru:Lu}ms ease-out`:"all 0ms ease-out",marginRight:this.rtl?r:"0",marginLeft:this.rtl?"0":r,width:`${this.width/this.perPage*this.length}px`,transform:this.transform,contain:"content"};Object.assign(this.spineElement.style,n)}updateBookStyle(e=!1){if(e){const t={overflow:"hidden",direction:this.pub.metadata.effectiveReadingProgression,cursor:"",height:"100%",width:"100%",position:"relative",outline:"none",transition:this.peripherals?.dragState?"none":"transform .15s ease-in-out",touchAction:"none"};Object.assign(this.bookElement.style,t)}this.bookElement.style.transform=`scale(${this.peripherals?.scale||1})`+(this.peripherals?` translate3d(${this.peripherals.pan.translateX}px, ${this.peripherals.pan.translateY}px, 0px)`:"")}goTo(e){if(this.slength<=this.perPage)return;e=this.reAlign(e);const t=this.currentSlide;this.currentSlide=Math.min(Math.max(e,0),this.length-1),t!==this.currentSlide&&this.slideToCurrent(!1)}onChange(){this.peripherals.scale=1,this.updateBookStyle()}get offset(){return(this.rtl?1:-1)*this.currentSlide*(this.width/this.perPage)}get length(){if(this.single)return this.slength;const e=this.slength+this.nLandscape;return this.shift&&e%2===0?e+1:e}get slength(){return this.pub.readingOrder.items.length||0}get shift(){return this.spreader.shift}get nLandscape(){return this.spreader.nLandscape}setPerPage(e){e===null?this.spread=!0:e===1?this.spread=!1:this.spread=!0,requestAnimationFrame(()=>this.resizeHandler(!0))}slideToCurrent(e,t=!0){if(this.updateDimensions(),e)requestAnimationFrame(()=>{requestAnimationFrame(()=>{const r=`translate3d(${this.offset}px, 0, 0)`;this.spineElement.style.transform!==r&&(this.transform=r,this.updateSpineStyle(!0,t),this.deselect())})});else{const r=`translate3d(${this.offset}px, 0, 0)`;if(this.spineElement.style.transform===r)return;this.transform=r,this.updateSpineStyle(!1),this.deselect()}}bounce(e=!1){requestAnimationFrame(()=>{this.transform=`translate3d(${this.offset+50*(e?1:-1)}px, 0, 0)`,this.updateSpineStyle(!0,!0),setTimeout(()=>{this.transform=`translate3d(${this.offset}px, 0, 0)`,this.updateSpineStyle(!0,!0)},100)})}next(e=1){if(this.slength<=this.perPage)return!1;const t=this.currentSlide;return this.currentSlide=Math.min(this.currentSlide+e,this.length-1),this.perPage>1&&this.currentSlide%2&&this.currentSlide--,this.currentSlide===t&&(this.currentSlide+1,this.length),t!==this.currentSlide?(this.slideToCurrent(!0),this.onChange(),!0):(this.bounce(this.rtl),!1)}prev(e=1){if(this.slength<=this.perPage)return!1;const t=this.currentSlide;return this.currentSlide=Math.max(this.currentSlide-e,0),this.perPage>1&&this.currentSlide%2&&this.currentSlide++,t!==this.currentSlide?(this.slideToCurrent(!0),this.onChange(),!0):(this.bounce(!this.rtl),!1)}get ownerWindow(){return this.container.ownerDocument.defaultView||window}async destroy(){let e=this.inprogress.values(),t=e.next();const r=[];for(;t.value;)r.push(t.value),t=e.next();r.length>0&&await Promise.allSettled(r),this.inprogress.clear();let n=this.pool.values(),s=n.next();for(;s.value;)await s.value.destroy(),s=n.next();this.pool.clear(),this.blobs.forEach(o=>URL.revokeObjectURL(o)),this.container.childNodes.forEach(o=>{(o.nodeType===Node.ELEMENT_NODE||o.nodeType===Node.TEXT_NODE)&&o.remove()})}makeSpread(e){return this.perPage<2?[this.pub.readingOrder.items[e]]:this.spreader.currentSpread(e,this.perPage)}reAlign(e=this.currentSlide){return e%2&&!this.single&&e++,e}spreadPosition(e,t){return this.perPage<2||e.length<2?Ne.center:t.href===e[0].href?this.rtl?Ne.right:Ne.left:this.rtl?Ne.left:Ne.right}async waitForItem(e){if(this.inprogress.has(e)&&await this.inprogress.get(e),this.delayedShow.has(e)){const t=this.delayedTimeout.get(e);t>0?clearTimeout(t):await this.delayedShow.get(e),this.delayedTimeout.set(e,0),this.delayedShow.delete(e)}}async cancelShowing(e){if(this.delayedShow.has(e)){const t=this.delayedTimeout.get(e);t>0&&clearTimeout(t),this.delayedShow.delete(e)}}async update(e,t,r,n=!1){let s=this.pub.readingOrder.items.findIndex(h=>h.href===t.href);if(s<0)throw Error("Href not found in reading order");this.currentSlide!==s&&(this.currentSlide=this.reAlign(s),this.slideToCurrent(!0));const o=this.makeSpread(this.currentSlide);this.perPage>1&&s++;for(const h of o)await this.waitForItem(h.href);const a=new Promise(async(h,l)=>{const u=[],c=[];this.positions.forEach((d,m)=>{(m>s+no||m<s-no)&&(u.includes(d.href)||u.push(d.href)),m<s+so&&m>s-so&&(c.includes(d.href)||c.push(d.href))}),u.forEach(async d=>{c.includes(d)||this.pool.has(d)&&(this.cancelShowing(d),await this.pool.get(d)?.unload())}),this.currentBaseURL!==void 0&&e.baseURL!==this.currentBaseURL&&(this.blobs.forEach(d=>URL.revokeObjectURL(d)),this.blobs.clear()),this.currentBaseURL=e.baseURL;const f=async d=>{const m=e.readingOrder.findIndexWithHref(d),y=e.readingOrder.items[m];if(y){if(!this.blobs.has(d)){const x=await new vl(e,this.currentBaseURL||"",y).build(!0);this.blobs.set(d,x)}this.delayedShow.has(d)||this.delayedShow.set(d,new Promise((x,R)=>{let L=!1;const I=window.setTimeout(async()=>{this.delayedTimeout.set(d,0);const W=this.makeSpread(this.reAlign(m)),H=this.spreadPosition(W,y),F=this.pool.get(d);await F.load(r,this.blobs.get(d)),this.peripherals.isScaled||await F.show(H),this.delayedShow.delete(d),L=!0,x()},Pu);setTimeout(()=>{!L&&this.delayedShow.has(d)&&R(`Offscreen load timeout: ${d}`)},_u),this.delayedTimeout.set(d,I)}))}};try{await Promise.all(c.map(d=>f(d)))}catch(d){l(d)}const g=[];for(const d of o){const m=this.pool.get(d.href),y=this.blobs.get(d.href);y&&(this.cancelShowing(d.href),await m.load(r,y),await m.show(this.spreadPosition(o,d)),this.previousFrames.push(m),await m.activate(),g.push(m))}for(;this.previousFrames.length>0;){const d=this.previousFrames.shift();d&&!g.includes(d)&&await d.unfocus()}this.previousFrames=g,h()});for(const h of o)this.inprogress.set(h.href,a);await a;for(const h of o)this.inprogress.delete(h.href)}get currentFrames(){if(this.perPage<2){const e=this.pub.readingOrder.items[this.currentSlide];return[this.pool.get(e.href)]}return this.spreader.currentSpread(this.currentSlide,this.perPage).map(e=>this.pool.get(e.href))}get currentBounds(){const e={x:0,y:0,width:0,height:0,top:0,right:0,bottom:0,left:0,toJSON(){return this}};return this.currentFrames.forEach(t=>{if(!t)return;const r=t.realSize;e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),e.width+=r.width,e.height=Math.max(e.height,r.height),e.top=Math.min(e.top,r.top),e.right=Math.min(e.right,r.right),e.bottom=Math.min(e.bottom,r.bottom),e.left=Math.min(e.left,r.left)}),e}get viewport(){const e={readingOrder:[],progressions:new Map,positions:null};return this.spreader.currentSpread(this.currentSlide,this.perPage).forEach(t=>{e.readingOrder.push(t.href),e.progressions.set(t.href,{start:0,end:1})}),e.positions=this.getCurrentNumbers(),e}getCurrentNumbers(){if(this.perPage<2)return[this.pub.readingOrder.items[this.currentSlide].properties?.otherProperties.number];const e=this.spreader.currentSpread(this.currentSlide,this.perPage);return e.length>1?[e[0].properties?.otherProperties.number,e[e.length-1].properties?.otherProperties.number]:[e[0].properties?.otherProperties.number]}deselect(){this.currentFrames?.forEach(e=>e?.deselect())}}var Kt=(i=>(i.start="start",i.left="left",i.right="right",i.justify="justify",i))(Kt||{});const Bi={range:[.7,4],step:.05},$i={range:[100,1e3],step:100},Hi={range:[50,250],step:10};function Nu(i,e){return i==null||e==null||i<=e?i:void 0}function zu(i,e){return i==null||e==null||i>=e?i:void 0}function le(i){return typeof i=="string"?i:i===null?null:void 0}function V(i){return typeof i=="boolean"||i==null?i:void 0}function wl(i,e){if(i!==void 0)return i===null?null:e[i]!==void 0?i:void 0}function _t(i){return typeof i=="boolean"||typeof i=="number"&&i>=0?i:i===null?null:void 0}function U(i){if(i!==void 0)return i===null?null:i<0?void 0:i}function Ot(i,e){if(i===void 0)return;if(i===null)return null;const t=Math.min(...e),r=Math.max(...e);return i>=t&&i<=r?i:void 0}function vr(i,e){return i===void 0?e:i}class Zt{constructor(e={}){this.backgroundColor=le(e.backgroundColor),this.blendFilter=V(e.blendFilter),this.constraint=U(e.constraint),this.columnCount=U(e.columnCount),this.darkenFilter=_t(e.darkenFilter),this.deprecatedFontSize=V(e.deprecatedFontSize),this.fontFamily=le(e.fontFamily),this.fontSize=Ot(e.fontSize,Bi.range),this.fontSizeNormalize=V(e.fontSizeNormalize),this.fontOpticalSizing=V(e.fontOpticalSizing),this.fontWeight=Ot(e.fontWeight,$i.range),this.fontWidth=Ot(e.fontWidth,Hi.range),this.hyphens=V(e.hyphens),this.invertFilter=_t(e.invertFilter),this.invertGaijiFilter=_t(e.invertGaijiFilter),this.iOSPatch=V(e.iOSPatch),this.iPadOSPatch=V(e.iPadOSPatch),this.letterSpacing=U(e.letterSpacing),this.ligatures=V(e.ligatures),this.lineHeight=U(e.lineHeight),this.linkColor=le(e.linkColor),this.noRuby=V(e.noRuby),this.pageGutter=U(e.pageGutter),this.paragraphIndent=U(e.paragraphIndent),this.paragraphSpacing=U(e.paragraphSpacing),this.scroll=V(e.scroll),this.scrollPaddingTop=U(e.scrollPaddingTop),this.scrollPaddingBottom=U(e.scrollPaddingBottom),this.selectionBackgroundColor=le(e.selectionBackgroundColor),this.selectionTextColor=le(e.selectionTextColor),this.textAlign=wl(e.textAlign,Kt),this.textColor=le(e.textColor),this.textNormalization=V(e.textNormalization),this.visitedColor=le(e.visitedColor),this.wordSpacing=U(e.wordSpacing),this.optimalLineLength=U(e.optimalLineLength),this.maximalLineLength=U(e.maximalLineLength),this.minimalLineLength=U(e.minimalLineLength)}static serialize(e){const{...t}=e;return JSON.stringify(t)}static deserialize(e){try{const t=JSON.parse(e);return new Zt(t)}catch(t){return console.error("Failed to deserialize preferences:",t),null}}merging(e){const t={...this};for(const r of Object.keys(e))e[r]!==void 0&&(r!=="maximalLineLength"||e[r]===null||e[r]>=(e.optimalLineLength??t.optimalLineLength??65))&&(r!=="minimalLineLength"||e[r]===null||e[r]<=(e.optimalLineLength??t.optimalLineLength??65))&&(t[r]=e[r]);return new Zt(t)}}class ku{constructor(e){this.backgroundColor=le(e.backgroundColor)||null,this.blendFilter=V(e.blendFilter)??!1,this.constraint=U(e.constraint)||0,this.columnCount=U(e.columnCount)||null,this.darkenFilter=_t(e.darkenFilter)??!1,this.deprecatedFontSize=V(e.deprecatedFontSize),(this.deprecatedFontSize===!1||this.deprecatedFontSize===null)&&(this.deprecatedFontSize=!CSS.supports("zoom","1")),this.fontFamily=le(e.fontFamily)||null,this.fontSize=Ot(e.fontSize,Bi.range)||1,this.fontSizeNormalize=V(e.fontSizeNormalize)??!1,this.fontOpticalSizing=V(e.fontOpticalSizing)??null,this.fontWeight=Ot(e.fontWeight,$i.range)||null,this.fontWidth=Ot(e.fontWidth,Hi.range)||null,this.hyphens=V(e.hyphens)??null,this.invertFilter=_t(e.invertFilter)??!1,this.invertGaijiFilter=_t(e.invertGaijiFilter)??!1,this.iOSPatch=e.iOSPatch===!1?!1:(ze.OS.iOS||ze.OS.iPadOS)&&ze.iOSRequest==="mobile",this.iPadOSPatch=e.iPadOSPatch===!1?!1:ze.OS.iPadOS&&ze.iOSRequest==="desktop",this.letterSpacing=U(e.letterSpacing)||null,this.ligatures=V(e.ligatures)??null,this.lineHeight=U(e.lineHeight)||null,this.linkColor=le(e.linkColor)||null,this.noRuby=V(e.noRuby)??!1,this.pageGutter=vr(U(e.pageGutter),20),this.paragraphIndent=U(e.paragraphIndent)??null,this.paragraphSpacing=U(e.paragraphSpacing)??null,this.scroll=V(e.scroll)??!1,this.scrollPaddingTop=U(e.scrollPaddingTop)??null,this.scrollPaddingBottom=U(e.scrollPaddingBottom)??null,this.selectionBackgroundColor=le(e.selectionBackgroundColor)||null,this.selectionTextColor=le(e.selectionTextColor)||null,this.textAlign=wl(e.textAlign,Kt)||null,this.textColor=le(e.textColor)||null,this.textNormalization=V(e.textNormalization)??!1,this.visitedColor=le(e.visitedColor)||null,this.wordSpacing=U(e.wordSpacing)||null,this.optimalLineLength=U(e.optimalLineLength)||65,this.maximalLineLength=vr(zu(e.maximalLineLength,this.optimalLineLength),80),this.minimalLineLength=vr(Nu(e.minimalLineLength,this.optimalLineLength),40)}}let ne=class{constructor({initialValue:e=null,effectiveValue:t,isEffective:r,onChange:n}){this._value=e,this._effectiveValue=t,this._isEffective=r,this._onChange=n}set value(e){this._value=e,this._onChange(this._value)}get value(){return this._value}get effectiveValue(){return this._effectiveValue}get isEffective(){return this._isEffective}clear(){this._value=null}},xe=class extends ne{set value(e){this._value=e,this._onChange(this._value)}get value(){return this._value}get effectiveValue(){return this._effectiveValue}get isEffective(){return this._isEffective}clear(){this._value=null}toggle(){this._value=!this._value,this._onChange(this._value)}};class Mu extends ne{constructor({initialValue:e=null,effectiveValue:t,isEffective:r,onChange:n,supportedValues:s}){super({initialValue:e,effectiveValue:t,isEffective:r,onChange:n}),this._supportedValues=s}set value(e){if(e&&!this._supportedValues.includes(e))throw new Error(`Value '${String(e)}' is not in the supported values for this preference.`);this._value=e,this._onChange(this._value)}get value(){return this._value}get effectiveValue(){return this._effectiveValue}get isEffective(){return this._isEffective}get supportedValues(){return this._supportedValues}clear(){this._value=null}}let oe=class extends ne{constructor({initialValue:e=null,effectiveValue:t,isEffective:r,onChange:n,supportedRange:s,step:o}){super({initialValue:e,effectiveValue:t,isEffective:r,onChange:n}),this._supportedRange=s,this._step=o,this._decimals=this._step.toString().includes(".")?this._step.toString().split(".")[1].length:0}set value(e){if(e&&(e<this._supportedRange[0]||e>this._supportedRange[1]))throw new Error(`Value '${String(e)}' is out of the supported range for this preference.`);this._value=e,this._onChange(this._value)}get value(){return this._value}get effectiveValue(){return this._effectiveValue}get isEffective(){return this._isEffective}get supportedRange(){return this._supportedRange}get step(){return this._step}increment(){this._value&&this._value<this._supportedRange[1]&&(this._value=Math.min(Math.round((this._value+this._step)*10**this._decimals)/10**this._decimals,this._supportedRange[1]),this._onChange(this._value))}decrement(){this._value&&this._value>this._supportedRange[0]&&(this._value=Math.max(Math.round((this._value-this._step)*10**this._decimals)/10**this._decimals,this._supportedRange[0]),this._onChange(this._value))}format(e){return e.toString()}clear(){this._value=null}};const Du="#FFFFFF",Fu="#121212",Uu="#0000EE",Wu="#551A8B",Bu="#b4d8fe",$u="inherit",dt={RS__backgroundColor:Du,RS__textColor:Fu,RS__linkColor:Uu,RS__visitedColor:Wu,RS__selectionBackgroundColor:Bu,RS__selectionTextColor:$u};class oo{constructor(e,t,r){this.preferences=e,this.settings=t,this.metadata=r,this.layout=this.metadata?.effectiveLayout||_.reflowable}clear(){this.preferences=new Zt({optimalLineLength:65})}updatePreference(e,t){this.preferences[e]=t}get backgroundColor(){return new ne({initialValue:this.preferences.backgroundColor,effectiveValue:this.settings.backgroundColor||dt.RS__backgroundColor,isEffective:this.preferences.backgroundColor!==null,onChange:e=>{this.updatePreference("backgroundColor",e||null)}})}get blendFilter(){return new xe({initialValue:this.preferences.blendFilter,effectiveValue:this.settings.blendFilter||!1,isEffective:this.preferences.blendFilter!==null,onChange:e=>{this.updatePreference("blendFilter",e||null)}})}get columnCount(){return new ne({initialValue:this.preferences.columnCount,effectiveValue:this.settings.columnCount||null,isEffective:this.layout!==_.fixed&&!this.settings.scroll,onChange:e=>{this.updatePreference("columnCount",e||null)}})}get constraint(){return new ne({initialValue:this.preferences.constraint,effectiveValue:this.preferences.constraint||0,isEffective:!0,onChange:e=>{this.updatePreference("constraint",e||null)}})}get darkenFilter(){return new oe({initialValue:typeof this.preferences.darkenFilter=="boolean"?100:this.preferences.darkenFilter,effectiveValue:typeof this.settings.darkenFilter=="boolean"?100:this.settings.darkenFilter||0,isEffective:this.settings.darkenFilter!==null,onChange:e=>{this.updatePreference("darkenFilter",e||null)},supportedRange:[0,100],step:1})}get deprecatedFontSize(){return new xe({initialValue:this.preferences.deprecatedFontSize,effectiveValue:CSS.supports("zoom","1")?this.settings.deprecatedFontSize||!1:!0,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("deprecatedFontSize",e||null)}})}get fontFamily(){return new ne({initialValue:this.preferences.fontFamily,effectiveValue:this.settings.fontFamily||null,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("fontFamily",e||null)}})}get fontSize(){return new oe({initialValue:this.preferences.fontSize,effectiveValue:this.settings.fontSize||1,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("fontSize",e||null)},supportedRange:Bi.range,step:Bi.step})}get fontSizeNormalize(){return new xe({initialValue:this.preferences.fontSizeNormalize,effectiveValue:this.settings.fontSizeNormalize||!1,isEffective:this.layout!==_.fixed&&this.preferences.fontSizeNormalize!==null,onChange:e=>{this.updatePreference("fontSizeNormalize",e||null)}})}get fontOpticalSizing(){return new xe({initialValue:this.preferences.fontOpticalSizing,effectiveValue:this.settings.fontOpticalSizing||!0,isEffective:this.layout!==_.fixed&&this.preferences.fontOpticalSizing!==null,onChange:e=>{this.updatePreference("fontOpticalSizing",e||null)}})}get fontWeight(){return new oe({initialValue:this.preferences.fontWeight,effectiveValue:this.settings.fontWeight||400,isEffective:this.layout!==_.fixed&&this.preferences.fontWeight!==null,onChange:e=>{this.updatePreference("fontWeight",e||null)},supportedRange:$i.range,step:$i.step})}get fontWidth(){return new oe({initialValue:this.preferences.fontWidth,effectiveValue:this.settings.fontWidth||100,isEffective:this.layout!==_.fixed&&this.preferences.fontWidth!==null,onChange:e=>{this.updatePreference("fontWidth",e||null)},supportedRange:Hi.range,step:Hi.step})}get hyphens(){return new xe({initialValue:this.preferences.hyphens,effectiveValue:this.settings.hyphens||!1,isEffective:this.layout!==_.fixed&&this.metadata?.effectiveReadingProgression===te.ltr&&this.preferences.hyphens!==null,onChange:e=>{this.updatePreference("hyphens",e||null)}})}get invertFilter(){return new oe({initialValue:typeof this.preferences.invertFilter=="boolean"?100:this.preferences.invertFilter,effectiveValue:typeof this.settings.invertFilter=="boolean"?100:this.settings.invertFilter||0,isEffective:this.settings.invertFilter!==null,onChange:e=>{this.updatePreference("invertFilter",e||null)},supportedRange:[0,100],step:1})}get invertGaijiFilter(){return new oe({initialValue:typeof this.preferences.invertGaijiFilter=="boolean"?100:this.preferences.invertGaijiFilter,effectiveValue:typeof this.settings.invertGaijiFilter=="boolean"?100:this.settings.invertGaijiFilter||0,isEffective:this.preferences.invertGaijiFilter!==null,onChange:e=>{this.updatePreference("invertGaijiFilter",e||null)},supportedRange:[0,100],step:1})}get iOSPatch(){return new xe({initialValue:this.preferences.iOSPatch,effectiveValue:this.settings.iOSPatch||!1,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("iOSPatch",e||null)}})}get iPadOSPatch(){return new xe({initialValue:this.preferences.iPadOSPatch,effectiveValue:this.settings.iPadOSPatch||!1,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("iPadOSPatch",e||null)}})}get letterSpacing(){return new oe({initialValue:this.preferences.letterSpacing,effectiveValue:this.settings.letterSpacing||0,isEffective:this.layout!==_.fixed&&this.preferences.letterSpacing!==null,onChange:e=>{this.updatePreference("letterSpacing",e||null)},supportedRange:[0,1],step:.125})}get ligatures(){return new xe({initialValue:this.preferences.ligatures,effectiveValue:this.settings.ligatures||!0,isEffective:this.layout!==_.fixed&&this.metadata?.languages?.some(e=>e==="ar"||e==="fa")&&this.preferences.ligatures!==null||!1,onChange:e=>{this.updatePreference("ligatures",e||null)}})}get lineHeight(){return new oe({initialValue:this.preferences.lineHeight,effectiveValue:this.settings.lineHeight,isEffective:this.layout!==_.fixed&&this.preferences.lineHeight!==null,onChange:e=>{this.updatePreference("lineHeight",e||null)},supportedRange:[1,2],step:.1})}get linkColor(){return new ne({initialValue:this.preferences.linkColor,effectiveValue:this.settings.linkColor||dt.RS__linkColor,isEffective:this.layout!==_.fixed&&this.preferences.linkColor!==null,onChange:e=>{this.updatePreference("linkColor",e||null)}})}get maximalLineLength(){return new oe({initialValue:this.preferences.maximalLineLength,effectiveValue:this.settings.maximalLineLength,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("maximalLineLength",e)},supportedRange:[20,100],step:1})}get minimalLineLength(){return new oe({initialValue:this.preferences.minimalLineLength,effectiveValue:this.settings.minimalLineLength,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("minimalLineLength",e)},supportedRange:[20,100],step:1})}get noRuby(){return new xe({initialValue:this.preferences.noRuby,effectiveValue:this.settings.noRuby||!1,isEffective:this.layout!==_.fixed&&this.metadata?.languages?.includes("ja")||!1,onChange:e=>{this.updatePreference("noRuby",e||null)}})}get optimalLineLength(){return new oe({initialValue:this.preferences.optimalLineLength,effectiveValue:this.settings.optimalLineLength,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("optimalLineLength",e)},supportedRange:[20,100],step:1})}get pageGutter(){return new ne({initialValue:this.preferences.pageGutter,effectiveValue:this.settings.pageGutter,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("pageGutter",e||null)}})}get paragraphIndent(){return new oe({initialValue:this.preferences.paragraphIndent,effectiveValue:this.settings.paragraphIndent||0,isEffective:this.layout!==_.fixed&&this.preferences.paragraphIndent!==null,onChange:e=>{this.updatePreference("paragraphIndent",e||null)},supportedRange:[0,3],step:.25})}get paragraphSpacing(){return new oe({initialValue:this.preferences.paragraphSpacing,effectiveValue:this.settings.paragraphSpacing||0,isEffective:this.layout!==_.fixed&&this.preferences.paragraphSpacing!==null,onChange:e=>{this.updatePreference("paragraphSpacing",e||null)},supportedRange:[0,3],step:.25})}get scroll(){return new xe({initialValue:this.preferences.scroll,effectiveValue:this.settings.scroll||!1,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("scroll",e||null)}})}get scrollPaddingTop(){return new ne({initialValue:this.preferences.scrollPaddingTop,effectiveValue:this.settings.scrollPaddingTop||0,isEffective:this.layout!==_.fixed&&!!this.settings.scroll&&this.preferences.scrollPaddingTop!==null,onChange:e=>{this.updatePreference("scrollPaddingTop",e||null)}})}get scrollPaddingBottom(){return new ne({initialValue:this.preferences.scrollPaddingBottom,effectiveValue:this.settings.scrollPaddingBottom||0,isEffective:this.layout!==_.fixed&&!!this.settings.scroll&&this.preferences.scrollPaddingBottom!==null,onChange:e=>{this.updatePreference("scrollPaddingBottom",e||null)}})}get selectionBackgroundColor(){return new ne({initialValue:this.preferences.selectionBackgroundColor,effectiveValue:this.settings.selectionBackgroundColor||dt.RS__selectionBackgroundColor,isEffective:this.layout!==_.fixed&&this.preferences.selectionBackgroundColor!==null,onChange:e=>{this.updatePreference("selectionBackgroundColor",e||null)}})}get selectionTextColor(){return new ne({initialValue:this.preferences.selectionTextColor,effectiveValue:this.settings.selectionTextColor||dt.RS__selectionTextColor,isEffective:this.layout!==_.fixed&&this.preferences.selectionTextColor!==null,onChange:e=>{this.updatePreference("selectionTextColor",e||null)}})}get textAlign(){return new Mu({initialValue:this.preferences.textAlign,effectiveValue:this.settings.textAlign||Kt.start,isEffective:this.layout!==_.fixed&&this.preferences.textAlign!==null,onChange:e=>{this.updatePreference("textAlign",e||null)},supportedValues:Object.values(Kt)})}get textColor(){return new ne({initialValue:this.preferences.textColor,effectiveValue:this.settings.textColor||dt.RS__textColor,isEffective:this.layout!==_.fixed&&this.preferences.textColor!==null,onChange:e=>{this.updatePreference("textColor",e||null)}})}get textNormalization(){return new xe({initialValue:this.preferences.textNormalization,effectiveValue:this.settings.textNormalization||!1,isEffective:this.layout!==_.fixed,onChange:e=>{this.updatePreference("textNormalization",e||null)}})}get visitedColor(){return new ne({initialValue:this.preferences.visitedColor,effectiveValue:this.settings.visitedColor||dt.RS__visitedColor,isEffective:this.layout!==_.fixed&&this.preferences.visitedColor!==null,onChange:e=>{this.updatePreference("visitedColor",e||null)}})}get wordSpacing(){return new oe({initialValue:this.preferences.wordSpacing,effectiveValue:this.settings.wordSpacing||0,isEffective:this.layout!==_.fixed&&this.preferences.wordSpacing!==null,onChange:e=>{this.updatePreference("wordSpacing",e||null)},supportedRange:[0,2],step:.125})}}class ao{constructor(e,t){this.backgroundColor=e.backgroundColor||t.backgroundColor||null,this.blendFilter=typeof e.blendFilter=="boolean"?e.blendFilter:t.blendFilter??null,this.columnCount=e.columnCount!==void 0?e.columnCount:t.columnCount!==void 0?t.columnCount:null,this.constraint=e.constraint||t.constraint,this.darkenFilter=typeof e.darkenFilter=="boolean"?e.darkenFilter:t.darkenFilter??null,this.deprecatedFontSize=typeof e.deprecatedFontSize=="boolean"?e.deprecatedFontSize:t.deprecatedFontSize??null,this.fontFamily=e.fontFamily||t.fontFamily||null,this.fontSize=e.fontSize!==void 0?e.fontSize:t.fontSize!==void 0?t.fontSize:null,this.fontSizeNormalize=typeof e.fontSizeNormalize=="boolean"?e.fontSizeNormalize:t.fontSizeNormalize??null,this.fontOpticalSizing=typeof e.fontOpticalSizing=="boolean"?e.fontOpticalSizing:t.fontOpticalSizing??null,this.fontWeight=e.fontWeight!==void 0?e.fontWeight:t.fontWeight!==void 0?t.fontWeight:null,this.fontWidth=e.fontWidth!==void 0?e.fontWidth:t.fontWidth!==void 0?t.fontWidth:null,this.hyphens=typeof e.hyphens=="boolean"?e.hyphens:t.hyphens??null,this.invertFilter=typeof e.invertFilter=="boolean"?e.invertFilter:t.invertFilter??null,this.invertGaijiFilter=typeof e.invertGaijiFilter=="boolean"?e.invertGaijiFilter:t.invertGaijiFilter??null,this.iOSPatch=this.deprecatedFontSize||e.iOSPatch===!1?!1:e.iOSPatch===!0?(ze.OS.iOS||ze.OS.iPadOS)&&ze.iOSRequest==="mobile":t.iOSPatch,this.iPadOSPatch=this.deprecatedFontSize||e.iPadOSPatch===!1?!1:e.iPadOSPatch===!0?ze.OS.iPadOS&&ze.iOSRequest==="desktop":t.iPadOSPatch,this.letterSpacing=e.letterSpacing!==void 0?e.letterSpacing:t.letterSpacing!==void 0?t.letterSpacing:null,this.ligatures=typeof e.ligatures=="boolean"?e.ligatures:t.ligatures??null,this.lineHeight=e.lineHeight!==void 0?e.lineHeight:t.lineHeight!==void 0?t.lineHeight:null,this.linkColor=e.linkColor||t.linkColor||null,this.maximalLineLength=e.maximalLineLength===null?null:e.maximalLineLength||t.maximalLineLength||null,this.minimalLineLength=e.minimalLineLength===null?null:e.minimalLineLength||t.minimalLineLength||null,this.noRuby=typeof e.noRuby=="boolean"?e.noRuby:t.noRuby??null,this.optimalLineLength=e.optimalLineLength||t.optimalLineLength,this.pageGutter=e.pageGutter!==void 0?e.pageGutter:t.pageGutter!==void 0?t.pageGutter:null,this.paragraphIndent=e.paragraphIndent!==void 0?e.paragraphIndent:t.paragraphIndent!==void 0?t.paragraphIndent:null,this.paragraphSpacing=e.paragraphSpacing!==void 0?e.paragraphSpacing:t.paragraphSpacing!==void 0?t.paragraphSpacing:null,this.scroll=typeof e.scroll=="boolean"?e.scroll:t.scroll??null,this.scrollPaddingTop=e.scrollPaddingTop!==void 0?e.scrollPaddingTop:t.scrollPaddingTop!==void 0?t.scrollPaddingTop:null,this.scrollPaddingBottom=e.scrollPaddingBottom!==void 0?e.scrollPaddingBottom:t.scrollPaddingBottom!==void 0?t.scrollPaddingBottom:null,this.selectionBackgroundColor=e.selectionBackgroundColor||t.selectionBackgroundColor||null,this.selectionTextColor=e.selectionTextColor||t.selectionTextColor||null,this.textAlign=e.textAlign||t.textAlign||null,this.textColor=e.textColor||t.textColor||null,this.textNormalization=typeof e.textNormalization=="boolean"?e.textNormalization:t.textNormalization??null,this.visitedColor=e.visitedColor||t.visitedColor||null,this.wordSpacing=e.wordSpacing!==void 0?e.wordSpacing:t.wordSpacing!==void 0?t.wordSpacing:null}}function Ii(i){const e=getComputedStyle(i),t=parseFloat(e.paddingLeft||"0"),r=parseFloat(e.paddingRight||"0");return i.clientWidth-t-r}class Sl{constructor(){}toFlag(e){return`readium-${e}-on`}toUnitless(e){return e.toString()}toPercentage(e,t=!1){return t||e>0&&e<=1?`${Math.round(e*100)}%`:`${e}%`}toVw(e){const t=Math.round(e*100);return`${Math.min(t,100)}vw`}toVh(e){const t=Math.round(e*100);return`${Math.min(t,100)}vh`}toPx(e){return`${e}px`}toRem(e){return`${e}rem`}}class El extends Sl{constructor(e){super(),this.a11yNormalize=e.a11yNormalize??null,this.backgroundColor=e.backgroundColor??null,this.blendFilter=e.blendFilter??null,this.bodyHyphens=e.bodyHyphens??null,this.colCount=e.colCount??null,this.darkenFilter=e.darkenFilter??null,this.deprecatedFontSize=e.deprecatedFontSize??null,this.fontFamily=e.fontFamily??null,this.fontOpticalSizing=e.fontOpticalSizing??null,this.fontSize=e.fontSize??null,this.fontSizeNormalize=e.fontSizeNormalize??null,this.fontWeight=e.fontWeight??null,this.fontWidth=e.fontWidth??null,this.invertFilter=e.invertFilter??null,this.invertGaijiFilter=e.invertGaijiFilter??null,this.iOSPatch=e.iOSPatch??null,this.iPadOSPatch=e.iPadOSPatch??null,this.letterSpacing=e.letterSpacing??null,this.ligatures=e.ligatures??null,this.lineHeight=e.lineHeight??null,this.lineLength=e.lineLength??null,this.linkColor=e.linkColor??null,this.noRuby=e.noRuby??null,this.paraIndent=e.paraIndent??null,this.paraSpacing=e.paraSpacing??null,this.selectionBackgroundColor=e.selectionBackgroundColor??null,this.selectionTextColor=e.selectionTextColor??null,this.textAlign=e.textAlign??null,this.textColor=e.textColor??null,this.view=e.view??null,this.visitedColor=e.visitedColor??null,this.wordSpacing=e.wordSpacing??null}toCSSProperties(){const e={};return this.a11yNormalize&&(e["--USER__a11yNormalize"]=this.toFlag("a11y")),this.backgroundColor&&(e["--USER__backgroundColor"]=this.backgroundColor),this.blendFilter&&(e["--USER__blendFilter"]=this.toFlag("blend")),this.bodyHyphens&&(e["--USER__bodyHyphens"]=this.bodyHyphens),this.colCount&&(e["--USER__colCount"]=this.toUnitless(this.colCount)),this.darkenFilter===!0?e["--USER__darkenFilter"]=this.toFlag("darken"):typeof this.darkenFilter=="number"&&(e["--USER__darkenFilter"]=this.toPercentage(this.darkenFilter)),this.deprecatedFontSize&&(e["--USER__fontSizeImplementation"]=this.toFlag("deprecatedFontSize")),this.fontFamily&&(e["--USER__fontFamily"]=this.fontFamily),this.fontOpticalSizing!=null&&(e["--USER__fontOpticalSizing"]=this.fontOpticalSizing),this.fontSize!=null&&(e["--USER__fontSize"]=this.toPercentage(this.fontSize,!0)),this.fontSizeNormalize&&(e["--USER__fontSizeNormalize"]=this.toFlag("normalize")),this.fontWeight!=null&&(e["--USER__fontWeight"]=this.toUnitless(this.fontWeight)),this.fontWidth!=null&&(e["--USER__fontWidth"]=typeof this.fontWidth=="string"?this.fontWidth:this.toUnitless(this.fontWidth)),this.invertFilter===!0?e["--USER__invertFilter"]=this.toFlag("invert"):typeof this.invertFilter=="number"&&(e["--USER__invertFilter"]=this.toPercentage(this.invertFilter)),this.invertGaijiFilter===!0?e["--USER__invertGaiji"]=this.toFlag("invertGaiji"):typeof this.invertGaijiFilter=="number"&&(e["--USER__invertGaiji"]=this.toPercentage(this.invertGaijiFilter)),this.iOSPatch&&(e["--USER__iOSPatch"]=this.toFlag("iOSPatch")),this.iPadOSPatch&&(e["--USER__iPadOSPatch"]=this.toFlag("iPadOSPatch")),this.letterSpacing!=null&&(e["--USER__letterSpacing"]=this.toRem(this.letterSpacing)),this.ligatures&&(e["--USER__ligatures"]=this.ligatures),this.lineHeight!=null&&(e["--USER__lineHeight"]=this.toUnitless(this.lineHeight)),this.lineLength!=null&&(e["--USER__lineLength"]=this.toPx(this.lineLength)),this.linkColor&&(e["--USER__linkColor"]=this.linkColor),this.noRuby&&(e["--USER__noRuby"]=this.toFlag("noRuby")),this.paraIndent!=null&&(e["--USER__paraIndent"]=this.toRem(this.paraIndent)),this.paraSpacing!=null&&(e["--USER__paraSpacing"]=this.toRem(this.paraSpacing)),this.selectionBackgroundColor&&(e["--USER__selectionBackgroundColor"]=this.selectionBackgroundColor),this.selectionTextColor&&(e["--USER__selectionTextColor"]=this.selectionTextColor),this.textAlign&&(e["--USER__textAlign"]=this.textAlign),this.textColor&&(e["--USER__textColor"]=this.textColor),this.view&&(e["--USER__view"]=this.toFlag(this.view)),this.visitedColor&&(e["--USER__visitedColor"]=this.visitedColor),this.wordSpacing!=null&&(e["--USER__wordSpacing"]=this.toRem(this.wordSpacing)),e}}class Hu extends Sl{constructor(e){super(),this.backgroundColor=e.backgroundColor??null,this.baseFontFamily=e.baseFontFamily??null,this.baseFontSize=e.baseFontSize??null,this.baseLineHeight=e.baseLineHeight??null,this.boxSizingMedia=e.boxSizingMedia??null,this.boxSizingTable=e.boxSizingTable??null,this.colWidth=e.colWidth??null,this.colCount=e.colCount??null,this.colGap=e.colGap??null,this.codeFontFamily=e.codeFontFamily??null,this.compFontFamily=e.compFontFamily??null,this.defaultLineLength=e.defaultLineLength??null,this.flowSpacing=e.flowSpacing??null,this.humanistTf=e.humanistTf??null,this.linkColor=e.linkColor??null,this.maxMediaWidth=e.maxMediaWidth??null,this.maxMediaHeight=e.maxMediaHeight??null,this.modernTf=e.modernTf??null,this.monospaceTf=e.monospaceTf??null,this.noOverflow=e.noOverflow??null,this.noVerticalPagination=e.noVerticalPagination??null,this.oldStyleTf=e.oldStyleTf??null,this.pageGutter=e.pageGutter??null,this.paraIndent=e.paraIndent??null,this.paraSpacing=e.paraSpacing??null,this.primaryColor=e.primaryColor??null,this.scrollPaddingBottom=e.scrollPaddingBottom??null,this.scrollPaddingTop=e.scrollPaddingTop??null,this.sansSerifJa=e.sansSerifJa??null,this.sansSerifJaV=e.sansSerifJaV??null,this.sansTf=e.sansTf??null,this.secondaryColor=e.secondaryColor??null,this.selectionBackgroundColor=e.selectionBackgroundColor??null,this.selectionTextColor=e.selectionTextColor??null,this.serifJa=e.serifJa??null,this.serifJaV=e.serifJaV??null,this.textColor=e.textColor??null,this.typeScale=e.typeScale??null,this.visitedColor=e.visitedColor??null}toCSSProperties(){const e={};return this.backgroundColor&&(e["--RS__backgroundColor"]=this.backgroundColor),this.baseFontFamily&&(e["--RS__baseFontFamily"]=this.baseFontFamily),this.baseFontSize!=null&&(e["--RS__baseFontSize"]=this.toRem(this.baseFontSize)),this.baseLineHeight!=null&&(e["--RS__baseLineHeight"]=this.toUnitless(this.baseLineHeight)),this.boxSizingMedia&&(e["--RS__boxSizingMedia"]=this.boxSizingMedia),this.boxSizingTable&&(e["--RS__boxSizingTable"]=this.boxSizingTable),this.colWidth!=null&&(e["--RS__colWidth"]=this.colWidth),this.colCount!=null&&(e["--RS__colCount"]=this.toUnitless(this.colCount)),this.colGap!=null&&(e["--RS__colGap"]=this.toPx(this.colGap)),this.codeFontFamily&&(e["--RS__codeFontFamily"]=this.codeFontFamily),this.compFontFamily&&(e["--RS__compFontFamily"]=this.compFontFamily),this.defaultLineLength!=null&&(e["--RS__defaultLineLength"]=this.toPx(this.defaultLineLength)),this.flowSpacing!=null&&(e["--RS__flowSpacing"]=this.toRem(this.flowSpacing)),this.humanistTf&&(e["--RS__humanistTf"]=this.humanistTf),this.linkColor&&(e["--RS__linkColor"]=this.linkColor),this.maxMediaWidth&&(e["--RS__maxMediaWidth"]=this.toVw(this.maxMediaWidth)),this.maxMediaHeight&&(e["--RS__maxMediaHeight"]=this.toVh(this.maxMediaHeight)),this.modernTf&&(e["--RS__modernTf"]=this.modernTf),this.monospaceTf&&(e["--RS__monospaceTf"]=this.monospaceTf),this.noOverflow&&(e["--RS__disableOverflow"]=this.toFlag("noOverflow")),this.noVerticalPagination&&(e["--RS__disablePagination"]=this.toFlag("noVerticalPagination")),this.oldStyleTf&&(e["--RS__oldStyleTf"]=this.oldStyleTf),this.pageGutter!=null&&(e["--RS__pageGutter"]=this.toPx(this.pageGutter)),this.paraIndent!=null&&(e["--RS__paraIndent"]=this.toRem(this.paraIndent)),this.paraSpacing!=null&&(e["--RS__paraSpacing"]=this.toRem(this.paraSpacing)),this.primaryColor&&(e["--RS__primaryColor"]=this.primaryColor),this.sansSerifJa&&(e["--RS__sans-serif-ja"]=this.sansSerifJa),this.sansSerifJaV&&(e["--RS__sans-serif-ja-v"]=this.sansSerifJaV),this.sansTf&&(e["--RS__sansTf"]=this.sansTf),this.scrollPaddingBottom!=null&&(e["--RS__scrollPaddingBottom"]=this.toPx(this.scrollPaddingBottom)),this.scrollPaddingTop!=null&&(e["--RS__scrollPaddingTop"]=this.toPx(this.scrollPaddingTop)),this.secondaryColor&&(e["--RS__secondaryColor"]=this.secondaryColor),this.selectionBackgroundColor&&(e["--RS__selectionBackgroundColor"]=this.selectionBackgroundColor),this.selectionTextColor&&(e["--RS__selectionTextColor"]=this.selectionTextColor),this.serifJa&&(e["--RS__serif-ja"]=this.serifJa),this.serifJaV&&(e["--RS__serif-ja-v"]=this.serifJaV),this.textColor&&(e["--RS__textColor"]=this.textColor),this.typeScale&&(e["--RS__typeScale"]=this.toUnitless(this.typeScale)),this.visitedColor&&(e["--RS__visitedColor"]=this.visitedColor),e}}class ju{constructor(e){this.rsProperties=e.rsProperties,this.userProperties=e.userProperties,this.lineLengths=e.lineLengths,this.container=e.container,this.containerParent=e.container.parentElement||document.documentElement,this.constraint=e.constraint,this.cachedColCount=e.userProperties.colCount,this.effectiveContainerWidth=Ii(this.containerParent)}update(e){this.cachedColCount=e.columnCount,e.constraint!==this.constraint&&(this.constraint=e.constraint),e.pageGutter!==this.rsProperties.pageGutter&&(this.rsProperties.pageGutter=e.pageGutter),e.scrollPaddingBottom!==this.rsProperties.scrollPaddingBottom&&(this.rsProperties.scrollPaddingBottom=e.scrollPaddingBottom),e.scrollPaddingTop!==this.rsProperties.scrollPaddingTop&&(this.rsProperties.scrollPaddingTop=e.scrollPaddingTop),this.lineLengths.update({fontFace:e.fontFamily,letterSpacing:e.letterSpacing,pageGutter:e.pageGutter,wordSpacing:e.wordSpacing,optimalChars:e.optimalLineLength,minChars:e.minimalLineLength,maxChars:e.maximalLineLength});const t=this.updateLayout(e.fontSize,e.deprecatedFontSize||e.iOSPatch,e.scroll,e.columnCount);t?.effectiveContainerWidth&&(this.effectiveContainerWidth=t?.effectiveContainerWidth);const r={a11yNormalize:e.textNormalization,backgroundColor:e.backgroundColor,blendFilter:e.blendFilter,bodyHyphens:typeof e.hyphens!="boolean"?null:e.hyphens?"auto":"none",colCount:t?.colCount,darkenFilter:e.darkenFilter,deprecatedFontSize:e.deprecatedFontSize,fontFamily:e.fontFamily,fontOpticalSizing:typeof e.fontOpticalSizing!="boolean"?null:e.fontOpticalSizing?"auto":"none",fontSize:e.fontSize,fontSizeNormalize:e.fontSizeNormalize,fontWeight:e.fontWeight,fontWidth:e.fontWidth,invertFilter:e.invertFilter,invertGaijiFilter:e.invertGaijiFilter,iOSPatch:e.iOSPatch,iPadOSPatch:e.iPadOSPatch,letterSpacing:e.letterSpacing,ligatures:typeof e.ligatures!="boolean"?null:e.ligatures?"common-ligatures":"none",lineHeight:e.lineHeight,lineLength:t?.effectiveLineLength,linkColor:e.linkColor,noRuby:e.noRuby,paraIndent:e.paragraphIndent,paraSpacing:e.paragraphSpacing,selectionBackgroundColor:e.selectionBackgroundColor,selectionTextColor:e.selectionTextColor,textAlign:e.textAlign,textColor:e.textColor,view:typeof e.scroll!="boolean"?null:e.scroll?"scroll":"paged",visitedColor:e.visitedColor,wordSpacing:e.wordSpacing};this.userProperties=new El(r)}updateLayout(e,t,r,n){return r??this.userProperties.view==="scroll"?this.computeScrollLength(e,t):this.paginate(e,t,n)}getCompensatedMetrics(e,t){const r=e||this.userProperties.fontSize||1,n=r<1?1/r:t?r:1;return{zoomFactor:r,zoomCompensation:n,optimal:Math.round(this.lineLengths.optimalLineLength)*r,minimal:this.lineLengths.minimalLineLength!==null?Math.round(this.lineLengths.minimalLineLength*r):null,maximal:this.lineLengths.maximalLineLength!==null?Math.round(this.lineLengths.maximalLineLength*r):null}}paginate(e,t,r){const n=Math.round(Ii(this.containerParent)-this.constraint),s=this.getCompensatedMetrics(e,t),{zoomCompensation:o,optimal:a,minimal:h,maximal:l}=s,u=()=>n>=a&&l!==null?Math.min(Math.round(l*o),n):n;let c=1,f=n;if(r===void 0)return{colCount:void 0,effectiveContainerWidth:f,effectiveLineLength:Math.round(f/c*o)};if(r===null)if(n>=a&&l!==null){c=Math.floor(n/a);const g=Math.round(c*(l*o));f=Math.min(g,n)}else f=u();else if(r>1){const g=Math.round(r*(h!==null?h:a));if(n>=g)if(c=r,l===null)f=n;else{const d=Math.round(c*(l*o));f=Math.min(d,n)}else if(h!==null&&n<Math.round(r*h))if(c=Math.floor(n/h),c<=1)c=1,f=u();else{const d=Math.round(c*(a*o));f=Math.min(d,n)}else{c=r;const d=Math.round(c*(a*o));f=Math.min(d,n)}}else c=1,f=u();return{colCount:c,effectiveContainerWidth:f,effectiveLineLength:Math.round(f/c/(e&&e>=1?e:1)*o)}}computeScrollLength(e,t){const r=Math.round(Ii(this.containerParent)-this.constraint),n=this.getCompensatedMetrics(e&&(e<1||t)?e:1,t),s=n.zoomCompensation,o=n.optimal,a=n.maximal;let h,l=r,u=Math.round(o*s);if(a===null)u=r;else{const c=Math.min(Math.round(a*s),r);u=t?c:Math.round(c*s)}return{colCount:h,effectiveContainerWidth:l,effectiveLineLength:u}}setContainerWidth(){this.container.style.width=`${this.effectiveContainerWidth}px`}resizeHandler(){const e=this.updateLayout(this.userProperties.fontSize,this.userProperties.deprecatedFontSize||this.userProperties.iOSPatch,this.userProperties.view==="scroll",this.cachedColCount);this.userProperties.colCount=e.colCount,this.userProperties.lineLength=e.effectiveLineLength,this.effectiveContainerWidth=e.effectiveContainerWidth,this.container.style.width=`${this.effectiveContainerWidth}px`}}const qu=i=>({frameLoaded:i.frameLoaded||(()=>{}),positionChanged:i.positionChanged||(()=>{}),tap:i.tap||(()=>!1),click:i.click||(()=>!1),zoom:i.zoom||(()=>{}),miscPointer:i.miscPointer||(()=>{}),scroll:i.scroll||(()=>{}),customEvent:i.customEvent||(()=>{}),handleLocator:i.handleLocator||(()=>!1),textSelected:i.textSelected||(()=>{})});class kn extends gc{constructor(e,t,r,n=[],s=void 0,o={preferences:{},defaults:{}}){super(),this._preferencesEditor=null,this.reflowViewport={readingOrder:[],progressions:new Map,positions:null},this.pub=t,this.container=e,this.listeners=qu(r),this.currentLocation=s,n.length&&(this.positions=n),this._preferences=new Zt(o.preferences),this._defaults=new ku(o.defaults),this._settings=new ao(this._preferences,this._defaults),this._css=new ju({rsProperties:new Hu({}),userProperties:new El({}),lineLengths:new uu({optimalChars:this._settings.optimalLineLength,minChars:this._settings.minimalLineLength,maxChars:this._settings.maximalLineLength,pageGutter:this._settings.pageGutter,fontFace:this._settings.fontFamily,letterSpacing:this._settings.letterSpacing,wordSpacing:this._settings.wordSpacing}),container:e,constraint:this._settings.constraint}),this._layout=kn.determineLayout(t,!!this._settings.scroll),this.currentProgression=t.metadata.effectiveReadingProgression,this.resizeObserver=new ResizeObserver(()=>this.ownerWindow.requestAnimationFrame(async()=>await this.resizeHandler())),this.resizeObserver.observe(this.container.parentElement||document.documentElement)}static determineLayout(e,t){const r=e.metadata.effectiveLayout;return r===_.fixed||e.metadata.otherMetadata&&"http://openmangaformat.org/schema/1.0#version"in e.metadata.otherMetadata||e.metadata?.conformsTo?.includes(Ia.DIVINA)?_.fixed:r===_.scrolled||r===_.reflowable&&t?_.scrolled:_.reflowable}async load(){if(this.positions?.length||(this.positions=await this.pub.positionsFromManifest()),this._layout===_.fixed)this.framePool=new Iu(this.container,this.positions,this.pub),this.framePool.listener=(e,t)=>{this.eventListener(e,t)};else{await this.updateCSS(!1);const e=this.compileCSSProperties(this._css);this.framePool=new Su(this.container,this.positions,e)}this.currentLocation===void 0&&(this.currentLocation=this.positions[0]),await this.resizeHandler(),await this.apply()}get settings(){if(this._layout===_.fixed)return Object.freeze({...this._settings});{const e=this._css.userProperties.colCount||this._css.rsProperties.colCount||this._settings.columnCount;return Object.freeze({...this._settings,columnCount:e})}}get preferencesEditor(){return this._preferencesEditor===null&&(this._preferencesEditor=new oo(this._preferences,this.settings,this.pub.metadata)),this._preferencesEditor}async submitPreferences(e){this._preferences=this._preferences.merging(e),await this.applyPreferences()}async applyPreferences(){const e=this._settings;this._settings=new ao(this._preferences,this._defaults),this._preferencesEditor!==null&&(this._preferencesEditor=new oo(this._preferences,this.settings,this.pub.metadata)),this._layout===_.fixed?this.handleFXLPrefs(e,this._settings):await this.updateCSS(!0)}handleFXLPrefs(e,t){e.columnCount!==t.columnCount&&this.framePool.setPerPage(t.columnCount)}async updateCSS(e){this._css.update(this._settings),e&&await this.commitCSS(this._css)}compileCSSProperties(e){const t={};for(const[r,n]of Object.entries(e.rsProperties.toCSSProperties()))t[r]=n;for(const[r,n]of Object.entries(e.userProperties.toCSSProperties()))t[r]=n;return t}async commitCSS(e){const t=this.compileCSSProperties(e);this.framePool.setCSSProperties(t),this._css.userProperties.view==="paged"&&this._layout===_.scrolled?await this.setLayout(_.reflowable):this._css.userProperties.view==="scroll"&&this._layout===_.reflowable&&await this.setLayout(_.scrolled),this._css.setContainerWidth()}async resizeHandler(){const e=this.container.parentElement||document.documentElement;if(this._layout===_.fixed)this.container.style.width=`${Ii(e)-this._settings.constraint}px`,this.framePool.resizeHandler();else{const t=this._css.userProperties.colCount,r=this._css.userProperties.lineLength;this._css.resizeHandler(),(this._css.userProperties.view!=="scroll"&&t!==this._css.userProperties.colCount||r!==this._css.userProperties.lineLength)&&await this.commitCSS(this._css)}}get layout(){return this._layout}get ownerWindow(){return this.container.ownerDocument.defaultView||window}get _cframes(){return this.framePool.currentFrames}get pool(){return this.framePool}eventListener(e,t){switch(e){case"_pong":this.listeners.frameLoaded(this._cframes[0].iframe.contentWindow),this.listeners.positionChanged(this.currentLocation);break;case"first_visible_locator":const r=jr.deserialize(t);if(!r)break;this.currentLocation=new jr({href:this.currentLocation.href,type:this.currentLocation.type,title:this.currentLocation.title,locations:r?.locations,text:r?.text}),this.listeners.positionChanged(this.currentLocation);break;case"text_selected":this.listeners.textSelected(t);break;case"click":case"tap":const n=t;if(n.interactiveElement){const s=new DOMParser().parseFromString(n.interactiveElement,"text/html").body.children[0];if(s.nodeType===s.ELEMENT_NODE&&s.nodeName==="A"&&s.hasAttribute("href")){const o=s.attributes.getNamedItem("href")?.value;if(o.startsWith("#"))this.go(this.currentLocation.copyWithLocations({fragments:[o.substring(1)]}),!1,()=>{});else if(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("mailto:")||o.startsWith("tel:"))this.listeners.handleLocator(new Yt({href:o}).locator);else try{this.goLink(new Yt({href:Qs.join(Qs.dirname(this.currentLocation.href),o)}),!1,()=>{})}catch(a){console.warn(`Couldn't go to link for ${o}: ${a}`),this.listeners.handleLocator(new Yt({href:o}).locator)}}else console.log("Clicked on",s)}else{if(this._layout===_.fixed&&this.framePool.doNotDisturb&&(n.doNotDisturb=!0),this._layout===_.fixed&&(this.currentProgression===te.rtl||this.currentProgression===te.ltr)&&this.framePool.currentFrames.length>1){const o=this.framePool.currentFrames;n.targetFrameSrc===o[this.currentProgression===te.rtl?0:1]?.source&&(n.x+=(o[this.currentProgression===te.rtl?1:0]?.iframe.contentWindow?.innerWidth??0)*window.devicePixelRatio)}if(e==="click"?this.listeners.click(n):this.listeners.tap(n))break;const s=(this._cframes.length===2?this._cframes[0].window.innerWidth+this._cframes[1].window.innerWidth:this._cframes[0].window.innerWidth)*window.devicePixelRatio/4;n.x>=s&&n.x<=s*3&&this.listeners.miscPointer(1),n.x<s?this.goLeft(!1,()=>{}):n.x>s*3&&this.goRight(!1,()=>{})}break;case"tap_more":this.listeners.miscPointer(t);break;case"no_more":this.changeResource(1);break;case"no_less":this.changeResource(-1);break;case"swipe":break;case"scroll":this.listeners.scroll(t);break;case"zoom":this.listeners.zoom(t);break;case"progress":this.syncLocation(t);break;case"log":console.log(this._cframes[0]?.source?.split("/")[3],...t);break;default:this.listeners.customEvent(e,t);break}}determineModules(){let e=Array.from(tn.keys());return this._layout===_.fixed?e.filter(t=>su.includes(t)):(e=e.filter(t=>ou.includes(t)),this._layout===_.scrolled?e=e.filter(t=>t!=="column_snapper"):e=e.filter(t=>t!=="scroll_snapper"),e)}attachListener(){const e=this._cframes.filter(t=>!!t);if(e.length===0)throw Error("no cframe to attach listener to");e.forEach(t=>{t.msg&&(t.msg.listener=(r,n)=>{this.eventListener(r,n)})})}async apply(){if(await this.framePool.update(this.pub,this.currentLocator,this.determineModules()),this.attachListener(),this.pub.readingOrder.findIndexWithHref(this.currentLocation.href)<0)throw Error("Link for "+this.currentLocation.href+" not found!")}async destroy(){await this.framePool?.destroy()}async changeResource(e){if(e===0)return!1;if(this._layout===_.fixed){const n=this.framePool,s=n.viewport.positions[0];if(e===1){if(!n.next(n.perPage))return!1}else if(e===-1){if(!n.prev(n.perPage))return!1}else throw Error("Invalid relative value for FXL");const o=n.viewport.positions[0];if(s>o){for(let a=this.positions.length-1;a>=0;a--)if(this.positions[a].href===this.pub.readingOrder.items[o-1].href){this.currentLocation=this.positions[a].copyWithLocations({progression:.999999999999});break}}else if(s<o){for(let a=0;a<this.positions.length;a++)if(this.positions[a].href===this.pub.readingOrder.items[o-1].href){this.currentLocation=this.positions[a];break}}return await this.apply(),!0}const t=this.pub.readingOrder.findIndexWithHref(this.currentLocation.href),r=Math.max(0,Math.min(this.pub.readingOrder.items.length-1,t+e));if(r===t)return this._cframes[0]?.msg?.send("shake",void 0,async n=>{}),!1;if(t>r){for(let n=this.positions.length-1;n>=0;n--)if(this.positions[n].href===this.pub.readingOrder.items[r].href){this.currentLocation=this.positions[n].copyWithLocations({progression:.999999999999});break}}else for(let n=0;n<this.positions.length;n++)if(this.positions[n].href===this.pub.readingOrder.items[r].href){this.currentLocation=this.positions[n];break}return await this.apply(),!0}findLastPositionInProgressionRange(e,t){const r=e.findLastIndex(n=>{const s=n.locations.progression;return!!(s&&s>t.start&&s<=t.end)});return r!==-1?e[r]:void 0}findNearestPositions(e){const t=this.positions.filter(s=>s.href===this.currentLocation.href);let r=this.currentLocation,n;return t.some((s,o)=>{const a=s.locations.progression??0;if(e.start<=a){r=s;const h=t.splice(o+1,t.length);return n=this.findLastPositionInProgressionRange(h,e),!0}else return!1}),{first:r,last:n}}updateViewport(e){this.reflowViewport.readingOrder=[],this.reflowViewport.progressions.clear(),this.reflowViewport.positions=null,this.currentLocation&&(this.reflowViewport.readingOrder.push(this.currentLocation.href),this.reflowViewport.progressions.set(this.currentLocation.href,e),this.currentLocation.locations?.position!==void 0&&(this.reflowViewport.positions=[this.currentLocation.locations.position],this.lastLocationInView?.locations?.position!==void 0&&this.reflowViewport.positions.push(this.lastLocationInView.locations.position)))}async syncLocation(e){const t=e,r=this.findNearestPositions(t);this.currentLocation=r.first.copyWithLocations({progression:t.start}),this.lastLocationInView=r.last,this.updateViewport(t),this.listeners.positionChanged(this.currentLocation),await this.framePool.update(this.pub,this.currentLocation,this.determineModules())}goBackward(e,t){this._layout===_.fixed?(this.changeResource(-1),t(!0)):this._cframes[0]?.msg?.send("go_prev",void 0,async r=>{t(r?!0:await this.changeResource(-1))})}goForward(e,t){this._layout===_.fixed?(this.changeResource(1),t(!0)):this._cframes[0]?.msg?.send("go_next",void 0,async r=>{t(r?!0:await this.changeResource(1))})}get currentLocator(){return this.currentLocation}get viewport(){return this._layout===_.fixed?this.framePool.viewport:this.reflowViewport}get isScrollStart(){const e=this.viewport.readingOrder[0];return this.viewport.progressions.get(e)?.start===0}get isScrollEnd(){const e=this.viewport.readingOrder[this.viewport.readingOrder.length-1];return this.viewport.progressions.get(e)?.end===1}get canGoBackward(){const e=this.pub.readingOrder.items[0]?.href;return!(this.viewport.progressions.has(e)&&this.viewport.progressions.get(e)?.start===0)}get canGoForward(){const e=this.pub.readingOrder.items[this.pub.readingOrder.items.length-1]?.href;return!(this.viewport.progressions.has(e)&&this.viewport.progressions.get(e)?.end===1)}get readingProgression(){return this.currentProgression}async setLayout(e){this._layout!==e&&(this._layout=e,await this.framePool.update(this.pub,this.currentLocator,this.determineModules(),!0),this.attachListener())}get publication(){return this.pub}async loadLocator(e,t){let r=!1,n=typeof e.locations.getCssSelector=="function"&&e.locations.getCssSelector();if(e.text?.highlight?r=await new Promise((a,h)=>{this._cframes[0].msg.send("go_text",n?[e.text?.serialize(),n]:e.text?.serialize(),l=>a(l))}):n&&(r=await new Promise((a,h)=>{this._cframes[0].msg.send("go_text",["",n],l=>a(l))})),r){t(r);return}const s=typeof e.locations.htmlId=="function"&&e.locations.htmlId();if(s&&(r=await new Promise((a,h)=>{this._cframes[0].msg.send("go_id",s,l=>a(l))})),r){t(r);return}const o=e?.locations?.progression;o&&o>0?r=await new Promise((a,h)=>{this._cframes[0].msg.send("go_progression",o,l=>a(l))}):r=!0,t(r)}go(e,t,r){const n=e.href.split("#")[0];let s=this.pub.readingOrder.findWithHref(n);if(!s)return r(this.listeners.handleLocator(e));this.currentLocation=this.positions.find(o=>o.href===s.href),this.apply().then(()=>this.loadLocator(e,o=>r(o))).then(()=>{this.attachListener()})}goLink(e,t,r){return this.go(e.locator,t,r)}}class Vu{close(){}links(){return[]}get(e){throw Error("This is an empty fetcher")}}class Gu{constructor(e,t){this.client=e||window.fetch.bind(window),this.baseUrl=t}links(){return[]}get(e){const t=e.toURL(this.baseUrl);if(t===void 0)throw Error(`Invalid HREF: ${e.href}`);return new Xu(this.client,e,t)}close(){}}class Xu{constructor(e,t,r){this.client=e||window.fetch.bind(window),this._link=t,this.url=r}async headResponse(){if(this._headResponse)return this._headResponse;const e=await this.client(this.url,{method:"HEAD"});if(!e.ok)throw new Error(`http HEAD request for ${this.url} failed with HTTP status code ${e.status}`);return this._headResponse=e,e}close(){}async link(){return this._link}async read(e){if(e)throw new Error("http read range not implemented!");const t=await this.client(this.url);if(!t.ok)throw new Error(`http GET request for ${this.url} failed with HTTP status code ${t.status}`);return new Uint8Array(await t.arrayBuffer())}async length(){const e=(await this.headResponse()).headers.get("content-length");if(e===null||e==="")throw new Error("length for resource unavailable");return parseInt(e)}async readAsJSON(){const e=await this.client(this.url);if(!e.ok)throw new Error(`http GET request for ${this.url} failed with HTTP status code ${e.status}`);return await e.json()}async readAsString(){const e=await this.client(this.url);if(!e.ok)throw new Error(`http GET request for ${this.url} failed with HTTP status code ${e.status}`);return await e.text()}async readAsXML(){const e=await this.client(this.url);if(!e.ok)throw new Error(`http GET request for ${this.url} failed with HTTP status code ${e.status}`);return new DOMParser().parseFromString(await e.text(),"application/xml")}}class Mn{constructor(e={}){this.conformsTo=e.conformsTo??[],this.certification=e.certification??null,this.summary=e.summary??null,this.accessMode=e.accessMode??[],this.accessModeSufficient=e.accessModeSufficient??[],this.feature=e.feature??[],this.hazard=e.hazard??[],this.exemption=e.exemption??[]}static deserialize(e){if(!e||typeof e!="object")return;const t=e;return new Mn({conformsTo:t.conformsTo?t.conformsTo.map(r=>Yu.deserialize(r)).filter(r=>r!==void 0):void 0,certification:t.certification?Dn.deserialize(t.certification):void 0,summary:t.summary,accessMode:t.accessMode?t.accessMode.map(r=>Ju.deserialize(r)).filter(r=>r!==void 0):void 0,accessModeSufficient:t.accessModeSufficient?t.accessModeSufficient.map(r=>Ku.deserialize(r)).filter(r=>r!==void 0):void 0,feature:t.feature?t.feature.map(r=>Zu.deserialize(r)).filter(r=>r!==void 0):void 0,hazard:t.hazard?t.hazard.map(r=>Qu.deserialize(r)).filter(r=>r!==void 0):void 0,exemption:t.exemption?t.exemption.map(r=>ed.deserialize(r)).filter(r=>r!==void 0):void 0})}serialize(){const e={};return this.conformsTo?.length>0&&(e.conformsTo=this.conformsTo.map(t=>t.serialize())),this.certification!==void 0&&this.certification!==null&&(e.certification=this.certification.serialize()),this.summary!==void 0&&this.summary!==null&&(e.summary=this.summary),this.accessMode?.length>0&&(e.accessMode=this.accessMode.map(t=>t.serialize())),this.accessModeSufficient?.length>0&&(e.accessModeSufficient=this.accessModeSufficient.map(t=>t.serialize())),this.feature?.length>0&&(e.feature=this.feature.map(t=>t.serialize())),this.hazard?.length>0&&(e.hazard=this.hazard.map(t=>t.serialize())),this.exemption?.length>0&&(e.exemption=this.exemption.map(t=>t.serialize())),e}}const M=class ae{constructor(e){this.uri=e}static deserialize(e){if(!(!e||typeof e!="string"))return new ae(e)}serialize(){return this.uri}get isWCAGLevelA(){return this===ae.EPUB_A11Y_10_WCAG_20_A||this===ae.EPUB_A11Y_11_WCAG_20_A||this===ae.EPUB_A11Y_11_WCAG_21_A||this===ae.EPUB_A11Y_11_WCAG_22_A}get isWCAGLevelAA(){return this===ae.EPUB_A11Y_10_WCAG_20_AA||this===ae.EPUB_A11Y_11_WCAG_20_AA||this===ae.EPUB_A11Y_11_WCAG_21_AA||this===ae.EPUB_A11Y_11_WCAG_22_AA}get isWCAGLevelAAA(){return this===ae.EPUB_A11Y_10_WCAG_20_AAA||this===ae.EPUB_A11Y_11_WCAG_20_AAA||this===ae.EPUB_A11Y_11_WCAG_21_AAA||this===ae.EPUB_A11Y_11_WCAG_22_AAA}};M.EPUB_A11Y_10_WCAG_20_A=new M("http://www.idpf.org/epub/a11y/accessibility-20170105.html#wcag-a"),M.EPUB_A11Y_10_WCAG_20_AA=new M("http://www.idpf.org/epub/a11y/accessibility-20170105.html#wcag-aa"),M.EPUB_A11Y_10_WCAG_20_AAA=new M("http://www.idpf.org/epub/a11y/accessibility-20170105.html#wcag-aaa"),M.EPUB_A11Y_11_WCAG_20_A=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.0-a"),M.EPUB_A11Y_11_WCAG_20_AA=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.0-aa"),M.EPUB_A11Y_11_WCAG_20_AAA=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.0-aaa"),M.EPUB_A11Y_11_WCAG_21_A=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.1-a"),M.EPUB_A11Y_11_WCAG_21_AA=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.1-aa"),M.EPUB_A11Y_11_WCAG_21_AAA=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.1-aaa"),M.EPUB_A11Y_11_WCAG_22_A=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.2-a"),M.EPUB_A11Y_11_WCAG_22_AA=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.2-aa"),M.EPUB_A11Y_11_WCAG_22_AAA=new M("https://www.w3.org/TR/epub-a11y-11#wcag-2.2-aaa");let Yu=M;class Dn{constructor(e=null,t=null,r=null){this.certifiedBy=e,this.credential=t,this.report=r}static deserialize(e){if(!(!e||typeof e!="object"))return new Dn(e.certifiedBy,e.credential,e.report)}serialize(){const e={};return this.certifiedBy&&(e.certifiedBy=this.certifiedBy),this.credential&&(e.credential=this.credential),this.report&&(e.report=this.report),e}}const B=class xl{constructor(e){this.value=e}static deserialize(e){if(!(!e||typeof e!="string"))return new xl(e)}serialize(){return this.value}};B.AUDITORY=new B("auditory"),B.CHART_ON_VISUAL=new B("chartOnVisual"),B.CHEM_ON_VISUAL=new B("chemOnVisual"),B.COLOR_DEPENDENT=new B("colorDependent"),B.DIAGRAM_ON_VISUAL=new B("diagramOnVisual"),B.MATH_ON_VISUAL=new B("mathOnVisual"),B.MUSIC_ON_VISUAL=new B("musicOnVisual"),B.TACTILE=new B("tactile"),B.TEXT_ON_VISUAL=new B("textOnVisual"),B.TEXTUAL=new B("textual"),B.VISUAL=new B("visual");let Ju=B;const Ie=class St{constructor(e){if(typeof e=="string"){if(!St.VALID_MODES.has(e.toLowerCase()))return;this.value=e.toLowerCase()}else{const t=e.filter(r=>St.VALID_MODES.has(r.toLowerCase()));if(t.length===0)return;this.value=Array.from(new Set(t))}}static deserialize(e){if(!e)return;if(typeof e=="string")return new St(e);if(!Array.isArray(e))return;const t=e.filter(r=>r?St.VALID_MODES.has(r.toLowerCase()):!1);if(t.length!==0)return new St(t)}serialize(){return this.value}};Ie.VALID_MODES=new Set(["auditory","tactile","textual","visual"]),Ie.AUDITORY=new Ie("auditory"),Ie.TACTILE=new Ie("tactile"),Ie.TEXTUAL=new Ie("textual"),Ie.VISUAL=new Ie("visual");let Ku=Ie;const T=class Tl{constructor(e){this.value=e}static deserialize(e){if(!(!e||typeof e!="string"))return new Tl(e)}serialize(){return this.value}};T.NONE=new T("none"),T.ANNOTATIONS=new T("annotations"),T.ARIA=new T("ARIA"),T.INDEX=new T("index"),T.PAGE_BREAK_MARKERS=new T("pageBreakMarkers"),T.PAGE_NAVIGATION=new T("pageNavigation"),T.PRINT_PAGE_NUMBERS=new T("printPageNumbers"),T.READING_ORDER=new T("readingOrder"),T.STRUCTURAL_NAVIGATION=new T("structuralNavigation"),T.TABLE_OF_CONTENTS=new T("tableOfContents"),T.TAGGED_PDF=new T("taggedPDF"),T.ALTERNATIVE_TEXT=new T("alternativeText"),T.AUDIO_DESCRIPTION=new T("audioDescription"),T.CAPTIONS=new T("captions"),T.CLOSED_CAPTIONS=new T("closedCaptions"),T.DESCRIBED_MATH=new T("describedMath"),T.LONG_DESCRIPTION=new T("longDescription"),T.OPEN_CAPTIONS=new T("openCaptions"),T.SIGN_LANGUAGE=new T("signLanguage"),T.TRANSCRIPT=new T("transcript"),T.DISPLAY_TRANSFORMABILITY=new T("displayTransformability"),T.SYNCHRONIZED_AUDIO_TEXT=new T("synchronizedAudioText"),T.TIMING_CONTROL=new T("timingControl"),T.UNLOCKED=new T("unlocked"),T.CHEM_ML=new T("ChemML"),T.LATEX=new T("latex"),T.LATEX_CHEMISTRY=new T("latex-chemistry"),T.MATH_ML=new T("MathML"),T.MATH_ML_CHEMISTRY=new T("MathML-chemistry"),T.TTS_MARKUP=new T("ttsMarkup"),T.HIGH_CONTRAST_AUDIO=new T("highContrastAudio"),T.HIGH_CONTRAST_DISPLAY=new T("highContrastDisplay"),T.LARGE_PRINT=new T("largePrint"),T.BRAILLE=new T("braille"),T.TACTILE_GRAPHIC=new T("tactileGraphic"),T.TACTILE_OBJECT=new T("tactileObject"),T.FULL_RUBY_ANNOTATIONS=new T("fullRubyAnnotations"),T.HORIZONTAL_WRITING=new T("horizontalWriting"),T.RUBY_ANNOTATIONS=new T("rubyAnnotations"),T.VERTICAL_WRITING=new T("verticalWriting"),T.WITH_ADDITIONAL_WORD_SEGMENTATION=new T("withAdditionalWordSegmentation"),T.WITHOUT_ADDITIONAL_WORD_SEGMENTATION=new T("withoutAdditionalWordSegmentation");let Zu=T;const $=class Al{constructor(e){this.value=e}static deserialize(e){if(!(!e||typeof e!="string"))return new Al(e)}serialize(){return this.value}};$.FLASHING=new $("flashing"),$.NO_FLASHING_HAZARD=new $("noFlashingHazard"),$.UNKNOWN_FLASHING_HAZARD=new $("unknownFlashingHazard"),$.MOTION_SIMULATION=new $("motionSimulation"),$.NO_MOTION_SIMULATION_HAZARD=new $("noMotionSimulationHazard"),$.UNKNOWN_MOTION_SIMULATION_HAZARD=new $("unknownMotionSimulationHazard"),$.SOUND=new $("sound"),$.NO_SOUND_HAZARD=new $("noSoundHazard"),$.UNKNOWN_SOUND_HAZARD=new $("unknownSoundHazard"),$.UNKNOWN=new $("unknown"),$.NONE=new $("none");let Qu=$;const j=class Cl{constructor(e){this.value=e}static deserialize(e){if(!(!e||typeof e!="string"))return new Cl(e)}serialize(){return this.value}};j.NONE=new j("none"),j.DOCUMENTED=new j("documented"),j.LEGAL=new j("legal"),j.TEMPORARY=new j("temporary"),j.TECHNICAL=new j("technical"),j.EAA_DISPROPORTIONATE_BURDEN=new j("eaa-disproportionate-burden"),j.EAA_FUNDAMENTAL_ALTERATION=new j("eaa-fundamental-alteration"),j.EAA_MICROENTERPRISE=new j("eaa-microenterprise"),j.EAA_TECHNICAL_IMPOSSIBILITY=new j("eaa-technical-impossibility"),j.EAA_TEMPORARY=new j("eaa-temporary");let ed=j;var qt=(i=>(i.reflowable="reflowable",i.fixed="fixed",i.scrolled="scrolled",i))(qt||{});class Fn{constructor(e){this.algorithm=e.algorithm,this.compression=e.compression,this.originalLength=e.originalLength,this.profile=e.profile,this.scheme=e.scheme}static deserialize(e){if(e&&e.algorithm)return new Fn({algorithm:e.algorithm,compression:e.compression,originalLength:e.originalLength,profile:e.profile,scheme:e.scheme})}serialize(){const e={algorithm:this.algorithm};return this.compression!==void 0&&(e.compression=this.compression),this.originalLength!==void 0&&(e.originalLength=this.originalLength),this.profile!==void 0&&(e.profile=this.profile),this.scheme!==void 0&&(e.scheme=this.scheme),e}}let _e=class on{constructor(e){this.otherProperties=e}get page(){return this.otherProperties.page}static deserialize(e){if(e)return new on(e)}serialize(){return this.otherProperties}add(e){const t=Object.assign({},this.otherProperties);for(const r in e)t[r]=e[r];return new on(t)}};Object.defineProperty(_e.prototype,"encryption",{get:function(){return Fn.deserialize(this.otherProperties.encrypted)}});class Un{constructor(e){this.activeClass=e.activeClass,this.playbackActiveClass=e.playbackActiveClass}static deserialize(e){if(e)return new Un({activeClass:e.activeClass,playbackActiveClass:e.playbackActiveClass})}serialize(){const e={};return this.activeClass&&(e.activeClass=this.activeClass),this.playbackActiveClass&&(e.playbackActiveClass=this.playbackActiveClass),e}}function td(i){return i&&Array.isArray(i)?i:void 0}function st(i){return i&&typeof i=="string"?[i]:td(i)}function ji(i){return typeof i=="string"?new Date(i):void 0}function Jt(i){return isNaN(i)?void 0:i}function ee(i){return Jt(i)!==void 0&&Math.sign(i)>=0?i:void 0}function qi(i){const e=new Array;return i.forEach(t=>e.push(t)),e}class Rt{constructor(e){this.value=e.value,this.scheme=e.scheme}static deserialize(e){if(e){if(typeof e=="string")return new Rt({value:e});if(typeof e=="object"&&e.value)return new Rt({value:e.value,scheme:e.scheme})}}serialize(){return this.scheme?{value:this.value,scheme:this.scheme}:this.value}}let an=class S{constructor(e){let t,r,n=e.mediaType.replace(/\s/g,"").split(";");const s=n[0].split("/");if(s.length===2){if(t=s[0].toLowerCase().trim(),r=s[1].toLowerCase().trim(),t.length===0||r.length===0)throw new Error("Invalid media type")}else throw new Error("Invalid media type");const o={};for(let f=1;f<n.length;f++){const g=n[f].split("=");if(g.length===2){const d=g[0].toLocaleLowerCase(),m=d==="charset"?g[1].toUpperCase():g[1];o[d]=m}}const a={},h=Object.keys(o);h.sort((f,g)=>f.localeCompare(g)),h.forEach(f=>a[f]=o[f]);let l="";for(const f in a){const g=a[f];l+=`;${f}=${g}`}const u=`${t}/${r}${l}`,c=a.encoding;this.string=u,this.type=t,this.subtype=r,this.parameters=a,this.encoding=c,this.name=e.name,this.fileExtension=e.fileExtension}static parse(e){return new S(e)}get structuredSyntaxSuffix(){const e=this.subtype.split("+");return e.length>1?`+${e[e.length-1]}`:void 0}get charset(){return this.parameters.charset}contains(e){const t=typeof e=="string"?S.parse({mediaType:e}):e;if(!((this.type==="*"||this.type===t.type)&&(this.subtype==="*"||this.subtype===t.subtype)))return!1;const r=new Set(Object.entries(this.parameters).map(([s,o])=>`${s}=${o}`)),n=new Set(Object.entries(t.parameters).map(([s,o])=>`${s}=${o}`));for(const s of Array.from(r.values()))if(!n.has(s))return!1;return!0}matches(e){const t=typeof e=="string"?S.parse({mediaType:e}):e;return this.contains(t)||t.contains(this)}matchesAny(...e){for(const t of e)if(this.matches(t))return!0;return!1}equals(e){return this.string===e.string}get isZIP(){return this.matchesAny(S.ZIP,S.LCP_PROTECTED_AUDIOBOOK,S.LCP_PROTECTED_PDF)||this.structuredSyntaxSuffix==="+zip"}get isJSON(){return this.matchesAny(S.JSON)||this.structuredSyntaxSuffix==="+json"}get isOPDS(){return this.matchesAny(S.OPDS1,S.OPDS1_ENTRY,S.OPDS2,S.OPDS2_PUBLICATION,S.OPDS_AUTHENTICATION)||this.structuredSyntaxSuffix==="+json"}get isHTML(){return this.matchesAny(S.HTML,S.XHTML)}get isBitmap(){return this.matchesAny(S.BMP,S.GIF,S.JPEG,S.PNG,S.TIFF,S.WEBP)}get isAudio(){return this.type==="audio"}get isVideo(){return this.type==="video"}get isRWPM(){return this.matchesAny(S.READIUM_AUDIOBOOK_MANIFEST,S.DIVINA_MANIFEST,S.READIUM_WEBPUB_MANIFEST)}get isPublication(){return this.matchesAny(S.READIUM_AUDIOBOOK,S.READIUM_AUDIOBOOK_MANIFEST,S.CBZ,S.DIVINA,S.DIVINA_MANIFEST,S.EPUB,S.LCP_PROTECTED_AUDIOBOOK,S.LCP_PROTECTED_PDF,S.LPF,S.PDF,S.W3C_WPUB_MANIFEST,S.READIUM_WEBPUB,S.READIUM_WEBPUB_MANIFEST,S.ZAB)}static get AAC(){return S.parse({mediaType:"audio/aac",fileExtension:"aac"})}static get ACSM(){return S.parse({mediaType:"application/vnd.adobe.adept+xml",name:"Adobe Content Server Message",fileExtension:"acsm"})}static get AIFF(){return S.parse({mediaType:"audio/aiff",fileExtension:"aiff"})}static get AVI(){return S.parse({mediaType:"video/x-msvideo",fileExtension:"avi"})}static get BINARY(){return S.parse({mediaType:"application/octet-stream"})}static get BMP(){return S.parse({mediaType:"image/bmp",fileExtension:"bmp"})}static get CBZ(){return S.parse({mediaType:"application/vnd.comicbook+zip",name:"Comic Book Archive",fileExtension:"cbz"})}static get CSS(){return S.parse({mediaType:"text/css",fileExtension:"css"})}static get DIVINA(){return S.parse({mediaType:"application/divina+zip",name:"Digital Visual Narratives",fileExtension:"divina"})}static get DIVINA_MANIFEST(){return S.parse({mediaType:"application/divina+json",name:"Digital Visual Narratives",fileExtension:"json"})}static get EPUB(){return S.parse({mediaType:"application/epub+zip",name:"EPUB",fileExtension:"epub"})}static get GIF(){return S.parse({mediaType:"image/gif",fileExtension:"gif"})}static get GZ(){return S.parse({mediaType:"application/gzip",fileExtension:"gz"})}static get HTML(){return S.parse({mediaType:"text/html",fileExtension:"html"})}static get JAVASCRIPT(){return S.parse({mediaType:"text/javascript",fileExtension:"js"})}static get JPEG(){return S.parse({mediaType:"image/jpeg",fileExtension:"jpeg"})}static get JSON(){return S.parse({mediaType:"application/json"})}static get LCP_LICENSE_DOCUMENT(){return S.parse({mediaType:"application/vnd.readium.lcp.license.v1.0+json",name:"LCP License",fileExtension:"lcpl"})}static get LCP_PROTECTED_AUDIOBOOK(){return S.parse({mediaType:"application/audiobook+lcp",name:"LCP Protected Audiobook",fileExtension:"lcpa"})}static get LCP_PROTECTED_PDF(){return S.parse({mediaType:"application/pdf+lcp",name:"LCP Protected PDF",fileExtension:"lcpdf"})}static get LCP_STATUS_DOCUMENT(){return S.parse({mediaType:"application/vnd.readium.license.status.v1.0+json"})}static get LPF(){return S.parse({mediaType:"application/lpf+zip",fileExtension:"lpf"})}static get MP3(){return S.parse({mediaType:"audio/mpeg",fileExtension:"mp3"})}static get MPEG(){return S.parse({mediaType:"video/mpeg",fileExtension:"mpeg"})}static get NCX(){return S.parse({mediaType:"application/x-dtbncx+xml",fileExtension:"ncx"})}static get OGG(){return S.parse({mediaType:"audio/ogg",fileExtension:"oga"})}static get OGV(){return S.parse({mediaType:"video/ogg",fileExtension:"ogv"})}static get OPDS1(){return S.parse({mediaType:"application/atom+xml;profile=opds-catalog"})}static get OPDS1_ENTRY(){return S.parse({mediaType:"application/atom+xml;type=entry;profile=opds-catalog"})}static get OPDS2(){return S.parse({mediaType:"application/opds+json"})}static get OPDS2_PUBLICATION(){return S.parse({mediaType:"application/opds-publication+json"})}static get OPDS_AUTHENTICATION(){return S.parse({mediaType:"application/opds-authentication+json"})}static get OPUS(){return S.parse({mediaType:"audio/opus",fileExtension:"opus"})}static get OTF(){return S.parse({mediaType:"font/otf",fileExtension:"otf"})}static get PDF(){return S.parse({mediaType:"application/pdf",name:"PDF",fileExtension:"pdf"})}static get PNG(){return S.parse({mediaType:"image/png",fileExtension:"png"})}static get READIUM_AUDIOBOOK(){return S.parse({mediaType:"application/audiobook+zip",name:"Readium Audiobook",fileExtension:"audiobook"})}static get READIUM_AUDIOBOOK_MANIFEST(){return S.parse({mediaType:"application/audiobook+json",name:"Readium Audiobook",fileExtension:"json"})}static get READIUM_CONTENT_DOCUMENT(){return S.parse({mediaType:"application/vnd.readium.content+json",name:"Readium Content Document",fileExtension:"json"})}static get READIUM_GUIDED_NAVIGATION_DOCUMENT(){return S.parse({mediaType:"application/guided-navigation+json",name:"Readium Guided Navigation Document",fileExtension:"json"})}static get READIUM_POSITION_LIST(){return S.parse({mediaType:"application/vnd.readium.position-list+json",name:"Readium Position List",fileExtension:"json"})}static get READIUM_WEBPUB(){return S.parse({mediaType:"application/webpub+zip",name:"Readium Web Publication",fileExtension:"webpub"})}static get READIUM_WEBPUB_MANIFEST(){return S.parse({mediaType:"application/webpub+json",name:"Readium Web Publication",fileExtension:"json"})}static get SMIL(){return S.parse({mediaType:"application/smil+xml",fileExtension:"smil"})}static get SVG(){return S.parse({mediaType:"image/svg+xml",fileExtension:"svg"})}static get TEXT(){return S.parse({mediaType:"text/plain",fileExtension:"txt"})}static get TIFF(){return S.parse({mediaType:"image/tiff",fileExtension:"tiff"})}static get TTF(){return S.parse({mediaType:"font/ttf",fileExtension:"ttf"})}static get W3C_WPUB_MANIFEST(){return S.parse({mediaType:"application/x.readium.w3c.wpub+json",name:"Web Publication",fileExtension:"json"})}static get WAV(){return S.parse({mediaType:"audio/wav",fileExtension:"wav"})}static get WEBM_AUDIO(){return S.parse({mediaType:"audio/webm",fileExtension:"webm"})}static get WEBM_VIDEO(){return S.parse({mediaType:"video/webm",fileExtension:"webm"})}static get WEBP(){return S.parse({mediaType:"image/webp",fileExtension:"webp"})}static get WOFF(){return S.parse({mediaType:"font/woff",fileExtension:"woff"})}static get WOFF2(){return S.parse({mediaType:"font/woff2",fileExtension:"woff2"})}static get XHTML(){return S.parse({mediaType:"application/xhtml+xml",fileExtension:"xhtml"})}static get XML(){return S.parse({mediaType:"application/xml",fileExtension:"xml"})}static get ZAB(){return S.parse({mediaType:"application/x.readium.zab+zip",name:"Zipped Audio Book",fileExtension:"zab"})}static get ZIP(){return S.parse({mediaType:"application/zip",fileExtension:"zip"})}};class Vi{constructor(e){this.uri=e,this.parameters=this.getParameters(e)}getParameters(e){const t=/\{\??([^}]+)\}/g,r=e.match(t);return r?new Set(r.join(",").replace(t,"$1").split(",").map(n=>n.trim())):new Set}expand(e){const t=n=>n.split(",").map(s=>{const o=e[s];return o?encodeURIComponent(o):""}).join(","),r=n=>"?"+n.split(",").map(s=>{const o=s.split("=")[0],a=e[o];return a?`${o}=${encodeURIComponent(a)}`:""}).join("&");return this.uri.replace(/\{(\??)([^}]+)\}/g,(...n)=>n[1]?r(n[2]):t(n[2]))}}class se{constructor(e){this.fragments=e.fragments?e.fragments:new Array,this.progression=e.progression,this.totalProgression=e.totalProgression,this.position=e.position,this.otherLocations=e.otherLocations}static deserialize(e){if(!e)return;const t=Jt(e.progression),r=Jt(e.totalProgression),n=Jt(e.position),s=new Map,o=new Set(["fragment","fragments","progression","totalProgression","position"]);return Object.entries(e).forEach(([a,h])=>{o.has(a)||s.set(a,h)}),new se({fragments:st(e.fragments||e.fragment),progression:t!==void 0&&t>=0&&t<=1?t:void 0,totalProgression:r!==void 0&&r>=0&&r<=1?r:void 0,position:n!==void 0&&n>0?n:void 0,otherLocations:s.size===0?void 0:s})}serialize(){const e={};return this.fragments&&(e.fragments=this.fragments),this.progression!==void 0&&(e.progression=this.progression),this.totalProgression!==void 0&&(e.totalProgression=this.totalProgression),this.position!==void 0&&(e.position=this.position),this.otherLocations&&this.otherLocations.forEach((t,r)=>e[r]=t),e}}class Wn{constructor(e){this.after=e.after,this.before=e.before,this.highlight=e.highlight}static deserialize(e){if(e)return new Wn({after:e.after,before:e.before,highlight:e.highlight})}serialize(){const e={};return this.after!==void 0&&(e.after=this.after),this.before!==void 0&&(e.before=this.before),this.highlight!==void 0&&(e.highlight=this.highlight),e}}class Lt{constructor(e){this.href=e.href,this.type=e.type,this.title=e.title,this.locations=e.locations?e.locations:new se({}),this.text=e.text}static deserialize(e){if(e&&e.href&&e.type)return new Lt({href:e.href,type:e.type,title:e.title,locations:se.deserialize(e.locations),text:Wn.deserialize(e.text)})}serialize(){const e={href:this.href,type:this.type};return this.title!==void 0&&(e.title=this.title),this.locations&&(e.locations=this.locations.serialize()),this.text&&(e.text=this.text.serialize()),e}copyWithLocations(e){return new Lt({href:this.href,type:this.type,title:this.title,text:this.text,locations:new se({...this.locations,...e})})}}class Be{constructor(e){this.href=e.href,this.templated=e.templated,this.type=e.type,this.title=e.title,this.rels=e.rels,this.properties=e.properties,this.height=e.height,this.width=e.width,this.size=e.size,this.duration=e.duration,this.bitrate=e.bitrate,this.languages=e.languages,this.alternates=e.alternates,this.children=e.children}static deserialize(e){if(!(!e||typeof e.href!="string"))return new Be({href:e.href,templated:e.templated,type:e.type,title:e.title,rels:e.rel?Array.isArray(e.rel)?new Set(e.rel):new Set([e.rel]):void 0,properties:_e.deserialize(e.properties),height:ee(e.height),width:ee(e.width),size:ee(e.size),duration:ee(e.duration),bitrate:ee(e.bitrate),languages:st(e.language),alternates:fe.deserialize(e.alternate),children:fe.deserialize(e.children)})}serialize(){const e={href:this.href};return this.templated!==void 0&&(e.templated=this.templated),this.type!==void 0&&(e.type=this.type),this.title!==void 0&&(e.title=this.title),this.rels&&(e.rel=qi(this.rels)),this.properties&&(e.properties=this.properties.serialize()),this.height!==void 0&&(e.height=this.height),this.width!==void 0&&(e.width=this.width),this.size!==void 0&&(e.size=this.size),this.duration!==void 0&&(e.duration=this.duration),this.bitrate!==void 0&&(e.bitrate=this.bitrate),this.languages&&(e.language=this.languages),this.alternates&&(e.alternate=this.alternates.serialize()),this.children&&(e.children=this.children.serialize()),e}get mediaType(){return this.type!==void 0?an.parse({mediaType:this.type}):an.BINARY}toURL(e){const t=this.href.replace(/^(\/)/,"");if(t.length===0)return;let r=e||"/";return r.startsWith("/")&&(r="file://"+r),new URL(t,r).href.replace(/^(file:\/\/)/,"")}get templateParameters(){return this.templated?new Vi(this.href).parameters:new Set}expandTemplate(e){return new Be({href:new Vi(this.href).expand(e),templated:!1})}addProperties(e){const t=Be.deserialize(this.serialize());return t.properties=t.properties?t.properties?.add(e):new _e(e),t}get locator(){let e=this.href.split("#");return new Lt({href:e.length>0&&e[0]!==void 0?e[0]:this.href,type:this.type??"",title:this.title,locations:new se({fragments:e.length>1&&e[1]!==void 0?[e[1]]:[]})})}}class fe{constructor(e){this.items=e}static deserialize(e){if(e&&Array.isArray(e))return new fe(e.map(t=>Be.deserialize(t)).filter(t=>t!==void 0))}serialize(){return this.items.map(e=>e.serialize())}findWithRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.find(t)}filterByRel(e){const t=r=>r.rels&&r.rels.has(e);return this.items.filter(t)}findWithHref(e){const t=r=>r.href===e;return this.items.find(t)}findIndexWithHref(e){const t=r=>r.href===e;return this.items.findIndex(t)}findWithMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.find(t)}filterByMediaType(e){const t=r=>r.mediaType.matches(e);return this.items.filter(t)}filterByMediaTypes(e){const t=r=>{for(const n of e)if(r.mediaType.matches(n))return!0;return!1};return this.items.filter(t)}everyIsAudio(){const e=t=>t.mediaType.isAudio;return this.items.length>0&&this.items.every(e)}everyIsBitmap(){const e=t=>t.mediaType.isBitmap;return this.items.length>0&&this.items.every(e)}everyIsHTML(){const e=t=>t.mediaType.isHTML;return this.items.length>0&&this.items.every(e)}everyIsVideo(){const e=t=>t.mediaType.isVideo;return this.items.length>0&&this.items.every(e)}everyMatchesMediaType(e){return Array.isArray(e)?this.items.length>0&&this.items.every(t=>{for(const r of e)return t.mediaType.matches(r);return!1}):this.items.length>0&&this.items.every(t=>t.mediaType.matches(e))}filterLinksHasType(){return this.items.filter(e=>e.type)}}const ln=class Et{constructor(e){this.translations=typeof e=="string"?{[Et.UNDEFINED_LANGUAGE]:e}:e}static deserialize(e){if(e&&(typeof e=="string"||e.constructor===Object))return new Et(e)}serialize(){return this.translations}getTranslation(e){return this.translations[e||Et.UNDEFINED_LANGUAGE]||this.translations[Et.UNDEFINED_LANGUAGE]||this.translations[Et.LANGUAGE_EN]||(Object.values(this.translations).length===0?"":Object.values(this.translations)[0])}};ln.UNDEFINED_LANGUAGE="undefined",ln.LANGUAGE_EN="en";let nt=ln;class Gi{constructor(e){this.name=e.name,this.sortAs=e.sortAs,this.identifier=e.identifier,this.altIdentifiers=e.altIdentifiers,this.roles=e.roles,this.links=e.links,this.position=e.position}static deserialize(e){if(e)return typeof e=="string"?new Gi({name:nt.deserialize(e)}):e.name?new Gi({name:nt.deserialize(e.name),sortAs:e.sortAs,identifier:e.identifier,altIdentifiers:e.altIdentifier?Array.isArray(e.altIdentifier)?new Set(e.altIdentifier.map(t=>Rt.deserialize(t)).filter(t=>t!==void 0)):new Set([Rt.deserialize(e.altIdentifier)].filter(t=>t!==void 0)):void 0,roles:e.role?new Set(st(e.role)):void 0,links:fe.deserialize(e.links),position:Jt(e.position)}):void 0}serialize(){const e={name:this.name.serialize()};return this.sortAs!==void 0&&(e.sortAs=this.sortAs),this.identifier!==void 0&&(e.identifier=this.identifier),this.altIdentifiers&&(e.altIdentifier=qi(this.altIdentifiers).map(t=>t.serialize())),this.roles&&(e.role=qi(this.roles)),this.links&&(e.links=this.links.serialize()),this.position!==void 0&&(e.position=this.position),e}}class Q{constructor(e){this.items=e}static deserialize(e){if(!e)return;const t=Array.isArray(e)?e:[e];return new Q(t.map(r=>Gi.deserialize(r)).filter(r=>r!==void 0))}serialize(){return this.items.map(e=>e.serialize())}}let wr=class Pl{constructor(e){this.items=e&&e.items?e.items:new Map}static deserialize(e){if(!(e&&typeof e=="object"))return;const t=new Map;return Object.entries(e).forEach(([r,n])=>{const s=Q.deserialize(n);s&&s.items.length>0&&t.set(r,s)}),new Pl({items:t})}serialize(){const e={};return this.items.forEach((t,r)=>e[r]=t.serialize()),e}};var Vt=(i=>(i.EPUB="https://readium.org/webpub-manifest/profiles/epub",i.AUDIOBOOK="https://readium.org/webpub-manifest/profiles/audiobook",i.DIVINA="https://readium.org/webpub-manifest/profiles/divina",i.PDF="https://readium.org/webpub-manifest/profiles/pdf",i))(Vt||{}),it=(i=>(i.ltr="ltr",i.rtl="rtl",i))(it||{});class Xi{constructor(e){this.name=e.name,this.sortAs=e.sortAs,this.code=e.code,this.scheme=e.scheme,this.links=e.links}static deserialize(e){if(e)return typeof e=="string"?new Xi({name:nt.deserialize(e)}):e.name?new Xi({name:nt.deserialize(e.name),sortAs:e.sortAs,code:e.code,scheme:e.scheme,links:fe.deserialize(e.links)}):void 0}serialize(){const e={name:this.name.serialize()};return this.sortAs!==void 0&&(e.sortAs=this.sortAs),this.code!==void 0&&(e.code=this.code),this.scheme!==void 0&&(e.scheme=this.scheme),this.links&&(e.links=this.links.serialize()),e}}class Bn{constructor(e){this.items=e}static deserialize(e){if(!e)return;const t=Array.isArray(e)?e:[e];return new Bn(t.map(r=>Xi.deserialize(r)).filter(r=>r!==void 0))}serialize(){return this.items.map(e=>e.serialize())}}class $n{constructor(e){this.reservation=e.reservation,this.policy=e.policy}static deserialize(e){if(e)return new $n({reservation:e.reservation,policy:e.policy})}serialize(){const e={};return this.reservation!==void 0&&(e.reservation=this.reservation),this.policy!==void 0&&(e.policy=this.policy),e}}const _l=class hn{constructor(e){this.title=e.title,this.typeUri=e.typeUri,this.conformsTo=e.conformsTo,this.identifier=e.identifier,this.altIdentifier=e.altIdentifier,this.subtitle=e.subtitle,this.sortAs=e.sortAs,this.artists=e.artists,this.authors=e.authors,this.colorists=e.colorists,this.contributors=e.contributors,this.editors=e.editors,this.illustrators=e.illustrators,this.inkers=e.inkers,this.letterers=e.letterers,this.narrators=e.narrators,this.pencilers=e.pencilers,this.translators=e.translators,this.languages=e.languages,this.description=e.description,this.publishers=e.publishers,this.imprints=e.imprints,this.published=e.published,this.modified=e.modified,this.subjects=e.subjects,this.belongsTo=e.belongsTo,this.belongsToCollections=e.belongsToCollections,this.belongsToSeries=e.belongsToSeries,this.belongsToCollections&&this.belongsToCollections.items.length>0&&(this.belongsTo||(this.belongsTo=new wr),this.belongsTo.items.set("collection",this.belongsToCollections)),this.belongsToSeries&&this.belongsToSeries.items.length>0&&(this.belongsTo||(this.belongsTo=new wr),this.belongsTo.items.set("series",this.belongsToSeries)),this.layout=e.layout,this.readingProgression=e.readingProgression,this.duration=e.duration,this.numberOfPages=e.numberOfPages,this.accessibility=e.accessibility,this.tdm=e.tdm,this.otherMetadata=e.otherMetadata}static deserialize(e){if(!(e&&e.title))return;const t=nt.deserialize(e.title),r=e["@type"],n=st(e.conformsTo),s=e.identifier,o=Rt.deserialize(e.altIdentifier),a=nt.deserialize(e.subtitle),h=nt.deserialize(e.sortAs),l=Q.deserialize(e.artist),u=Q.deserialize(e.author),c=Q.deserialize(e.colorist),f=Q.deserialize(e.contributor),g=Q.deserialize(e.editor),d=Q.deserialize(e.illustrator),m=Q.deserialize(e.inker),y=Q.deserialize(e.letterer),x=Q.deserialize(e.narrator),R=Q.deserialize(e.penciler),L=Q.deserialize(e.translator),I=st(e.language),W=e.description,H=Q.deserialize(e.publisher),F=Q.deserialize(e.imprint),q=ji(e.published),qe=ji(e.modified),E=Bn.deserialize(e.subject),ht=wr.deserialize(e.belongsTo),Ke=Mn.deserialize(e.accessibility),N=e.layout,ke=e.readingProgression,Oe=ee(e.duration),ct=ee(e.numberOfPages),hi=$n.deserialize(e.tdm);let Z=Object.assign({},e);return hn.mappedProperties.forEach(ur=>delete Z[ur]),Object.keys(Z).length===0&&(Z=void 0),new hn({title:t,typeUri:r,conformsTo:n,identifier:s,altIdentifier:o,subtitle:a,sortAs:h,artists:l,authors:u,colorists:c,contributors:f,editors:g,illustrators:d,inkers:m,letterers:y,narrators:x,pencilers:R,translators:L,languages:I,description:W,publishers:H,imprints:F,published:q,modified:qe,subjects:E,belongsTo:ht,layout:N,readingProgression:ke,duration:Oe,numberOfPages:ct,accessibility:Ke,tdm:hi,otherMetadata:Z})}serialize(){const e={title:this.title.serialize()};if(this.typeUri!==void 0&&(e["@type"]=this.typeUri),this.conformsTo&&(e.conformsTo=this.conformsTo),this.identifier!==void 0&&(e.identifier=this.identifier),this.altIdentifier&&(e.altIdentifier=this.altIdentifier.serialize()),this.subtitle&&(e.subtitle=this.subtitle.serialize()),this.sortAs&&(e.sortAs=this.sortAs.serialize()),this.editors&&(e.editor=this.editors.serialize()),this.artists&&(e.artist=this.artists.serialize()),this.authors&&(e.author=this.authors.serialize()),this.colorists&&(e.colorist=this.colorists.serialize()),this.contributors&&(e.contributor=this.contributors.serialize()),this.illustrators&&(e.illustrator=this.illustrators.serialize()),this.letterers&&(e.letterer=this.letterers.serialize()),this.narrators&&(e.narrator=this.narrators.serialize()),this.pencilers&&(e.penciler=this.pencilers.serialize()),this.translators&&(e.translator=this.translators.serialize()),this.inkers&&(e.inker=this.inkers.serialize()),this.languages&&(e.language=this.languages),this.description!==void 0&&(e.description=this.description),this.publishers&&(e.publisher=this.publishers.serialize()),this.imprints&&(e.imprint=this.imprints.serialize()),this.published!==void 0&&(e.published=this.published.toISOString()),this.modified!==void 0&&(e.modified=this.modified.toISOString()),this.subjects&&(e.subject=this.subjects.serialize()),this.belongsTo&&(e.belongsTo=this.belongsTo.serialize()),this.layout&&(e.layout=this.layout),this.readingProgression&&(e.readingProgression=this.readingProgression),this.duration!==void 0&&(e.duration=this.duration),this.numberOfPages!==void 0&&(e.numberOfPages=this.numberOfPages),this.accessibility&&(e.accessibility=this.accessibility.serialize()),this.tdm&&(e.tdm=this.tdm.serialize()),this.otherMetadata){const t=this.otherMetadata;Object.keys(t).forEach(r=>e[r]=t[r])}return e}get effectiveLayout(){if(!this.conformsTo)return null;for(const e of this.conformsTo)switch(e){case Vt.EPUB:return this.layout||qt.reflowable;case Vt.DIVINA:return this.layout===qt.reflowable?qt.fixed:this.layout||qt.fixed;case Vt.AUDIOBOOK:case Vt.PDF:return null}return null}get effectiveReadingProgression(){if(this.readingProgression)return this.readingProgression;if(this.languages?.length!==1)return it.ltr;const e=this.languages[0].toLowerCase();if(e==="zh-hant"||e==="zh-tw")return it.rtl;switch(e.split("-")[0]){case"ar":return it.rtl;case"fa":return it.rtl;case"he":return it.rtl;default:return it.ltr}}};_l.mappedProperties=["title","@type","conformsTo","identifier","altIdentifier","subtitle","sortAs","artist","author","colorist","contributor","editor","illustrator","inker","letterer","narrator","penciler","translator","language","description","publisher","imprint","published","modified","subject","belongsTo","layout","readingProgression","duration","numberOfPages","accessibility","tdm"];let Ol=_l;Ol.prototype.getMediaOverlay=function(){const i=this.otherMetadata?.mediaOverlay;if(i)return Un.deserialize(i)};_e.prototype.getContains=function(){return new Set(this.otherProperties.contains||[])};class Hn{constructor(e){this.links=e.links,this.guided=e.guided}static deserialize(e){if(e)return new Hn({links:fe.deserialize(e.links),guided:At.deserializeArray(e.guided)})}serialize(){const e={};return this.links!==void 0&&(e.links=this.links.serialize()),this.guided!==void 0&&(e.guided=this.guided.map(t=>t.serialize())),e}}class Yi{constructor(e){this.plain=e.plain,this.ssml=e.ssml,this.language=e.language}static deserialize(e){if(e!=null){if(typeof e=="string")return new Yi({plain:e});if(e.plain||e.ssml||e.language)return new Yi({plain:e.plain,ssml:e.ssml,language:e.language})}}serialize(){const e={};return this.plain!==void 0&&(e.plain=this.plain),this.ssml!==void 0&&(e.ssml=this.ssml),this.language!==void 0&&(e.language=this.language),Object.keys(e).length>0?e:void 0}}class At{constructor(e){this.audioref=e.audioref,this.children=e.children,this.imgref=e.imgref,this.role=e.role,this.level=e.level!==void 0?Math.min(6,Math.max(1,e.level)):void 0,this.text=e.text,this.textref=e.textref,this.description=e.description}get plainText(){return this.text?.plain}get ssmlText(){return this.text?.ssml}get textLanguage(){return this.text?.language}static deserialize(e){if(e)return new At({audioref:e.audioref,children:At.deserializeArray(e.children),imgref:e.imgref,role:e.role?new Set(st(e.role)):void 0,level:typeof e.level=="number"?e.level:void 0,text:Yi.deserialize(e.text),textref:e.textref,description:At.deserialize(e.description)})}static deserializeArray(e){if(Array.isArray(e))return e.map(t=>At.deserialize(t)).filter(t=>t!==void 0)}serialize(){const e={};if(this.audioref!==void 0&&(e.audioref=this.audioref),this.children!==void 0&&(e.children=this.children.map(t=>t.serialize())),this.imgref!==void 0&&(e.imgref=this.imgref),this.role!==void 0&&(e.role=qi(this.role)),this.level!==void 0&&(e.level=this.level),this.text!==void 0){const t=this.text.serialize();t!==void 0&&(e.text=t)}return this.textref!==void 0&&(e.textref=this.textref),this.description&&(e.description=this.description.serialize()),e}get audioFile(){return this.audioref?.split("#")[0]}get audioTime(){if(this.audioref?.includes("#"))return this.audioref.split("#",2)[1]}get textFile(){return this.textref?.split("#")[0]}get fragmentId(){if(this.textref?.includes("#"))return this.textref.split("#",2)[1]}get clip(){const e=this.audioFile;if(!e)return;const t=this.audioTime,r={audioResource:e,fragmentId:this.fragmentId};if(!t)return r;const n=this.parseTimer(t);return r.start=n[0],r.end=n[1],r}parseTimer(e){if(!e||!e.startsWith("t="))return[void 0,void 0];const t=e.substring(2).split(",").map(r=>parseFloat(r));return t.length===1?[isNaN(t[0])?void 0:t[0],void 0]:t.length>2?[void 0,void 0]:[isNaN(t[0])?void 0:t[0],isNaN(t[1])?void 0:t[1]]}}let Je=class{constructor(e){this.fetcher=new Vu,e.fetcher&&(this.fetcher=e.fetcher),this.manifest=e.manifest,this.context=e.manifest.context,this.metadata=e.manifest.metadata,this.links=e.manifest.links,this.readingOrder=e.manifest.readingOrder,this.resources=e.manifest.resources,this.toc=e.manifest.toc,this.subcollections=e.manifest.subcollections}get baseURL(){return this.manifest.baseURL}linkWithHref(e){return this.manifest.linkWithHref(e)}linksWithRole(e){const t=this.subcollections?.get(e);return t&&t.length>0?t[0].links:void 0}linksWithRel(e){return this.manifest.linksWithRel(e)}linkWithRel(e){return this.manifest.linkWithRel(e)}async positionsFromManifest(){const e=this.manifest.links.findWithMediaType("application/vnd.readium.position-list+json");if(e===void 0)return[];const t=await this.get(e).readAsJSON();return t.total?t.positions.map(r=>Lt.deserialize(r)).filter(r=>r!==void 0):[]}async guideForLink(e){const t=o=>o.alternates?.findWithMediaType("application/guided-navigation+json");let r=t(e);if(!r){const o=this.linkWithHref(e.href);o!==void 0&&(r=t(o))}if(r||(r=this.manifest.links.findWithMediaType("application/guided-navigation+json")),!r)return;let n=r.href;if(r.templated){const o=new Vi(n),a={};o.parameters.has("ref")&&(a.ref=e.href),n=new Vi(n).expand(a)}const s=await this.get(new Be({href:n})).readAsJSON();return Hn.deserialize(s)}get(e){return this.fetcher.get(e)}};Je.prototype.getPageList=function(){return this.linksWithRole("pageList")};Je.prototype.getLandmarks=function(){return this.linksWithRole("landmarks")};Je.prototype.getListOfAudioClips=function(){return this.linksWithRole("loa")};Je.prototype.getListOfIllustrations=function(){return this.linksWithRole("loi")};Je.prototype.getListOfTables=function(){return this.linksWithRole("lot")};Je.prototype.getListOfVideoClips=function(){return this.linksWithRole("lov")};class Ji{constructor(e){this.cssSelector=e.cssSelector,this.textNodeIndex=e.textNodeIndex,this.charOffset=e.charOffset}static deserialize(e){if(!(e&&e.cssSelector))return;let t=ee(e.textNodeIndex);if(t===void 0)return;let r=ee(e.charOffset);return r===void 0&&(r=ee(e.offset)),new Ji({cssSelector:e.cssSelector,textNodeIndex:t,charOffset:r})}serialize(){const e={cssSelector:this.cssSelector,textNodeIndex:this.textNodeIndex};return this.charOffset!==void 0&&(e.charOffset=this.charOffset),e}}class jn{constructor(e){this.start=e.start,this.end=e.end}static deserialize(e){if(!e)return;let t=Ji.deserialize(e.start);if(t)return new jn({start:t,end:Ji.deserialize(e.end)})}serialize(){const e={start:this.start.serialize()};return this.end&&(e.end=this.end.serialize()),e}}se.prototype.getCssSelector=function(){return this.otherLocations?.get("cssSelector")};se.prototype.getPartialCfi=function(){return this.otherLocations?.get("partialCfi")};se.prototype.getDomRange=function(){return jn.deserialize(this.otherLocations?.get("domRange"))};se.prototype.fragmentParameters=function(){return new Map(this.fragments.map(i=>i.startsWith("#")?i.slice(1):i).join("&").split("&").filter(i=>!i.startsWith("#")).map(i=>i.split("=")).filter(i=>i.length===2).map(i=>[i[0].trim().toLowerCase(),i[1].trim()]))};se.prototype.htmlId=function(){if(!this.fragments.length)return;let i=this.fragments.find(e=>e.length&&!e.includes("="));if(!i){const e=this.fragmentParameters();e.has("id")?i=e.get("id"):e.has("name")&&(i=e.get("name"))}return i?.startsWith("#")?i.slice(1):i};se.prototype.page=function(){const i=parseInt(this.fragmentParameters().get("page"));if(!isNaN(i)&&i>=0)return i};se.prototype.time=function(){const i=parseInt(this.fragmentParameters().get("t"));if(!isNaN(i))return i};se.prototype.space=function(){const i=this.fragmentParameters();if(!i.has("xywh"))return;const e=i.get("xywh").split(",").map(t=>parseInt(t));if(e.length===4&&!e.some(isNaN))return e};class qn{constructor(e){this.currency=e.currency,this.value=e.value}static deserialize(e){if(!e)return;let t=e.currency;if(!(t&&typeof t=="string"&&t.length>0))return;let r=ee(e.value);if(r!==void 0)return new qn({currency:t,value:r})}serialize(){return{currency:this.currency,value:this.value}}}let id=class Ni{constructor(e){this.type=e.type,this.children=e.children}static deserialize(e){if(e&&e.type)return new Ni({type:e.type,children:Ni.deserializeArray(e.children)})}static deserializeArray(e){if(Array.isArray(e))return e.map(t=>Ni.deserialize(t)).filter(t=>t!==void 0)}serialize(){const e={type:this.type};return this.children&&(e.children=this.children.map(t=>t.serialize())),e}};class Vn{constructor(e){this.total=e.total,this.position=e.position}static deserialize(e){if(e)return new Vn({total:ee(e.total),position:ee(e.position)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.position!==void 0&&(e.position=this.position),e}}class Gn{constructor(e){this.total=e.total,this.available=e.available}static deserialize(e){if(e)return new Gn({total:ee(e.total),available:ee(e.available)})}serialize(){const e={};return this.total!==void 0&&(e.total=this.total),this.available!==void 0&&(e.available=this.available),e}}class Xn{constructor(e){this.state=e.state,this.since=e.since,this.until=e.until}static deserialize(e){if(e&&e.state)return new Xn({state:e.state,since:ji(e.since),until:ji(e.until)})}serialize(){const e={state:this.state};return this.since!==void 0&&(e.since=this.since.toISOString()),this.until!==void 0&&(e.until=this.until.toISOString()),e}}_e.prototype.getNumberOfItems=function(){return ee(this.otherProperties.numberOfItems)};_e.prototype.getPrice=function(){return qn.deserialize(this.otherProperties.price)};_e.prototype.getIndirectAcquisitions=function(){const i=this.otherProperties.indirectAcquisition;if(i&&Array.isArray(i))return i.map(e=>id.deserialize(e)).filter(e=>e!==void 0)};_e.prototype.getHolds=function(){return Vn.deserialize(this.otherProperties.holds)};_e.prototype.getCopies=function(){return Gn.deserialize(this.otherProperties.copies)};_e.prototype.getAvailability=function(){return Xn.deserialize(this.otherProperties.availability)};_e.prototype.getAuthenticate=function(){return Be.deserialize(this.otherProperties.authenticate)};Je.prototype.getImages=function(){return this.linksWithRole("images")};const rd="CssSelectorGenerator";function lo(i="unknown problem",...e){console.warn(`${rd}: ${i}`,...e)}function nd(i){return i instanceof RegExp}function sd(i){return i.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".+")}function od(i){const e=i.map(t=>{if(nd(t))return r=>t.test(r);if(typeof t=="function")return r=>{const n=t(r);return typeof n!="boolean"?(lo("pattern matcher function invalid","Provided pattern matching function does not return boolean. It's result will be ignored.",t),!1):n};if(typeof t=="string"){const r=new RegExp("^"+sd(t)+"$");return n=>r.test(n)}return lo("pattern matcher invalid","Pattern matching only accepts strings, regular expressions and/or functions. This item is invalid and will be ignored.",t),()=>!1});return t=>e.some(r=>r(t))}od(["class","id","ng-*"]);let ho=class xt{constructor(e){this.metadata=e.metadata,this.links=e.links,this.subcollections=e.subcollections}static deserialize(e){if(!e)return;let t,r,n;if(Array.isArray(e))t=fe.deserialize(e);else if(typeof e=="object")t=fe.deserialize(e.links),r=new Map,e.metadata&&Object.entries(e.metadata).forEach(([s,o])=>{r?.set(s,o)}),n=xt.deserializeCollections(e);else return;if(!(!t||t.items.length===0))return new xt({metadata:r?.size?r:void 0,links:t,subcollections:n?.size?n:void 0})}static deserializeCollections(e){if(!e)return;const t=new Map;return Object.entries(e).forEach(([r,n])=>{if(r!=="links"&&r!=="metadata"){const s=xt.deserialize(n);if(s){const o=new Array;o.push(s),t.set(r,o)}else if(Array.isArray(n)){const o=n.map(a=>xt.deserialize(a)).filter(a=>a!==void 0);t.set(r,o)}}}),t.size?t:void 0}serialize(){const e={};return this.metadata&&(e.metadata={},this.metadata.forEach((t,r)=>e.metadata[r]=t)),this.links.items.length&&(e.links=this.links.serialize()),xt.serializeCollection(e,this.subcollections),e}static serializeCollection(e,t){t&&t.size>0&&t.forEach((r,n)=>{r.length===1?e[n]=r[0].serialize():e[n]=r.map(s=>s.serialize())})}};class Yn{constructor(e){this.context=e.context,this.metadata=e.metadata,this.links=e.links,this.readingOrder=e.readingOrder,this.resources=e.resources,this.toc=e.toc,this.subcollections=e.subcollections}static deserialize(e){if(!e)return;const t=Ol.deserialize(e.metadata);if(!t)return;const r=fe.deserialize(e.links);if(!r)return;const n=fe.deserialize(e.readingOrder?e.readingOrder:e.spine);if(n)return new Yn({context:st(e["@context"]),metadata:t,links:r,readingOrder:n,resources:fe.deserialize(e.resources),toc:fe.deserialize(e.toc),subcollections:ho.deserializeCollections({sub:e.sub})})}serialize(){const e={};return this.context!==void 0&&(e["@context"]=this.context),e.metadata=this.metadata.serialize(),e.links=this.links.serialize(),e.readingOrder=this.readingOrder.serialize(),this.resources&&(e.resources=this.resources.serialize()),this.toc&&(e.toc=this.toc.serialize()),ho.serializeCollection(e,this.subcollections),e}linkWithRel(e){const t=new Array;t.push(this.readingOrder),this.resources&&t.push(this.resources),t.push(this.links);let r;for(const n of t)if(r=n.findWithRel(e),r!==void 0)return r;return r}linksWithRel(e){const t=[];return t.push(this.readingOrder.filterByRel(e)),this.resources&&t.push(this.resources.filterByRel(e)),t.push(this.links.filterByRel(e)),t.reduce((r,n)=>r.concat(n),[])}locatorFromLink(e){const t=e.href.split("#"),r=t.length==2?t[0]:e.href,n=this.linkWithHref(r);if(!n)return;const s=n.type;if(!s)return;const o=t.length==2?t[1]:void 0;return new Lt({href:r,type:s,title:n.title??e.title,locations:new se({fragments:o?[o]:void 0,progression:o?void 0:0})})}linkWithHref(e){const t=a=>{let h;for(const u of a)if(h=u.findWithHref(e),h!==void 0)return h;const l=new Array;return a.forEach(u=>{const c=[];for(const f of u.items)f.alternates&&c.push(f.alternates),f.children&&c.push(f.children);l.push(...c)}),l.length>0&&(h=t(l)),h},r=[];r.push(this.readingOrder),this.resources&&r.push(this.resources),r.push(this.links);const n=t(r);if(n!==void 0)return n;const s=e.split(/[#]/);if(s.length<2)return;const o=s[0];return this.linkWithHref(o)}get baseURL(){const e=this.links.items.find(t=>t.rels&&t.rels.has("self"));if(e){let t=e.href;if(t){const r=t.lastIndexOf("/"),n=r===-1?void 0:t.substring(r+1);t=t.replace(new RegExp("/?$query$"),""),t=t.replace(new RegExp("//$"),""),n&&(t=t.replace(new RegExp(n+"$"),""))}return t}}setSelfLink(e){this.links.items=this.links.items.filter(t=>t.rels===void 0||!t.rels?.has("self")),this.links.items.push(new Be({href:e,type:an.READIUM_WEBPUB_MANIFEST.string,rels:new Set(["self"])}))}}const ad=/[\p{Letter}\p{Number}]+/ug;function Rl(i,e){const t={width:i.innerWidth||i.document.documentElement.clientWidth,height:i.innerHeight||i.document.documentElement.clientHeight};return!(e.bottom<0||e.right<0||e.top>t.height||e.left>t.width)}function co(i,e){const t=new Range;return t.setStart(e,0),t.setEnd(e,e.textContent.length),Rl(i,t.getBoundingClientRect())}function Ll(i,e,t){e=e??i.document.documentElement,t=t??[];for(let r=0;r<e.childNodes.length;r++)e.childNodes[r].nodeName.toLocaleLowerCase()!=="head"&&(e.childNodes[r].nodeType===Node.TEXT_NODE&&e.childNodes[r].textContent.trim().length>0?t.indexOf(e)<0&&t.push(e):e.childNodes[r].nodeType===Node.ELEMENT_NODE&&Ll(i,e.childNodes[r],t));return t}function Il(i,e){e=e??[];for(let t=0;t<i.childNodes.length;t++)i.childNodes[t].nodeType===Node.TEXT_NODE?e.push(i.childNodes[t]):i.childNodes[t].nodeType===Node.ELEMENT_NODE&&Il(i.childNodes[t],e);return e}const uo=i=>i.replace(/([^\s])$/,"$1 ");function ld(i){const e=Ll(i),t=e.filter(n=>n.childElementCount>0);return e.filter(n=>t.indexOf(n.parentElement)<0).map(n=>Il(n)).map(n=>({rangedTextNodes:n.reduce((s,o)=>{const a=s.length>0?s[s.length-1].parentStartCharIndex+uo(s[s.length-1].textNode.textContent).length:0;return s.concat({textNode:o,parentStartCharIndex:a})},[]),utteranceStr:n.reduce((s,o)=>s+uo(o.textContent),"")})).filter(n=>n.utteranceStr.trim().length>0)}function Nl(i,e){if(!i.textContent||i.textContent.length===0)return-1;const t=i.textContent.matchAll(ad);let r=[0];for(const n of t)r.push(n.index);r.push(i.textContent.length-1);for(let n=0;n<r.length-1;n++){const s=new Range,o=r[n],a=r[n+1];s.setStart(i,o),s.setEnd(i,a),s.getClientRects();for(let h=0;h<s.getClientRects().length;h++){const l=s.getClientRects().item(h);if(l&&e(l))return o}}return-1}const hd=(i,e,t)=>Nl(t,r=>i>=r.x&&i<=r.x+r.width&&e>=r.y&&e<=r.y+r.height),cd=(i,e)=>Nl(e,t=>Rl(i,t)),zl={ar:{normal:"",high:""},ca:{normal:"millorada",high:"prmium"},"cmn-CN":{normal:"",high:""},"cmn-TW":{normal:"",high:""},cs:{normal:"vylepen verze",high:"prmiov"},da:{normal:"forbedret",high:"hj kvalitet"},de:{normal:"erweitert",high:"premium"},el:{normal:"",high:" "},en:{normal:"Enhanced",high:"Premium"},es:{normal:"mejorada",high:"premium"},fi:{normal:"parannettu",high:"korkealaatuinen"},fr:{normal:"premium",high:"de qualit"},he:{normal:"",high:""},hi:{normal:"",high:""},hr:{normal:"poboljani",high:"vrhunski"},hu:{normal:"tovbbfejlesztett",high:"prmium"},id:{normal:"Ditingkatkan",high:"Premium"},it:{normal:"ottimizzata",high:"premium"},ja:{normal:"",high:""},ko:{normal:"",high:""},ms:{normal:"Dipertingkat",high:"Premium"},nb:{normal:"forbedret",high:"premium"},nl:{normal:"verbeterd",high:"premium"},pl:{normal:"rozszerzony",high:"premium"},pt:{normal:"melhorada",high:"premium"},ro:{normal:"mbuntit",high:"premium"},ru:{normal:"",high:" "},sk:{normal:"vylepen",high:"prmiov"},sl:{normal:"izboljano",high:"prvovrsten"},sv:{normal:"frbttrad",high:"premium"},th:{normal:"",high:""},tr:{normal:"Gelitirilmi",high:"Yksek Kaliteli"},uk:{normal:"",high:" "},vi:{normal:"Nng cao",high:"Cao cp"}},ud=()=>(navigator?.language||"").split("-")[0].toLowerCase();Object.values(zl).map(({normal:i})=>i);Object.values(zl).map(({high:i})=>i);async function dd(i=1e4,e=10){const t=()=>speechSynthesis.getVoices(),r=t();return Array.isArray(r)&&r.length?r:new Promise((n,s)=>{let o=Math.floor(i/e),a=!1;const h=()=>{if(a)return;a=!0;const l=()=>{if(o<1)return n([]);--o;const u=t();if(Array.isArray(u)&&u.length)return n(u);setTimeout(l,e)};setTimeout(l,e)};speechSynthesis.onvoiceschanged?speechSynthesis.onvoiceschanged=()=>{const l=t();Array.isArray(l)&&l.length?n(l):h()}:h(),setTimeout(()=>s(new Error("No voices available after timeout")),i)})}function pd(i){const e=t=>{const r=t.replace("_","-");return/\w{2,3}-\w{2,3}/.test(r)?`${r.split("-")[0].toLowerCase()}-${r.split("-")[1].toUpperCase()}`:t};return i.map(t=>({label:t.name,voiceURI:t.voiceURI,name:t.name,__lang:t.lang,language:e(t.lang),gender:void 0,age:void 0,offlineAvailability:t.localService,quality:void 0,pitchControl:!0,recommendedPitch:void 0,recomendedRate:void 0}))}function fd(i,e=ud()){return e=Array.isArray(e)?e:[e],e=e.map(t=>po(t)[0]),i.filter(({language:t})=>{const[r]=po(t);return e.includes(r)})}const po=i=>[i.split("-")[0].toLowerCase(),i.split("-")[1]?.toUpperCase()],gd=["webKit","moz","ms","o"],md=["boundary","end","error","mark","pause","resume","start"],yd=i=>`${i.charAt(0).toUpperCase()}${i.slice(1)}`,Ut=(i={},e)=>Object.hasOwnProperty.call(i,e)||e in i||!!i[e],bd=i=>typeof window<"u"&&i in window,vd=i=>{const e=yd(i),t=gd.map(n=>`${n}${e}`),r=[i,e].concat(t).find(bd);return r&&typeof window<"u"?window[r]:void 0},wd=()=>{const i={};["speechSynthesis","speechSynthesisUtterance","speechSynthesisVoice","speechSynthesisEvent","speechSynthesisErrorEvent"].forEach(t=>{i[t]=vd(t)}),i.onvoiceschanged=Ut(i.speechSynthesis,"onvoiceschanged"),i.speechSynthesisSpeaking=Ut(i.speechSynthesis,"speaking"),i.speechSynthesisPaused=Ut(i.speechSynthesis,"paused");const e=i.speechSynthesisUtterance?Ut(i.speechSynthesisUtterance,"prototype"):!1;return md.forEach(t=>{const r=`on${t}`;i[r]=e&&i.speechSynthesisUtterance?Ut(i.speechSynthesisUtterance.prototype,r):!1}),i},kl=()=>{const e=typeof window<"u"&&(window.navigator||{}).userAgent||"",t=()=>/android/i.test(e),r=()=>/kaios/i.test(e),n=()=>typeof window.InstallTrigger<"u"?!0:/firefox/i.test(e),s=()=>typeof window.GestureEvent<"u"||/safari/i.test(e);return{isAndroid:t(),isFirefox:n()||r(),isSafari:s(),isKaiOS:r()}};function Sd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Sr,fo;function Ed(){if(fo)return Sr;fo=1,Sr=e;function i(r){return r instanceof Buffer?Buffer.from(r):new r.constructor(r.buffer.slice(),r.byteOffset,r.length)}function e(r){if(r=r||{},r.circles)return t(r);const n=new Map;if(n.set(Date,l=>new Date(l)),n.set(Map,(l,u)=>new Map(o(Array.from(l),u))),n.set(Set,(l,u)=>new Set(o(Array.from(l),u))),r.constructorHandlers)for(const l of r.constructorHandlers)n.set(l[0],l[1]);let s=null;return r.proto?h:a;function o(l,u){const c=Object.keys(l),f=new Array(c.length);for(let g=0;g<c.length;g++){const d=c[g],m=l[d];typeof m!="object"||m===null?f[d]=m:m.constructor!==Object&&(s=n.get(m.constructor))?f[d]=s(m,u):ArrayBuffer.isView(m)?f[d]=i(m):f[d]=u(m)}return f}function a(l){if(typeof l!="object"||l===null)return l;if(Array.isArray(l))return o(l,a);if(l.constructor!==Object&&(s=n.get(l.constructor)))return s(l,a);const u={};for(const c in l){if(Object.hasOwnProperty.call(l,c)===!1)continue;const f=l[c];typeof f!="object"||f===null?u[c]=f:f.constructor!==Object&&(s=n.get(f.constructor))?u[c]=s(f,a):ArrayBuffer.isView(f)?u[c]=i(f):u[c]=a(f)}return u}function h(l){if(typeof l!="object"||l===null)return l;if(Array.isArray(l))return o(l,h);if(l.constructor!==Object&&(s=n.get(l.constructor)))return s(l,h);const u={};for(const c in l){const f=l[c];typeof f!="object"||f===null?u[c]=f:f.constructor!==Object&&(s=n.get(f.constructor))?u[c]=s(f,h):ArrayBuffer.isView(f)?u[c]=i(f):u[c]=h(f)}return u}}function t(r){const n=[],s=[],o=new Map;if(o.set(Date,c=>new Date(c)),o.set(Map,(c,f)=>new Map(h(Array.from(c),f))),o.set(Set,(c,f)=>new Set(h(Array.from(c),f))),r.constructorHandlers)for(const c of r.constructorHandlers)o.set(c[0],c[1]);let a=null;return r.proto?u:l;function h(c,f){const g=Object.keys(c),d=new Array(g.length);for(let m=0;m<g.length;m++){const y=g[m],x=c[y];if(typeof x!="object"||x===null)d[y]=x;else if(x.constructor!==Object&&(a=o.get(x.constructor)))d[y]=a(x,f);else if(ArrayBuffer.isView(x))d[y]=i(x);else{const R=n.indexOf(x);R!==-1?d[y]=s[R]:d[y]=f(x)}}return d}function l(c){if(typeof c!="object"||c===null)return c;if(Array.isArray(c))return h(c,l);if(c.constructor!==Object&&(a=o.get(c.constructor)))return a(c,l);const f={};n.push(c),s.push(f);for(const g in c){if(Object.hasOwnProperty.call(c,g)===!1)continue;const d=c[g];if(typeof d!="object"||d===null)f[g]=d;else if(d.constructor!==Object&&(a=o.get(d.constructor)))f[g]=a(d,l);else if(ArrayBuffer.isView(d))f[g]=i(d);else{const m=n.indexOf(d);m!==-1?f[g]=s[m]:f[g]=l(d)}}return n.pop(),s.pop(),f}function u(c){if(typeof c!="object"||c===null)return c;if(Array.isArray(c))return h(c,u);if(c.constructor!==Object&&(a=o.get(c.constructor)))return a(c,u);const f={};n.push(c),s.push(f);for(const g in c){const d=c[g];if(typeof d!="object"||d===null)f[g]=d;else if(d.constructor!==Object&&(a=o.get(d.constructor)))f[g]=a(d,u);else if(ArrayBuffer.isView(d))f[g]=i(d);else{const m=n.indexOf(d);m!==-1?f[g]=s[m]:f[g]=u(d)}}return n.pop(),s.pop(),f}}return Sr}var xd=Ed();const Ml=Sd(xd);/**
 * @name codsen-utils
 * @fileoverview Various utility functions
 * @version 1.7.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/codsen-utils/}
 */Ml();function cn(i){if(i==null||typeof i!="object")return!1;let e=Object.getPrototypeOf(i);return e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null?!1:!(Symbol.iterator in i)&&!(Symbol.toStringTag in i)}function Tt(i){return typeof i=="string"}function Td(i){return Number.isFinite(i)}function pt(i){return Number.isSafeInteger(i)&&i>=0}function Ve(i){return i!=null}function Ad(i,e){return cn(i)&&Tt(e)&&e in i}var Cd=typeof global=="object"&&global&&global.Object===Object&&global,Pd=typeof self=="object"&&self&&self.Object===Object&&self,Jn=Cd||Pd||Function("return this")(),It=Jn.Symbol,Dl=Object.prototype,_d=Dl.hasOwnProperty,Od=Dl.toString,Wt=It?It.toStringTag:void 0;function Rd(i){var e=_d.call(i,Wt),t=i[Wt];try{i[Wt]=void 0;var r=!0}catch{}var n=Od.call(i);return r&&(e?i[Wt]=t:delete i[Wt]),n}var Ld=Object.prototype,Id=Ld.toString;function Nd(i){return Id.call(i)}var zd="[object Null]",kd="[object Undefined]",go=It?It.toStringTag:void 0;function Fl(i){return i==null?i===void 0?kd:zd:go&&go in Object(i)?Rd(i):Nd(i)}function Ul(i){return i!=null&&typeof i=="object"}var Md="[object Symbol]";function Dd(i){return typeof i=="symbol"||Ul(i)&&Fl(i)==Md}function Fd(i,e){for(var t=-1,r=i==null?0:i.length,n=Array(r);++t<r;)n[t]=e(i[t],t,i);return n}var Ud=Array.isArray,mo=It?It.prototype:void 0,yo=mo?mo.toString:void 0;function Kn(i){if(typeof i=="string")return i;if(Ud(i))return Fd(i,Kn)+"";if(Dd(i))return yo?yo.call(i):"";var e=i+"";return e=="0"&&1/i==-1/0?"-0":e}var Wd=/\s/;function Bd(i){for(var e=i.length;e--&&Wd.test(i.charAt(e)););return e}var $d=/^\s+/;function Hd(i){return i&&i.slice(0,Bd(i)+1).replace($d,"")}function Wl(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}function Bl(i){return i}var jd="[object AsyncFunction]",qd="[object Function]",Vd="[object GeneratorFunction]",Gd="[object Proxy]";function $l(i){if(!Wl(i))return!1;var e=Fl(i);return e==qd||e==Vd||e==jd||e==Gd}var Er=Jn["__core-js_shared__"],bo=(function(){var i=/[^.]+$/.exec(Er&&Er.keys&&Er.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""})();function Xd(i){return!!bo&&bo in i}var Yd=Function.prototype,Jd=Yd.toString;function Kd(i){if(i!=null){try{return Jd.call(i)}catch{}try{return i+""}catch{}}return""}var Zd=/[\\^$.*+?()[\]{}|]/g,Qd=/^\[object .+?Constructor\]$/,ep=Function.prototype,tp=Object.prototype,ip=ep.toString,rp=tp.hasOwnProperty,np=RegExp("^"+ip.call(rp).replace(Zd,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function sp(i){if(!Wl(i)||Xd(i))return!1;var e=$l(i)?np:Qd;return e.test(Kd(i))}function op(i,e){return i?.[e]}function Zn(i,e){var t=op(i,e);return sp(t)?t:void 0}function ap(i,e,t){switch(t.length){case 0:return i.call(e);case 1:return i.call(e,t[0]);case 2:return i.call(e,t[0],t[1]);case 3:return i.call(e,t[0],t[1],t[2])}return i.apply(e,t)}var lp=800,hp=16,cp=Date.now;function up(i){var e=0,t=0;return function(){var r=cp(),n=hp-(r-t);if(t=r,n>0){if(++e>=lp)return arguments[0]}else e=0;return i.apply(void 0,arguments)}}function dp(i){return function(){return i}}var vo=(function(){try{var i=Zn(Object,"defineProperty");return i({},"",{}),i}catch{}})(),pp=vo?function(i,e){return vo(i,"toString",{configurable:!0,enumerable:!1,value:dp(e),writable:!0})}:Bl,fp=up(pp);function gp(i,e,t,r){for(var n=i.length,s=t+-1;++s<n;)if(e(i[s],s,i))return s;return-1}function mp(i){return i!==i}function yp(i,e,t){for(var r=t-1,n=i.length;++r<n;)if(i[r]===e)return r;return-1}function Qn(i,e,t){return e===e?yp(i,e,t):gp(i,mp,t)}function bp(i,e){var t=i==null?0:i.length;return!!t&&Qn(i,e,0)>-1}function vp(i,e){return i===e||i!==i&&e!==e}var wo=Math.max;function wp(i,e,t){return e=wo(e===void 0?i.length-1:e,0),function(){for(var r=arguments,n=-1,s=wo(r.length-e,0),o=Array(s);++n<s;)o[n]=r[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=r[n];return a[e]=t(o),ap(i,this,a)}}function Sp(i,e){return fp(wp(i,e,Bl),i+"")}var Ep=9007199254740991;function xp(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=Ep}function Tp(i){return i!=null&&xp(i.length)&&!$l(i)}var Qt=Zn(Object,"create");function Ap(){this.__data__=Qt?Qt(null):{},this.size=0}function Cp(i){var e=this.has(i)&&delete this.__data__[i];return this.size-=e?1:0,e}var Pp="__lodash_hash_undefined__",_p=Object.prototype,Op=_p.hasOwnProperty;function Rp(i){var e=this.__data__;if(Qt){var t=e[i];return t===Pp?void 0:t}return Op.call(e,i)?e[i]:void 0}var Lp=Object.prototype,Ip=Lp.hasOwnProperty;function Np(i){var e=this.__data__;return Qt?e[i]!==void 0:Ip.call(e,i)}var zp="__lodash_hash_undefined__";function kp(i,e){var t=this.__data__;return this.size+=this.has(i)?0:1,t[i]=Qt&&e===void 0?zp:e,this}function ot(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}ot.prototype.clear=Ap;ot.prototype.delete=Cp;ot.prototype.get=Rp;ot.prototype.has=Np;ot.prototype.set=kp;function Mp(){this.__data__=[],this.size=0}function or(i,e){for(var t=i.length;t--;)if(vp(i[t][0],e))return t;return-1}var Dp=Array.prototype,Fp=Dp.splice;function Up(i){var e=this.__data__,t=or(e,i);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():Fp.call(e,t,1),--this.size,!0}function Wp(i){var e=this.__data__,t=or(e,i);return t<0?void 0:e[t][1]}function Bp(i){return or(this.__data__,i)>-1}function $p(i,e){var t=this.__data__,r=or(t,i);return r<0?(++this.size,t.push([i,e])):t[r][1]=e,this}function Dt(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}Dt.prototype.clear=Mp;Dt.prototype.delete=Up;Dt.prototype.get=Wp;Dt.prototype.has=Bp;Dt.prototype.set=$p;var Hp=Zn(Jn,"Map");function jp(){this.size=0,this.__data__={hash:new ot,map:new(Hp||Dt),string:new ot}}function qp(i){var e=typeof i;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?i!=="__proto__":i===null}function ar(i,e){var t=i.__data__;return qp(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Vp(i){var e=ar(this,i).delete(i);return this.size-=e?1:0,e}function Gp(i){return ar(this,i).get(i)}function Xp(i){return ar(this,i).has(i)}function Yp(i,e){var t=ar(this,i),r=t.size;return t.set(i,e),this.size+=t.size==r?0:1,this}function Ft(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}Ft.prototype.clear=jp;Ft.prototype.delete=Vp;Ft.prototype.get=Gp;Ft.prototype.has=Xp;Ft.prototype.set=Yp;function Jp(i){return i==null?"":Kn(i)}function Kp(i,e,t){var r=-1,n=i.length;e<0&&(e=-e>n?0:n+e),t=t>n?n:t,t<0&&(t+=n),n=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(n);++r<n;)s[r]=i[r+e];return s}function Zp(i,e,t){var r=i.length;return t=t===void 0?r:t,!e&&t>=r?i:Kp(i,e,t)}var Qp="\\ud800-\\udfff",ef="\\u0300-\\u036f",tf="\\ufe20-\\ufe2f",rf="\\u20d0-\\u20ff",nf=ef+tf+rf,sf="\\ufe0e\\ufe0f",of="\\u200d",af=RegExp("["+of+Qp+nf+sf+"]");function lf(i){return af.test(i)}function hf(i){return i.split("")}var Hl="\\ud800-\\udfff",cf="\\u0300-\\u036f",uf="\\ufe20-\\ufe2f",df="\\u20d0-\\u20ff",pf=cf+uf+df,ff="\\ufe0e\\ufe0f",gf="["+Hl+"]",un="["+pf+"]",dn="\\ud83c[\\udffb-\\udfff]",mf="(?:"+un+"|"+dn+")",jl="[^"+Hl+"]",ql="(?:\\ud83c[\\udde6-\\uddff]){2}",Vl="[\\ud800-\\udbff][\\udc00-\\udfff]",yf="\\u200d",Gl=mf+"?",Xl="["+ff+"]?",bf="(?:"+yf+"(?:"+[jl,ql,Vl].join("|")+")"+Xl+Gl+")*",vf=Xl+Gl+bf,wf="(?:"+[jl+un+"?",un,ql,Vl,gf].join("|")+")",Sf=RegExp(dn+"(?="+dn+")|"+wf+vf,"g");function Ef(i){return i.match(Sf)||[]}function So(i){return lf(i)?Ef(i):hf(i)}var xf="__lodash_hash_undefined__";function Tf(i){return this.__data__.set(i,xf),this}function Af(i){return this.__data__.has(i)}function Ki(i){var e=-1,t=i==null?0:i.length;for(this.__data__=new Ft;++e<t;)this.add(i[e])}Ki.prototype.add=Ki.prototype.push=Tf;Ki.prototype.has=Af;function Cf(i,e){return i.has(e)}function Pf(i){return Ul(i)&&Tp(i)}var _f=200;function Of(i,e,t,r){var n=-1,s=bp,o=!0,a=i.length,h=[],l=e.length;if(!a)return h;e.length>=_f&&(s=Cf,o=!1,e=new Ki(e));e:for(;++n<a;){var u=i[n],c=u;if(u=u!==0?u:0,o&&c===c){for(var f=l;f--;)if(e[f]===c)continue e;h.push(u)}else s(e,c,r)||h.push(u)}return h}function Rf(i,e){for(var t=i.length;t--&&Qn(e,i[t],0)>-1;);return t}function Lf(i,e){for(var t=-1,r=i.length;++t<r&&Qn(e,i[t],0)>-1;);return t}function Eo(i,e,t){if(i=Jp(i),i&&e===void 0)return Hd(i);if(!i||!(e=Kn(e)))return i;var r=So(i),n=So(e),s=Lf(r,n),o=Rf(r,n)+1;return Zp(r,s,o).join("")}var If=Sp(function(i,e){return Pf(i)?Of(i,e):[]}),Ct=function(){return Ct=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i},Ct.apply(this,arguments)},Nf="~",zf="~~";function es(i,e){for(var t={},r={},n=i.split(zf),s=!1,o=0;n.length>o;o++){for(var a=n[o].split(Nf),h=0;h<a.length;h+=2){var l=a[h],u=a[h+1],c="&"+l+";";t[c]=u,s&&(t["&"+l]=u),r[u]=c}s=!0}return e?{entities:Ct(Ct({},t),e.entities),characters:Ct(Ct({},r),e.characters)}:{entities:t,characters:r}}var xr={xml:/&(?:#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);?/g,html4:/&notin;|&(?:nbsp|iexcl|cent|pound|curren|yen|brvbar|sect|uml|copy|ordf|laquo|not|shy|reg|macr|deg|plusmn|sup2|sup3|acute|micro|para|middot|cedil|sup1|ordm|raquo|frac14|frac12|frac34|iquest|Agrave|Aacute|Acirc|Atilde|Auml|Aring|AElig|Ccedil|Egrave|Eacute|Ecirc|Euml|Igrave|Iacute|Icirc|Iuml|ETH|Ntilde|Ograve|Oacute|Ocirc|Otilde|Ouml|times|Oslash|Ugrave|Uacute|Ucirc|Uuml|Yacute|THORN|szlig|agrave|aacute|acirc|atilde|auml|aring|aelig|ccedil|egrave|eacute|ecirc|euml|igrave|iacute|icirc|iuml|eth|ntilde|ograve|oacute|ocirc|otilde|ouml|divide|oslash|ugrave|uacute|ucirc|uuml|yacute|thorn|yuml|quot|amp|lt|gt|#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);?/g,html5:/&centerdot;|&copysr;|&divideontimes;|&gtcc;|&gtcir;|&gtdot;|&gtlPar;|&gtquest;|&gtrapprox;|&gtrarr;|&gtrdot;|&gtreqless;|&gtreqqless;|&gtrless;|&gtrsim;|&ltcc;|&ltcir;|&ltdot;|&lthree;|&ltimes;|&ltlarr;|&ltquest;|&ltrPar;|&ltri;|&ltrie;|&ltrif;|&notin;|&notinE;|&notindot;|&notinva;|&notinvb;|&notinvc;|&notni;|&notniva;|&notnivb;|&notnivc;|&parallel;|&timesb;|&timesbar;|&timesd;|&(?:AElig|AMP|Aacute|Acirc|Agrave|Aring|Atilde|Auml|COPY|Ccedil|ETH|Eacute|Ecirc|Egrave|Euml|GT|Iacute|Icirc|Igrave|Iuml|LT|Ntilde|Oacute|Ocirc|Ograve|Oslash|Otilde|Ouml|QUOT|REG|THORN|Uacute|Ucirc|Ugrave|Uuml|Yacute|aacute|acirc|acute|aelig|agrave|amp|aring|atilde|auml|brvbar|ccedil|cedil|cent|copy|curren|deg|divide|eacute|ecirc|egrave|eth|euml|frac12|frac14|frac34|gt|iacute|icirc|iexcl|igrave|iquest|iuml|laquo|lt|macr|micro|middot|nbsp|not|ntilde|oacute|ocirc|ograve|ordf|ordm|oslash|otilde|ouml|para|plusmn|pound|quot|raquo|reg|sect|shy|sup1|sup2|sup3|szlig|thorn|times|uacute|ucirc|ugrave|uml|uuml|yacute|yen|yuml|#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);?/g},Nt={};Nt.xml=es(`lt~<~gt~>~quot~"~apos~'~amp~&`);Nt.html4=es(`apos~'~OElig~~oelig~~Scaron~~scaron~~Yuml~~circ~~tilde~~ensp~~emsp~~thinsp~~zwnj~~zwj~~lrm~~rlm~~ndash~~mdash~~lsquo~~rsquo~~sbquo~~ldquo~~rdquo~~bdquo~~dagger~~Dagger~~permil~~lsaquo~~rsaquo~~euro~~fnof~~Alpha~~Beta~~Gamma~~Delta~~Epsilon~~Zeta~~Eta~~Theta~~Iota~~Kappa~~Lambda~~Mu~~Nu~~Xi~~Omicron~~Pi~~Rho~~Sigma~~Tau~~Upsilon~~Phi~~Chi~~Psi~~Omega~~alpha~~beta~~gamma~~delta~~epsilon~~zeta~~eta~~theta~~iota~~kappa~~lambda~~mu~~nu~~xi~~omicron~~pi~~rho~~sigmaf~~sigma~~tau~~upsilon~~phi~~chi~~psi~~omega~~thetasym~~upsih~~piv~~bull~~hellip~~prime~~Prime~~oline~~frasl~~weierp~~image~~real~~trade~~alefsym~~larr~~uarr~~rarr~~darr~~harr~~crarr~~lArr~~uArr~~rArr~~dArr~~hArr~~forall~~part~~exist~~empty~~nabla~~isin~~notin~~ni~~prod~~sum~~minus~~lowast~~radic~~prop~~infin~~ang~~and~~or~~cap~~cup~~int~~there4~~sim~~cong~~asymp~~ne~~equiv~~le~~ge~~sub~~sup~~nsub~~sube~~supe~~oplus~~otimes~~perp~~sdot~~lceil~~rceil~~lfloor~~rfloor~~lang~~rang~~loz~~spades~~clubs~~hearts~~diams~~~nbsp~~iexcl~~cent~~pound~~curren~~yen~~brvbar~~sect~~uml~~copy~~ordf~~laquo~~not~~shy~~reg~~macr~~deg~~plusmn~~sup2~~sup3~~acute~~micro~~para~~middot~~cedil~~sup1~~ordm~~raquo~~frac14~~frac12~~frac34~~iquest~~Agrave~~Aacute~~Acirc~~Atilde~~Auml~~Aring~~AElig~~Ccedil~~Egrave~~Eacute~~Ecirc~~Euml~~Igrave~~Iacute~~Icirc~~Iuml~~ETH~~Ntilde~~Ograve~~Oacute~~Ocirc~~Otilde~~Ouml~~times~~Oslash~~Ugrave~~Uacute~~Ucirc~~Uuml~~Yacute~~THORN~~szlig~~agrave~~aacute~~acirc~~atilde~~auml~~aring~~aelig~~ccedil~~egrave~~eacute~~ecirc~~euml~~igrave~~iacute~~icirc~~iuml~~eth~~ntilde~~ograve~~oacute~~ocirc~~otilde~~ouml~~divide~~oslash~~ugrave~~uacute~~ucirc~~uuml~~yacute~~thorn~~yuml~~quot~"~amp~&~lt~<~gt~>`);Nt.html5=es('Abreve~~Acy~~Afr~~Amacr~~And~~Aogon~~Aopf~~ApplyFunction~~Ascr~~Assign~~Backslash~~Barv~~Barwed~~Bcy~~Because~~Bernoullis~~Bfr~~Bopf~~Breve~~Bscr~~Bumpeq~~CHcy~~Cacute~~Cap~~CapitalDifferentialD~~Cayleys~~Ccaron~~Ccirc~~Cconint~~Cdot~~Cedilla~~CenterDot~~Cfr~~CircleDot~~CircleMinus~~CirclePlus~~CircleTimes~~ClockwiseContourIntegral~~CloseCurlyDoubleQuote~~CloseCurlyQuote~~Colon~~Colone~~Congruent~~Conint~~ContourIntegral~~Copf~~Coproduct~~CounterClockwiseContourIntegral~~Cross~~Cscr~~Cup~~CupCap~~DD~~DDotrahd~~DJcy~~DScy~~DZcy~~Darr~~Dashv~~Dcaron~~Dcy~~Del~~Dfr~~DiacriticalAcute~~DiacriticalDot~~DiacriticalDoubleAcute~~DiacriticalGrave~`~DiacriticalTilde~~Diamond~~DifferentialD~~Dopf~~Dot~~DotDot~~DotEqual~~DoubleContourIntegral~~DoubleDot~~DoubleDownArrow~~DoubleLeftArrow~~DoubleLeftRightArrow~~DoubleLeftTee~~DoubleLongLeftArrow~~DoubleLongLeftRightArrow~~DoubleLongRightArrow~~DoubleRightArrow~~DoubleRightTee~~DoubleUpArrow~~DoubleUpDownArrow~~DoubleVerticalBar~~DownArrow~~DownArrowBar~~DownArrowUpArrow~~DownBreve~~DownLeftRightVector~~DownLeftTeeVector~~DownLeftVector~~DownLeftVectorBar~~DownRightTeeVector~~DownRightVector~~DownRightVectorBar~~DownTee~~DownTeeArrow~~Downarrow~~Dscr~~Dstrok~~ENG~~Ecaron~~Ecy~~Edot~~Efr~~Element~~Emacr~~EmptySmallSquare~~EmptyVerySmallSquare~~Eogon~~Eopf~~Equal~~EqualTilde~~Equilibrium~~Escr~~Esim~~Exists~~ExponentialE~~Fcy~~Ffr~~FilledSmallSquare~~FilledVerySmallSquare~~Fopf~~ForAll~~Fouriertrf~~Fscr~~GJcy~~Gammad~~Gbreve~~Gcedil~~Gcirc~~Gcy~~Gdot~~Gfr~~Gg~~Gopf~~GreaterEqual~~GreaterEqualLess~~GreaterFullEqual~~GreaterGreater~~GreaterLess~~GreaterSlantEqual~~GreaterTilde~~Gscr~~Gt~~HARDcy~~Hacek~~Hat~^~Hcirc~~Hfr~~HilbertSpace~~Hopf~~HorizontalLine~~Hscr~~Hstrok~~HumpDownHump~~HumpEqual~~IEcy~~IJlig~~IOcy~~Icy~~Idot~~Ifr~~Im~~Imacr~~ImaginaryI~~Implies~~Int~~Integral~~Intersection~~InvisibleComma~~InvisibleTimes~~Iogon~~Iopf~~Iscr~~Itilde~~Iukcy~~Jcirc~~Jcy~~Jfr~~Jopf~~Jscr~~Jsercy~~Jukcy~~KHcy~~KJcy~~Kcedil~~Kcy~~Kfr~~Kopf~~Kscr~~LJcy~~Lacute~~Lang~~Laplacetrf~~Larr~~Lcaron~~Lcedil~~Lcy~~LeftAngleBracket~~LeftArrow~~LeftArrowBar~~LeftArrowRightArrow~~LeftCeiling~~LeftDoubleBracket~~LeftDownTeeVector~~LeftDownVector~~LeftDownVectorBar~~LeftFloor~~LeftRightArrow~~LeftRightVector~~LeftTee~~LeftTeeArrow~~LeftTeeVector~~LeftTriangle~~LeftTriangleBar~~LeftTriangleEqual~~LeftUpDownVector~~LeftUpTeeVector~~LeftUpVector~~LeftUpVectorBar~~LeftVector~~LeftVectorBar~~Leftarrow~~Leftrightarrow~~LessEqualGreater~~LessFullEqual~~LessGreater~~LessLess~~LessSlantEqual~~LessTilde~~Lfr~~Ll~~Lleftarrow~~Lmidot~~LongLeftArrow~~LongLeftRightArrow~~LongRightArrow~~Longleftarrow~~Longleftrightarrow~~Longrightarrow~~Lopf~~LowerLeftArrow~~LowerRightArrow~~Lscr~~Lsh~~Lstrok~~Lt~~Map~~Mcy~~MediumSpace~~Mellintrf~~Mfr~~MinusPlus~~Mopf~~Mscr~~NJcy~~Nacute~~Ncaron~~Ncedil~~Ncy~~NegativeMediumSpace~~NegativeThickSpace~~NegativeThinSpace~~NegativeVeryThinSpace~~NestedGreaterGreater~~NestedLessLess~~NewLine~\n~Nfr~~NoBreak~~NonBreakingSpace~~Nopf~~Not~~NotCongruent~~NotCupCap~~NotDoubleVerticalBar~~NotElement~~NotEqual~~NotEqualTilde~~NotExists~~NotGreater~~NotGreaterEqual~~NotGreaterFullEqual~~NotGreaterGreater~~NotGreaterLess~~NotGreaterSlantEqual~~NotGreaterTilde~~NotHumpDownHump~~NotHumpEqual~~NotLeftTriangle~~NotLeftTriangleBar~~NotLeftTriangleEqual~~NotLess~~NotLessEqual~~NotLessGreater~~NotLessLess~~NotLessSlantEqual~~NotLessTilde~~NotNestedGreaterGreater~~NotNestedLessLess~~NotPrecedes~~NotPrecedesEqual~~NotPrecedesSlantEqual~~NotReverseElement~~NotRightTriangle~~NotRightTriangleBar~~NotRightTriangleEqual~~NotSquareSubset~~NotSquareSubsetEqual~~NotSquareSuperset~~NotSquareSupersetEqual~~NotSubset~~NotSubsetEqual~~NotSucceeds~~NotSucceedsEqual~~NotSucceedsSlantEqual~~NotSucceedsTilde~~NotSuperset~~NotSupersetEqual~~NotTilde~~NotTildeEqual~~NotTildeFullEqual~~NotTildeTilde~~NotVerticalBar~~Nscr~~Ocy~~Odblac~~Ofr~~Omacr~~Oopf~~OpenCurlyDoubleQuote~~OpenCurlyQuote~~Or~~Oscr~~Otimes~~OverBar~~OverBrace~~OverBracket~~OverParenthesis~~PartialD~~Pcy~~Pfr~~PlusMinus~~Poincareplane~~Popf~~Pr~~Precedes~~PrecedesEqual~~PrecedesSlantEqual~~PrecedesTilde~~Product~~Proportion~~Proportional~~Pscr~~Qfr~~Qopf~~Qscr~~RBarr~~Racute~~Rang~~Rarr~~Rarrtl~~Rcaron~~Rcedil~~Rcy~~Re~~ReverseElement~~ReverseEquilibrium~~ReverseUpEquilibrium~~Rfr~~RightAngleBracket~~RightArrow~~RightArrowBar~~RightArrowLeftArrow~~RightCeiling~~RightDoubleBracket~~RightDownTeeVector~~RightDownVector~~RightDownVectorBar~~RightFloor~~RightTee~~RightTeeArrow~~RightTeeVector~~RightTriangle~~RightTriangleBar~~RightTriangleEqual~~RightUpDownVector~~RightUpTeeVector~~RightUpVector~~RightUpVectorBar~~RightVector~~RightVectorBar~~Rightarrow~~Ropf~~RoundImplies~~Rrightarrow~~Rscr~~Rsh~~RuleDelayed~~SHCHcy~~SHcy~~SOFTcy~~Sacute~~Sc~~Scedil~~Scirc~~Scy~~Sfr~~ShortDownArrow~~ShortLeftArrow~~ShortRightArrow~~ShortUpArrow~~SmallCircle~~Sopf~~Sqrt~~Square~~SquareIntersection~~SquareSubset~~SquareSubsetEqual~~SquareSuperset~~SquareSupersetEqual~~SquareUnion~~Sscr~~Star~~Sub~~Subset~~SubsetEqual~~Succeeds~~SucceedsEqual~~SucceedsSlantEqual~~SucceedsTilde~~SuchThat~~Sum~~Sup~~Superset~~SupersetEqual~~Supset~~TRADE~~TSHcy~~TScy~~Tab~	~Tcaron~~Tcedil~~Tcy~~Tfr~~Therefore~~ThickSpace~~ThinSpace~~Tilde~~TildeEqual~~TildeFullEqual~~TildeTilde~~Topf~~TripleDot~~Tscr~~Tstrok~~Uarr~~Uarrocir~~Ubrcy~~Ubreve~~Ucy~~Udblac~~Ufr~~Umacr~~UnderBar~_~UnderBrace~~UnderBracket~~UnderParenthesis~~Union~~UnionPlus~~Uogon~~Uopf~~UpArrow~~UpArrowBar~~UpArrowDownArrow~~UpDownArrow~~UpEquilibrium~~UpTee~~UpTeeArrow~~Uparrow~~Updownarrow~~UpperLeftArrow~~UpperRightArrow~~Upsi~~Uring~~Uscr~~Utilde~~VDash~~Vbar~~Vcy~~Vdash~~Vdashl~~Vee~~Verbar~~Vert~~VerticalBar~~VerticalLine~|~VerticalSeparator~~VerticalTilde~~VeryThinSpace~~Vfr~~Vopf~~Vscr~~Vvdash~~Wcirc~~Wedge~~Wfr~~Wopf~~Wscr~~Xfr~~Xopf~~Xscr~~YAcy~~YIcy~~YUcy~~Ycirc~~Ycy~~Yfr~~Yopf~~Yscr~~ZHcy~~Zacute~~Zcaron~~Zcy~~Zdot~~ZeroWidthSpace~~Zfr~~Zopf~~Zscr~~abreve~~ac~~acE~~acd~~acy~~af~~afr~~aleph~~amacr~~amalg~~andand~~andd~~andslope~~andv~~ange~~angle~~angmsd~~angmsdaa~~angmsdab~~angmsdac~~angmsdad~~angmsdae~~angmsdaf~~angmsdag~~angmsdah~~angrt~~angrtvb~~angrtvbd~~angsph~~angst~~angzarr~~aogon~~aopf~~ap~~apE~~apacir~~ape~~apid~~approx~~approxeq~~ascr~~ast~*~asympeq~~awconint~~awint~~bNot~~backcong~~backepsilon~~backprime~~backsim~~backsimeq~~barvee~~barwed~~barwedge~~bbrk~~bbrktbrk~~bcong~~bcy~~becaus~~because~~bemptyv~~bepsi~~bernou~~beth~~between~~bfr~~bigcap~~bigcirc~~bigcup~~bigodot~~bigoplus~~bigotimes~~bigsqcup~~bigstar~~bigtriangledown~~bigtriangleup~~biguplus~~bigvee~~bigwedge~~bkarow~~blacklozenge~~blacksquare~~blacktriangle~~blacktriangledown~~blacktriangleleft~~blacktriangleright~~blank~~blk12~~blk14~~blk34~~block~~bne~=~bnequiv~~bnot~~bopf~~bot~~bottom~~bowtie~~boxDL~~boxDR~~boxDl~~boxDr~~boxH~~boxHD~~boxHU~~boxHd~~boxHu~~boxUL~~boxUR~~boxUl~~boxUr~~boxV~~boxVH~~boxVL~~boxVR~~boxVh~~boxVl~~boxVr~~boxbox~~boxdL~~boxdR~~boxdl~~boxdr~~boxh~~boxhD~~boxhU~~boxhd~~boxhu~~boxminus~~boxplus~~boxtimes~~boxuL~~boxuR~~boxul~~boxur~~boxv~~boxvH~~boxvL~~boxvR~~boxvh~~boxvl~~boxvr~~bprime~~breve~~bscr~~bsemi~~bsim~~bsime~~bsol~\\~bsolb~~bsolhsub~~bullet~~bump~~bumpE~~bumpe~~bumpeq~~cacute~~capand~~capbrcup~~capcap~~capcup~~capdot~~caps~~caret~~caron~~ccaps~~ccaron~~ccirc~~ccups~~ccupssm~~cdot~~cemptyv~~centerdot~~cfr~~chcy~~check~~checkmark~~cir~~cirE~~circeq~~circlearrowleft~~circlearrowright~~circledR~~circledS~~circledast~~circledcirc~~circleddash~~cire~~cirfnint~~cirmid~~cirscir~~clubsuit~~colon~:~colone~~coloneq~~comma~,~commat~@~comp~~compfn~~complement~~complexes~~congdot~~conint~~copf~~coprod~~copysr~~cross~~cscr~~csub~~csube~~csup~~csupe~~ctdot~~cudarrl~~cudarrr~~cuepr~~cuesc~~cularr~~cularrp~~cupbrcap~~cupcap~~cupcup~~cupdot~~cupor~~cups~~curarr~~curarrm~~curlyeqprec~~curlyeqsucc~~curlyvee~~curlywedge~~curvearrowleft~~curvearrowright~~cuvee~~cuwed~~cwconint~~cwint~~cylcty~~dHar~~daleth~~dash~~dashv~~dbkarow~~dblac~~dcaron~~dcy~~dd~~ddagger~~ddarr~~ddotseq~~demptyv~~dfisht~~dfr~~dharl~~dharr~~diam~~diamond~~diamondsuit~~die~~digamma~~disin~~div~~divideontimes~~divonx~~djcy~~dlcorn~~dlcrop~~dollar~$~dopf~~dot~~doteq~~doteqdot~~dotminus~~dotplus~~dotsquare~~doublebarwedge~~downarrow~~downdownarrows~~downharpoonleft~~downharpoonright~~drbkarow~~drcorn~~drcrop~~dscr~~dscy~~dsol~~dstrok~~dtdot~~dtri~~dtrif~~duarr~~duhar~~dwangle~~dzcy~~dzigrarr~~eDDot~~eDot~~easter~~ecaron~~ecir~~ecolon~~ecy~~edot~~ee~~efDot~~efr~~eg~~egs~~egsdot~~el~~elinters~~ell~~els~~elsdot~~emacr~~emptyset~~emptyv~~emsp13~~emsp14~~eng~~eogon~~eopf~~epar~~eparsl~~eplus~~epsi~~epsiv~~eqcirc~~eqcolon~~eqsim~~eqslantgtr~~eqslantless~~equals~=~equest~~equivDD~~eqvparsl~~erDot~~erarr~~escr~~esdot~~esim~~excl~!~expectation~~exponentiale~~fallingdotseq~~fcy~~female~~ffilig~~fflig~~ffllig~~ffr~~filig~~fjlig~fj~flat~~fllig~~fltns~~fopf~~fork~~forkv~~fpartint~~frac13~~frac15~~frac16~~frac18~~frac23~~frac25~~frac35~~frac38~~frac45~~frac56~~frac58~~frac78~~frown~~fscr~~gE~~gEl~~gacute~~gammad~~gap~~gbreve~~gcirc~~gcy~~gdot~~gel~~geq~~geqq~~geqslant~~ges~~gescc~~gesdot~~gesdoto~~gesdotol~~gesl~~gesles~~gfr~~gg~~ggg~~gimel~~gjcy~~gl~~glE~~gla~~glj~~gnE~~gnap~~gnapprox~~gne~~gneq~~gneqq~~gnsim~~gopf~~grave~`~gscr~~gsim~~gsime~~gsiml~~gtcc~~gtcir~~gtdot~~gtlPar~~gtquest~~gtrapprox~~gtrarr~~gtrdot~~gtreqless~~gtreqqless~~gtrless~~gtrsim~~gvertneqq~~gvnE~~hairsp~~half~~hamilt~~hardcy~~harrcir~~harrw~~hbar~~hcirc~~heartsuit~~hercon~~hfr~~hksearow~~hkswarow~~hoarr~~homtht~~hookleftarrow~~hookrightarrow~~hopf~~horbar~~hscr~~hslash~~hstrok~~hybull~~hyphen~~ic~~icy~~iecy~~iff~~ifr~~ii~~iiiint~~iiint~~iinfin~~iiota~~ijlig~~imacr~~imagline~~imagpart~~imath~~imof~~imped~~in~~incare~~infintie~~inodot~~intcal~~integers~~intercal~~intlarhk~~intprod~~iocy~~iogon~~iopf~~iprod~~iscr~~isinE~~isindot~~isins~~isinsv~~isinv~~it~~itilde~~iukcy~~jcirc~~jcy~~jfr~~jmath~~jopf~~jscr~~jsercy~~jukcy~~kappav~~kcedil~~kcy~~kfr~~kgreen~~khcy~~kjcy~~kopf~~kscr~~lAarr~~lAtail~~lBarr~~lE~~lEg~~lHar~~lacute~~laemptyv~~lagran~~langd~~langle~~lap~~larrb~~larrbfs~~larrfs~~larrhk~~larrlp~~larrpl~~larrsim~~larrtl~~lat~~latail~~late~~lates~~lbarr~~lbbrk~~lbrace~{~lbrack~[~lbrke~~lbrksld~~lbrkslu~~lcaron~~lcedil~~lcub~{~lcy~~ldca~~ldquor~~ldrdhar~~ldrushar~~ldsh~~leftarrow~~leftarrowtail~~leftharpoondown~~leftharpoonup~~leftleftarrows~~leftrightarrow~~leftrightarrows~~leftrightharpoons~~leftrightsquigarrow~~leftthreetimes~~leg~~leq~~leqq~~leqslant~~les~~lescc~~lesdot~~lesdoto~~lesdotor~~lesg~~lesges~~lessapprox~~lessdot~~lesseqgtr~~lesseqqgtr~~lessgtr~~lesssim~~lfisht~~lfr~~lg~~lgE~~lhard~~lharu~~lharul~~lhblk~~ljcy~~ll~~llarr~~llcorner~~llhard~~lltri~~lmidot~~lmoust~~lmoustache~~lnE~~lnap~~lnapprox~~lne~~lneq~~lneqq~~lnsim~~loang~~loarr~~lobrk~~longleftarrow~~longleftrightarrow~~longmapsto~~longrightarrow~~looparrowleft~~looparrowright~~lopar~~lopf~~loplus~~lotimes~~lowbar~_~lozenge~~lozf~~lpar~(~lparlt~~lrarr~~lrcorner~~lrhar~~lrhard~~lrtri~~lscr~~lsh~~lsim~~lsime~~lsimg~~lsqb~[~lsquor~~lstrok~~ltcc~~ltcir~~ltdot~~lthree~~ltimes~~ltlarr~~ltquest~~ltrPar~~ltri~~ltrie~~ltrif~~lurdshar~~luruhar~~lvertneqq~~lvnE~~mDDot~~male~~malt~~maltese~~map~~mapsto~~mapstodown~~mapstoleft~~mapstoup~~marker~~mcomma~~mcy~~measuredangle~~mfr~~mho~~mid~~midast~*~midcir~~minusb~~minusd~~minusdu~~mlcp~~mldr~~mnplus~~models~~mopf~~mp~~mscr~~mstpos~~multimap~~mumap~~nGg~~nGt~~nGtv~~nLeftarrow~~nLeftrightarrow~~nLl~~nLt~~nLtv~~nRightarrow~~nVDash~~nVdash~~nacute~~nang~~nap~~napE~~napid~~napos~~napprox~~natur~~natural~~naturals~~nbump~~nbumpe~~ncap~~ncaron~~ncedil~~ncong~~ncongdot~~ncup~~ncy~~neArr~~nearhk~~nearr~~nearrow~~nedot~~nequiv~~nesear~~nesim~~nexist~~nexists~~nfr~~ngE~~nge~~ngeq~~ngeqq~~ngeqslant~~nges~~ngsim~~ngt~~ngtr~~nhArr~~nharr~~nhpar~~nis~~nisd~~niv~~njcy~~nlArr~~nlE~~nlarr~~nldr~~nle~~nleftarrow~~nleftrightarrow~~nleq~~nleqq~~nleqslant~~nles~~nless~~nlsim~~nlt~~nltri~~nltrie~~nmid~~nopf~~notinE~~notindot~~notinva~~notinvb~~notinvc~~notni~~notniva~~notnivb~~notnivc~~npar~~nparallel~~nparsl~~npart~~npolint~~npr~~nprcue~~npre~~nprec~~npreceq~~nrArr~~nrarr~~nrarrc~~nrarrw~~nrightarrow~~nrtri~~nrtrie~~nsc~~nsccue~~nsce~~nscr~~nshortmid~~nshortparallel~~nsim~~nsime~~nsimeq~~nsmid~~nspar~~nsqsube~~nsqsupe~~nsubE~~nsube~~nsubset~~nsubseteq~~nsubseteqq~~nsucc~~nsucceq~~nsup~~nsupE~~nsupe~~nsupset~~nsupseteq~~nsupseteqq~~ntgl~~ntlg~~ntriangleleft~~ntrianglelefteq~~ntriangleright~~ntrianglerighteq~~num~#~numero~~numsp~~nvDash~~nvHarr~~nvap~~nvdash~~nvge~~nvgt~>~nvinfin~~nvlArr~~nvle~~nvlt~<~nvltrie~~nvrArr~~nvrtrie~~nvsim~~nwArr~~nwarhk~~nwarr~~nwarrow~~nwnear~~oS~~oast~~ocir~~ocy~~odash~~odblac~~odiv~~odot~~odsold~~ofcir~~ofr~~ogon~~ogt~~ohbar~~ohm~~oint~~olarr~~olcir~~olcross~~olt~~omacr~~omid~~ominus~~oopf~~opar~~operp~~orarr~~ord~~order~~orderof~~origof~~oror~~orslope~~orv~~oscr~~osol~~otimesas~~ovbar~~par~~parallel~~parsim~~parsl~~pcy~~percnt~%~period~.~pertenk~~pfr~~phiv~~phmmat~~phone~~pitchfork~~planck~~planckh~~plankv~~plus~+~plusacir~~plusb~~pluscir~~plusdo~~plusdu~~pluse~~plussim~~plustwo~~pm~~pointint~~popf~~pr~~prE~~prap~~prcue~~pre~~prec~~precapprox~~preccurlyeq~~preceq~~precnapprox~~precneqq~~precnsim~~precsim~~primes~~prnE~~prnap~~prnsim~~profalar~~profline~~profsurf~~propto~~prsim~~prurel~~pscr~~puncsp~~qfr~~qint~~qopf~~qprime~~qscr~~quaternions~~quatint~~quest~?~questeq~~rAarr~~rAtail~~rBarr~~rHar~~race~~racute~~raemptyv~~rangd~~range~~rangle~~rarrap~~rarrb~~rarrbfs~~rarrc~~rarrfs~~rarrhk~~rarrlp~~rarrpl~~rarrsim~~rarrtl~~rarrw~~ratail~~ratio~~rationals~~rbarr~~rbbrk~~rbrace~}~rbrack~]~rbrke~~rbrksld~~rbrkslu~~rcaron~~rcedil~~rcub~}~rcy~~rdca~~rdldhar~~rdquor~~rdsh~~realine~~realpart~~reals~~rect~~rfisht~~rfr~~rhard~~rharu~~rharul~~rhov~~rightarrow~~rightarrowtail~~rightharpoondown~~rightharpoonup~~rightleftarrows~~rightleftharpoons~~rightrightarrows~~rightsquigarrow~~rightthreetimes~~ring~~risingdotseq~~rlarr~~rlhar~~rmoust~~rmoustache~~rnmid~~roang~~roarr~~robrk~~ropar~~ropf~~roplus~~rotimes~~rpar~)~rpargt~~rppolint~~rrarr~~rscr~~rsh~~rsqb~]~rsquor~~rthree~~rtimes~~rtri~~rtrie~~rtrif~~rtriltri~~ruluhar~~rx~~sacute~~sc~~scE~~scap~~sccue~~sce~~scedil~~scirc~~scnE~~scnap~~scnsim~~scpolint~~scsim~~scy~~sdotb~~sdote~~seArr~~searhk~~searr~~searrow~~semi~;~seswar~~setminus~~setmn~~sext~~sfr~~sfrown~~sharp~~shchcy~~shcy~~shortmid~~shortparallel~~sigmav~~simdot~~sime~~simeq~~simg~~simgE~~siml~~simlE~~simne~~simplus~~simrarr~~slarr~~smallsetminus~~smashp~~smeparsl~~smid~~smile~~smt~~smte~~smtes~~softcy~~sol~/~solb~~solbar~~sopf~~spadesuit~~spar~~sqcap~~sqcaps~~sqcup~~sqcups~~sqsub~~sqsube~~sqsubset~~sqsubseteq~~sqsup~~sqsupe~~sqsupset~~sqsupseteq~~squ~~square~~squarf~~squf~~srarr~~sscr~~ssetmn~~ssmile~~sstarf~~star~~starf~~straightepsilon~~straightphi~~strns~~subE~~subdot~~subedot~~submult~~subnE~~subne~~subplus~~subrarr~~subset~~subseteq~~subseteqq~~subsetneq~~subsetneqq~~subsim~~subsub~~subsup~~succ~~succapprox~~succcurlyeq~~succeq~~succnapprox~~succneqq~~succnsim~~succsim~~sung~~supE~~supdot~~supdsub~~supedot~~suphsol~~suphsub~~suplarr~~supmult~~supnE~~supne~~supplus~~supset~~supseteq~~supseteqq~~supsetneq~~supsetneqq~~supsim~~supsub~~supsup~~swArr~~swarhk~~swarr~~swarrow~~swnwar~~target~~tbrk~~tcaron~~tcedil~~tcy~~tdot~~telrec~~tfr~~therefore~~thetav~~thickapprox~~thicksim~~thkap~~thksim~~timesb~~timesbar~~timesd~~tint~~toea~~top~~topbot~~topcir~~topf~~topfork~~tosa~~tprime~~triangle~~triangledown~~triangleleft~~trianglelefteq~~triangleq~~triangleright~~trianglerighteq~~tridot~~trie~~triminus~~triplus~~trisb~~tritime~~trpezium~~tscr~~tscy~~tshcy~~tstrok~~twixt~~twoheadleftarrow~~twoheadrightarrow~~uHar~~ubrcy~~ubreve~~ucy~~udarr~~udblac~~udhar~~ufisht~~ufr~~uharl~~uharr~~uhblk~~ulcorn~~ulcorner~~ulcrop~~ultri~~umacr~~uogon~~uopf~~uparrow~~updownarrow~~upharpoonleft~~upharpoonright~~uplus~~upsi~~upuparrows~~urcorn~~urcorner~~urcrop~~uring~~urtri~~uscr~~utdot~~utilde~~utri~~utrif~~uuarr~~uwangle~~vArr~~vBar~~vBarv~~vDash~~vangrt~~varepsilon~~varkappa~~varnothing~~varphi~~varpi~~varpropto~~varr~~varrho~~varsigma~~varsubsetneq~~varsubsetneqq~~varsupsetneq~~varsupsetneqq~~vartheta~~vartriangleleft~~vartriangleright~~vcy~~vdash~~vee~~veebar~~veeeq~~vellip~~verbar~|~vert~|~vfr~~vltri~~vnsub~~vnsup~~vopf~~vprop~~vrtri~~vscr~~vsubnE~~vsubne~~vsupnE~~vsupne~~vzigzag~~wcirc~~wedbar~~wedge~~wedgeq~~wfr~~wopf~~wp~~wr~~wreath~~wscr~~xcap~~xcirc~~xcup~~xdtri~~xfr~~xhArr~~xharr~~xlArr~~xlarr~~xmap~~xnis~~xodot~~xopf~~xoplus~~xotime~~xrArr~~xrarr~~xscr~~xsqcup~~xuplus~~xutri~~xvee~~xwedge~~yacy~~ycirc~~ycy~~yfr~~yicy~~yopf~~yscr~~yucy~~zacute~~zcaron~~zcy~~zdot~~zeetrf~~zfr~~zhcy~~zigrarr~~zopf~~zscr~~~AMP~&~COPY~~GT~>~LT~<~QUOT~"~REG~',Nt.html4);var kf={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376},Mf=String.fromCodePoint||function(i){return String.fromCharCode(Math.floor((i-65536)/1024)+55296,(i-65536)%1024+56320)},zt=function(){return zt=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i},zt.apply(this,arguments)},Df=zt(zt({},Nt),{all:Nt.html5}),Ff={scope:"body",level:"all"},Tr=/&(?:#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+);/g,Ar=/&(?:#\d+|#[xX][\da-fA-F]+|[0-9a-zA-Z]+)[;=]?/g,xo={xml:{strict:Tr,attribute:Ar,body:xr.xml},html4:{strict:Tr,attribute:Ar,body:xr.html4},html5:{strict:Tr,attribute:Ar,body:xr.html5}},Uf=zt(zt({},xo),{all:xo.html5}),Yl=String.fromCharCode,Wf=Yl(65533);function Bf(i,e,t,r){var n=i,s=i[i.length-1];if(t&&s==="=")n=i;else if(r&&s!==";")n=i;else{var o=e[i];if(o)n=o;else if(i[0]==="&"&&i[1]==="#"){var a=i[2],h=a=="x"||a=="X"?parseInt(i.substr(3),16):parseInt(i.substr(2));n=h>=1114111?Wf:h>65535?Mf(h):Yl(kf[h]||h)}}return n}function To(i,e){var t=e===void 0?Ff:e,r=t.level,n=r===void 0?"all":r,s=t.scope,o=s===void 0?n==="xml"?"strict":"body":s;if(!i)return"";var a=Uf[n][o],h=Df[n].entities,l=o==="attribute",u=o==="strict";return i.replace(a,function(c){return Bf(c,h,l,u)})}/**
 * @name ranges-sort
 * @fileoverview Sort string index ranges
 * @version 6.1.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/ranges-sort/}
 */var $f={strictlyTwoElementsInRangeArrays:!1,progressFn:null};function Zi(i,e){if(!Array.isArray(i)||!i.length)return i;let t={...$f,...e},r,n;if(t.strictlyTwoElementsInRangeArrays&&!i.every((a,h)=>!Array.isArray(a)||a.length!==2?(r=h,n=a.length,!1):!0))throw new TypeError(`ranges-sort: [THROW_ID_03] The first argument should be an array and must consist of arrays which are natural number indexes representing TWO string index ranges. However, ${r}th range (${JSON.stringify(i[r],null,4)}) has not two but ${n} elements!`);if(!i.every((a,h)=>!Array.isArray(a)||!Number.isInteger(a[0])||a[0]<0||!Number.isInteger(a[1])||a[1]<0?(r=h,!1):!0))throw new TypeError(`ranges-sort: [THROW_ID_04] The first argument should be an array and must consist of arrays which are natural number indexes representing string index ranges. However, ${r}th range (${JSON.stringify(i[r],null,4)}) does not consist of only natural numbers!`);let s=i.length**2,o=0;return Array.from(i).sort((a,h)=>(t.progressFn&&(o+=1,t.progressFn(Math.floor(o*100/s))),a[0]===h[0]?a[1]<h[1]?-1:a[1]>h[1]?1:0:a[0]<h[0]?-1:1))}/**
 * @name ranges-merge
 * @fileoverview Merge and sort string index ranges
 * @version 9.1.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/ranges-merge/}
 */var Ao={mergeType:1,progressFn:null,joinRangesThatTouchEdges:!0};function Hf(i,e){function t(l){return!!l&&typeof l=="object"&&!Array.isArray(l)}if(!Array.isArray(i)||!i.length)return null;let r;if(e)if(t(e)){if(r={...Ao,...e},r.progressFn&&t(r.progressFn)&&!Object.keys(r.progressFn).length)r.progressFn=null;else if(r.progressFn&&typeof r.progressFn!="function")throw new Error(`ranges-merge: [THROW_ID_01] opts.progressFn must be a function! It was given of a type: "${typeof r.progressFn}", equal to ${JSON.stringify(r.progressFn,null,4)}`);if(![1,2,"1","2"].includes(r.mergeType))throw new Error(`ranges-merge: [THROW_ID_02] opts.mergeType was customised to a wrong thing! It was given of a type: "${typeof r.mergeType}", equal to ${JSON.stringify(r.mergeType,null,4)}`);if(typeof r.joinRangesThatTouchEdges!="boolean")throw new Error(`ranges-merge: [THROW_ID_04] opts.joinRangesThatTouchEdges was customised to a wrong thing! It was given of a type: "${typeof r.joinRangesThatTouchEdges}", equal to ${JSON.stringify(r.joinRangesThatTouchEdges,null,4)}`)}else throw new Error(`emlint: [THROW_ID_03] the second input argument must be a plain object. It was given as:
${JSON.stringify(e,null,4)} (type ${typeof e})`);else r={...Ao};let n=i.filter(l=>Array.isArray(l)).map(l=>[...l]).filter(l=>l[2]!==void 0||l[0]!==l[1]),s,o,a;r.progressFn?s=Zi(n,{progressFn:l=>{a=Math.floor(l/5),a!==o&&(o=a,r.progressFn(a))}}):s=Zi(n);let h=s.length-1;for(let l=h;l>0;l--)r.progressFn&&(a=Math.floor((1-l/h)*78)+21,a!==o&&a>o&&(o=a,r.progressFn(a))),(s[l][0]<=s[l-1][0]||!r.joinRangesThatTouchEdges&&s[l][0]<s[l-1][1]||r.joinRangesThatTouchEdges&&s[l][0]<=s[l-1][1])&&(s[l-1][0]=Math.min(s[l][0],s[l-1][0]),s[l-1][1]=Math.max(s[l][1],s[l-1][1]),s[l][2]!==void 0&&(s[l-1][0]>=s[l][0]||s[l-1][1]<=s[l][1])&&s[l-1][2]!==null&&(s[l][2]===null&&s[l-1][2]!==null?s[l-1][2]=null:s[l-1][2]!=null?+r.mergeType==2&&s[l-1][0]===s[l][0]?s[l-1][2]=s[l][2]:s[l-1][2]+=s[l][2]:s[l-1][2]=s[l][2]),s.splice(l,1),l=s.length);return s.length?s:null}var jf="Invariant failed";function qf(i,e){if(!i)throw new Error(jf)}/**
 * @name ranges-apply
 * @fileoverview Take an array of string index ranges, delete/replace the string according to them
 * @version 7.1.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/ranges-apply/}
 */function Vf(i,e,t){if(arguments.length===0)throw new Error("ranges-apply: [THROW_ID_01] inputs missing!");if(typeof i!="string")throw new TypeError(`ranges-apply: [THROW_ID_02] first input argument must be a string! Currently it's: ${typeof i}, equal to: ${JSON.stringify(i,null,4)}`);if(e&&!Array.isArray(e))throw new TypeError(`ranges-apply: [THROW_ID_03] second input argument must be an array (or null)! Currently it's: ${typeof e}, equal to: ${JSON.stringify(e,null,4)}`);if(!e?.filter(o=>o).length)return i;let r;Array.isArray(e)&&Number.isInteger(e[0])&&Number.isInteger(e[1])?r=[Array.from(e)]:r=Array.from(e),r.length,r.filter(o=>o).forEach((o,a)=>{if(!Array.isArray(o))throw new TypeError(`ranges-apply: [THROW_ID_05] ranges array, second input arg., has ${a}th element not an array: ${JSON.stringify(o,null,4)}, which is ${typeof o}`);if(!Number.isInteger(o[0])){if(!Number.isInteger(+o[0])||+o[0]<0)throw new TypeError(`ranges-apply: [THROW_ID_06] ranges array, second input arg. has ${a}th element, array ${JSON.stringify(o,null,0)}. Its first element is not an integer, string index, but ${typeof o[0]}, equal to: ${JSON.stringify(o[0],null,4)}.`);r[a][0]=+r[a][0]}if(!Number.isInteger(o[1])){if(!Number.isInteger(+o[1])||+o[1]<0)throw new TypeError(`ranges-apply: [THROW_ID_07] ranges array, second input arg. has ${a}th element, array ${JSON.stringify(o,null,0)}. Its second element is not an integer, string index, but ${typeof o[1]}, equal to: ${JSON.stringify(o[1],null,4)}.`);r[a][1]=+r[a][1]}});let n=Hf(r,{progressFn:o=>{}});qf(n);let s=n.length;if(s>0){let o=i.slice(n[s-1][1]);i=n.reduce((a,h,l,u)=>{let c=l===0?0:u[l-1][1],f=u[l][0];return`${a}${i.slice(c,f)}${u[l][2]||""}`},""),i+=o}return i}/**
 * @name string-collapse-leading-whitespace
 * @fileoverview Collapse the leading and trailing whitespace of a string
 * @version 7.1.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/string-collapse-leading-whitespace/}
 */function Cr(i,e=1){let t="";function r(s){return Array.from(s).reverse().join("")}function n(s,o,a){let h=a?`
`:"\r",l=a?"\r":`
`;if(!s)return s;let u=0,c="";for(let f=0,g=s.length;f<g;f++)(s[f]===h||s[f]===l&&s[f-1]!==h)&&u++,`\r
`.includes(s[f])||s[f]===t?s[f]===t?c+=s[f]:s[f]===h?u<=o&&(c+=s[f],s[f+1]===l&&(c+=s[f+1],f++)):s[f]===l&&s?.[f-1]!==h&&u<=o&&(c+=s[f]):!s[f+1]&&!u&&(c+=" ");return c}if(typeof i=="string"&&i.length){let s=1;typeof+e=="number"&&Number.isInteger(+e)&&+e>=0&&(s=+e);let o="",a="";if(!i.trim())o=i;else if(!i[0].trim()){for(let h=0,l=i.length;h<l;h++)if(i[h].trim()){o=i.slice(0,h);break}}if(i.trim()&&(i.slice(-1).trim()===""||i.slice(-1)===t)){for(let h=i.length;h--;)if(i[h].trim()){a=i.slice(h+1);break}}return`${n(o,s,!1)}${i.trim()}${r(n(r(a),s,!0))}`}return i}/**
 * @name ranges-push
 * @fileoverview Gather string index ranges
 * @version 7.1.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/ranges-push/}
 */var Co={mergeType:1,progressFn:null,joinRangesThatTouchEdges:!0};function Gf(i,e){function t(l){return!!l&&typeof l=="object"&&!Array.isArray(l)}if(!Array.isArray(i)||!i.length)return null;let r;if(e)if(t(e)){if(r={...Co,...e},r.progressFn&&t(r.progressFn)&&!Object.keys(r.progressFn).length)r.progressFn=null;else if(r.progressFn&&typeof r.progressFn!="function")throw new Error(`ranges-merge: [THROW_ID_01] resolvedOpts.progressFn must be a function! It was given of a type: "${typeof r.progressFn}", equal to ${JSON.stringify(r.progressFn,null,4)}`);if(![1,2,"1","2"].includes(r.mergeType))throw new Error(`ranges-merge: [THROW_ID_02] resolvedOpts.mergeType was customised to a wrong thing! It was given of a type: "${typeof r.mergeType}", equal to ${JSON.stringify(r.mergeType,null,4)}`);if(typeof r.joinRangesThatTouchEdges!="boolean")throw new Error(`ranges-merge: [THROW_ID_04] resolvedOpts.joinRangesThatTouchEdges was customised to a wrong thing! It was given of a type: "${typeof r.joinRangesThatTouchEdges}", equal to ${JSON.stringify(r.joinRangesThatTouchEdges,null,4)}`)}else throw new Error(`ranges-merge: [THROW_ID_03] the second input argument must be a plain object. It was given as:
${JSON.stringify(e,null,4)} (type ${typeof e})`);else r={...Co};let n=i.filter(l=>Array.isArray(l)).map(l=>[...l]).filter(l=>l[2]!==void 0||l[0]!==l[1]),s,o,a;r.progressFn?s=Zi(n,{progressFn:l=>{a=Math.floor(l/5),a!==o&&(o=a,r.progressFn!=null&&r.progressFn(a))}}):s=Zi(n);let h=s.length-1;for(let l=h;l>0;l--)r.progressFn&&(a=Math.floor((1-l/h)*78)+21,a!==o&&a>o&&(o=a,r.progressFn(a))),(s[l][0]<=s[l-1][0]||!r.joinRangesThatTouchEdges&&s[l][0]<s[l-1][1]||r.joinRangesThatTouchEdges&&s[l][0]<=s[l-1][1])&&(s[l-1][0]=Math.min(s[l][0],s[l-1][0]),s[l-1][1]=Math.max(s[l][1],s[l-1][1]),s[l][2]!==void 0&&(s[l-1][0]>=s[l][0]||s[l-1][1]<=s[l][1])&&s[l-1][2]!==null&&(s[l][2]===null&&s[l-1][2]!==null?s[l-1][2]=null:s[l-1][2]!=null?+(r||{})?.mergeType==2&&s[l-1][0]===s[l][0]?s[l-1][2]=s[l][2]:s[l-1][2]+=s[l][2]:s[l-1][2]=s[l][2]),s.splice(l,1),l=s.length);return s.length?s:null}var Xf={limitToBeAddedWhitespace:!1,limitLinebreaksCount:1,mergeType:1},Yf=class{constructor(i){let e={...Xf,...i};if(e.mergeType&&e.mergeType!==1&&e.mergeType!==2)if(Tt(e.mergeType)&&e.mergeType.trim()==="1")e.mergeType=1;else if(Tt(e.mergeType)&&e.mergeType.trim()==="2")e.mergeType=2;else throw new Error(`ranges-push: [THROW_ID_02] opts.mergeType was customised to a wrong thing! It was given of a type: "${typeof e.mergeType}", equal to ${JSON.stringify(e.mergeType,null,4)}`);this.opts=e,this.ranges=[]}ranges;opts;add(i,e,t){if(i==null&&e==null)return;if(Ve(i)&&!Ve(e)){if(Array.isArray(i)){if(i.length){if(i.some(s=>Array.isArray(s))){i.forEach(s=>{Array.isArray(s)&&this.add(...s)});return}i.length&&pt(+i[0])&&pt(+i[1])&&this.add(...i)}return}throw new TypeError(`ranges-push/Ranges/add(): [THROW_ID_12] the first input argument, "from" is set (${JSON.stringify(i,null,0)}) but second-one, "to" is not (${JSON.stringify(e,null,0)})`)}else if(!Ve(i)&&Ve(e))throw new TypeError(`ranges-push/Ranges/add(): [THROW_ID_13] the second input argument, "to" is set (${JSON.stringify(e,null,0)}) but first-one, "from" is not (${JSON.stringify(i,null,0)})`);let r=+i,n=+e;if(pt(r)&&pt(n)){if(Ve(t)&&!Tt(t)&&!Td(t))throw new TypeError(`ranges-push/Ranges/add(): [THROW_ID_08] The third argument, the value to add, was given not as string but ${typeof t}, equal to:
${JSON.stringify(t,null,4)}`);if(Ve(this.ranges)&&Array.isArray(this.last())&&r===this.last()[1]){if(this.last()[1]=n,this.last()[2],this.last()[2]!==null&&Ve(t)){let s=this.last()[2]&&this.last()[2].length&&(!this.opts?.mergeType||this.opts.mergeType===1)?`${this.last()[2]}${t}`:t;this.opts.limitToBeAddedWhitespace&&(s=Cr(s,this.opts.limitLinebreaksCount)),Tt(s)&&!s.length||(this.last()[2]=s)}}else{this.ranges||(this.ranges=[]);let s=t!==void 0&&!(Tt(t)&&!t.length)?[r,n,t&&this.opts.limitToBeAddedWhitespace?Cr(t,this.opts.limitLinebreaksCount):t]:[r,n];this.ranges.push(s)}}else throw pt(r)&&r>=0?new TypeError(`ranges-push/Ranges/add(): [THROW_ID_10] "to" value, the second input argument, must be a natural number or zero! Currently it's of a type "${typeof n}" equal to: ${JSON.stringify(n,null,4)}`):new TypeError(`ranges-push/Ranges/add(): [THROW_ID_09] "from" value, the first input argument, must be a natural number or zero! Currently it's of a type "${typeof r}" equal to: ${JSON.stringify(r,null,4)}`)}push(i,e,t){this.add(i,e,t)}current(){return Array.isArray(this.ranges)&&this.ranges.length?(this.ranges=Gf(this.ranges,{mergeType:this.opts.mergeType}),this.ranges&&this.opts.limitToBeAddedWhitespace?this.ranges.map(i=>Ve(i[2])?[i[0],i[1],Cr(i[2],this.opts.limitLinebreaksCount)]:i):this.ranges):null}wipe(){this.ranges=[]}replace(i){if(Array.isArray(i)&&i.length)if(Array.isArray(i[0])&&pt(i[0][0]))this.ranges=Array.from(i);else throw new Error(`ranges-push/Ranges/replace(): [THROW_ID_11] Single range was given but we expected array of arrays! The first element, ${JSON.stringify(i[0],null,4)} should be an array and its first element should be an integer, a string index.`);else this.ranges=[]}last(){return Array.isArray(this.ranges)&&this.ranges.length?this.ranges[this.ranges.length-1]:null}};/**
 * @name string-left-right
 * @fileoverview Looks up the first non-whitespace character to the left/right of a given index
 * @version 6.1.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/string-left-right/}
 */Ml();var Pr="";function Jf({str:i,idx:e=0,stopAtNewlines:t=!1,stopAtRawNbsp:r=!1}){if(typeof i!="string"||!i.length||((!e||typeof e!="number")&&(e=0),!i[e+1]))return null;if(i[e+1]&&(i[e+1].trim()||t&&`
\r`.includes(i[e+1])||r&&i[e+1]===Pr))return e+1;if(i[e+2]&&(i[e+2].trim()||t&&`
\r`.includes(i[e+2])||r&&i[e+2]===Pr))return e+2;for(let n=e+1,s=i.length;n<s;n++)if(i[n].trim()||t&&`
\r`.includes(i[n])||r&&i[n]===Pr)return n;return null}function Le(i,e=0){return Jf({str:i,idx:e,stopAtNewlines:!1,stopAtRawNbsp:!1})}/**
 * @name string-strip-html
 * @fileoverview Strip HTML tags from strings. No parser, accepts mixed sources.
 * @version 13.5.0
 * @author Roy Revelt
 * @license MIT
 * {@link https://codsen.com/os/string-strip-html/}
 */function Kf(i){return/[-_A-Za-z0-9]/.test(i)}function Po(i,e){if(!i)return[];if(Array.isArray(i))return i.filter(t=>typeof t=="string"&&t.trim());if(typeof i=="string")return i.trim()?[i]:[];throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_05] ${e} must be array containing zero or more strings or something falsey. Currently it's equal to: ${i}, that a type of ${typeof i}.`)}function fi(i,e,t,r){for(let n=e,s=i.length;n<s;n++){if(i.startsWith(t,n))return!0;if(i.startsWith(r,n))return!1}return!1}function _o(i,e,t){return i?.quotes,i?.quotes?.value&&fi(e,t+1,i.quotes.value,">"),i?.quotes?.next,fi(e,i?.quotes?.next-1,i?.quotes?.value,">"),!i?.quotes||!fi(e,t+1,i.quotes.value,">")&&i?.quotes?.next!==-1&&fi(e,i?.quotes?.next-1,i?.quotes?.value,">")}function Zf(i,e){return(e.match(new RegExp(i,"g"))||[]).length}var Bt=new Set(["!doctype","abbr","address","area","article","aside","audio","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","param","picture","pre","progress","rb","rp","rt","rtc","ruby","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","ul","var","video","wbr","xml"]),_r=new Set(["a","b","i","p","q","s","u"]),Or=new Set([".",",",";","!","?"]),Oo=new Set([".",",","?",";",")","",'"',""]),Qf=new Set(["a","abbr","acronym","audio","b","bdi","bdo","big","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","iframe","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"]),Ro={ignoreTags:[],ignoreTagsWithTheirContents:[],onlyStripTags:[],stripTogetherWithTheirContents:["script","style","xml"],skipHtmlDecoding:!1,trimOnlySpaces:!1,stripRecognisedHTMLOnly:!1,dumpLinkHrefsNearby:{enabled:!1,putOnNewLine:!1,wrapHeads:"",wrapTails:""},ignoreIndentations:!1,cb:null,reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100};function Jl(i,e){let t=Date.now(),r=[],n=[],s=[],o=[],a={};function h(){a={attributes:[]}}h();let l=null,u=null,c=null,f=!1,g={},d={tagName:"",hrefValue:"",openingTagEnds:void 0},m="",y=!1,x=null,R=!0;function L(p,A,P){if(Array.isArray(A.stripTogetherWithTheirContents)&&(A.stripTogetherWithTheirContents.includes(a.name)||A.stripTogetherWithTheirContents.includes("*")))if(a.slashPresent&&Array.isArray(r)&&r.some(C=>C.name===a.name)){for(let C=r.length;C--;)if(r[C].name===a.name){o=o.filter(([z,X])=>(z<r[C].lastOpeningBracketAt||z>=p+1)&&(X<=r[C].lastOpeningBracketAt||X>p+1));let k=p+1;a.lastClosingBracketAt&&(k=a.lastClosingBracketAt+1),o.push([r[C].lastOpeningBracketAt,k]),Oo.has(i[p])&&A.cb?A.cb({tag:a,deleteFrom:r[C].lastOpeningBracketAt,deleteTo:p+1,insert:null,rangesArr:P,proposedReturn:[r[C].lastOpeningBracketAt,p,null]}):A.cb&&A.cb({tag:a,deleteFrom:r[C].lastOpeningBracketAt,deleteTo:p,insert:"",rangesArr:P,proposedReturn:[r[C].lastOpeningBracketAt,p,""]}),r.splice(C,1);break}}else a.slashPresent||r.push(a);else Array.isArray(A.ignoreTagsWithTheirContents)&&q(p,A,a)&&(R=!1)}function I(p,A,P,C,k,z){if(Array.isArray(N.current())&&typeof P=="number"&&N.current()[0][0]===0&&N.current()[0][1]>=P)return"";if(i.length===C&&z&&!E?.dumpLinkHrefsNearby?.enabled)return null;let X="";if(Number.isInteger(P)&&P<k&&(X+=p.slice(P,k)),Number.isInteger(C)&&C>z+1){let Me=p.slice(z+1,C);C&&!Le(i,C-1)&&(Me=Me.trimEnd()),Me.includes(`
`)&&H(C,p)?X+=" ":X+=Me}let ut=!Oo.has(p[A]),os=p[C-1]!==">"||!p[P].trim(),as=!['"',"("].includes(p[k-1]),ch=![";",".",":","!"].includes(p[A]);if((ut||os&&as&&ch)&&(os||as)&&p[A]!=="!"&&(!Qf.has(a.name)||typeof P=="number"&&P<k||typeof C=="number"&&C>z+1)){let Me=X.match(/\n/g);return Array.isArray(Me)&&Me.length?Me.length===1?`
`:Me.length===2?`

`:`


`:" "}return""}function W(p,A){if(p.dumpLinkHrefsNearby?.enabled&&d.tagName&&d.tagName===a.name&&a.lastOpeningBracketAt&&(d.openingTagEnds&&a.lastOpeningBracketAt>d.openingTagEnds||!d.openingTagEnds)&&(y=!0),y){let P=p.dumpLinkHrefsNearby?.putOnNewLine?`

`:"";m=`${P}${d.hrefValue}`,(typeof A!="number"||Le(i,A-1))&&(m+=P)}}function H(p,A){return A?A[p]==="<"&&A[p+1]!=="%":i[p]==="<"&&i[p+1]!=="%"}function F(p){return i[p]===">"&&i[p-1]!=="%"}function q(p,A,P){if(A.ignoreTagsWithTheirContents.includes("*"))return!0;let C=i.indexOf(`<${P.name}`,p),k=i.indexOf(`</${P.name}`,p);return!P.slashPresent&&k===-1||P.slashPresent&&!n.some(z=>z.name===P.name)||k>-1&&C>-1&&C<k?!1:A.ignoreTagsWithTheirContents.includes(P.name)}if(typeof i!="string")throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_01] Input must be string! Currently it's: ${(typeof i).toLowerCase()}, equal to:
${JSON.stringify(i,null,4)}`);if(e)if(cn(e)){if(e.reportProgressFunc&&typeof e.reportProgressFunc!="function")throw new Error(`string-strip-html/stripHtml(): [THROW_ID_03] The Optional Options Object's key reportProgressFunc, callback function, should be a function but it was given as type ${typeof e.reportProgressFunc}, equal to ${JSON.stringify(e.reportProgressFunc,null,4)}`);if(typeof e.dumpLinkHrefsNearby=="boolean"&&e.dumpLinkHrefsNearby!=null)throw new Error(`string-strip-html/stripHtml(): [THROW_ID_04] The Optional Options Object's key should be a plain object but it was given as type ${typeof e.dumpLinkHrefsNearby}, equal to ${JSON.stringify(e.dumpLinkHrefsNearby,null,4)}`)}else throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_02] Optional Options Object must be a plain object! Currently it's: ${(typeof e).toLowerCase()}, equal to:
${JSON.stringify(e,null,4)}`);function qe(){y&&(d={tagName:"",hrefValue:"",openingTagEnds:void 0},y=!1)}let E={...Ro,...e,dumpLinkHrefsNearby:Object.assign({},Ro.dumpLinkHrefsNearby,e?.dumpLinkHrefsNearby)};if(Ad(E,"returnRangesOnly"))throw new TypeError("string-strip-html/stripHtml(): [THROW_ID_05] The Optional Options Object's key returnRangesOnly has been removed from the API since v.5 release.");if(E.reportProgressFunc){if(typeof E.reportProgressFuncFrom!="number")throw new Error(`string-strip-html/stripHtml(): [THROW_ID_06] The Optional Options Object's key reportProgressFuncFrom, callback function's "from" range, should be a number but it was given as type ${typeof E.reportProgressFuncFrom}, equal to ${JSON.stringify(E.reportProgressFuncFrom,null,4)}`);if(typeof E.reportProgressFuncTo!="number")throw new Error(`string-strip-html/stripHtml(): [THROW_ID_07] The Optional Options Object's key reportProgressFuncTo, callback function's "to" range, should be a number but it was given as type ${typeof E.reportProgressFuncTo}, equal to ${JSON.stringify(E.reportProgressFuncTo,null,4)}`)}E.ignoreTags=Po(E.ignoreTags,"resolvedOpts.ignoreTags"),E.onlyStripTags=Po(E.onlyStripTags,"resolvedOpts.onlyStripTags");let ht=!!E.onlyStripTags.length;E.onlyStripTags.length&&E.ignoreTags.length&&(E.onlyStripTags=If(E.onlyStripTags,...E.ignoreTags)),E.stripTogetherWithTheirContents?typeof E.stripTogetherWithTheirContents=="string"&&E.stripTogetherWithTheirContents.length&&(E.stripTogetherWithTheirContents=[E.stripTogetherWithTheirContents]):E.stripTogetherWithTheirContents=[];let Ke={};if(E.stripTogetherWithTheirContents&&Array.isArray(E.stripTogetherWithTheirContents)&&E.stripTogetherWithTheirContents.length&&!E.stripTogetherWithTheirContents.every((p,A)=>typeof p!="string"?(Ke.el=p,Ke.i=A,!1):!0))throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_08] Optional Options Object's key stripTogetherWithTheirContents was set to contain not just string elements! For example, element at index ${Ke.i} has a value ${Ke.el} which is not string but ${(typeof Ke.el).toLowerCase()}.`);E.cb||(E.cb=({rangesArr:p,proposedReturn:A})=>{A&&p.push(...A)});let N=new Yf({limitToBeAddedWhitespace:!0,limitLinebreaksCount:2});if(!E.skipHtmlDecoding)for(;i!==To(i,{scope:"strict"});)i=To(i,{scope:"strict"});let ke=!1,Oe=!1,ct=0,hi=0,Z=i.length,ur=Math.floor(Z/2);for(let p=0;p<Z;p++){if(E.reportProgressFunc&&(Z>1e3&&Z<2e3?p===ur&&E.reportProgressFunc(Math.floor((E.reportProgressFuncTo-E.reportProgressFuncFrom)/2)):Z>=2e3&&(ct=E.reportProgressFuncFrom+Math.floor(p/Z*(E.reportProgressFuncTo-E.reportProgressFuncFrom)),ct!==hi&&(hi=ct,E.reportProgressFunc(ct)))),Object.keys(a).length>1&&a.lastClosingBracketAt&&a.lastClosingBracketAt<p&&i[p]!==" "&&x===null&&(x=p),!ke&&i[p]==="%"&&i[p-1]==="{"&&i.includes("%}",p+1)){c=null;let A=i.indexOf("%}",p)-1;if(A>p){p=A;continue}}if(!ke&&F(p)&&(!a||Object.keys(a).length<2)&&p>1){for(let A=p;A--;)if(i[A-1]===void 0||F(A)){let P=i[A-1]===void 0?A:A+1,C=i.slice(P,p+1)||"";if((C.includes("/>")||C.includes("/ >")||C.includes('="')||C.includes("='"))&&i!==`<${Eo(C.trim(),"/>")}>`&&[...Bt].some(k=>Eo(C.trim().split(/\s+/).filter(z=>z.trim()).filter((z,X)=>X===0),"/>").toLowerCase()===k)&&Jl(`<${C.trim()}>`,E).result===""){(!s.length||s[s.length-1][0]!==a.lastOpeningBracketAt)&&s.push([P,p+1]),(!o.length||o[o.length-1][0]!==a.lastOpeningBracketAt)&&o.push([P,p+1]);let k=I(i,p,P,p+1,P,p+1),z=p+1;if(i[z]&&!i[z].trim()){for(let X=z;X<Z;X++)if(i[X].trim()){z=X;break}}E.cb({tag:a,deleteFrom:P,deleteTo:z,insert:k,rangesArr:N,proposedReturn:[P,z,k]})}break}}if(!Oe&&i[p]==="/"&&!a.quotes?.value&&Number.isInteger(a.lastOpeningBracketAt)&&!Number.isInteger(a.lastClosingBracketAt)&&(a.slashPresent=p),i[p]==='"'||i[p]==="'")if(!Oe&&a.nameStarts&&a?.quotes?.value===i[p])if(g.valueStarts===void 0)g={},delete a.quotes;else{g.valueEnds=p,g.value=i.slice(g.valueStarts,p),a.attributes.push(g),g={},delete a.quotes;let A;E.dumpLinkHrefsNearby?.enabled&&!r.length&&a.attributes.some(P=>{if(typeof P.name=="string"&&P.name.toLowerCase()==="href")return A=`${E.dumpLinkHrefsNearby?.wrapHeads||""}${P.value}${E.dumpLinkHrefsNearby?.wrapTails||""}`,!0})&&(d={tagName:a.name,hrefValue:A,openingTagEnds:void 0})}else!Oe&&!a.quotes&&a.nameStarts&&(a.quotes={},a.quotes.value=i[p],a.quotes.start=p,a.quotes.next=i.indexOf(i[p],p+1),g.nameStarts&&g.nameEnds&&g.nameEnds<p&&g.nameStarts<p&&!g.valueStarts&&(g.name=i.slice(g.nameStarts,g.nameEnds)));if(a.nameStarts!==void 0&&a.nameEnds===void 0&&(!i[p].trim()||!Kf(i[p]))){if(a.nameEnds=p,a.name=i.slice(a.nameStarts,a.nameEnds+(!F(p)&&i[p]!=="/"&&i[p+1]===void 0?1:0)),i[a.nameStarts-1]!=="!"&&!a.name.replace(/-/g,"").length||/^\d+$/.test(a.name[0])){a={};continue}if(typeof a.name=="string"&&a.name.toLowerCase()==="doctype"&&(Oe=!0),H(p)){W(E);let A=I(i,p,a.leftOuterWhitespace,p,a.lastOpeningBracketAt,p);(E.stripTogetherWithTheirContents.includes(a.name)||E.stripTogetherWithTheirContents.includes("*"))&&(o=o.filter(([P,C])=>!(P===a.leftOuterWhitespace&&C===p))),E.cb({tag:a,deleteFrom:a.leftOuterWhitespace,deleteTo:p,insert:`${A}${m}${A}`,rangesArr:N,proposedReturn:[a.leftOuterWhitespace,p,`${A}${m}${A}`]}),qe(),L(p,E,N)}}if(a.quotes?.start&&a.quotes.start<p&&!a.quotes.end&&g.nameEnds&&g.equalsAt&&!g.valueStarts&&(g.valueStarts=p),!a.quotes&&g.nameEnds&&i[p]==="="&&!g.valueStarts&&!g.equalsAt&&(g.equalsAt=p),!a.quotes&&g.nameStarts&&g.nameEnds&&!g.valueStarts&&i[p].trim()&&i[p]!=="="&&(a.attributes.push(g),g={}),!a.quotes&&g.nameStarts&&!g.nameEnds&&(Oe&&`'"`.includes(i[g.nameStarts])?g.nameStarts<p&&i[p]===i[g.nameStarts]&&(g.nameEnds=p+1,g.name=i.slice(g.nameStarts,g.nameEnds)):i[p].trim()?i[p]==="="?g.equalsAt||(g.nameEnds=p,g.equalsAt=p,g.name=i.slice(g.nameStarts,g.nameEnds)):i[p]==="/"||F(p)?(g.nameEnds=p,g.name=i.slice(g.nameStarts,g.nameEnds),a.attributes.push(g),g={}):H(p)&&(g.nameEnds=p,g.name=i.slice(g.nameStarts,g.nameEnds),a.attributes.push(g),g={}):(g.nameEnds=p,g.name=i.slice(g.nameStarts,g.nameEnds))),!a.quotes&&a.nameEnds<p&&!i[p-1].trim()&&i[p].trim()&&!"<>/!".includes(i[p])&&!g.nameStarts&&!a.lastClosingBracketAt&&(g.nameStarts=p),a.lastOpeningBracketAt!==null&&a.lastOpeningBracketAt<p&&i[p]==="/"&&a.onlyPlausible&&(a.onlyPlausible=!1),a.lastOpeningBracketAt!==null&&a.lastOpeningBracketAt<p&&i[p]!=="/"&&(a.onlyPlausible===void 0&&((!i[p].trim()||H(p))&&!a.slashPresent?a.onlyPlausible=!0:a.onlyPlausible=!1),i[p].trim()&&a.nameStarts===void 0&&!H(p)&&i[p]!=="/"&&!F(p)&&i[p]!=="!"&&(a.nameStarts=p,a.nameContainsLetters=!1)),a.nameStarts&&!a.quotes&&typeof i[p]=="string"&&i[p].toLowerCase()!==i[p].toUpperCase()&&(a.nameContainsLetters=!0),F(p)&&(_o(a,i,p)||a.quotes.value&&typeof a.lastOpeningBracketAt=="number"&&Zf(a.quotes.value,i.slice(a.lastOpeningBracketAt,p))%2===1&&!i.slice(a.lastOpeningBracketAt+1,p).includes("<")&&!i.slice(a.lastOpeningBracketAt+1,p).includes(">"))&&a.lastOpeningBracketAt!==void 0&&(a.lastClosingBracketAt=p,x=null,Object.keys(g).length&&(a.attributes.push(g),g={}),E.dumpLinkHrefsNearby?.enabled&&d.tagName&&!d.openingTagEnds&&(d.openingTagEnds=p)),(!Oe||i[p]===">")&&a.lastOpeningBracketAt!==void 0){if(a.lastClosingBracketAt===void 0){if(a.lastOpeningBracketAt<p&&!H(p)&&(i[p+1]===void 0||H(p+1)&&!a?.quotes?.value)&&a.nameContainsLetters&&typeof a.nameStarts=="number"){if(a.name=i.slice(a.nameStarts,a.nameEnds||p+1).toLowerCase(),(!s.length||s[s.length-1][0]!==a.lastOpeningBracketAt)&&s.push([a.lastOpeningBracketAt,p+1]),E.ignoreTags.includes(a.name)||q(p,E,a)||!Bt.has(a.name)&&(a.onlyPlausible||E.stripRecognisedHTMLOnly)){a={},g={};continue}if((Bt.has(a.name)||_r.has(a.name))&&(a.onlyPlausible===!1||a.onlyPlausible===!0&&a.attributes.length)||i[p+1]===void 0){W(E);let A=I(i,p,a.leftOuterWhitespace,p+1,a.lastOpeningBracketAt,a.lastClosingBracketAt);ke&&a.name==="script"&&a.slashPresent&&(ke=!1);let P;A===null||m===null?P=null:P=`${A}${m}${A}`,E.cb({tag:a,deleteFrom:a.leftOuterWhitespace,deleteTo:p+1,insert:P,rangesArr:N,proposedReturn:[a.leftOuterWhitespace,p+1,P]}),qe(),L(p,E,N)}if(!o.length||o[o.length-1][0]!==a.lastOpeningBracketAt&&o[o.length-1][1]!==p+1)if(E.stripTogetherWithTheirContents.includes(a.name)||E.stripTogetherWithTheirContents.includes("*")){let A;for(let P=r.length;P--;)r[P].name===a.name&&(A=r[P]);A?(o=o.filter(([P])=>P!==A.lastOpeningBracketAt),o.push([A.lastOpeningBracketAt,p+1])):o.push([a.lastOpeningBracketAt,p+1])}else o.push([a.lastOpeningBracketAt,p+1])}}else if(p>a.lastClosingBracketAt&&i[p].trim()||i[p+1]===void 0||E.ignoreIndentations&&`\r
`.includes(i[p])){let A=a.lastClosingBracketAt===p?p+1:p;E.trimOnlySpaces&&A===Z-1&&x!==null&&x<p&&(A=x),(!s.length||s[s.length-1][0]!==a.lastOpeningBracketAt)&&s.push([a.lastOpeningBracketAt,a.lastClosingBracketAt+1]);let P=E.ignoreTags.includes(a.name),C=q(p,E,a);if(!R||E.stripRecognisedHTMLOnly&&typeof a.name=="string"&&!Bt.has(a.name.toLowerCase())&&!_r.has(a.name.toLowerCase())||!ht&&(P||C)||ht&&!E.onlyStripTags.includes(a.name)||E.ignoreTagsWithTheirContents.includes(a.name)){if(C)if(a.slashPresent){for(let k=n.length;k--;)if(n[k].name===a.name){n.splice(k,1);break}n.length||(R=!0)}else R&&(R=!1),n.push(a);E.cb({tag:a,deleteFrom:null,deleteTo:null,insert:null,rangesArr:N,proposedReturn:null}),a={},g={}}else if(!a.onlyPlausible||a.attributes.length===0&&a.name&&(Bt.has(a.name.toLowerCase())||_r.has(a.name.toLowerCase()))||a.attributes?.some(k=>k.equalsAt)){(!o.length||o[o.length-1][0]!==a.lastOpeningBracketAt)&&o.push([a.lastOpeningBracketAt,a.lastClosingBracketAt+1]);let k=I(i,p,a.leftOuterWhitespace,A,a.lastOpeningBracketAt,a.lastClosingBracketAt);m="",y=!1,W(E,A);let z;typeof m=="string"&&m.length?(z=`${k}${m}${k===`

`?`
`:k}`,A===a.lastClosingBracketAt+1&&(!i[A]||!Or.has(i[A]))&&(z+=" "),a.leftOuterWhitespace===a.lastOpeningBracketAt&&N.last()&&N.last()[1]<a.lastOpeningBracketAt&&(!E?.dumpLinkHrefsNearby?.putOnNewLine||!Or.has(i[A]))&&(z=" "+z)):z=k,z!==null&&(a.leftOuterWhitespace===0||!Le(i,A-1))&&(!E.dumpLinkHrefsNearby?.enabled||a.name!=="a")&&(z=void 0);let X=0;if(y&&Or.has(i[A])){E.dumpLinkHrefsNearby?.putOnNewLine&&(z=`${i[A]}${z||""}`);let ut=Le(i,A);ut&&z?.endsWith(`
`)?X+=ut-p:(!ut||ut>p)&&X++}E.cb({tag:a,deleteFrom:a.leftOuterWhitespace,deleteTo:A+X,insert:z,rangesArr:N,proposedReturn:[a.leftOuterWhitespace,A+X,z]}),qe(),L(p,E,N)}else a={};F(p)||(a={})}Oe&&(Oe=!1)}if((!ke||i[p]==="<"&&Le(i,Le(i,p))&&i[Le(i,p)]==="/"&&i.startsWith("script",Le(i,Le(i,p))))&&H(p)&&!H(p-1)&&!`'"`.includes(i[p+1])&&(!`'"`.includes(i[p+2])||/\w/.test(i[p+1]))&&!(i[p+1]==="c"&&i[p+2]===":")&&!(i[p+1]==="f"&&i[p+2]==="m"&&i[p+3]==="t"&&i[p+4]===":")&&!(i[p+1]==="s"&&i[p+2]==="q"&&i[p+3]==="l"&&i[p+4]===":")&&!(i[p+1]==="x"&&i[p+2]===":")&&!(i[p+1]==="f"&&i[p+2]==="n"&&i[p+3]===":")&&_o(a,i,p)){if(F(Le(i,p)))continue;if(a.nameEnds&&a.nameEnds<p&&!a.lastClosingBracketAt&&(a.onlyPlausible===!0&&a.attributes?.length||a.onlyPlausible===!1)){let A=I(i,p,a.leftOuterWhitespace,p,a.lastOpeningBracketAt,p);E.cb({tag:a,deleteFrom:a.leftOuterWhitespace,deleteTo:p,insert:A,rangesArr:N,proposedReturn:[a.leftOuterWhitespace,p,A]}),L(p,E,N),a={},g={}}if(a.lastOpeningBracketAt!==void 0&&a.onlyPlausible&&a.name&&!a.quotes&&(a.lastOpeningBracketAt=void 0,a.name=void 0,a.onlyPlausible=!1),(a.lastOpeningBracketAt===void 0||!a.onlyPlausible)&&!a.quotes&&(a.lastOpeningBracketAt=p,a.slashPresent=!1,a.attributes=[],l===null?a.leftOuterWhitespace=p:E.trimOnlySpaces&&l===0?a.leftOuterWhitespace=u||p:a.leftOuterWhitespace=l,`${i[p+1]}${i[p+2]}${i[p+3]}`=="!--"||`${i[p+1]}${i[p+2]}${i[p+3]}${i[p+4]}${i[p+5]}${i[p+6]}${i[p+7]}${i[p+8]}`=="![CDATA[")){let A=!0;i[p+2]==="-"&&(A=!1);let P;for(let C=p;C<Z;C++)if((!P&&A&&`${i[C-2]}${i[C-1]}${i[C]}`=="]]>"||!A&&`${i[C-2]}${i[C-1]}${i[C]}`=="-->")&&(P=C),P&&(P<C&&i[C].trim()||i[C+1]===void 0)){let k=C;(i[C+1]===void 0&&!i[C].trim()||i[C]===">")&&(k+=1),(!s.length||s[s.length-1][0]!==a.lastOpeningBracketAt)&&s.push([a.lastOpeningBracketAt,P+1]),(!o.length||o[o.length-1][0]!==a.lastOpeningBracketAt)&&o.push([a.lastOpeningBracketAt,P+1]);let z=I(i,C,a.leftOuterWhitespace,k,a.lastOpeningBracketAt,P);E.cb({tag:a,deleteFrom:a.leftOuterWhitespace,deleteTo:k,insert:z,rangesArr:N,proposedReturn:[a.leftOuterWhitespace,k,z]}),p=C-1,i[C]===">"&&(p=C),a={},g={};break}}}!i[p].trim()||i[p].charCodeAt(0)===847?(l===null&&(l=p,a.lastOpeningBracketAt!==void 0&&a.lastOpeningBracketAt<p&&a.nameStarts&&a.nameStarts<a.lastOpeningBracketAt&&p===a.lastOpeningBracketAt+1&&!r.some(A=>A.name===a.name)&&(a.onlyPlausible=!0,a.name=void 0,a.nameStarts=void 0)),(i[p]===`
`||i[p]==="\r")&&(c=p,f&&(f=!1))):(l!==null&&(!a.quotes&&g.equalsAt>l-1&&g.nameEnds&&g.equalsAt>g.nameEnds&&i[p]!=='"'&&i[p]!=="'"&&(cn(g)&&a.attributes.push(g),g={},a.equalsSpottedAt=void 0),l=null),f||(f=!0,R&&!ke&&typeof c=="number"&&p&&c<p-1&&(i.slice(c+1,p).trim()?c=null:E.ignoreIndentations||N.push([c+1,p])))),i[p]===" "?u===null&&(u=p):u!==null&&(u=null),a.name==="script"&&(ke=!a.slashPresent)}if(i&&!E.ignoreIndentations&&(E.trimOnlySpaces&&i[0]===" "||!E.trimOnlySpaces&&!i[0].trim()))for(let p=0;p<Z;p++)if(E.trimOnlySpaces&&i[p]!==" "||!E.trimOnlySpaces&&i[p].trim()){N.push([0,p]);break}else i[p+1]||N.push([0,p+1]);if(i&&(E.trimOnlySpaces&&i[~-i.length]===" "||!E.trimOnlySpaces&&!i[~-i.length].trim())){for(let p=i.length;p--;)if(E.trimOnlySpaces&&i[p]!==" "||!E.trimOnlySpaces&&i[p].trim()){N.push([p+1,Z]);break}}let Re=N.current();if(!e?.cb&&Re&&(Re[0]&&!Re[0][0]&&(Re[0][1],N.ranges[0]=[N.ranges[0][0],N.ranges[0][1]]),Re[Re.length-1]&&Re[Re.length-1][1]===i.length&&(Re[Re.length-1][0],N.ranges))){let p=N.ranges[N.ranges.length-1][0];i[p-1]&&(E.trimOnlySpaces&&i[p-1]===" "||!E.trimOnlySpaces&&!i[p-1].trim())&&(p-=1);let A=N.ranges[N.ranges.length-1][2];N.ranges[N.ranges.length-1]=[p,N.ranges[N.ranges.length-1][1]],A?.trim()&&N.ranges[N.ranges.length-1].push(A.trimEnd())}return{log:{timeTakenInMilliseconds:Date.now()-t},result:Vf(i,N.current()),ranges:N.current(),allTagLocations:s,filteredTagLocations:o}}class Lo{speechSynthesis;speechSynthesisUtterance;currentVoice=null;currentUtterances=[];currentUtteranceIndex=0;playbackState="idle";eventListeners=new Map;voices=[];browserVoices=[];defaultVoice=null;resumeInfinityTimer;isPausedInternal=!1;isSpeakingInternal=!1;initialized=!1;maxLengthExceeded="warn";utterancesBeingCancelled=!1;rate=1;pitch=1;volume=1;features;patches;constructor(){if(this.features=wd(),this.patches=kl(),!this.features.speechSynthesis||!this.features.speechSynthesisUtterance)throw new Error("Web Speech API is not available in this environment");this.speechSynthesis=this.features.speechSynthesis,this.speechSynthesisUtterance=this.features.speechSynthesisUtterance}getRate(){return this.rate}shouldUseResumeInfinity(){const e=this.currentVoice,t=!!(e?.name&&typeof e.name=="string"&&e.name.toLocaleLowerCase().includes("(natural)"));return this.patches.isAndroid!==!0&&!this.patches.isFirefox&&!this.patches.isSafari&&!t}createUtterance(e){return new this.speechSynthesisUtterance(e)}async initialize(e={}){const{maxTimeout:t=1e4,interval:r=10,maxLengthExceeded:n="warn"}=e;if(this.initialized)return!1;this.maxLengthExceeded=n;try{this.browserVoices=await dd(t,r),this.voices=pd(this.browserVoices);const s=fd(this.voices);return this.defaultVoice=s.length>0?s[0]:this.voices[0]||null,this.initialized=!0,!0}catch(s){return console.error("Failed to initialize WebSpeechEngine:",s),this.initialized=!1,!1}}validateText(e){if(new TextEncoder().encode(e).length>4096){const r="Text exceeds max length of 4096 bytes, which may not work with some voices.";switch(this.maxLengthExceeded){case"none":break;case"error":throw new Error(`WebSpeechEngine: ${r}`);case"warn":default:console.warn(`WebSpeechEngine: ${r}`)}}}getCurrentVoiceForUtterance(e){return e&&typeof e=="object"?e:typeof e=="string"?this.voices.find(t=>t.name===e||t.language===e)||null:this.currentVoice||this.defaultVoice}getCurrentVoice(){return this.currentVoice}escapeSSML(e){return e.map(t=>({...t,text:t.ssml?Jl(t.text).result:t.text}))}loadUtterances(e){this.currentUtterances=this.escapeSSML(e),this.currentUtteranceIndex=0,this.setState("ready"),this.emitEvent({type:"ready"})}setVoice(e){const t=this.currentVoice;typeof e=="string"?this.getAvailableVoices().then(r=>{const n=r.find(s=>s.name===e||s.language===e);n?(this.currentVoice=n,t&&t.name!==n.name&&(this.currentUtteranceIndex=0)):console.warn(`Voice "${e}" not found`)}):(this.currentVoice=e,t&&t.name!==e.name&&(this.currentUtteranceIndex=0))}getAvailableVoices(){return new Promise(e=>{this.voices.length>0?e(this.voices):this.initialize().then(()=>{e(this.voices)}).catch(()=>{e([])})})}speak(e){if(e!==void 0){if(e<0||e>=this.currentUtterances.length)throw new Error("Invalid utterance index");this.currentUtteranceIndex=e}if(this.currentUtterances.length===0){console.warn("No utterances loaded");return}this.cancelCurrentSpeech(),this.isSpeakingInternal=!0,this.isPausedInternal=!1,this.setState("playing"),this.emitEvent({type:"start"}),this.stopResumeInfinity(),this.currentUtteranceIndex=e??0,this.currentUtteranceIndex>=this.currentUtterances.length&&(this.currentUtteranceIndex=0),this.speakCurrentUtterance()}cancelCurrentSpeech(){this.patches.isFirefox&&this.speechSynthesis.speaking&&(this.utterancesBeingCancelled=!0,setTimeout(()=>{this.utterancesBeingCancelled=!1},100)),this.speechSynthesis.cancel()}async speakCurrentUtterance(){if(this.currentUtteranceIndex>=this.currentUtterances.length){this.setState("idle"),this.emitEvent({type:"end"});return}const e=this.currentUtterances[this.currentUtteranceIndex],t=(e.ssml,e.text);this.validateText(t);const r=this.createUtterance(t);e.language&&(r.lang=e.language);const n=this.getCurrentVoiceForUtterance(this.currentVoice);if(n){const s=this.browserVoices.find(o=>o.name===n.name&&o.lang===(n.__lang||n.language));s&&(r.voice=s)}r.rate=this.rate,r.pitch=this.pitch,r.volume=this.volume,r.onstart=()=>{this.isSpeakingInternal=!0,this.isPausedInternal=!1,this.setState("playing"),this.emitEvent({type:"start"}),this.shouldUseResumeInfinity()&&this.startResumeInfinity(r)},r.onend=()=>{if(this.utterancesBeingCancelled){this.utterancesBeingCancelled=!1;return}this.playbackState!=="idle"&&(this.isSpeakingInternal=!1,this.isPausedInternal=!1,this.stopResumeInfinity(),this.currentUtteranceIndex>=this.currentUtterances.length-1&&this.setState("idle"),this.emitEvent({type:"end"}))},r.onerror=s=>{this.isSpeakingInternal=!1,this.isPausedInternal=!1,this.stopResumeInfinity(),["synthesis-unavailable","audio-hardware","voice-unavailable"].includes(s.error)&&(console.log("[ENGINE] fatal error detected, resetting index to 0"),this.currentUtteranceIndex=0),this.setState("idle"),this.emitEvent({type:"error",detail:{error:s.error,message:`Speech synthesis error: ${s.error}`}})},r.onpause=()=>{this.isPausedInternal=!0,this.isSpeakingInternal=!1,this.emitEvent({type:"pause"})},r.onresume=()=>{this.isPausedInternal=!1,this.isSpeakingInternal=!0,this.emitEvent({type:"resume"})},r.onboundary=s=>{this.emitEvent({type:"boundary",detail:{charIndex:s.charIndex,charLength:s.charLength,elapsedTime:s.elapsedTime,name:s.name}})},r.onmark=s=>{this.emitEvent({type:"mark",detail:{name:s.name}})},this.speechSynthesis.speak(r)}startResumeInfinity(e){this.shouldUseResumeInfinity()&&(this.resumeInfinityTimer=window.setTimeout(()=>{if(e){const{paused:r,speaking:n}=this.speechSynthesis,s=n||this.isSpeakingInternal,o=r||this.isPausedInternal;s&&!o&&(this.speechSynthesis.pause(),this.speechSynthesis.resume())}this.startResumeInfinity(e)},5e3))}stopResumeInfinity(){this.resumeInfinityTimer&&(clearTimeout(this.resumeInfinityTimer),this.resumeInfinityTimer=void 0)}pause(){if(this.playbackState==="playing"){if(this.patches.isAndroid){this.speechSynthesis.cancel();return}this.speechSynthesis.pause(),this.isPausedInternal=!0,this.isSpeakingInternal=!1,this.setState("paused"),this.emitEvent({type:"pause"})}}resume(){this.playbackState==="paused"&&(this.speechSynthesis.resume(),this.isPausedInternal=!1,this.isSpeakingInternal=!0,this.setState("playing"),this.emitEvent({type:"resume"}))}stop(){this.speechSynthesis.cancel(),this.currentUtteranceIndex=0,this.setState("idle"),this.emitEvent({type:"stop"})}setRate(e){this.rate=Math.max(.1,Math.min(10,e))}setPitch(e){this.pitch=Math.max(0,Math.min(2,e))}setVolume(e){this.volume=Math.max(0,Math.min(1,e))}getState(){return this.playbackState}getCurrentUtteranceIndex(){return this.currentUtteranceIndex}getUtteranceCount(){return this.currentUtterances.length}on(e,t){return this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t),()=>{const r=this.eventListeners.get(e);if(r){const n=r.indexOf(t);n>-1&&r.splice(n,1)}}}emitEvent(e){const t=this.eventListeners.get(e.type);t&&t.forEach(r=>r(e))}setState(e){const t=this.playbackState;if(this.playbackState=e,t!==e)switch(e){case"idle":this.emitEvent({type:"idle"});break;case"loading":this.emitEvent({type:"loading"});break;case"ready":this.emitEvent({type:"ready"});break}}async destroy(){this.stop(),this.stopResumeInfinity(),this.eventListeners.clear(),this.currentUtterances=[],this.currentVoice=null,this.voices=[],this.defaultVoice=null,this.initialized=!1}}class eg{engine;contentQueue=[];eventListeners=new Map;navigatorState="idle";constructor(e){this.engine=e||new Lo,this.setupEngineListeners(),this.initializeEngine()}async initializeEngine(){if(this.engine instanceof Lo)try{await this.engine.initialize({maxTimeout:6e4,interval:10})}catch(e){console.warn("Failed to initialize WebSpeechEngine:",e)}}setupEngineListeners(){this.engine.on("start",()=>{this.setNavigatorState("playing"),this.emitEvent({type:"start"})}),this.engine.on("end",()=>{const e=this.engine.getCurrentUtteranceIndex(),t=this.engine.getUtteranceCount();e<t-1?this.engine.speak(e+1):this.setNavigatorState("idle"),this.emitEvent({type:"end"})}),this.engine.on("pause",()=>{this.setNavigatorState("paused"),this.emitEvent({type:"pause"})}),this.engine.on("resume",()=>{this.setNavigatorState("playing"),this.emitEvent({type:"resume"})}),this.engine.on("error",e=>{this.setNavigatorState("idle"),e.detail.error!=="interrupted"&&e.detail.error!=="canceled"&&this.emitEvent(e)}),this.engine.on("ready",()=>{this.contentQueue.length>0&&(this.setNavigatorState("ready"),this.emitEvent({type:"ready"}))}),this.engine.on("boundary",e=>{this.emitEvent(e)}),this.engine.on("mark",e=>{this.emitEvent(e)}),this.engine.on("voiceschanged",()=>{this.emitEvent({type:"voiceschanged"})})}setNavigatorState(e){this.navigatorState=e}async getVoices(){return this.engine.getAvailableVoices()}async setVoice(e){this.engine.setVoice(e)}getCurrentVoice(){return this.engine.getCurrentVoice()}loadContent(e){const t=Array.isArray(e)?e:[e];this.contentQueue=[...t],this.engine.loadUtterances(t),this.setNavigatorState("ready"),this.emitContentChangeEvent({content:t})}getCurrentContent(){const e=this.getCurrentUtteranceIndex();return e<this.contentQueue.length?this.contentQueue[e]:null}getContentQueue(){return[...this.contentQueue]}getPlaybackRate(){return this.engine.getRate()}getCurrentUtteranceIndex(){return this.engine.getCurrentUtteranceIndex()}async play(){if(this.navigatorState==="paused")this.setNavigatorState("playing"),this.engine.resume();else if(this.navigatorState==="ready"||this.navigatorState==="idle")this.setNavigatorState("playing"),this.engine.speak();else if(this.navigatorState==="playing")return}pause(){this.navigatorState==="playing"&&(this.setNavigatorState("paused"),this.engine.pause())}stop(){this.setNavigatorState("idle"),this.engine.stop(),this.emitEvent({type:"stop"})}async togglePlayPause(){this.navigatorState==="playing"?this.pause():await this.play()}async next(){const e=this.getCurrentUtteranceIndex(),t=this.engine.getUtteranceCount();return e<t-1?(this.engine.speak(e+1),!0):!1}async previous(){const e=this.getCurrentUtteranceIndex();return e>0?(this.engine.speak(e-1),!0):!1}jumpTo(e){e>=0&&e<this.contentQueue.length&&this.engine.speak(e)}setRate(e){this.engine.setRate(e)}setPitch(e){this.engine.setPitch(e)}setVolume(e){this.engine.setVolume(e)}getState(){return this.navigatorState}on(e,t){return this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t),()=>{const r=this.eventListeners.get(e);if(r){const n=r.indexOf(t);n>-1&&r.splice(n,1)}}}emitEvent(e){const t=this.eventListeners.get(e.type);t&&t.forEach(r=>r(e))}emitContentChangeEvent(e){const t=this.eventListeners.get("contentchange");t&&t.forEach(r=>r({type:"contentchange",detail:e}))}async destroy(){this.eventListeners.clear(),await this.engine.destroy()}}let gi=null;function tg(i){if(gi)return gi;function e(t,...r){const n=document.createElement("div");n.style.color=t,n.innerHTML=r.map(s=>{if(typeof s=="string")return s;try{return JSON.stringify(s)}catch{return s}}).join(", "),i.appendChild(n),i.scrollTo(0,i.scrollHeight)}return i.addEventListener("click",()=>{i.style.display="none"}),document.getElementById("open-debug")?.addEventListener("click",()=>{i.style.display="block"}),gi={debug:(...t)=>{},log:(...t)=>{["DEBUG","INFO"].includes("WARN")&&(console.log(...t),e("black",...t))},info:(...t)=>{["DEBUG","INFO"].includes("WARN")&&(console.log(...t),e("black",...t))},warn:(...t)=>{["DEBUG","INFO","WARN"].includes("WARN")&&(console.warn(...t),e("darkorange",...t))},error:(...t)=>{["DEBUG","INFO","WARN","ERROR"].includes("WARN")&&(console.error(...t),e("red",...t))}},gi}function K(i){return`Minified Redux error #${i}; visit https://redux.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}var ig=typeof Symbol=="function"&&Symbol.observable||"@@observable",Io=ig,Rr=()=>Math.random().toString(36).substring(7).split("").join("."),rg={INIT:`@@redux/INIT${Rr()}`,REPLACE:`@@redux/REPLACE${Rr()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Rr()}`},Qi=rg;function ts(i){if(typeof i!="object"||i===null)return!1;let e=i;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e||Object.getPrototypeOf(i)===null}function Kl(i,e,t){if(typeof i!="function")throw new Error(K(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(K(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(K(1));return t(Kl)(i,e)}let r=i,n=e,s=new Map,o=s,a=0,h=!1;function l(){o===s&&(o=new Map,s.forEach((y,x)=>{o.set(x,y)}))}function u(){if(h)throw new Error(K(3));return n}function c(y){if(typeof y!="function")throw new Error(K(4));if(h)throw new Error(K(5));let x=!0;l();const R=a++;return o.set(R,y),function(){if(x){if(h)throw new Error(K(6));x=!1,l(),o.delete(R),s=null}}}function f(y){if(!ts(y))throw new Error(K(7));if(typeof y.type>"u")throw new Error(K(8));if(typeof y.type!="string")throw new Error(K(17));if(h)throw new Error(K(9));try{h=!0,n=r(n,y)}finally{h=!1}return(s=o).forEach(R=>{R()}),y}function g(y){if(typeof y!="function")throw new Error(K(10));r=y,f({type:Qi.REPLACE})}function d(){const y=c;return{subscribe(x){if(typeof x!="object"||x===null)throw new Error(K(11));function R(){const I=x;I.next&&I.next(u())}return R(),{unsubscribe:y(R)}},[Io](){return this}}}return f({type:Qi.INIT}),{dispatch:f,subscribe:c,getState:u,replaceReducer:g,[Io]:d}}function ng(i){Object.keys(i).forEach(e=>{const t=i[e];if(typeof t(void 0,{type:Qi.INIT})>"u")throw new Error(K(12));if(typeof t(void 0,{type:Qi.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(K(13))})}function sg(i){const e=Object.keys(i),t={};for(let s=0;s<e.length;s++){const o=e[s];typeof i[o]=="function"&&(t[o]=i[o])}const r=Object.keys(t);let n;try{ng(t)}catch(s){n=s}return function(o={},a){if(n)throw n;let h=!1;const l={};for(let u=0;u<r.length;u++){const c=r[u],f=t[c],g=o[c],d=f(g,a);if(typeof d>"u")throw a&&a.type,new Error(K(14));l[c]=d,h=h||d!==g}return h=h||r.length!==Object.keys(o).length,h?l:o}}function er(...i){return i.length===0?e=>e:i.length===1?i[0]:i.reduce((e,t)=>(...r)=>e(t(...r)))}function og(...i){return e=>(t,r)=>{const n=e(t,r);let s=()=>{throw new Error(K(15))};const o={getState:n.getState,dispatch:(h,...l)=>s(h,...l)},a=i.map(h=>h(o));return s=er(...a)(n.dispatch),{...n,dispatch:s}}}function ag(i){return ts(i)&&"type"in i&&typeof i.type=="string"}var Zl=Symbol.for("immer-nothing"),No=Symbol.for("immer-draftable"),ge=Symbol.for("immer-state");function Te(i,...e){throw new Error(`[Immer] minified error nr: ${i}. Full error at: https://bit.ly/3cXEKWf`)}var ei=Object.getPrototypeOf;function at(i){return!!i&&!!i[ge]}function He(i){return i?Ql(i)||Array.isArray(i)||!!i[No]||!!i.constructor?.[No]||ai(i)||hr(i):!1}var lg=Object.prototype.constructor.toString(),zo=new WeakMap;function Ql(i){if(!i||typeof i!="object")return!1;const e=Object.getPrototypeOf(i);if(e===null||e===Object.prototype)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(t===Object)return!0;if(typeof t!="function")return!1;let r=zo.get(t);return r===void 0&&(r=Function.toString.call(t),zo.set(t,r)),r===lg}function tr(i,e,t=!0){lr(i)===0?(t?Reflect.ownKeys(i):Object.keys(i)).forEach(n=>{e(n,i[n],i)}):i.forEach((r,n)=>e(n,r,i))}function lr(i){const e=i[ge];return e?e.type_:Array.isArray(i)?1:ai(i)?2:hr(i)?3:0}function pn(i,e){return lr(i)===2?i.has(e):Object.prototype.hasOwnProperty.call(i,e)}function eh(i,e,t){const r=lr(i);r===2?i.set(e,t):r===3?i.add(t):i[e]=t}function hg(i,e){return i===e?i!==0||1/i===1/e:i!==i&&e!==e}function ai(i){return i instanceof Map}function hr(i){return i instanceof Set}function rt(i){return i.copy_||i.base_}function fn(i,e){if(ai(i))return new Map(i);if(hr(i))return new Set(i);if(Array.isArray(i))return Array.prototype.slice.call(i);const t=Ql(i);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(i);delete r[ge];let n=Reflect.ownKeys(r);for(let s=0;s<n.length;s++){const o=n[s],a=r[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(r[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:i[o]})}return Object.create(ei(i),r)}else{const r=ei(i);if(r!==null&&t)return{...i};const n=Object.create(r);return Object.assign(n,i)}}function is(i,e=!1){return cr(i)||at(i)||!He(i)||(lr(i)>1&&Object.defineProperties(i,{set:mi,add:mi,clear:mi,delete:mi}),Object.freeze(i),e&&Object.values(i).forEach(t=>is(t,!0))),i}function cg(){Te(2)}var mi={value:cg};function cr(i){return i===null||typeof i!="object"?!0:Object.isFrozen(i)}var ug={};function lt(i){const e=ug[i];return e||Te(0,i),e}var ti;function th(){return ti}function dg(i,e){return{drafts_:[],parent_:i,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ko(i,e){e&&(lt("Patches"),i.patches_=[],i.inversePatches_=[],i.patchListener_=e)}function gn(i){mn(i),i.drafts_.forEach(pg),i.drafts_=null}function mn(i){i===ti&&(ti=i.parent_)}function Mo(i){return ti=dg(ti,i)}function pg(i){const e=i[ge];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Do(i,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return i!==void 0&&i!==t?(t[ge].modified_&&(gn(e),Te(4)),He(i)&&(i=ir(e,i),e.parent_||rr(e,i)),e.patches_&&lt("Patches").generateReplacementPatches_(t[ge].base_,i,e.patches_,e.inversePatches_)):i=ir(e,t,[]),gn(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),i!==Zl?i:void 0}function ir(i,e,t){if(cr(e))return e;const r=i.immer_.shouldUseStrictIteration(),n=e[ge];if(!n)return tr(e,(s,o)=>Fo(i,n,e,s,o,t),r),e;if(n.scope_!==i)return e;if(!n.modified_)return rr(i,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const s=n.copy_;let o=s,a=!1;n.type_===3&&(o=new Set(s),s.clear(),a=!0),tr(o,(h,l)=>Fo(i,n,s,h,l,t,a),r),rr(i,s,!1),t&&i.patches_&&lt("Patches").generatePatches_(n,t,i.patches_,i.inversePatches_)}return n.copy_}function Fo(i,e,t,r,n,s,o){if(n==null||typeof n!="object"&&!o)return;const a=cr(n);if(!(a&&!o)){if(at(n)){const h=s&&e&&e.type_!==3&&!pn(e.assigned_,r)?s.concat(r):void 0,l=ir(i,n,h);if(eh(t,r,l),at(l))i.canAutoFreeze_=!1;else return}else o&&t.add(n);if(He(n)&&!a){if(!i.immer_.autoFreeze_&&i.unfinalizedDrafts_<1||e&&e.base_&&e.base_[r]===n&&a)return;ir(i,n),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&(ai(t)?t.has(r):Object.prototype.propertyIsEnumerable.call(t,r))&&rr(i,n)}}}function rr(i,e,t=!1){!i.parent_&&i.immer_.autoFreeze_&&i.canAutoFreeze_&&is(e,t)}function fg(i,e){const t=Array.isArray(i),r={type_:t?1:0,scope_:e?e.scope_:th(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:i,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=r,s=rs;t&&(n=[r],s=ii);const{revoke:o,proxy:a}=Proxy.revocable(n,s);return r.draft_=a,r.revoke_=o,a}var rs={get(i,e){if(e===ge)return i;const t=rt(i);if(!pn(t,e))return gg(i,t,e);const r=t[e];return i.finalized_||!He(r)?r:r===Lr(i.base_,e)?(Ir(i),i.copy_[e]=bn(r,i)):r},has(i,e){return e in rt(i)},ownKeys(i){return Reflect.ownKeys(rt(i))},set(i,e,t){const r=ih(rt(i),e);if(r?.set)return r.set.call(i.draft_,t),!0;if(!i.modified_){const n=Lr(rt(i),e),s=n?.[ge];if(s&&s.base_===t)return i.copy_[e]=t,i.assigned_[e]=!1,!0;if(hg(t,n)&&(t!==void 0||pn(i.base_,e)))return!0;Ir(i),yn(i)}return i.copy_[e]===t&&(t!==void 0||e in i.copy_)||Number.isNaN(t)&&Number.isNaN(i.copy_[e])||(i.copy_[e]=t,i.assigned_[e]=!0),!0},deleteProperty(i,e){return Lr(i.base_,e)!==void 0||e in i.base_?(i.assigned_[e]=!1,Ir(i),yn(i)):delete i.assigned_[e],i.copy_&&delete i.copy_[e],!0},getOwnPropertyDescriptor(i,e){const t=rt(i),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:i.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){Te(11)},getPrototypeOf(i){return ei(i.base_)},setPrototypeOf(){Te(12)}},ii={};tr(rs,(i,e)=>{ii[i]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});ii.deleteProperty=function(i,e){return ii.set.call(this,i,e,void 0)};ii.set=function(i,e,t){return rs.set.call(this,i[0],e,t,i[0])};function Lr(i,e){const t=i[ge];return(t?rt(t):i)[e]}function gg(i,e,t){const r=ih(e,t);return r?"value"in r?r.value:r.get?.call(i.draft_):void 0}function ih(i,e){if(!(e in i))return;let t=ei(i);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=ei(t)}}function yn(i){i.modified_||(i.modified_=!0,i.parent_&&yn(i.parent_))}function Ir(i){i.copy_||(i.copy_=fn(i.base_,i.scope_.immer_.useStrictShallowCopy_))}var mg=class{constructor(i){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const s=t;t=e;const o=this;return function(h=s,...l){return o.produce(h,u=>t.call(this,u,...l))}}typeof t!="function"&&Te(6),r!==void 0&&typeof r!="function"&&Te(7);let n;if(He(e)){const s=Mo(this),o=bn(e,void 0);let a=!0;try{n=t(o),a=!1}finally{a?gn(s):mn(s)}return ko(s,r),Do(n,s)}else if(!e||typeof e!="object"){if(n=t(e),n===void 0&&(n=e),n===Zl&&(n=void 0),this.autoFreeze_&&is(n,!0),r){const s=[],o=[];lt("Patches").generateReplacementPatches_(e,n,s,o),r(s,o)}return n}else Te(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,h=>e(h,...a));let r,n;return[this.produce(e,t,(o,a)=>{r=o,n=a}),r,n]},typeof i?.autoFreeze=="boolean"&&this.setAutoFreeze(i.autoFreeze),typeof i?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(i.useStrictShallowCopy),typeof i?.useStrictIteration=="boolean"&&this.setUseStrictIteration(i.useStrictIteration)}createDraft(i){He(i)||Te(8),at(i)&&(i=yg(i));const e=Mo(this),t=bn(i,void 0);return t[ge].isManual_=!0,mn(e),t}finishDraft(i,e){const t=i&&i[ge];(!t||!t.isManual_)&&Te(9);const{scope_:r}=t;return ko(r,e),Do(void 0,r)}setAutoFreeze(i){this.autoFreeze_=i}setUseStrictShallowCopy(i){this.useStrictShallowCopy_=i}setUseStrictIteration(i){this.useStrictIteration_=i}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(i,e){let t;for(t=e.length-1;t>=0;t--){const n=e[t];if(n.path.length===0&&n.op==="replace"){i=n.value;break}}t>-1&&(e=e.slice(t+1));const r=lt("Patches").applyPatches_;return at(i)?r(i,e):this.produce(i,n=>r(n,e))}};function bn(i,e){const t=ai(i)?lt("MapSet").proxyMap_(i,e):hr(i)?lt("MapSet").proxySet_(i,e):fg(i,e);return(e?e.scope_:th()).drafts_.push(t),t}function yg(i){return at(i)||Te(10,i),rh(i)}function rh(i){if(!He(i)||cr(i))return i;const e=i[ge];let t,r=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=fn(i,e.scope_.immer_.useStrictShallowCopy_),r=e.scope_.immer_.shouldUseStrictIteration()}else t=fn(i,!0);return tr(t,(n,s)=>{eh(t,n,rh(s))},r),e&&(e.finalized_=!1),t}var vn=new mg,nh=vn.produce,bg=vn.setUseStrictIteration.bind(vn);function sh(i){return({dispatch:t,getState:r})=>n=>s=>typeof s=="function"?s(t,r,i):n(s)}var vg=sh(),wg=sh,Sg=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?er:er.apply(null,arguments)};function Uo(i,e){function t(...r){if(e){let n=e(...r);if(!n)throw new Error($e(0));return{type:i,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:i,payload:r[0]}}return t.toString=()=>`${i}`,t.type=i,t.match=r=>ag(r)&&r.type===i,t}var oh=class Gt extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Gt.prototype)}static get[Symbol.species](){return Gt}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new Gt(...e[0].concat(this)):new Gt(...e.concat(this))}};function Wo(i){return He(i)?nh(i,()=>{}):i}function yi(i,e,t){return i.has(e)?i.get(e):i.set(e,t(e)).get(e)}function Eg(i){return typeof i=="boolean"}var xg=()=>function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:n=!0,actionCreatorCheck:s=!0}=e??{};let o=new oh;return t&&(Eg(t)?o.push(vg):o.push(wg(t.extraArgument))),o},Tg="RTK_autoBatch",Bo=i=>e=>{setTimeout(e,i)},Ag=(i={type:"raf"})=>e=>(...t)=>{const r=e(...t);let n=!0,s=!1,o=!1;const a=new Set,h=i.type==="tick"?queueMicrotask:i.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Bo(10):i.type==="callback"?i.queueNotification:Bo(i.timeout),l=()=>{o=!1,s&&(s=!1,a.forEach(u=>u()))};return Object.assign({},r,{subscribe(u){const c=()=>n&&u(),f=r.subscribe(c);return a.add(u),()=>{f(),a.delete(u)}},dispatch(u){try{return n=!u?.meta?.[Tg],s=!n,s&&(o||(o=!0,h(l))),r.dispatch(u)}finally{n=!0}}})},Cg=i=>function(t){const{autoBatch:r=!0}=t??{};let n=new oh(i);return r&&n.push(Ag(typeof r=="object"?r:void 0)),n};function Pg(i){const e=xg(),{reducer:t=void 0,middleware:r,devTools:n=!0,preloadedState:s=void 0,enhancers:o=void 0}=i||{};let a;if(typeof t=="function")a=t;else if(ts(t))a=sg(t);else throw new Error($e(1));let h;typeof r=="function"?h=r(e):h=e();let l=er;n&&(l=Sg({trace:!1,...typeof n=="object"&&n}));const u=og(...h),c=Cg(u);let f=typeof o=="function"?o(c):c();const g=l(...f);return Kl(a,s,g)}function ah(i){const e={},t=[];let r;const n={addCase(s,o){const a=typeof s=="string"?s:s.type;if(!a)throw new Error($e(28));if(a in e)throw new Error($e(29));return e[a]=o,n},addAsyncThunk(s,o){return o.pending&&(e[s.pending.type]=o.pending),o.rejected&&(e[s.rejected.type]=o.rejected),o.fulfilled&&(e[s.fulfilled.type]=o.fulfilled),o.settled&&t.push({matcher:s.settled,reducer:o.settled}),n},addMatcher(s,o){return t.push({matcher:s,reducer:o}),n},addDefaultCase(s){return r=s,n}};return i(n),[e,t,r]}bg(!1);function _g(i){return typeof i=="function"}function Og(i,e){let[t,r,n]=ah(e),s;if(_g(i))s=()=>Wo(i());else{const a=Wo(i);s=()=>a}function o(a=s(),h){let l=[t[h.type],...r.filter(({matcher:u})=>u(h)).map(({reducer:u})=>u)];return l.filter(u=>!!u).length===0&&(l=[n]),l.reduce((u,c)=>{if(c)if(at(u)){const g=c(u,h);return g===void 0?u:g}else{if(He(u))return nh(u,f=>c(f,h));{const f=c(u,h);if(f===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return u},a)}return o.getInitialState=s,o}var Rg=Symbol.for("rtk-slice-createasyncthunk");function Lg(i,e){return`${i}/${e}`}function Ig({creators:i}={}){const e=i?.asyncThunk?.[Rg];return function(r){const{name:n,reducerPath:s=n}=r;if(!n)throw new Error($e(11));const o=(typeof r.reducers=="function"?r.reducers(kg()):r.reducers)||{},a=Object.keys(o),h={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},l={addCase(L,I){const W=typeof L=="string"?L:L.type;if(!W)throw new Error($e(12));if(W in h.sliceCaseReducersByType)throw new Error($e(13));return h.sliceCaseReducersByType[W]=I,l},addMatcher(L,I){return h.sliceMatchers.push({matcher:L,reducer:I}),l},exposeAction(L,I){return h.actionCreators[L]=I,l},exposeCaseReducer(L,I){return h.sliceCaseReducersByName[L]=I,l}};a.forEach(L=>{const I=o[L],W={reducerName:L,type:Lg(n,L),createNotation:typeof r.reducers=="function"};Dg(I)?Ug(W,I,l,e):Mg(W,I,l)});function u(){const[L={},I=[],W=void 0]=typeof r.extraReducers=="function"?ah(r.extraReducers):[r.extraReducers],H={...L,...h.sliceCaseReducersByType};return Og(r.initialState,F=>{for(let q in H)F.addCase(q,H[q]);for(let q of h.sliceMatchers)F.addMatcher(q.matcher,q.reducer);for(let q of I)F.addMatcher(q.matcher,q.reducer);W&&F.addDefaultCase(W)})}const c=L=>L,f=new Map,g=new WeakMap;let d;function m(L,I){return d||(d=u()),d(L,I)}function y(){return d||(d=u()),d.getInitialState()}function x(L,I=!1){function W(F){let q=F[L];return typeof q>"u"&&I&&(q=yi(g,W,y)),q}function H(F=c){const q=yi(f,I,()=>new WeakMap);return yi(q,F,()=>{const qe={};for(const[E,ht]of Object.entries(r.selectors??{}))qe[E]=Ng(ht,F,()=>yi(g,F,y),I);return qe})}return{reducerPath:L,getSelectors:H,get selectors(){return H(W)},selectSlice:W}}const R={name:n,reducer:m,actions:h.actionCreators,caseReducers:h.sliceCaseReducersByName,getInitialState:y,...x(s),injectInto(L,{reducerPath:I,...W}={}){const H=I??s;return L.inject({reducerPath:H,reducer:m},W),{...R,...x(H,!0)}}};return R}}function Ng(i,e,t,r){function n(s,...o){let a=e(s);return typeof a>"u"&&r&&(a=t()),i(a,...o)}return n.unwrapped=i,n}var zg=Ig();function kg(){function i(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return i.withTypes=()=>i,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:i}}function Mg({type:i,reducerName:e,createNotation:t},r,n){let s,o;if("reducer"in r){if(t&&!Fg(r))throw new Error($e(17));s=r.reducer,o=r.prepare}else s=r;n.addCase(i,s).exposeCaseReducer(e,s).exposeAction(e,o?Uo(i,o):Uo(i))}function Dg(i){return i._reducerDefinitionType==="asyncThunk"}function Fg(i){return i._reducerDefinitionType==="reducerWithPrepare"}function Ug({type:i,reducerName:e},t,r,n){if(!n)throw new Error($e(18));const{payloadCreator:s,fulfilled:o,pending:a,rejected:h,settled:l,options:u}=t,c=n(i,s,u);r.exposeAction(e,c),o&&r.addCase(c.fulfilled,o),a&&r.addCase(c.pending,a),h&&r.addCase(c.rejected,h),l&&r.addMatcher(c.settled,l),r.exposeCaseReducer(e,{fulfilled:o||bi,pending:a||bi,rejected:h||bi,settled:l||bi})}function bi(){}function $e(i){return`Minified Redux Toolkit error #${i}; visit https://redux-toolkit.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}const Wg={publicationIsLoading:!0,documentTextNodes:[],lastKnownWordPosition:{rangedTextNodeIndex:-1,documentTextNodeChunkIndex:-1,wordCharPos:-1},highlights:[]},lh=zg({name:"readaloudNavigation",initialState:Wg,reducers:{setLastKnownWordPosition(i,{payload:e}){i.lastKnownWordPosition=e},setDocumentTextNodes(i,{payload:e}){i.documentTextNodes=e},setPublicationIsLoading(i,{payload:e}){i.publicationIsLoading=e},setHighlights(i,{payload:e}){i.highlights=e},setSelection(i,{payload:e}){i.selection=e,i.highlights=[]}}}),{setLastKnownWordPosition:ns,setDocumentTextNodes:Bg,setPublicationIsLoading:ft,setHighlights:zi,setSelection:$o}=lh.actions,$g=lh.reducer,D=Pg({reducer:{readaloudNavigation:$g},middleware:i=>i({serializableCheck:!1})}),{isAndroid:Hg}=kl(),G=tg(document.getElementById("debug")),ss=document.getElementById("container");function jg(){const{publicationIsLoading:i,highlights:e,lastKnownWordPosition:t}=D.getState().readaloudNavigation;document.querySelectorAll("#loading-message").forEach(r=>r.style.display=i?"block":"none"),document.querySelectorAll(".word-highlight").forEach(r=>r.remove()),e.forEach(({rect:r,characters:n})=>{const s=document.createElement("div");s.innerHTML=n,s.className="word-highlight",s.style.top=`${r.top}px`,s.style.left=`${r.left}px`,s.style.width=`${r.width}px`,s.style.height=`${r.height}px`,ss.appendChild(s)}),G.debug("rendered",e,t)}D.subscribe(jg);const O=new eg,We=document.getElementById("play-readaloud"),Ho=document.getElementById("rate-percentage"),$t=document.getElementById("rate-slider"),wn="voiceURI";let jo=!1;const vi=document.getElementById("voice-select");async function qg(){if(!jo){jo=!0;try{const i=await O.getVoices();G.warn("CHECK VOICES ",i);const e=i.filter(r=>r.language.startsWith("nl-NL")),t=e.length===0?i:e;if(t.length>0){t.forEach((n,s)=>{const o=document.createElement("option");o.setAttribute("value",`${s}`),n.voiceURI===localStorage.getItem(wn)&&o.setAttribute("selected","selected"),o.innerHTML=`${n.name.replace("Microsoft ","").replace(/\s.*$/,"")}`,G.log(n),vi.appendChild(o)});const r=t.find(n=>n.voiceURI===localStorage.getItem(wn));r?O.setVoice(r):O.setVoice(t[0]),vi.addEventListener("change",n=>{Yg(t[parseInt(n.target.value)])}),document.getElementById("voices-are-pending")?.remove(),t.length===1?vi.setAttribute("disabled","disabled"):vi.removeAttribute("disabled"),We.addEventListener("click",Jg),Ho.addEventListener("click",n=>{$t.value="100",n.target.innerHTML="100%",$t.title="100%",qo(1)}),$t.addEventListener("change",n=>qo(parseFloat(n.target.value)*.01)),$t.addEventListener("input",n=>{Ho.innerHTML=n.target.value+"%",$t.title=n.target.value+"%"}),document.querySelectorAll(".readaloud-control").forEach(n=>{n.style.display="inline-block"})}else document.getElementById("no-voices-found").style.display="inline",document.querySelectorAll(".readaloud-control").forEach(r=>{r.style.display="none"})}catch(i){G.error("Error initializing voices:",i),document.getElementById("no-voices-found").style.display="inline",document.querySelectorAll(".readaloud-control").forEach(e=>{e.style.display="none"})}}}O.on("ready",qg);function Vg(i){document.querySelectorAll("[name='paginate']")?.forEach(e=>e.addEventListener("change",t=>{const r=i.preferencesEditor;t.target.value==="no"!==r.scroll.effectiveValue&&(r.scroll.toggle(),i.submitPreferences(r.preferences))})),Nr(document.getElementById("change-letter-size"),document.getElementById("letter-size-percentage"),i,"Lettergrootte","fontSize"),Nr(document.getElementById("change-line-height"),document.getElementById("line-height-percentage"),i,"Witruimte tussen regels","lineHeight"),Nr(document.getElementById("change-word-spacing"),document.getElementById("word-spacing-percentage"),i,"Witruimte tussen woorden","wordSpacing",0)}function Nr(i,e,t,r,n,s=100){const o=t.preferencesEditor;i.addEventListener("input",()=>{i.title=`${r}: ${i.value}%`,e.innerHTML=`${i.value}%`,o[n].value=parseFloat(i.value)*.01,t.submitPreferences(o.preferences)}),e?.addEventListener("click",()=>{i.value=`${s}`,i.title=`${r}: ${s}%`,e.innerHTML=`${s}%`,o[n].value=s*.01,t.submitPreferences(o.preferences)})}function Gg({x:i,y:e}){const{documentTextNodes:t}=D.getState().readaloudNavigation;for(let r=0;r<t.length;r++){const n=t[r];for(let s=0;s<n.rangedTextNodes.length;s++){const o=n.rangedTextNodes[s],a=hd(i,e,o.textNode);if(a>-1)return{rangedTextNodeIndex:s,documentTextNodeChunkIndex:r,wordCharPos:a}}}return{rangedTextNodeIndex:-1,documentTextNodeChunkIndex:-1,wordCharPos:-1}}function li({rangedTextNodeIndex:i,documentTextNodeChunkIndex:e,wordCharPos:t},r=!1){if(G.debug(`jumping to word at: dtn=${e}, rtn=${i}, wrd=${t}`),e<0)return;if(i<0||t<0){O.jumpTo(e);return}const{documentTextNodes:n}=D.getState().readaloudNavigation,s=n[e],a=s.rangedTextNodes[i].parentStartCharIndex+t,h=s.utteranceStr.substring(a,s.utteranceStr.length-1);D.dispatch(ns({documentTextNodeChunkIndex:e,rangedTextNodeIndex:i,wordCharPos:t})),O.stop(),O.loadContent(n.map((l,u)=>({id:`${u}`,text:u===e?" ".repeat(a)+h:l.utteranceStr}))),r||O.jumpTo(e)}function Xg({x:i,y:e}){G.debug(`Frame clicked at ${i}/${e}`),hh();const t=Gg({x:i,y:e});li(t)}function hh(){const{documentTextNodes:i}=D.getState().readaloudNavigation;O.loadContent([]),O.loadContent(i.map((e,t)=>({id:`${t}`,text:e.utteranceStr})))}function Yg(i){const e=O.getState()==="playing";if(O.stop(),O.setVoice(i),localStorage.setItem(wn,i.voiceURI),e){const{lastKnownWordPosition:t,selection:r}=D.getState().readaloudNavigation;r?O.play():li(t)}}function qo(i){if(i>0&&i<=2){O.setRate(i);const e=O.getState()==="playing";if(O.stop(),e){const{lastKnownWordPosition:t,selection:r}=D.getState().readaloudNavigation;r?O.play():li(t)}}}function Jg(){const{lastKnownWordPosition:i,selection:e}=D.getState().readaloudNavigation;G.debug(`Play button clicked with navigator state: ${O.getState()}`),O.getState()==="playing"?(Hg?O.stop():O.pause(),We.querySelector("img")?.setAttribute("src",Si)):O.getState()==="paused"?O.play():i.documentTextNodeChunkIndex>-1&&(e?O.play():li(i))}function je({type:i,detail:e}){switch(G.debug(`WebSpeechNavigatorEvent state: ${O.getState()}`,`Event type: ${i}`,"details:",e),O.getState()){case"playing":We.removeAttribute("disabled"),We.querySelector("img")?.setAttribute("src",uh);break;case"loading":We.setAttribute("disabled","disabled"),We.querySelector("img")?.setAttribute("src",Si),D.dispatch(zi([]));break;case"ready":case"idle":We.removeAttribute("disabled"),We.querySelector("img")?.setAttribute("src",Si);break;case"paused":default:We.querySelector("img")?.setAttribute("src",Si)}if(i==="end"&&D.dispatch(zi([])),i==="boundary"&&O.getState()==="playing"){const{documentTextNodes:t}=D.getState().readaloudNavigation,{charIndex:r,charLength:n,name:s}=e;if(s!=="word")return;const o=parseInt(O.getCurrentContent().id);let a=-1,h=-1;for(let l=0;l<(t[o]?.rangedTextNodes||[]).length;l++){const u=t[o].rangedTextNodes[l];u.parentStartCharIndex<=r&&(a=l,h=l),a>-1&&u.parentStartCharIndex+u.textNode.textContent.length<=r+n&&(h=l)}if(a>-1){let l=[];for(let u=a;u<=h;u++){const c=t[o].rangedTextNodes[u],f=r-c.parentStartCharIndex,g=r-c.parentStartCharIndex+n,d=f<0?0:f>(c.textNode.textContent||"").length?(c.textNode.textContent||"").length:f,m=g>(c.textNode.textContent||"").length?(c.textNode.textContent||"").length:g,y=new Range;y.setStart(c.textNode,d),y.setEnd(c.textNode,m);for(let x=0;x<y.getClientRects().length;x++){const R=y.getClientRects().item(x);l.push({characters:y.cloneContents().textContent,rect:R})}}D.dispatch(zi(l)),D.dispatch(ns({wordCharPos:r+n-t[o].rangedTextNodes[a].parentStartCharIndex,rangedTextNodeIndex:a,documentTextNodeChunkIndex:o}))}}}O.on("start",je);O.on("end",je);O.on("pause",je);O.on("resume",je);O.on("ready",je);O.on("boundary",je);O.on("mark",je);O.on("voiceschanged",je);O.on("stop",je);function Vo(i){Xg({x:i.x,y:i.y+ss.clientTop})}function wi(i){const e=i.view?.getSelection()?.toString()??"";e.length===0?D.dispatch($o(void 0)):D.dispatch($o(e))}async function Kg(i){const e=`https://www.kbresearch.nl/epub/${i}/manifest.json`,t=new Be({href:"manifest.json"}),r=new Gu(void 0,e),n=r.get(t),s=(await n.link()).toURL(e);await n.readAsJSON().then(async o=>{const a=Yn.deserialize(o);a.setSelfLink(s);const h=new Je({manifest:a,fetcher:r}),l={frameLoaded:function(c){G.debug("--frame loaded---",c)},positionChanged:function(c){D.dispatch(zi([])),console.log(h.readingOrder.items.length),G.info("positionChanged locator=",c);const f=O.getState()==="playing";O.stop();const g=[...document.querySelectorAll("iframe")].filter(d=>d.style.visibility!=="hidden");if(g.length>0){D.dispatch(ft(!1));const d=g[0];d.contentWindow?.removeEventListener("click",Vo),d.contentWindow?.addEventListener("click",Vo),d.contentWindow?.removeEventListener("mouseup",wi),d.contentWindow?.addEventListener("mouseup",wi),d.contentWindow?.removeEventListener("touchend",wi),d.contentWindow?.addEventListener("touchend",wi);const m=d.contentWindow,y=ld(m);D.dispatch(Bg(y)),hh();const x=y.map((R,L)=>R.rangedTextNodes.find(I=>co(m,I.textNode))?L:-1).filter(R=>R>-1);if(x.length>0){const R=y[x[0]].rangedTextNodes.findIndex(I=>co(m,I.textNode)),L=cd(m,y[x[0]].rangedTextNodes[R].textNode);li({documentTextNodeChunkIndex:x[0],rangedTextNodeIndex:R,wordCharPos:L},!f)}else D.dispatch(ns({documentTextNodeChunkIndex:0,wordCharPos:0,rangedTextNodeIndex:0}))}else D.dispatch(ft(!0));u.preferencesEditor.scroll.effectiveValue?(u.canGoForward&&u.isScrollEnd?document.getElementById("next-page").style.visibility="visible":document.getElementById("next-page").style.visibility="hidden",u.canGoBackward&&u.isScrollStart?document.getElementById("previous-page").style.visibility="visible":document.getElementById("previous-page").style.visibility="hidden"):(u.canGoForward?document.getElementById("next-page").style.visibility="visible":document.getElementById("next-page").style.visibility="hidden",u.canGoBackward?document.getElementById("previous-page").style.visibility="visible":document.getElementById("previous-page").style.visibility="hidden")},tap:function(c){return G.debug("tap e=",c),!0},click:function(c){return G.debug("click e=",c),!0},zoom:function(c){G.debug("zoom scale=",c)},miscPointer:function(c){G.debug("miscPointer amount=",c)},scroll:function(c){G.debug("scroll delta=",c)},customEvent:function(c,f){G.debug("customEvent key=",c,"data=",f)},handleLocator:function(c){return G.info("handleLocator locator=",c),!1},textSelected:function(c){G.log("textSelected selection=",c),O.stop(),O.loadContent([{id:"selection",text:c.text}]),O.play()}},u=new kn(ss,h,l);await u.load(),document.getElementById("next-page")?.addEventListener("click",()=>{u.goForward(!0,c=>{c||(document.getElementById("next-page").style.visibility="hidden",D.dispatch(ft(!1)))}),D.dispatch(ft(!0))}),document.getElementById("previous-page")?.addEventListener("click",()=>{u.goBackward(!0,c=>{c||(document.getElementById("previous-page").style.visibility="hidden",D.dispatch(ft(!1)))}),D.dispatch(ft(!0))}),Vg(u)}).catch(o=>{G.error("Error loading manifest",o),alert(`Failed loading manifest ${s}`)})}document.addEventListener("DOMContentLoaded",()=>{const e=`${new URLSearchParams(location.search.replace("?","")).get("boek")}`;e?Kg(e):G.error("Er mist een boek ID")});window.addEventListener("beforeunload",()=>O.stop());
